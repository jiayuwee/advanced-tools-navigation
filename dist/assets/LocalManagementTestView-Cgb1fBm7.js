import{u as e,L as t}from"./localManagement-CIVuO9w4.js";import{d as s,r as a,c as r,o as n,m as o,q as c,C as l,F as i,z as u,H as d,t as m,v as p,u as g,W as f,U as y,aP as v,aQ as w,G as h}from"./vendor-DVQ19h0E.js";import{_ as b}from"./index-BqZfy5yB.js";const k={class:"local-management-test"},L={class:"test-results"},E={class:"test-summary"},S={class:"summary-item"},T={class:"value"},C={class:"summary-item"},I={class:"value success"},U={class:"summary-item"},O={class:"value error"},j={class:"test-list"},P={class:"test-info"},D={class:"test-name"},$={class:"test-description"},_={class:"test-status"},F={key:0,class:"test-error"},M=b(s({__name:"LocalManagementTestView",setup(s){const b=e(),M=a([]),R=a(!1),x=r(()=>M.value.length),Q=r(()=>M.value.filter(e=>"passed"===e.status).length),q=r(()=>M.value.filter(e=>"failed"===e.status).length),z=[{name:"本地存储服务初始化",description:"测试本地存储服务是否正确初始化",test:async()=>{const e=t.getUserPreferences();if(!e||"object"!=typeof e)throw new Error("用户偏好设置初始化失败");return!0}},{name:"添加本地工具",description:"测试添加本地工具功能",test:async()=>{const e=b.addLocalTool({name:"测试工具",description:"这是一个测试工具",url:"https://test.com",icon:"🧪",categoryId:"test-category",tags:["test"],isFeatured:!1,clickCount:0});if(!e||!e.localId)throw new Error("添加本地工具失败");return!0}},{name:"更新本地工具",description:"测试更新本地工具功能",test:async()=>{const e=t.getLocalTools();if(0===e.length)throw new Error("没有可更新的工具");const s=e[0];if(!b.updateLocalTool(s.id||s.localId,{name:"更新后的工具名称"}))throw new Error("更新本地工具失败");return!0}},{name:"删除本地工具",description:"测试删除本地工具功能",test:async()=>{const e=t.getLocalTools();if(0===e.length)throw new Error("没有可删除的工具");const s=e[0];if(!b.deleteLocalTool(s.id||s.localId))throw new Error("删除本地工具失败");return!0}},{name:"用户偏好设置",description:"测试用户偏好设置的保存和读取",test:async()=>{const e=t.getUserPreferences();b.updateUserPreferences({theme:"dark",autoSync:!1});const s=t.getUserPreferences();if("dark"!==s.theme||!1!==s.autoSync)throw new Error("用户偏好设置更新失败");return b.updateUserPreferences(e),!0}},{name:"离线队列管理",description:"测试离线操作队列的管理",test:async()=>{const e=t.getOfflineQueue().length;b.addLocalTool({name:"队列测试工具",description:"测试离线队列",url:"https://queue-test.com",icon:"📋",categoryId:"test",tags:[],isFeatured:!1,clickCount:0});if(t.getOfflineQueue().length<=e)throw new Error("离线队列未正确更新");return!0}},{name:"存储使用情况",description:"测试存储使用情况的计算",test:async()=>{const e=t.getStorageInfo();if(!e||"number"!=typeof e.used||"number"!=typeof e.total)throw new Error("存储使用情况计算失败");if(e.percentage<0||e.percentage>100)throw new Error("存储使用百分比计算错误");return!0}},{name:"数据导出功能",description:"测试本地数据导出功能",test:async()=>{try{const e={tools:t.getLocalTools(),categories:t.getLocalCategories(),preferences:t.getUserPreferences(),exportTime:(new Date).toISOString()},s=JSON.stringify(e,null,2);if(!s||s.length<10)throw new Error("导出数据为空或格式错误");return!0}catch(e){throw new Error(`数据导出失败: ${e}`)}}}],J=async()=>{if(!R.value){R.value=!0;for(let t=0;t<z.length;t++){const s=z[t],a=M.value[t];a.status="running",a.error=void 0;const r=Date.now();try{await s.test(),a.status="passed",a.duration=Date.now()-r}catch(e){a.status="failed",a.error=e instanceof Error?e.message:String(e),a.duration=Date.now()-r}await new Promise(e=>setTimeout(e,100))}R.value=!1}},N=()=>{confirm("确定要清空所有测试数据吗？")&&(t.clearAllLocalData(),b.initialize(),alert("测试数据已清空"))},A=()=>{for(let e=1;e<=3;e++)b.addLocalTool({name:`测试工具 ${e}`,description:`这是第 ${e} 个测试工具`,url:`https://test-tool-${e}.com`,icon:"🔧",categoryId:"test-category",tags:["test",`tool${e}`],isFeatured:1===e,clickCount:Math.floor(100*Math.random())});alert("测试数据已生成")},B=()=>{const e={summary:{total:x.value,passed:Q.value,failed:q.value,timestamp:(new Date).toISOString()},tests:M.value},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`test-results-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)};return n(()=>{M.value=z.map(e=>({name:e.name,description:e.description,status:"pending"}))}),(e,t)=>(h(),o("div",k,[c("div",{class:"test-header"},[t[0]||(t[0]=c("h2",null,"本地管理功能测试",-1)),c("button",{class:"btn primary",onClick:J},"运行所有测试")]),c("div",L,[c("div",E,[c("div",S,[t[1]||(t[1]=c("span",{class:"label"},"总测试数:",-1)),c("span",T,l(x.value),1)]),c("div",C,[t[2]||(t[2]=c("span",{class:"label"},"通过:",-1)),c("span",I,l(Q.value),1)]),c("div",U,[t[3]||(t[3]=c("span",{class:"label"},"失败:",-1)),c("span",O,l(q.value),1)])]),c("div",j,[(h(!0),o(i,null,u(M.value,e=>(h(),o("div",{key:e.name,class:d(["test-item",{success:"passed"===e.status,error:"failed"===e.status,running:"running"===e.status}])},[c("div",P,[c("div",D,l(e.name),1),c("div",$,l(e.description),1)]),c("div",_,["passed"===e.status?(h(),p(g(f),{key:0,class:"icon success"})):"failed"===e.status?(h(),p(g(y),{key:1,class:"icon error"})):"running"===e.status?(h(),p(g(v),{key:2,class:"icon spinning"})):(h(),p(g(w),{key:3,class:"icon pending"}))]),e.error?(h(),o("div",F,l(e.error),1)):m("",!0)],2))),128))])]),c("div",{class:"test-actions"},[c("button",{class:"btn secondary",onClick:N},"清空测试数据"),c("button",{class:"btn secondary",onClick:A},"生成测试数据"),c("button",{class:"btn secondary",onClick:B},"导出测试结果")])]))}}),[["__scopeId","data-v-2567861d"]]);export{M as default};
