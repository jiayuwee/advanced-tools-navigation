import{d as e,r as a,c as l,o as s,_ as n,aI as o,X as t,aJ as c,ax as i,aG as r,aH as d,as as u,aB as p,am as f,av as v,a8 as g,aK as m,aL as y,aM as h,t as b,v as I,x as C,J as T,E as w,A as k,y as S,Y as M,F as x,B as O,C as D,G as L,H as P,L as U,D as V,z as B,I as A}from"./vendor-BUZxw6e1.js";import{u as E}from"./localManagement-DWH7U7jI.js";import{_}from"./index-BxdVNC7e.js";const F={class:"local-management-view"},W={class:"page-header"},j={class:"header-content"},z={class:"status-indicators"},H={key:0,class:"status-item pending"},G={class:"header-actions"},X=["disabled"],J=["disabled"],K={class:"stats-grid"},N={class:"stat-card"},R={class:"stat-icon"},Y={class:"stat-content"},$={class:"stat-value"},q={class:"stat-card"},Q={class:"stat-icon"},Z={class:"stat-content"},ee={class:"stat-value"},ae={class:"stat-card"},le={class:"stat-icon"},se={class:"stat-content"},ne={class:"stat-value"},oe={class:"stat-card"},te={class:"stat-icon"},ce={class:"stat-content"},ie={class:"stat-value"},re={class:"content-grid"},de={class:"content-section"},ue={class:"section-header"},pe={class:"tools-list"},fe={class:"tool-info"},ve={class:"tool-icon"},ge={class:"tool-details"},me={class:"tool-meta"},ye={class:"modified-time"},he={class:"tool-actions"},be=["onClick"],Ie=["onClick"],Ce={key:0,class:"empty-state"},Te={class:"content-section"},we={class:"preferences-form"},ke={class:"form-group"},Se={class:"form-group"},Me={class:"form-group"},xe={class:"checkbox-label"},Oe={class:"form-group"},De={class:"checkbox-label"},Le={class:"content-section"},Pe={class:"data-actions"},Ue={class:"storage-usage"},Ve={class:"usage-header"},Be={class:"usage-bar"},Ae={class:"usage-details"},Ee={class:"modal-header"},_e={class:"modal-body"},Fe={class:"form-group"},We={class:"form-group"},je={class:"form-group"},ze={class:"form-group"},He={class:"modal-footer"},Ge=["disabled"],Xe={key:1,class:"error-toast"};const Je=_(e({__name:"LocalManagementView",setup(e,{expose:b}){b();const I=E(),C=a(!1),T=a(),w=a({name:"",description:"",url:"",icon:"🔧"}),{isOfflineMode:k,isSyncing:S,syncError:M,lastSyncTime:x,userPreferences:O,localTools:D,localCategories:L,pendingSyncCount:P,storageInfo:U,isOnline:V}=I,B=l({get:()=>O.value,set:e=>I.updateUserPreferences(e)}),A=l(()=>{if(!x.value)return"从未同步";return new Date(x.value).toLocaleString("zh-CN")}),_=()=>{C.value=!1,w.value={name:"",description:"",url:"",icon:"🔧"}};s(()=>{I.initialize()}),n(()=>{window.removeEventListener("online",()=>{}),window.removeEventListener("offline",()=>{})});const F={localStore:I,showAddToolModal:C,fileInput:T,newTool:w,isOfflineMode:k,isSyncing:S,syncError:M,lastSyncTime:x,userPreferences:O,localTools:D,localCategories:L,pendingSyncCount:P,storageInfo:U,isOnline:V,preferences:B,formatLastSync:A,handleSync:async()=>{try{await I.forceSyncData()}catch(e){console.error("同步失败:",e)}},toggleOfflineMode:()=>{I.toggleOfflineMode()},updatePreferences:()=>{I.updateUserPreferences(B.value)},addTool:()=>{try{I.addLocalTool({name:w.value.name,description:w.value.description,url:w.value.url,icon:w.value.icon,categoryId:"",tags:[],isFeatured:!1,clickCount:0}),_()}catch(e){console.error("添加工具失败:",e)}},editTool:e=>{console.log("编辑工具:",e)},deleteTool:e=>{confirm("确定要删除这个工具吗？")&&I.deleteLocalTool(e.id||e.localId)},closeAddToolModal:_,exportData:()=>{I.exportLocalData()},triggerImport:()=>{var e;null==(e=T.value)||e.click()},handleImport:async e=>{var a;const l=null==(a=e.target.files)?void 0:a[0];if(l)try{await I.importLocalData(l)}catch(s){console.error("导入失败:",s)}},confirmClearData:()=>{confirm("确定要清空所有本地数据吗？此操作不可恢复。")&&I.clearLocalData()},getSyncStatusText:e=>({pending:"待同步",synced:"已同步",conflict:"冲突"}[e||"synced"]||"未知"),formatTime:e=>e?new Date(e).toLocaleString("zh-CN"):"",formatBytes:e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]},get WifiIcon(){return h},get WifiOffIcon(){return y},get RefreshCwIcon(){return m},get ClockIcon(){return g},get WrenchIcon(){return v},get FolderIcon(){return f},get HardDriveIcon(){return p},get PlusIcon(){return u},get EditIcon(){return d},get TrashIcon(){return r},get DownloadIcon(){return i},get UploadIcon(){return c},get XIcon(){return t},get AlertCircleIcon(){return o}};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),[["render",function(e,a,l,s,n,o){return A(),b("div",F,[I("div",W,[I("div",j,[a[12]||(a[12]=I("h2",{class:"page-title"},"本地管理",-1)),I("div",z,[I("div",{class:T(["status-item",{online:s.isOnline,offline:!s.isOnline}])},[a[11]||(a[11]=I("div",{class:"status-dot"},null,-1)),I("span",null,w(s.isOnline?"在线":"离线"),1)],2),s.pendingSyncCount>0?(A(),b("div",H,[k(s.ClockIcon,{class:"icon"}),I("span",null,w(s.pendingSyncCount)+" 项待同步",1)])):C("",!0)])]),I("div",G,[I("button",{class:"btn secondary",disabled:s.isSyncing,onClick:s.toggleOfflineMode},[s.isOfflineMode?(A(),S(s.WifiIcon,{key:1,class:"icon"})):(A(),S(s.WifiOffIcon,{key:0,class:"icon"})),M(" "+w(s.isOfflineMode?"启用在线模式":"启用离线模式"),1)],8,X),I("button",{class:"btn primary",disabled:!s.isOnline||s.isSyncing||0===s.pendingSyncCount,onClick:s.handleSync},[k(s.RefreshCwIcon,{class:T(["icon",{spinning:s.isSyncing}])},null,8,["class"]),M(" "+w(s.isSyncing?"同步中...":"立即同步"),1)],8,J)])]),I("div",K,[I("div",N,[I("div",R,[k(s.WrenchIcon,{class:"icon"})]),I("div",Y,[I("div",$,w(s.localTools.length),1),a[13]||(a[13]=I("div",{class:"stat-label"},"本地工具",-1))])]),I("div",q,[I("div",Q,[k(s.FolderIcon,{class:"icon"})]),I("div",Z,[I("div",ee,w(s.localCategories.length),1),a[14]||(a[14]=I("div",{class:"stat-label"},"本地分类",-1))])]),I("div",ae,[I("div",le,[k(s.HardDriveIcon,{class:"icon"})]),I("div",se,[I("div",ne,w(s.formatBytes(s.storageInfo.used)),1),a[15]||(a[15]=I("div",{class:"stat-label"},"存储使用",-1))])]),I("div",oe,[I("div",te,[k(s.ClockIcon,{class:"icon"})]),I("div",ce,[I("div",ie,w(s.formatLastSync),1),a[16]||(a[16]=I("div",{class:"stat-label"},"最后同步",-1))])])]),I("div",re,[I("div",de,[I("div",ue,[a[18]||(a[18]=I("h3",null,"本地工具",-1)),I("button",{class:"btn small primary",onClick:a[0]||(a[0]=e=>s.showAddToolModal=!0)},[k(s.PlusIcon,{class:"icon"}),a[17]||(a[17]=M(" 添加工具 "))])]),I("div",pe,[(A(!0),b(x,null,O(s.localTools,e=>(A(),b("div",{key:e.localId||e.id,class:T(["tool-item",{pending:"pending"===e.syncStatus}])},[I("div",fe,[I("div",ve,w(e.icon||"🔧"),1),I("div",ge,[I("h4",null,w(e.name),1),I("p",null,w(e.description),1),I("div",me,[I("span",{class:T(["sync-status",e.syncStatus])},w(s.getSyncStatusText(e.syncStatus)),3),I("span",ye,w(s.formatTime(e.lastModified)),1)])])]),I("div",he,[I("button",{class:"btn small secondary",onClick:a=>s.editTool(e)},[k(s.EditIcon,{class:"icon"})],8,be),I("button",{class:"btn small danger",onClick:a=>s.deleteTool(e)},[k(s.TrashIcon,{class:"icon"})],8,Ie)])],2))),128)),0===s.localTools.length?(A(),b("div",Ce,[k(s.WrenchIcon,{class:"empty-icon"}),a[19]||(a[19]=I("p",null,"暂无本地工具",-1))])):C("",!0)])]),I("div",Te,[a[26]||(a[26]=I("div",{class:"section-header"},[I("h3",null,"偏好设置")],-1)),I("div",we,[I("div",ke,[a[21]||(a[21]=I("label",null,"主题",-1)),D(I("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>s.preferences.theme=e),onChange:s.updatePreferences},a[20]||(a[20]=[I("option",{value:"auto"},"自动",-1),I("option",{value:"light"},"浅色",-1),I("option",{value:"dark"},"深色",-1)]),544),[[L,s.preferences.theme]])]),I("div",Se,[a[23]||(a[23]=I("label",null,"默认视图",-1)),D(I("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>s.preferences.defaultView=e),onChange:s.updatePreferences},a[22]||(a[22]=[I("option",{value:"grid"},"网格",-1),I("option",{value:"list"},"列表",-1)]),544),[[L,s.preferences.defaultView]])]),I("div",Me,[I("label",xe,[D(I("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>s.preferences.autoSync=e),type:"checkbox",onChange:s.updatePreferences},null,544),[[P,s.preferences.autoSync]]),a[24]||(a[24]=I("span",null,"自动同步",-1))])]),I("div",Oe,[I("label",De,[D(I("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>s.preferences.sidebarCollapsed=e),type:"checkbox",onChange:s.updatePreferences},null,544),[[P,s.preferences.sidebarCollapsed]]),a[25]||(a[25]=I("span",null,"折叠侧边栏",-1))])])])]),I("div",Le,[a[31]||(a[31]=I("div",{class:"section-header"},[I("h3",null,"数据管理")],-1)),I("div",Pe,[I("button",{class:"btn secondary full-width",onClick:s.exportData},[k(s.DownloadIcon,{class:"icon"}),a[27]||(a[27]=M(" 导出本地数据 "))]),I("button",{class:"btn secondary full-width",onClick:s.triggerImport},[k(s.UploadIcon,{class:"icon"}),a[28]||(a[28]=M(" 导入本地数据 "))]),I("input",{ref:"fileInput",type:"file",accept:".json",style:{display:"none"},onChange:s.handleImport},null,544),I("button",{class:"btn danger full-width",onClick:s.confirmClearData},[k(s.TrashIcon,{class:"icon"}),a[29]||(a[29]=M(" 清空本地数据 "))])]),I("div",Ue,[I("div",Ve,[a[30]||(a[30]=I("span",null,"存储使用情况",-1)),I("span",null,w(s.storageInfo.percentage.toFixed(1))+"%",1)]),I("div",Be,[I("div",{class:"usage-fill",style:U({width:`${Math.min(s.storageInfo.percentage,100)}%`})},null,4)]),I("div",Ae,[I("span",null,w(s.formatBytes(s.storageInfo.used))+" / "+w(s.formatBytes(s.storageInfo.total)),1)])])])]),s.showAddToolModal?(A(),b("div",{key:0,class:"modal-overlay",onClick:s.closeAddToolModal},[I("div",{class:"modal-content",onClick:a[9]||(a[9]=B(()=>{},["stop"]))},[I("div",Ee,[a[32]||(a[32]=I("h3",null,"添加本地工具",-1)),I("button",{class:"close-btn",onClick:s.closeAddToolModal},[k(s.XIcon,{class:"icon"})])]),I("div",_e,[I("div",Fe,[a[33]||(a[33]=I("label",null,"工具名称",-1)),D(I("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>s.newTool.name=e),type:"text",placeholder:"输入工具名称"},null,512),[[V,s.newTool.name]])]),I("div",We,[a[34]||(a[34]=I("label",null,"工具描述",-1)),D(I("textarea",{"onUpdate:modelValue":a[6]||(a[6]=e=>s.newTool.description=e),placeholder:"输入工具描述"},null,512),[[V,s.newTool.description]])]),I("div",je,[a[35]||(a[35]=I("label",null,"工具链接",-1)),D(I("input",{"onUpdate:modelValue":a[7]||(a[7]=e=>s.newTool.url=e),type:"url",placeholder:"https://example.com"},null,512),[[V,s.newTool.url]])]),I("div",ze,[a[36]||(a[36]=I("label",null,"工具图标",-1)),D(I("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>s.newTool.icon=e),type:"text",placeholder:"🔧"},null,512),[[V,s.newTool.icon]])])]),I("div",He,[I("button",{class:"btn secondary",onClick:s.closeAddToolModal},"取消"),I("button",{class:"btn primary",disabled:!s.newTool.name,onClick:s.addTool}," 添加 ",8,Ge)])])])):C("",!0),s.syncError?(A(),b("div",Xe,[k(s.AlertCircleIcon,{class:"icon"}),I("span",null,w(s.syncError),1),I("button",{onClick:a[10]||(a[10]=e=>s.syncError=null)},[k(s.XIcon,{class:"icon"})])])):C("",!0)])}],["__scopeId","data-v-ae5b187e"],["__file","/mnt/persist/workspace/src/views/admin/LocalManagementView.vue"]]);export{Je as default};
