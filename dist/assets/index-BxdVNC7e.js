const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./EnhancedHomeView-DCMv1pAq.js","./vendor-BUZxw6e1.js","./EnhancedHomeView-xxn3eL22.css","./HomeView-CuRrGP94.js","./HomeView-C8n0uPRx.css","./ComparisonView-DCp_pQNB.js","./ComparisonView-i4iSG5MY.css","./ToolsView-D6Ct8FFh.js","./ToolsView-CQM78QKS.css","./ProductsView-C_5bxQIX.js","./ProductsView-DHJNfujn.css","./ProductDetailView-DQEVupRP.js","./ProductDetailView-DD-AMH6Y.css","./UserView-DaUZAuRx.js","./UserView-CESQHG86.css","./ProfileView-OZRHXzQZ.js","./ProfileView-Ccbz3f-T.css","./FavoritesView-Dlz--qF8.js","./FavoritesView-D-xBCJtF.css","./OrdersView-DBciq1MA.js","./OrdersView-J_-wR6RE.css","./AuthView-DzPh3Lkn.js","./AuthView-ClPTLx_d.css","./LoginView-BEpiVcH3.js","./LoginView-_zevxqMM.css","./RegisterView-BL3MJKcj.js","./RegisterView-M6h8fk_l.css","./ForgotPasswordView-CJ15alYq.js","./ForgotPasswordView-Ck-kSxwb.css","./AdminView-Doj9Rcmm.js","./AdminView-Cx2CM8X1.css","./DashboardView-Bk2-lAeS.js","./DashboardView-kz3b66AL.css","./AdminToolsView-Cx0SwiKZ.js","./AdminToolsView-BtmzLlXs.css","./ProductsManageView-ii6B1tO1.js","./ProductsManageView-CX4sFgF-.css","./LocalManagementView-udbKvIY6.js","./localManagement-DWH7U7jI.js","./LocalManagementView-DgVR0y5l.css","./LocalManagementTestView-xgSX56gD.js","./LocalManagementTestView-ajVYZoGR.css","./PaymentView-Dn3dsliZ.js","./PaymentView-CQM1C4QW.css","./PaymentSuccessView-DgHIHj_w.js","./PaymentSuccessView-DZ1pqX7H.css","./PaymentCancelView-cS1bBruu.js","./PaymentCancelView-BHQZEzbp.css","./NotFoundView-CEZAFZKm.js","./NotFoundView-fPZJ7R-b.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,r,s)=>((t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s)(t,"symbol"!=typeof r?r+"":r,s);import{s as r,d as s,u as n,a as o,i,c as a,p as l,r as c,w as u,h as d,b as h,g as f,n as p,e as m,f as g,j as v,o as y,k as b,l as _,m as w,S as k,M as S,q as T,X as E,t as P,v as C,x as j,y as O,z as A,A as I,F as x,B as $,C as R,D as L,E as U,G as D,H as N,I as q,J as M,K as B,L as V,N as F,O as z,P as W,Q as J,R as K,T as G,U as H,V as Y,W as X,Y as Q,Z,_ as ee,$ as te,a0 as re,a1 as se,a2 as ne,a3 as oe,a4 as ie,a5 as ae,a6 as le,a7 as ce,a8 as ue,a9 as de,aa as he,ab as fe,ac as pe,ad as me,ae as ge,af as ve,ag as ye,ah as be,ai as _e,aj as we}from"./vendor-BUZxw6e1.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();
/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */
const ke="undefined"!=typeof document;function Se(e){return"object"==typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}const Te=Object.assign;function Ee(e,t){const r={};for(const s in t){const n=t[s];r[s]=Ce(n)?n.map(e):e(n)}return r}const Pe=()=>{},Ce=Array.isArray;function je(e){const t=Array.from(arguments).slice(1);console.warn.apply(console,["[Vue Router warn]: "+e].concat(t))}const Oe=/#/g,Ae=/&/g,Ie=/\//g,xe=/=/g,$e=/\?/g,Re=/\+/g,Le=/%5B/g,Ue=/%5D/g,De=/%5E/g,Ne=/%60/g,qe=/%7B/g,Me=/%7C/g,Be=/%7D/g,Ve=/%20/g;function Fe(e){return encodeURI(""+e).replace(Me,"|").replace(Le,"[").replace(Ue,"]")}function ze(e){return Fe(e).replace(Re,"%2B").replace(Ve,"+").replace(Oe,"%23").replace(Ae,"%26").replace(Ne,"`").replace(qe,"{").replace(Be,"}").replace(De,"^")}function We(e){return ze(e).replace(xe,"%3D")}function Je(e){return null==e?"":function(e){return Fe(e).replace(Oe,"%23").replace($e,"%3F")}(e).replace(Ie,"%2F")}function Ke(e){try{return decodeURIComponent(""+e)}catch(t){je(`Error decoding "${e}". Using original value`)}return""+e}const Ge=/\/$/;function He(e,t,r="/"){let s,n={},o="",i="";const a=t.indexOf("#");let l=t.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(s=t.slice(0,l),o=t.slice(l+1,a>-1?a:t.length),n=e(o)),a>-1&&(s=s||t.slice(0,a),i=t.slice(a,t.length)),s=function(e,t){if(e.startsWith("/"))return e;if(!t.startsWith("/"))return je(`Cannot resolve a relative location without an absolute path. Trying to resolve "${e}" from "${t}". It should look like "/${t}".`),e;if(!e)return t;const r=t.split("/"),s=e.split("/"),n=s[s.length-1];".."!==n&&"."!==n||s.push("");let o,i,a=r.length-1;for(o=0;o<s.length;o++)if(i=s[o],"."!==i){if(".."!==i)break;a>1&&a--}return r.slice(0,a).join("/")+"/"+s.slice(o).join("/")}(null!=s?s:t,r),{fullPath:s+(o&&"?")+o+i,path:s,query:n,hash:Ke(i)}}function Ye(e,t){return t&&e.toLowerCase().startsWith(t.toLowerCase())?e.slice(t.length)||"/":e}function Xe(e,t,r){const s=t.matched.length-1,n=r.matched.length-1;return s>-1&&s===n&&Qe(t.matched[s],r.matched[n])&&Ze(t.params,r.params)&&e(t.query)===e(r.query)&&t.hash===r.hash}function Qe(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function Ze(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!et(e[r],t[r]))return!1;return!0}function et(e,t){return Ce(e)?tt(e,t):Ce(t)?tt(t,e):e===t}function tt(e,t){return Ce(t)?e.length===t.length&&e.every((e,r)=>e===t[r]):1===e.length&&e[0]===t}const rt={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var st,nt,ot,it;function at(e){if(!e)if(ke){const t=document.querySelector("base");e=(e=t&&t.getAttribute("href")||"/").replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),e.replace(Ge,"")}(nt=st||(st={})).pop="pop",nt.push="push",(it=ot||(ot={})).back="back",it.forward="forward",it.unknown="";const lt=/^[^#]+#/;function ct(e,t){return e.replace(lt,"#")+t}const ut=()=>({left:window.scrollX,top:window.scrollY});function dt(e){let t;if("el"in e){const s=e.el,n="string"==typeof s&&s.startsWith("#");if(!("string"!=typeof e.el||n&&document.getElementById(e.el.slice(1))))try{const t=document.querySelector(e.el);if(n&&t)return void je(`The selector "${e.el}" should be passed as "el: document.querySelector('${e.el}')" because it starts with "#".`)}catch(r){return void je(`The selector "${e.el}" is invalid. If you are using an id selector, make sure to escape it. You can find more information about escaping characters in selectors at https://mathiasbynens.be/notes/css-escapes or use CSS.escape (https://developer.mozilla.org/en-US/docs/Web/API/CSS/escape).`)}const o="string"==typeof s?n?document.getElementById(s.slice(1)):document.querySelector(s):s;if(!o)return void je(`Couldn't find element using selector "${e.el}" returned by scrollBehavior.`);t=function(e,t){const r=document.documentElement.getBoundingClientRect(),s=e.getBoundingClientRect();return{behavior:t.behavior,left:s.left-r.left-(t.left||0),top:s.top-r.top-(t.top||0)}}(o,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.scrollX,null!=t.top?t.top:window.scrollY)}function ht(e,t){return(history.state?history.state.position-t:-1)+e}const ft=new Map;function pt(e,t){const{pathname:r,search:s,hash:n}=t,o=e.indexOf("#");if(o>-1){let t=n.includes(e.slice(o))?e.slice(o).length:1,r=n.slice(t);return"/"!==r[0]&&(r="/"+r),Ye(r,"")}return Ye(r,e)+s+n}function mt(e,t,r,s=!1,n=!1){return{back:e,current:t,forward:r,replaced:s,position:window.history.length,scroll:n?ut():null}}function gt(e){const{history:t,location:r}=window,s={value:pt(e,r)},n={value:t.state};function o(s,o,i){const a=e.indexOf("#"),l=a>-1?(r.host&&document.querySelector("base")?e:e.slice(a))+s:location.protocol+"//"+location.host+e+s;try{t[i?"replaceState":"pushState"](o,"",l),n.value=o}catch(c){je("Error with push/replace State",c),r[i?"replace":"assign"](l)}}return n.value||o(s.value,{back:null,current:s.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:s,state:n,push:function(e,r){const i=Te({},n.value,t.state,{forward:e,scroll:ut()});t.state||je("history.state seems to have been manually replaced without preserving the necessary values. Make sure to preserve existing history state if you are manually calling history.replaceState:\n\nhistory.replaceState(history.state, '', url)\n\nYou can find more information at https://router.vuejs.org/guide/migration/#Usage-of-history-state"),o(i.current,i,!0),o(e,Te({},mt(s.value,e,null),{position:i.position+1},r),!1),s.value=e},replace:function(e,r){o(e,Te({},t.state,mt(n.value.back,e,n.value.forward,!0),r,{position:n.value.position}),!0),s.value=e}}}function vt(e){return"string"==typeof e||e&&"object"==typeof e}function yt(e){return"string"==typeof e||"symbol"==typeof e}const bt=Symbol("navigation failure");var _t,wt;(wt=_t||(_t={}))[wt.aborted=4]="aborted",wt[wt.cancelled=8]="cancelled",wt[wt.duplicated=16]="duplicated";const kt={1:({location:e,currentLocation:t})=>`No match for\n ${JSON.stringify(e)}${t?"\nwhile being at\n"+JSON.stringify(t):""}`,2:({from:e,to:t})=>`Redirected from "${e.fullPath}" to "${function(e){if("string"==typeof e)return e;if(null!=e.path)return e.path;const t={};for(const r of Et)r in e&&(t[r]=e[r]);return JSON.stringify(t,null,2)}(t)}" via a navigation guard.`,4:({from:e,to:t})=>`Navigation aborted from "${e.fullPath}" to "${t.fullPath}" via a navigation guard.`,8:({from:e,to:t})=>`Navigation cancelled from "${e.fullPath}" to "${t.fullPath}" with a new navigation.`,16:({from:e,to:t})=>`Avoided redundant navigation to current location: "${e.fullPath}".`};function St(e,t){return Te(new Error(kt[e](t)),{type:e,[bt]:!0},t)}function Tt(e,t){return e instanceof Error&&bt in e&&(null==t||!!(e.type&t))}const Et=["params","query","hash"];const Pt="[^/]+?",Ct={sensitive:!1,strict:!1,start:!0,end:!0},jt=/[.+*?^${}()[\]/\\]/g;function Ot(e,t){let r=0;for(;r<e.length&&r<t.length;){const s=t[r]-e[r];if(s)return s;r++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function At(e,t){let r=0;const s=e.score,n=t.score;for(;r<s.length&&r<n.length;){const e=Ot(s[r],n[r]);if(e)return e;r++}if(1===Math.abs(n.length-s.length)){if(It(s))return 1;if(It(n))return-1}return n.length-s.length}function It(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const xt={type:0,value:""},$t=/[a-zA-Z0-9_]/;function Rt(e,t,r){const s=function(e,t){const r=Te({},Ct,t),s=[];let n=r.start?"^":"";const o=[];for(const l of e){const e=l.length?[]:[90];r.strict&&!l.length&&(n+="/");for(let t=0;t<l.length;t++){const s=l[t];let i=40+(r.sensitive?.25:0);if(0===s.type)t||(n+="/"),n+=s.value.replace(jt,"\\$&"),i+=40;else if(1===s.type){const{value:e,repeatable:r,optional:c,regexp:u}=s;o.push({name:e,repeatable:r,optional:c});const d=u||Pt;if(d!==Pt){i+=10;try{new RegExp(`(${d})`)}catch(a){throw new Error(`Invalid custom RegExp for param "${e}" (${d}): `+a.message)}}let h=r?`((?:${d})(?:/(?:${d}))*)`:`(${d})`;t||(h=c&&l.length<2?`(?:/${h})`:"/"+h),c&&(h+="?"),n+=h,i+=20,c&&(i+=-8),r&&(i+=-20),".*"===d&&(i+=-50)}e.push(i)}s.push(e)}if(r.strict&&r.end){const e=s.length-1;s[e][s[e].length-1]+=.7000000000000001}r.strict||(n+="/?"),r.end?n+="$":r.strict&&!n.endsWith("/")&&(n+="(?:/|$)");const i=new RegExp(n,r.sensitive?"":"i");return{re:i,score:s,keys:o,parse:function(e){const t=e.match(i),r={};if(!t)return null;for(let s=1;s<t.length;s++){const e=t[s]||"",n=o[s-1];r[n.name]=e&&n.repeatable?e.split("/"):e}return r},stringify:function(t){let r="",s=!1;for(const n of e){s&&r.endsWith("/")||(r+="/"),s=!1;for(const e of n)if(0===e.type)r+=e.value;else if(1===e.type){const{value:o,repeatable:i,optional:a}=e,l=o in t?t[o]:"";if(Ce(l)&&!i)throw new Error(`Provided param "${o}" is an array but it is not repeatable (* or + modifiers)`);const c=Ce(l)?l.join("/"):l;if(!c){if(!a)throw new Error(`Missing required param "${o}"`);n.length<2&&(r.endsWith("/")?r=r.slice(0,-1):s=!0)}r+=c}}return r||"/"}}}(function(e){if(!e)return[[]];if("/"===e)return[[xt]];if(!e.startsWith("/"))throw new Error(`Route paths should start with a "/": "${e}" should be "/${e}".`);function t(e){throw new Error(`ERR (${r})/"${c}": ${e}`)}let r=0,s=r;const n=[];let o;function i(){o&&n.push(o),o=[]}let a,l=0,c="",u="";function d(){c&&(0===r?o.push({type:0,value:c}):1===r||2===r||3===r?(o.length>1&&("*"===a||"+"===a)&&t(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:c,regexp:u,repeatable:"*"===a||"+"===a,optional:"*"===a||"?"===a})):t("Invalid state to consume buffer"),c="")}function h(){c+=a}for(;l<e.length;)if(a=e[l++],"\\"!==a||2===r)switch(r){case 0:"/"===a?(c&&d(),i()):":"===a?(d(),r=1):h();break;case 4:h(),r=s;break;case 1:"("===a?r=2:$t.test(a)?h():(d(),r=0,"*"!==a&&"?"!==a&&"+"!==a&&l--);break;case 2:")"===a?"\\"==u[u.length-1]?u=u.slice(0,-1)+a:r=3:u+=a;break;case 3:d(),r=0,"*"!==a&&"?"!==a&&"+"!==a&&l--,u="";break;default:t("Unknown state")}else s=r,r=4;return 2===r&&t(`Unfinished custom RegExp for param "${c}"`),d(),i(),n}(e.path),r);{const t=new Set;for(const r of s.keys)t.has(r.name)&&je(`Found duplicated params with name "${r.name}" for path "${e.path}". Only the last one will be available on "$route.params".`),t.add(r.name)}const n=Te(s,{record:e,parent:t,children:[],alias:[]});return t&&!n.record.aliasOf==!t.record.aliasOf&&t.children.push(n),n}function Lt(e,t){const r=[],s=new Map;function n(e,r,s){const a=!s,l=Dt(e);!function(e,t){t&&t.record.name&&!e.name&&!e.path&&je(`The route named "${String(t.record.name)}" has a child without a name and an empty path. Using that name won't render the empty path child so you probably want to move the name to the child instead. If this is intentional, add a name to the child route to remove the warning.`)}(l,r),l.aliasOf=s&&s.record;const c=Bt(t,e),u=[l];if("alias"in e){const t="string"==typeof e.alias?[e.alias]:e.alias;for(const e of t)u.push(Dt(Te({},l,{components:s?s.record.components:l.components,path:e,aliasOf:s?s.record:l})))}let d,h;for(const t of u){const{path:u}=t;if(r&&"/"!==u[0]){const e=r.record.path,s="/"===e[e.length-1]?"":"/";t.path=r.record.path+(u&&s+u)}if("*"===t.path)throw new Error('Catch all routes ("*") must now be defined using a param with a custom regexp.\nSee more at https://router.vuejs.org/guide/migration/#Removed-star-or-catch-all-routes.');if(d=Rt(t,r,c),r&&"/"===u[0]&&Wt(d,r),s?(s.alias.push(d),Ft(s,d)):(h=h||d,h!==d&&h.alias.push(d),a&&e.name&&!qt(d)&&(zt(e,r),o(e.name))),Jt(d)&&i(d),l.children){const e=l.children;for(let t=0;t<e.length;t++)n(e[t],d,s&&s.children[t])}s=s||d}return h?()=>{o(h)}:Pe}function o(e){if(yt(e)){const t=s.get(e);t&&(s.delete(e),r.splice(r.indexOf(t),1),t.children.forEach(o),t.alias.forEach(o))}else{const t=r.indexOf(e);t>-1&&(r.splice(t,1),e.record.name&&s.delete(e.record.name),e.children.forEach(o),e.alias.forEach(o))}}function i(e){const t=function(e,t){let r=0,s=t.length;for(;r!==s;){const n=r+s>>1;At(e,t[n])<0?s=n:r=n+1}const n=function(e){let t=e;for(;t=t.parent;)if(Jt(t)&&0===At(e,t))return t;return}(e);n&&(s=t.lastIndexOf(n,s-1),s<0&&je(`Finding ancestor route "${n.record.path}" failed for "${e.record.path}"`));return s}(e,r);r.splice(t,0,e),e.record.name&&!qt(e)&&s.set(e.record.name,e)}return t=Bt({strict:!1,end:!0,sensitive:!1},t),e.forEach(e=>n(e)),{addRoute:n,resolve:function(e,t){let n,o,i,a={};if("name"in e&&e.name){if(n=s.get(e.name),!n)throw St(1,{location:e});{const t=Object.keys(e.params||{}).filter(e=>!n.keys.find(t=>t.name===e));t.length&&je(`Discarded invalid param(s) "${t.join('", "')}" when navigating. See https://github.com/vuejs/router/blob/main/packages/router/CHANGELOG.md#414-2022-08-22 for more details.`)}i=n.record.name,a=Te(Ut(t.params,n.keys.filter(e=>!e.optional).concat(n.parent?n.parent.keys.filter(e=>e.optional):[]).map(e=>e.name)),e.params&&Ut(e.params,n.keys.map(e=>e.name))),o=n.stringify(a)}else if(null!=e.path)o=e.path,o.startsWith("/")||je(`The Matcher cannot resolve relative paths but received "${o}". Unless you directly called \`matcher.resolve("${o}")\`, this is probably a bug in vue-router. Please open an issue at https://github.com/vuejs/router/issues/new/choose.`),n=r.find(e=>e.re.test(o)),n&&(a=n.parse(o),i=n.record.name);else{if(n=t.name?s.get(t.name):r.find(e=>e.re.test(t.path)),!n)throw St(1,{location:e,currentLocation:t});i=n.record.name,a=Te({},t.params,e.params),o=n.stringify(a)}const l=[];let c=n;for(;c;)l.unshift(c.record),c=c.parent;return{name:i,path:o,params:a,matched:l,meta:Mt(l)}},removeRoute:o,clearRoutes:function(){r.length=0,s.clear()},getRoutes:function(){return r},getRecordMatcher:function(e){return s.get(e)}}}function Ut(e,t){const r={};for(const s of t)s in e&&(r[s]=e[s]);return r}function Dt(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:Nt(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function Nt(e){const t={},r=e.props||!1;if("component"in e)t.default=r;else for(const s in e.components)t[s]="object"==typeof r?r[s]:r;return t}function qt(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function Mt(e){return e.reduce((e,t)=>Te(e,t.meta),{})}function Bt(e,t){const r={};for(const s in e)r[s]=s in t?t[s]:e[s];return r}function Vt(e,t){return e.name===t.name&&e.optional===t.optional&&e.repeatable===t.repeatable}function Ft(e,t){for(const r of e.keys)if(!r.optional&&!t.keys.find(Vt.bind(null,r)))return je(`Alias "${t.record.path}" and the original record: "${e.record.path}" must have the exact same param named "${r.name}"`);for(const r of t.keys)if(!r.optional&&!e.keys.find(Vt.bind(null,r)))return je(`Alias "${t.record.path}" and the original record: "${e.record.path}" must have the exact same param named "${r.name}"`)}function zt(e,t){for(let r=t;r;r=r.parent)if(r.record.name===e.name)throw new Error(`A route named "${String(e.name)}" has been added as a ${t===r?"child":"descendant"} of a route with the same name. Route names must be unique and a nested route cannot use the same name as an ancestor.`)}function Wt(e,t){for(const r of t.keys)if(!e.keys.find(Vt.bind(null,r)))return je(`Absolute path "${e.record.path}" must have the exact same param named "${r.name}" as its parent "${t.record.path}".`)}function Jt({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function Kt(e){const t={};if(""===e||"?"===e)return t;const r=("?"===e[0]?e.slice(1):e).split("&");for(let s=0;s<r.length;++s){const e=r[s].replace(Re," "),n=e.indexOf("="),o=Ke(n<0?e:e.slice(0,n)),i=n<0?null:Ke(e.slice(n+1));if(o in t){let e=t[o];Ce(e)||(e=t[o]=[e]),e.push(i)}else t[o]=i}return t}function Gt(e){let t="";for(let r in e){const s=e[r];if(r=We(r),null==s){void 0!==s&&(t+=(t.length?"&":"")+r);continue}(Ce(s)?s.map(e=>e&&ze(e)):[s&&ze(s)]).forEach(e=>{void 0!==e&&(t+=(t.length?"&":"")+r,null!=e&&(t+="="+e))})}return t}function Ht(e){const t={};for(const r in e){const s=e[r];void 0!==s&&(t[r]=Ce(s)?s.map(e=>null==e?null:""+e):null==s?s:""+s)}return t}const Yt=Symbol("router view location matched"),Xt=Symbol("router view depth"),Qt=Symbol("router"),Zt=Symbol("route location"),er=Symbol("router view location");function tr(){let e=[];return{add:function(t){return e.push(t),()=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)}},list:()=>e.slice(),reset:function(){e=[]}}}function rr(e,t,r,s,n,o=e=>e()){const i=s&&(s.enterCallbacks[n]=s.enterCallbacks[n]||[]);return()=>new Promise((a,l)=>{const c=e=>{!1===e?l(St(4,{from:r,to:t})):e instanceof Error?l(e):vt(e)?l(St(2,{from:t,to:e})):(i&&s.enterCallbacks[n]===i&&"function"==typeof e&&i.push(e),a())},u=o(()=>e.call(s&&s.instances[n],t,r,function(e,t,r){let s=0;return function(){1===s++&&je(`The "next" callback was called more than once in one navigation guard when going from "${r.fullPath}" to "${t.fullPath}". It should be called exactly one time in each navigation guard. This will fail in production.`),e._called=!0,1===s&&e.apply(null,arguments)}}(c,t,r)));let d=Promise.resolve(u);if(e.length<3&&(d=d.then(c)),e.length>2){const t=`The "next" callback was never called inside of ${e.name?'"'+e.name+'"':""}:\n${e.toString()}\n. If you are returning a value instead of calling "next", make sure to remove the "next" parameter from your function.`;if("object"==typeof u&&"then"in u)d=d.then(e=>c._called?e:(je(t),Promise.reject(new Error("Invalid navigation guard"))));else if(void 0!==u&&!c._called)return je(t),void l(new Error("Invalid navigation guard"))}d.catch(e=>l(e))})}function sr(e,t,r,s,n=e=>e()){const o=[];for(const i of e){i.components||i.children.length||je(`Record with path "${i.path}" is either missing a "component(s)" or "children" property.`);for(const e in i.components){let a=i.components[e];if(!a||"object"!=typeof a&&"function"!=typeof a)throw je(`Component "${e}" in record with path "${i.path}" is not a valid component. Received "${String(a)}".`),new Error("Invalid route component");if("then"in a){je(`Component "${e}" in record with path "${i.path}" is a Promise instead of a function that returns a Promise. Did you write "import('./MyPage.vue')" instead of "() => import('./MyPage.vue')" ? This will break in production if not fixed.`);const t=a;a=()=>t}else a.__asyncLoader&&!a.__warnedDefineAsync&&(a.__warnedDefineAsync=!0,je(`Component "${e}" in record with path "${i.path}" is defined using "defineAsyncComponent()". Write "() => import('./MyPage.vue')" instead of "defineAsyncComponent(() => import('./MyPage.vue'))".`));if("beforeRouteEnter"===t||i.instances[e])if(Se(a)){const l=(a.__vccOpts||a)[t];l&&o.push(rr(l,r,s,i,e,n))}else{let l=a();"catch"in l||(je(`Component "${e}" in record with path "${i.path}" is a function that does not return a Promise. If you were passing a functional component, make sure to add a "displayName" to the component. This will break in production if not fixed.`),l=Promise.resolve(l)),o.push(()=>l.then(o=>{if(!o)throw new Error(`Couldn't resolve component "${e}" at "${i.path}"`);const a=(l=o).__esModule||"Module"===l[Symbol.toStringTag]||l.default&&Se(l.default)?o.default:o;var l;i.mods[e]=o,i.components[e]=a;const c=(a.__vccOpts||a)[t];return c&&rr(c,r,s,i,e,n)()}))}}}return o}function nr(e){const t=i(Qt),r=i(Zt);let s=!1,o=null;const l=a(()=>{const r=n(e.to);return s&&r===o||(vt(r)||(s?je('Invalid value for prop "to" in useLink()\n- to:',r,"\n- previous to:",o,"\n- props:",e):je('Invalid value for prop "to" in useLink()\n- to:',r,"\n- props:",e)),o=r,s=!0),t.resolve(r)}),c=a(()=>{const{matched:e}=l.value,{length:t}=e,s=e[t-1],n=r.matched;if(!s||!n.length)return-1;const o=n.findIndex(Qe.bind(null,s));if(o>-1)return o;const i=ar(e[t-2]);return t>1&&ar(s)===i&&n[n.length-1].path!==i?n.findIndex(Qe.bind(null,e[t-2])):o}),u=a(()=>c.value>-1&&function(e,t){for(const r in t){const s=t[r],n=e[r];if("string"==typeof s){if(s!==n)return!1}else if(!Ce(n)||n.length!==s.length||s.some((e,t)=>e!==n[t]))return!1}return!0}(r.params,l.value.params)),d=a(()=>c.value>-1&&c.value===r.matched.length-1&&Ze(r.params,l.value.params));if(ke){const t=f();if(t){const r={route:l.value,isActive:u.value,isExactActive:d.value,error:null};t.__vrl_devtools=t.__vrl_devtools||[],t.__vrl_devtools.push(r),g(()=>{r.route=l.value,r.isActive=u.value,r.isExactActive=d.value,r.error=vt(n(e.to))?null:'Invalid "to" value'},{flush:"post"})}}return{route:l,href:a(()=>l.value.href),isActive:u,isExactActive:d,navigate:function(r={}){if(function(e){if(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)return;if(e.defaultPrevented)return;if(void 0!==e.button&&0!==e.button)return;if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}e.preventDefault&&e.preventDefault();return!0}(r)){const r=t[n(e.replace)?"replace":"push"](n(e.to)).catch(Pe);return e.viewTransition&&"undefined"!=typeof document&&"startViewTransition"in document&&document.startViewTransition(()=>r),r}return Promise.resolve()}}}const or=s({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:nr,setup(e,{slots:t}){const r=m(nr(e)),{options:s}=i(Qt),n=a(()=>({[lr(e.activeClass,s.linkActiveClass,"router-link-active")]:r.isActive,[lr(e.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive}));return()=>{const s=t.default&&(1===(o=t.default(r)).length?o[0]:o);var o;return e.custom?s:d("a",{"aria-current":r.isExactActive?e.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:n.value},s)}}}),ir=or;function ar(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const lr=(e,t,r)=>null!=e?e:null!=t?t:r;function cr(e,t){if(!e)return null;const r=e(t);return 1===r.length?r[0]:r}const ur=s({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:r}){!function(){const e=f(),t=e.parent&&e.parent.type.name,r=e.parent&&e.parent.subTree&&e.parent.subTree.type;if(t&&("KeepAlive"===t||t.includes("Transition"))&&"object"==typeof r&&"RouterView"===r.name){const e="KeepAlive"===t?"keep-alive":"transition";je(`<router-view> can no longer be used directly inside <transition> or <keep-alive>.\nUse slot props instead:\n\n<router-view v-slot="{ Component }">\n  <${e}>\n    <component :is="Component" />\n  </${e}>\n</router-view>`)}}();const s=i(er),o=a(()=>e.route||s.value),h=i(Xt,0),p=a(()=>{let e=n(h);const{matched:t}=o.value;let r;for(;(r=t[e])&&!r.components;)e++;return e}),m=a(()=>o.value.matched[p.value]);l(Xt,a(()=>p.value+1)),l(Yt,m),l(er,o);const g=c();return u(()=>[g.value,m.value,e.name],([e,t,r],[s,n,o])=>{t&&(t.instances[r]=e,n&&n!==t&&e&&e===s&&(t.leaveGuards.size||(t.leaveGuards=n.leaveGuards),t.updateGuards.size||(t.updateGuards=n.updateGuards))),!e||!t||n&&Qe(t,n)&&s||(t.enterCallbacks[r]||[]).forEach(t=>t(e))},{flush:"post"}),()=>{const s=o.value,n=e.name,i=m.value,a=i&&i.components[n];if(!a)return cr(r.default,{Component:a,route:s});const l=i.props[n],c=l?!0===l?s.params:"function"==typeof l?l(s):l:null,u=d(a,Te({},c,t,{onVnodeUnmounted:e=>{e.component.isUnmounted&&(i.instances[n]=null)},ref:g}));if(ke&&u.ref){const e={depth:p.value,name:i.name,path:i.path,meta:i.meta};(Ce(u.ref)?u.ref.map(e=>e.i):[u.ref.i]).forEach(t=>{t.__vrv_devtools=e})}return cr(r.default,{Component:u,route:s})||u}}});function dr(e,t){const r=Te({},e,{matched:e.matched.map(e=>function(e,t){const r={};for(const s in e)t.includes(s)||(r[s]=e[s]);return r}(e,["instances","children","aliasOf"]))});return{_custom:{type:null,readOnly:!0,display:e.fullPath,tooltip:t,value:r}}}function hr(e){return{_custom:{display:e}}}let fr=0;function pr(e,t,r){if(t.__hasDevtools)return;t.__hasDevtools=!0;const s=fr++;h({id:"org.vuejs.router"+(s?"."+s:""),label:"Vue Router",packageName:"vue-router",homepage:"https://router.vuejs.org",logo:"https://router.vuejs.org/logo.png",componentStateTypes:["Routing"],app:e},n=>{"function"!=typeof n.now&&console.warn("[Vue Router]: You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html."),n.on.inspectComponent((e,r)=>{e.instanceData&&e.instanceData.state.push({type:"Routing",key:"$route",editable:!1,value:dr(t.currentRoute.value,"Current Route")})}),n.on.visitComponentTree(({treeNode:e,componentInstance:t})=>{if(t.__vrv_devtools){const r=t.__vrv_devtools;e.tags.push({label:(r.name?`${r.name.toString()}: `:"")+r.path,textColor:0,tooltip:"This component is rendered by &lt;router-view&gt;",backgroundColor:gr})}Ce(t.__vrl_devtools)&&(t.__devtoolsApi=n,t.__vrl_devtools.forEach(t=>{let r=t.route.path,s=_r,n="",o=0;t.error?(r=t.error,s=kr,o=Sr):t.isExactActive?(s=yr,n="This is exactly active"):t.isActive&&(s=vr,n="This link is active"),e.tags.push({label:r,textColor:o,tooltip:n,backgroundColor:s})}))}),u(t.currentRoute,()=>{l(),n.notifyComponentUpdate(),n.sendInspectorTree(a),n.sendInspectorState(a)});const o="router:navigations:"+s;n.addTimelineLayer({id:o,label:`Router${s?" "+s:""} Navigations`,color:4237508}),t.onError((e,t)=>{n.addTimelineEvent({layerId:o,event:{title:"Error during Navigation",subtitle:t.fullPath,logType:"error",time:n.now(),data:{error:e},groupId:t.meta.__navigationId}})});let i=0;t.beforeEach((e,t)=>{const r={guard:hr("beforeEach"),from:dr(t,"Current Location during this navigation"),to:dr(e,"Target location")};Object.defineProperty(e.meta,"__navigationId",{value:i++}),n.addTimelineEvent({layerId:o,event:{time:n.now(),title:"Start of navigation",subtitle:e.fullPath,data:r,groupId:e.meta.__navigationId}})}),t.afterEach((e,t,r)=>{const s={guard:hr("afterEach")};r?(s.failure={_custom:{type:Error,readOnly:!0,display:r?r.message:"",tooltip:"Navigation Failure",value:r}},s.status=hr("❌")):s.status=hr("✅"),s.from=dr(t,"Current Location during this navigation"),s.to=dr(e,"Target location"),n.addTimelineEvent({layerId:o,event:{title:"End of navigation",subtitle:e.fullPath,time:n.now(),data:s,logType:r?"warning":"default",groupId:e.meta.__navigationId}})});const a="router-inspector:"+s;function l(){if(!c)return;const e=c;let s=r.getRoutes().filter(e=>!e.parent||!e.parent.record.components);s.forEach(jr),e.filter&&(s=s.filter(t=>Or(t,e.filter.toLowerCase()))),s.forEach(e=>Cr(e,t.currentRoute.value)),e.rootNodes=s.map(Tr)}let c;n.addInspector({id:a,label:"Routes"+(s?" "+s:""),icon:"book",treeFilterPlaceholder:"Search routes"}),n.on.getInspectorTree(t=>{c=t,t.app===e&&t.inspectorId===a&&l()}),n.on.getInspectorState(t=>{if(t.app===e&&t.inspectorId===a){const e=r.getRoutes().find(e=>e.record.__vd_id===t.nodeId);e&&(t.state={options:mr(e)})}}),n.sendInspectorTree(a),n.sendInspectorState(a)})}function mr(e){const{record:t}=e,r=[{editable:!1,key:"path",value:t.path}];return null!=t.name&&r.push({editable:!1,key:"name",value:t.name}),r.push({editable:!1,key:"regexp",value:e.re}),e.keys.length&&r.push({editable:!1,key:"keys",value:{_custom:{type:null,readOnly:!0,display:e.keys.map(e=>`${e.name}${function(e){return e.optional?e.repeatable?"*":"?":e.repeatable?"+":""}(e)}`).join(" "),tooltip:"Param keys",value:e.keys}}}),null!=t.redirect&&r.push({editable:!1,key:"redirect",value:t.redirect}),e.alias.length&&r.push({editable:!1,key:"aliases",value:e.alias.map(e=>e.record.path)}),Object.keys(e.record.meta).length&&r.push({editable:!1,key:"meta",value:e.record.meta}),r.push({key:"score",editable:!1,value:{_custom:{type:null,readOnly:!0,display:e.score.map(e=>e.join(", ")).join(" | "),tooltip:"Score used to sort routes",value:e.score}}}),r}const gr=15485081,vr=2450411,yr=8702998,br=2282478,_r=16486972,wr=6710886,kr=16704226,Sr=12131356;function Tr(e){const t=[],{record:r}=e;null!=r.name&&t.push({label:String(r.name),textColor:0,backgroundColor:br}),r.aliasOf&&t.push({label:"alias",textColor:0,backgroundColor:_r}),e.__vd_match&&t.push({label:"matches",textColor:0,backgroundColor:gr}),e.__vd_exactActive&&t.push({label:"exact",textColor:0,backgroundColor:yr}),e.__vd_active&&t.push({label:"active",textColor:0,backgroundColor:vr}),r.redirect&&t.push({label:"string"==typeof r.redirect?`redirect: ${r.redirect}`:"redirects",textColor:16777215,backgroundColor:wr});let s=r.__vd_id;return null==s&&(s=String(Er++),r.__vd_id=s),{id:s,label:r.path,tags:t,children:e.children.map(Tr)}}let Er=0;const Pr=/^\/(.*)\/([a-z]*)$/;function Cr(e,t){const r=t.matched.length&&Qe(t.matched[t.matched.length-1],e.record);e.__vd_exactActive=e.__vd_active=r,r||(e.__vd_active=t.matched.some(t=>Qe(t,e.record))),e.children.forEach(e=>Cr(e,t))}function jr(e){e.__vd_match=!1,e.children.forEach(jr)}function Or(e,t){const r=String(e.re).match(Pr);if(e.__vd_match=!1,!r||r.length<3)return!1;if(new RegExp(r[1].replace(/\$$/,""),r[2]).test(t))return e.children.forEach(e=>Or(e,t)),("/"!==e.record.path||"/"===t)&&(e.__vd_match=e.re.test(t),!0);const s=e.record.path.toLowerCase(),n=Ke(s);return!(t.startsWith("/")||!n.includes(t)&&!s.includes(t))||(!(!n.startsWith(t)&&!s.startsWith(t))||(!(!e.record.name||!String(e.record.name).includes(t))||e.children.some(e=>Or(e,t))))}function Ar(){return i(Qt)}function Ir(e){return i(Zt)}const xr={},$r=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),o=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));s=Promise.allSettled(t.map(t=>{if(t=function(e,t){return new URL(e,t).href}(t,r),t in xr)return;xr[t]=!0;const s=t.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(!!r)for(let r=e.length-1;r>=0;r--){const n=e[r];if(n.href===t&&(!s||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${t}"]${n}`))return;const i=document.createElement("link");return i.rel=s?"stylesheet":"modulepreload",s||(i.as="script"),i.crossOrigin="",i.href=t,o&&i.setAttribute("nonce",o),document.head.appendChild(i),s?new Promise((e,r)=>{i.addEventListener("load",e),i.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};class Rr extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Lr extends Rr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ur extends Rr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Dr extends Rr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Nr,qr;(qr=Nr||(Nr={})).Any="any",qr.ApNortheast1="ap-northeast-1",qr.ApNortheast2="ap-northeast-2",qr.ApSouth1="ap-south-1",qr.ApSoutheast1="ap-southeast-1",qr.ApSoutheast2="ap-southeast-2",qr.CaCentral1="ca-central-1",qr.EuCentral1="eu-central-1",qr.EuWest1="eu-west-1",qr.EuWest2="eu-west-2",qr.EuWest3="eu-west-3",qr.SaEast1="sa-east-1",qr.UsEast1="us-east-1",qr.UsWest1="us-west-1",qr.UsWest2="us-west-2";var Mr=function(e,t,r,s){return new(r||(r=Promise))(function(n,o){function i(e){try{l(s.next(e))}catch(t){o(t)}}function a(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((s=s.apply(e,t||[])).next())})};class Br{constructor(e,{headers:t={},customFetch:r,region:s=Nr.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>$r(async()=>{const{default:e}=await Promise.resolve().then(()=>rs);return{default:e}},void 0,import.meta.url).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Mr(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:o}=t;let i,a={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(a["x-region"]=l),o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",i=o):"string"==typeof o?(a["Content-Type"]="text/plain",i=o):"undefined"!=typeof FormData&&o instanceof FormData?i=o:(a["Content-Type"]="application/json",i=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:i}).catch(e=>{throw new Lr(e)}),u=c.headers.get("x-relay-error");if(u&&"true"===u)throw new Ur(c);if(!c.ok)throw new Dr(c);let d,h=(null!==(r=c.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return d="application/json"===h?yield c.json():"application/octet-stream"===h?yield c.blob():"text/event-stream"===h?c:"multipart/form-data"===h?yield c.formData():yield c.text(),{data:d,error:null}}catch(s){return{data:null,error:s}}})}}var Vr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Fr(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,s.get?s:{enumerable:!0,get:function(){return e[t]}})}),r}var zr={},Wr={},Jr={},Kr={},Gr={},Hr={},Yr=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const Xr=Yr.fetch,Qr=Yr.fetch.bind(Yr),Zr=Yr.Headers,es=Yr.Request,ts=Yr.Response,rs=Object.freeze(Object.defineProperty({__proto__:null,Headers:Zr,Request:es,Response:ts,default:Qr,fetch:Xr},Symbol.toStringTag,{value:"Module"})),ss=Fr(rs);var ns={};Object.defineProperty(ns,"__esModule",{value:!0});let os=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};ns.default=os;var is=Vr&&Vr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Hr,"__esModule",{value:!0});const as=is(ss),ls=is(ns);Hr.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=as.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,s;let n=null,o=null,i=null,a=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(o="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const s=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");s&&c&&c.length>1&&(i=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(n={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,i=null,a=406,l="Not Acceptable"):o=1===o.length?o[0]:null)}else{const t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(o=[],n=null,a=200,l="OK")}catch(c){404===e.status&&""===t?(a=204,l="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(s=null==n?void 0:n.details)||void 0===s?void 0:s.includes("0 rows"))&&(n=null,a=200,l="OK"),n&&this.shouldThrowOnError)throw new ls.default(n)}return{error:n,data:o,count:i,status:a,statusText:l}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}};var cs=Vr&&Vr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Gr,"__esModule",{value:!0});const us=cs(Hr);let ds=class extends us.default{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const o=n?`${n}.order`:"order",i=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,o=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(o,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:o="text"}={}){var i;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(i=this.headers.Accept)&&void 0!==i?i:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${a};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Gr.default=ds;var hs=Vr&&Vr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Kr,"__esModule",{value:!0});const fs=hs(Gr);let ps=class extends fs.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const o=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Kr.default=ps;var ms=Vr&&Vr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Jr,"__esModule",{value:!0});const gs=ms(Kr);Jr.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let n=!1;const o=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new gs.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),r||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new gs.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){const o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),n||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new gs.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new gs.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new gs.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var vs={},ys={};Object.defineProperty(ys,"__esModule",{value:!0}),ys.version=void 0,ys.version="0.0.0-automated",Object.defineProperty(vs,"__esModule",{value:!0}),vs.DEFAULT_HEADERS=void 0;const bs=ys;vs.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${bs.version}`};var _s=Vr&&Vr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Wr,"__esModule",{value:!0});const ws=_s(Jr),ks=_s(Kr),Ss=vs;Wr.default=class e{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Ss.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new ws.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){let o;const i=new URL(`${this.url}/rpc/${e}`);let a;r||s?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{i.searchParams.append(e,t)})):(o="POST",a=t);const l=Object.assign({},this.headers);return n&&(l.Prefer=`count=${n}`),new ks.default({method:o,url:i,headers:l,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};var Ts=Vr&&Vr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(zr,"__esModule",{value:!0}),zr.PostgrestError=zr.PostgrestBuilder=zr.PostgrestTransformBuilder=zr.PostgrestFilterBuilder=zr.PostgrestQueryBuilder=zr.PostgrestClient=void 0;const Es=Ts(Wr);zr.PostgrestClient=Es.default;const Ps=Ts(Jr);zr.PostgrestQueryBuilder=Ps.default;const Cs=Ts(Kr);zr.PostgrestFilterBuilder=Cs.default;const js=Ts(Gr);zr.PostgrestTransformBuilder=js.default;const Os=Ts(Hr);zr.PostgrestBuilder=Os.default;const As=Ts(ns);zr.PostgrestError=As.default;var Is=zr.default={PostgrestClient:Es.default,PostgrestQueryBuilder:Ps.default,PostgrestFilterBuilder:Cs.default,PostgrestTransformBuilder:js.default,PostgrestBuilder:Os.default,PostgrestError:As.default};const{PostgrestClient:xs,PostgrestQueryBuilder:$s,PostgrestFilterBuilder:Rs,PostgrestTransformBuilder:Ls,PostgrestBuilder:Us,PostgrestError:Ds}=Is;const Ns=function(){if("undefined"!=typeof WebSocket)return WebSocket;if(void 0!==global.WebSocket)return global.WebSocket;if(void 0!==window.WebSocket)return window.WebSocket;if(void 0!==self.WebSocket)return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}();var qs,Ms,Bs,Vs,Fs,zs,Ws,Js,Ks,Gs,Hs;(Ms=qs||(qs={}))[Ms.connecting=0]="connecting",Ms[Ms.open=1]="open",Ms[Ms.closing=2]="closing",Ms[Ms.closed=3]="closed",(Vs=Bs||(Bs={})).closed="closed",Vs.errored="errored",Vs.joined="joined",Vs.joining="joining",Vs.leaving="leaving",(zs=Fs||(Fs={})).close="phx_close",zs.error="phx_error",zs.join="phx_join",zs.reply="phx_reply",zs.leave="phx_leave",zs.access_token="access_token",(Ws||(Ws={})).websocket="websocket",(Ks=Js||(Js={})).Connecting="connecting",Ks.Open="open",Ks.Closing="closing",Ks.Closed="closed";class Ys{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let o=this.HEADER_LENGTH+2;const i=r.decode(e.slice(o,o+s));o+=s;const a=r.decode(e.slice(o,o+n));o+=n;return{ref:null,topic:i,event:a,payload:JSON.parse(r.decode(e.slice(o,e.byteLength)))}}}class Xs{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(Hs=Gs||(Gs={})).abstime="abstime",Hs.bool="bool",Hs.date="date",Hs.daterange="daterange",Hs.float4="float4",Hs.float8="float8",Hs.int2="int2",Hs.int4="int4",Hs.int4range="int4range",Hs.int8="int8",Hs.int8range="int8range",Hs.json="json",Hs.jsonb="jsonb",Hs.money="money",Hs.numeric="numeric",Hs.oid="oid",Hs.reltime="reltime",Hs.text="text",Hs.time="time",Hs.timestamp="timestamp",Hs.timestamptz="timestamptz",Hs.timetz="timetz",Hs.tsrange="tsrange",Hs.tstzrange="tstzrange";const Qs=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce((r,s)=>(r[s]=Zs(s,e,t,n),r),{})},Zs=(e,t,r,s)=>{const n=t.find(t=>t.name===e),o=null==n?void 0:n.type,i=r[e];return o&&!s.includes(o)?en(o,i):tn(i)},en=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return on(t,r)}switch(e){case Gs.bool:return rn(t);case Gs.float4:case Gs.float8:case Gs.int2:case Gs.int4:case Gs.int8:case Gs.numeric:case Gs.oid:return sn(t);case Gs.json:case Gs.jsonb:return nn(t);case Gs.timestamp:return an(t);case Gs.abstime:case Gs.date:case Gs.daterange:case Gs.int4range:case Gs.int8range:case Gs.money:case Gs.reltime:case Gs.text:case Gs.time:case Gs.timestamptz:case Gs.timetz:case Gs.tsrange:case Gs.tstzrange:default:return tn(t)}},tn=e=>e,rn=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},sn=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},nn=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},on=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const o=e.slice(1,r);try{s=JSON.parse("["+o+"]")}catch(n){s=o?o.split(","):[]}return s.map(e=>en(t,e))}return e},an=e=>"string"==typeof e?e.replace(" ","T"):e,ln=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class cn{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var un,dn,hn,fn,pn,mn,gn,vn;(dn=un||(un={})).SYNC="sync",dn.JOIN="join",dn.LEAVE="leave";class yn{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=yn.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=yn.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=yn.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),o=this.transformState(t),i={},a={};return this.map(n,(e,t)=>{o[e]||(a[e]=t)}),this.map(o,(e,t)=>{const r=n[e];if(r){const s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),o=t.filter(e=>n.indexOf(e.presence_ref)<0),l=r.filter(e=>s.indexOf(e.presence_ref)<0);o.length>0&&(i[e]=o),l.length>0&&(a[e]=l)}else i[e]=t}),this.syncDiff(n,{joins:i,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;const o=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),o.length>0){const r=e[t].map(e=>e.presence_ref),s=o.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...s)}r(t,o,s)}),this.map(o,(t,r)=>{let n=e[t];if(!n)return;const o=r.map(e=>e.presence_ref);n=n.filter(e=>o.indexOf(e.presence_ref)<0),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(fn=hn||(hn={})).ALL="*",fn.INSERT="INSERT",fn.UPDATE="UPDATE",fn.DELETE="DELETE",(mn=pn||(pn={})).BROADCAST="broadcast",mn.PRESENCE="presence",mn.POSTGRES_CHANGES="postgres_changes",mn.SYSTEM="system",(vn=gn||(gn={})).SUBSCRIBED="SUBSCRIBED",vn.TIMED_OUT="TIMED_OUT",vn.CLOSED="CLOSED",vn.CHANNEL_ERROR="CHANNEL_ERROR";class bn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Bs.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new cn(this,Fs.join,this.params,this.timeout),this.rejoinTimer=new Xs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bs.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Bs.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Bs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bs.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Fs.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new yn(this),this.broadcastEndpointURL=ln(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Bs.closed){const{config:{broadcast:n,presence:o,private:i}}=this.params;this._onError(t=>null==e?void 0:e(gn.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(gn.CLOSED));const a={},l={broadcast:n,presence:o,postgres_changes:null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],private:i};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,o=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:i,schema:a,table:l,filter:c}}=n,u=t&&t[r];if(!u||u.event!==i||u.schema!==a||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=Bs.errored,void(null==e||e(gn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));o.push(Object.assign(Object.assign({},n),{id:u.id}))}return this.bindings.postgres_changes=o,void(e&&e(gn.SUBSCRIBED))}null==e||e(gn.SUBSCRIBED)}).receive("error",t=>{this.state=Bs.errored,null==e||e(gn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(gn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,o;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(o=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===o?void 0:o.ack)||r("ok"),i.receive("ok",()=>r("ok")),i.receive("error",()=>r("error")),i.receive("timeout",()=>r("timed out"))});{const{event:o,payload:i}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Bs.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Fs.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new cn(this,Fs.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new cn(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const o=e.toLocaleLowerCase(),{close:i,error:a,leave:l,join:c}=Fs;if(r&&[i,a,l,c].indexOf(o)>=0&&r!==this._joinRef())return;let u=this._onMessage(o,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===o}).map(e=>e.callback(u,r)):null===(n=this.bindings[o])||void 0===n||n.filter(e=>{var r,s,n,i,a,l;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in e){const o=e.id,i=null===(r=e.filter)||void 0===r?void 0:r.event;return o&&(null===(s=t.ids)||void 0===s?void 0:s.includes(o))&&("*"===i||(null==i?void 0:i.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(a=null===(i=null==e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===o}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:o}=e,i={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:o};u=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(u,r)})}_isClosed(){return this.state===Bs.closed}_isJoined(){return this.state===Bs.joined}_isJoining(){return this.state===Bs.joining}_isLeaving(){return this.state===Bs.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&bn.isEqual(e.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Fs.close,{},e)}_onError(e){this._on(Fs.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Bs.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Qs(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Qs(e.columns,e.old_record)),t}}const _n=()=>{};class wn{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=_n,this.ref=0,this.logger=_n,this.conn=null,this.sendBuffer=[],this.serializer=new Ys,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>$r(async()=>{const{default:e}=await Promise.resolve().then(()=>rs);return{default:e}},void 0,import.meta.url).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${Ws.websocket}`,this.httpEndpoint=ln(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Xs(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Ns),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(e=>e.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case qs.connecting:return Js.Connecting;case qs.open:return Js.Open;case qs.closing:return Js.Closing;default:return Js.Closed}}isConnected(){return this.connectionState()===Js.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{const r=new bn(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:s,ref:n}=e,o=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.11.15"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(Fs.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:r,payload:s,ref:n}=e;"phoenix"===t&&"phx_reply"===r&&this.heartbeatCallback("ok"==e.payload.status?"ok":"error"),n&&n===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${r} ${n&&"("+n+")"||""}`,s),Array.from(this.channels).filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Fs.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class kn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Sn(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Tn extends kn{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class En extends kn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Pn=function(e,t,r,s){return new(r||(r=Promise))(function(n,o){function i(e){try{l(s.next(e))}catch(t){o(t)}}function a(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((s=s.apply(e,t||[])).next())})};const Cn=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>$r(async()=>{const{default:e}=await Promise.resolve().then(()=>rs);return{default:e}},void 0,import.meta.url).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},jn=e=>{if(Array.isArray(e))return e.map(e=>jn(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const s=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=jn(r)}),t};var On=function(e,t,r,s){return new(r||(r=Promise))(function(n,o){function i(e){try{l(s.next(e))}catch(t){o(t)}}function a(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((s=s.apply(e,t||[])).next())})};const An=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),In=(e,t,r)=>On(void 0,void 0,void 0,function*(){const s=yield Pn(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield $r(()=>Promise.resolve().then(()=>rs),void 0,import.meta.url)).Response:Response});e instanceof s&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{t(new Tn(An(r),e.status||500))}).catch(e=>{t(new En(An(e),e))}):t(new En(An(e),e))});function xn(e,t,r,s,n,o){return On(this,void 0,void 0,function*(){return new Promise((i,a)=>{e(r,((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),r))})(t,s,n,o)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>In(e,a,s))})})}function $n(e,t,r,s){return On(this,void 0,void 0,function*(){return xn(e,"GET",t,r,s)})}function Rn(e,t,r,s,n){return On(this,void 0,void 0,function*(){return xn(e,"POST",t,s,n,r)})}function Ln(e,t,r,s,n){return On(this,void 0,void 0,function*(){return xn(e,"DELETE",t,s,n,r)})}var Un=function(e,t,r,s){return new(r||(r=Promise))(function(n,o){function i(e){try{l(s.next(e))}catch(t){o(t)}}function a(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((s=s.apply(e,t||[])).next())})};const Dn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Nn={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class qn{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Cn(s)}uploadOrUpdate(e,t,r,s){return Un(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},Nn),s);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(o.upsert)});const a=o.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",o.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=r,i["cache-control"]=`max-age=${o.cacheControl}`,i["content-type"]=o.contentType,a&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(i=Object.assign(Object.assign({},i),s.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:i},(null==o?void 0:o.duplex)?{duplex:o.duplex}:{})),d=yield u.json();if(u.ok)return{data:{path:l,id:d.Id,fullPath:d.Key},error:null};return{data:null,error:d}}catch(n){if(Sn(n))return{data:null,error:n};throw n}})}upload(e,t,r){return Un(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return Un(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),o=this._getFinalPath(n),i=new URL(this.url+`/object/upload/sign/${o}`);i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Nn.upsert},s),o=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,o["cache-control"]=`max-age=${t.cacheControl}`,o["content-type"]=t.contentType);const a=yield this.fetch(i.toString(),{method:"PUT",body:e,headers:o}),l=yield a.json();if(a.ok)return{data:{path:n,fullPath:l.Key},error:null};return{data:null,error:l}}catch(a){if(Sn(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return Un(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const n=yield Rn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+n.url),i=o.searchParams.get("token");if(!i)throw new kn("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:i},error:null}}catch(r){if(Sn(r))return{data:null,error:r};throw r}})}update(e,t,r){return Un(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Un(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Sn(s))return{data:null,error:s};throw s}})}copy(e,t,r){return Un(this,void 0,void 0,function*(){try{return{data:{path:(yield Rn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Sn(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return Un(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield Rn(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const o=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(s){if(Sn(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return Un(this,void 0,void 0,function*(){try{const s=yield Rn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(s){if(Sn(s))return{data:null,error:s};throw s}})}download(e,t){return Un(this,void 0,void 0,function*(){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield $n(this.fetch,`${this.url}/${r}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(o){if(Sn(o))return{data:null,error:o};throw o}})}info(e){return Un(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield $n(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:jn(e),error:null}}catch(r){if(Sn(r))return{data:null,error:r};throw r}})}exists(e){return Un(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r,s){return On(this,void 0,void 0,function*(){return xn(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),s)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Sn(r)&&r instanceof En){const e=r.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const o=void 0!==(null==t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==i&&s.push(i);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${a}`)}}}remove(e){return Un(this,void 0,void 0,function*(){try{return{data:yield Ln(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Sn(t))return{data:null,error:t};throw t}})}list(e,t,r){return Un(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Dn),t),{prefix:e||""});return{data:yield Rn(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Sn(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Mn={"X-Client-Info":"storage-js/2.7.1"};var Bn=function(e,t,r,s){return new(r||(r=Promise))(function(n,o){function i(e){try{l(s.next(e))}catch(t){o(t)}}function a(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((s=s.apply(e,t||[])).next())})};class Vn{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Mn),t),this.fetch=Cn(r)}listBuckets(){return Bn(this,void 0,void 0,function*(){try{return{data:yield $n(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Sn(e))return{data:null,error:e};throw e}})}getBucket(e){return Bn(this,void 0,void 0,function*(){try{return{data:yield $n(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Sn(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Bn(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Sn(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Bn(this,void 0,void 0,function*(){try{const r=yield function(e,t,r,s,n){return On(this,void 0,void 0,function*(){return xn(e,"PUT",t,s,n,r)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:r,error:null}}catch(r){if(Sn(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Bn(this,void 0,void 0,function*(){try{return{data:yield Rn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Sn(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Bn(this,void 0,void 0,function*(){try{return{data:yield Ln(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Sn(t))return{data:null,error:t};throw t}})}}class Fn extends Vn{constructor(e,t={},r){super(e,t,r)}from(e){return new qn(this.url,this.headers,e,this.fetch)}}let zn="";zn="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Wn={headers:{"X-Client-Info":`supabase-js-${zn}/2.50.2`}},Jn={schema:"public"},Kn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Gn={};var Hn=function(e,t,r,s){return new(r||(r=Promise))(function(n,o){function i(e){try{l(s.next(e))}catch(t){o(t)}}function a(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((s=s.apply(e,t||[])).next())})};const Yn=(e,t,r)=>{const s=(e=>{let t;return t=e||("undefined"==typeof fetch?Qr:fetch),(...e)=>t(...e)})(r),n="undefined"==typeof Headers?Zr:Headers;return(r,o)=>Hn(void 0,void 0,void 0,function*(){var i;const a=null!==(i=yield t())&&void 0!==i?i:e;let l=new n(null==o?void 0:o.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),s(r,Object.assign(Object.assign({},o),{headers:l}))})};var Xn=function(e,t,r,s){return new(r||(r=Promise))(function(n,o){function i(e){try{l(s.next(e))}catch(t){o(t)}}function a(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((s=s.apply(e,t||[])).next())})};const Qn="2.70.0",Zn=3e4,eo=9e4,to={"X-Client-Info":`gotrue-js/${Qn}`},ro="X-Supabase-Api-Version",so={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},no=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class oo extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function io(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class ao extends oo{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class lo extends oo{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class co extends oo{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class uo extends co{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ho extends co{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class fo extends co{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class po extends co{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class mo extends co{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class go extends co{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function vo(e){return io(e)&&"AuthRetryableFetchError"===e.name}class yo extends co{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class bo extends co{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const _o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),wo=" \t\n\r=".split(""),ko=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<wo.length;t+=1)e[wo[t].charCodeAt(0)]=-2;for(let t=0;t<_o.length;t+=1)e[_o[t].charCodeAt(0)]=t;return e})();function So(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(_o[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(_o[e]),t.queuedBits-=6}}function To(e,t,r){const s=ko[e];if(!(s>-1)){if(-2===s)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Eo(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},o=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,s,r)};for(let i=0;i<e.length;i+=1)To(e.charCodeAt(i),n,o);return t.join("")}function Po(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Co(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let n=0;n<e.length;n+=1)To(e.charCodeAt(n),r,s);return new Uint8Array(t)}function jo(e){const t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){const t=1024*(s-55296)&65535;s=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}Po(s,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function Oo(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>So(e,r,s)),So(null,r,s),t.join("")}const Ao=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Io={tested:!1,writable:!1},xo=()=>{if(!Ao())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Io.tested)return Io.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Io.tested=!0,Io.writable=!0}catch(t){Io.tested=!0,Io.writable=!1}return Io.writable};const $o=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>$r(async()=>{const{default:e}=await Promise.resolve().then(()=>rs);return{default:e}},void 0,import.meta.url).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Ro=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Lo=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(s){return r}},Uo=async(e,t)=>{await e.removeItem(t)};class Do{constructor(){this.promise=new Do.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function No(e){const t=e.split(".");if(3!==t.length)throw new bo("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!no.test(t[r]))throw new bo("JWT not in base64url format");return{header:JSON.parse(Eo(t[0])),payload:JSON.parse(Eo(t[1])),signature:Co(t[2]),raw:{header:t[0],payload:t[1]}}}function qo(e){return("0"+e.toString(16)).substr(-2)}async function Mo(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Bo(e,t,r=!1){const s=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,qo).join("")}();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await Ro(e,`${t}-code-verifier`,n);const o=await Mo(s);return[o,s===o?"plain":"s256"]}Do.promiseConstructor=Promise;const Vo=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Fo=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function zo(e){if(!Fo.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}const Wo=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Jo=[502,503,504];async function Ko(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new go(Wo(e),0);if(Jo.includes(e.status))throw new go(Wo(e),e.status);let s,n;try{s=await e.json()}catch(i){throw new lo(Wo(i),i)}const o=function(e){const t=e.headers.get(ro);if(!t)return null;if(!t.match(Vo))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(i){return null}}(e);if(o&&o.getTime()>=so.timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?n=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(n=s.error_code),n){if("weak_password"===n)throw new yo(Wo(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new uo}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new yo(Wo(s),e.status,s.weak_password.reasons);throw new ao(Wo(s),e.status||500,n)}async function Go(e,t,r,s){var n;const o=Object.assign({},null==s?void 0:s.headers);o[ro]||(o[ro]=so.name),(null==s?void 0:s.jwt)&&(o.Authorization=`Bearer ${s.jwt}`);const i=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(i.redirect_to=s.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await async function(e,t,r,s,n,o){const i=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,n,o);let a;try{a=await e(r,Object.assign({},i))}catch(l){throw console.error(l),new go(Wo(l),0)}a.ok||await Ko(a);if(null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(l){await Ko(l)}}(e,t,r+a,{headers:o,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function Ho(e){var t;let r=null;var s;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Yo(e){const t=Ho(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Xo(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Qo(e){return{data:e,error:null}}function Zo(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:o}=e,i=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:o},user:Object.assign({},i)},error:null}}function ei(e){return e}const ti=["global","local","others"];class ri{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=$o(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=ti[0]){if(ti.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ti.join(", ")}`);try{return await Go(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(io(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await Go(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Xo})}catch(r){if(io(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await Go(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Zo,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(io(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Go(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Xo})}catch(t){if(io(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,o,i,a;try{const l={nextPage:null,lastPage:0,total:0},c=await Go(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:ei});if(c.error)throw c.error;const u=await c.json(),d=null!==(o=c.headers.get("x-total-count"))&&void 0!==o?o:0,h=null!==(a=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==a?a:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(io(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){zo(e);try{return await Go(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Xo})}catch(t){if(io(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){zo(e);try{return await Go(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Xo})}catch(r){if(io(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){zo(e);try{return await Go(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Xo})}catch(r){if(io(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){zo(e.userId);try{const{data:t,error:r}=await Go(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(io(t))return{data:null,error:t};throw t}}async _deleteFactor(e){zo(e.userId),zo(e.id);try{return{data:await Go(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(io(t))return{data:null,error:t};throw t}}}const si={getItem:e=>xo()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{xo()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{xo()&&globalThis.localStorage.removeItem(e)}};function ni(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const oi=!!(globalThis&&xo()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class ii extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ai extends ii{}async function li(e,t,r){oi&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),oi&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(!s){if(0===t)throw oi&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new ai(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(oi)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}oi&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{oi&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const ci={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:to,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ui(e,t,r){return await r()}class di{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=di.nextInstanceID,di.nextInstanceID+=1,this.instanceID>0&&Ao()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},ci),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new ri({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=$o(s.fetch),this.lock=s.lock||ui,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Ao()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=li:this.lock=ui,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:xo()?this.storage=si:(this.memoryStorage={},this.storage=ni(this.memoryStorage)):(this.memoryStorage={},this.storage=ni(this.memoryStorage)),Ao()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Qn}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(s){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),Ao()&&this.detectSessionInUrl&&"none"!==r){const{data:s,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),function(e){return io(e)&&"AuthImplicitGrantRedirectError"===e.name}(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return await this._removeSession(),{error:n}}const{session:o,redirectType:i}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",i),await this._saveSession(o),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return io(t)?{error:t}:{error:new lo("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const n=await Go(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:Ho}),{data:o,error:i}=n;if(i||!o)return{data:{user:null,session:null},error:i};const a=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(io(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,s;try{let n;if("email"in e){const{email:r,password:s,options:o}=e;let i=null,a=null;"pkce"===this.flowType&&([i,a]=await Bo(this.storage,this.storageKey)),n=await Go(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==o?void 0:o.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==o?void 0:o.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken},code_challenge:i,code_challenge_method:a},xform:Ho})}else{if(!("phone"in e))throw new fo("You must provide either an email or phone number and a password");{const{phone:t,password:o,options:i}=e;n=await Go(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:o,data:null!==(r=null==i?void 0:i.data)&&void 0!==r?r:{},channel:null!==(s=null==i?void 0:i.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Ho})}}const{data:o,error:i}=n;if(i||!o)return{data:{user:null,session:null},error:i};const a=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(io(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:s,options:n}=e;t=await Go(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Yo})}else{if(!("phone"in e))throw new fo("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await Go(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Yo})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s}):{data:{user:null,session:null},error:new ho}}catch(t){if(io(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,n,o,i,a,l,c,u,d,h;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:d,wallet:h,statement:m,options:g}=e;let v;if(Ao())if("object"==typeof h)v=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!=typeof h||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=h}const y=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in v&&v.signIn){const e=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==g?void 0:g.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),m?{statement:m}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in v&&"function"==typeof v.signMessage&&"publicKey"in v&&"object"==typeof v&&v.publicKey&&"toBase58"in v.publicKey&&"function"==typeof v.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${y.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...m?["",m,""]:[""],"Version: 1",`URI: ${y.href}`,`Issued At: ${null!==(s=null===(r=null==g?void 0:g.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==s?s:(new Date).toISOString()}`,...(null===(n=null==g?void 0:g.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...(null===(o=null==g?void 0:g.signInWithSolana)||void 0===o?void 0:o.expirationTime)?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...(null===(i=null==g?void 0:g.signInWithSolana)||void 0===i?void 0:i.chainId)?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...(null===(a=null==g?void 0:g.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...(null===(l=null==g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...g.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await v.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:r}=await Go(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Oo(p)},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Ho});if(r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:r}):{data:{user:null,session:null},error:new ho}}catch(m){if(io(m))return{data:{user:null,session:null},error:m};throw m}}async _exchangeCodeForSession(e){const t=await Lo(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{const{data:t,error:n}=await Go(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ho});if(await Uo(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new ho}}catch(n){if(io(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:o}=e,i=await Go(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Ho}),{data:a,error:l}=i;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new ho}}catch(t){if(io(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,o;try{if("email"in e){const{email:s,options:n}=e;let o=null,i=null;"pkce"===this.flowType&&([o,i]=await Bo(this.storage,this.storageKey));const{error:a}=await Go(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:o,code_challenge_method:i},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:r}=e,{data:i,error:a}=await Go(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(o=null==r?void 0:r.channel)&&void 0!==o?o:"sms"}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:a}}throw new fo("You must provide either an email or phone number.")}catch(i){if(io(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:o,error:i}=await Go(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:Ho});if(i)throw i;if(!o)throw new Error("An error occurred on token verification.");const a=o.session,l=o.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(io(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let n=null,o=null;return"pkce"===this.flowType&&([n,o]=await Bo(this.storage,this.storageKey)),await Go(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:Qo})}catch(n){if(io(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new uo;const{error:s}=await Go(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(io(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:o}=await Go(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:o,error:i}=await Go(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:i}}throw new fo("You must provide either an email or phone number and a type")}catch(t){if(io(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Lo(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<eo;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,r,s)=>(t||"user"!==r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,r,s))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Go(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Xo}):await this._useSession(async e=>{var t,r,s;const{data:n,error:o}=e;if(o)throw o;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Go(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0,xform:Xo}):{data:{user:null},error:new uo}})}catch(t){if(io(t))return function(e){return io(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await Uo(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new uo;const o=s.session;let i=null,a=null;"pkce"===this.flowType&&null!=e.email&&([i,a]=await Bo(this.storage,this.storageKey));const{data:l,error:c}=await Go(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:a}),jwt:o.access_token,xform:Xo});if(c)throw c;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(io(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new uo;const t=Date.now()/1e3;let r=t,s=!0,n=null;const{payload:o}=No(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:o}=await this._getUser(e.access_token);if(o)throw o;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(io(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new uo;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(io(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Ao())throw new po("No browser detected.");if(e.error||e.error_description||e.error_code)throw new po(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new mo("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new po("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new mo("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:o,expires_in:i,expires_at:a,token_type:l}=e;if(!(n&&i&&o&&l))throw new po("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(i);let d=c+u;a&&(d=parseInt(a));const h=d-c;1e3*h<=Zn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${u}s`);const f=d-u;c-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,d,c):c-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,d,c);const{data:p,error:m}=await this._getUser(n);if(m)throw m;const g={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:u,expires_at:d,refresh_token:o,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(r){if(io(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Lo(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const o=null===(r=s.session)||void 0===r?void 0:r.access_token;if(o){const{error:t}=await this.admin.signOut(o,e);if(t&&(!function(e){return io(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Uo(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(n){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await Bo(this.storage,this.storageKey,!0));try{return await Go(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(io(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(io(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async t=>{var r,s,n,o,i;const{data:a,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await Go(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(o=a.session)||void 0===o?void 0:o.access_token)&&void 0!==i?i:void 0})});if(s)throw s;return Ao()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:e.provider,url:null==r?void 0:r.url},error:null}}catch(r){if(io(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:o}=t;if(o)throw o;return await Go(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})})}catch(t){if(io(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Go(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ho})),s=(e,t)=>{const r=200*Math.pow(2,e);return t&&vo(t)&&Date.now()+r-n<Zn},new Promise((e,t)=>{(async()=>{for(let o=0;o<1/0;o++)try{const t=await r(o);if(!s(o,null,t))return void e(t)}catch(n){if(!s(o,n))return void t(n)}})()}))}catch(n){if(this._debug(t,"error",n),io(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Ao()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Lo(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r))return this._debug(t,"session is not valid"),void(null!==r&&await this._removeSession());const s=1e3*(null!==(e=r.expires_at)&&void 0!==e?e:1/0)-Date.now()<eo;if(this._debug(t,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),vo(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){return this._debug(t,"error",r),void console.error(r)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new uo;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Do;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new uo;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(n){if(this._debug(s,"error",n),io(n)){const e={session:null,error:n};return vo(n)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(n){s.push(n)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ro(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Uo(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ao()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Zn);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-t)/Zn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof ii))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ao()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await Bo(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Go(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(io(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:o}=t;if(o)return{data:null,error:o};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=await Go(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(s=null==a?void 0:a.totp)||void 0===s?void 0:s.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(io(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:i}=await Go(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:i})})}catch(t){if(io(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Go(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(io(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status),n=r.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=No(s.access_token);let i=null;o.aal&&(i=o.aal);let a=i;(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(a="aal2");return{data:{currentLevel:i,nextLevel:a,currentAuthenticationMethods:o.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;if(r=this.jwks.keys.find(t=>t.kid===e),r&&this.jwks_cached_at+6e5>Date.now())return r;const{data:s,error:n}=await Go(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!s.keys||0===s.keys.length)throw new bo("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(t=>t.kid===e),!r)throw new bo("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};r=e.session.access_token}const{header:s,payload:n,signature:o,raw:{header:i,payload:a}}=No(r);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp),!s.kid||"HS256"===s.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:n,header:s,signature:o},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(s.alg),c=await this.fetchJwk(s.kid,t),u=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,u,o,jo(`${i}.${a}`))))throw new bo("Invalid JWT signature");return{data:{claims:n,header:s,signature:o},error:null}}catch(r){if(io(r))return{data:null,error:r};throw r}}}di.nextInstanceID=0;const hi=di;class fi extends hi{constructor(e){super(e)}}var pi=function(e,t,r,s){return new(r||(r=Promise))(function(n,o){function i(e){try{l(s.next(e))}catch(t){o(t)}}function a(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,a)}l((s=s.apply(e,t||[])).next())})};class mi{constructor(e,t,r){var s,n,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const i=(a=e).endsWith("/")?a:a+"/";var a;const l=new URL(i);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u=function(e,t){var r,s;const{db:n,auth:o,realtime:i,global:a}=e,{db:l,auth:c,realtime:u,global:d}=t,h={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),o),realtime:Object.assign(Object.assign({},u),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},null!==(r=null==d?void 0:d.headers)&&void 0!==r?r:{}),null!==(s=null==a?void 0:a.headers)&&void 0!==s?s:{})}),accessToken:()=>Xn(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=r?r:{},{db:Jn,realtime:Gn,auth:Object.assign(Object.assign({},Kn),{storageKey:c}),global:Wn});this.storageKey=null!==(s=u.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(n=u.global.headers)&&void 0!==n?n:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(o=u.auth)&&void 0!==o?o:{},this.headers,u.global.fetch),this.fetch=Yn(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new xs(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Br(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Fn(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return pi(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:o,lock:i,debug:a},l,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new fi({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,lock:i,debug:a,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new wn(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=r}}var gi={};const vi=gi.VITE_SUPABASE_URL,yi=gi.VITE_SUPABASE_ANON_KEY;if(!vi||!yi)throw new Error("\n    Supabase 环境变量未配置!\n    \n    开发环境: 请检查 .env 文件中是否设置了:\n      VITE_SUPABASE_URL 和 VITE_SUPABASE_ANON_KEY\n      \n    生产环境: 请确保 GitHub Secrets 已设置:\n      VITE_SUPABASE_URL 和 VITE_SUPABASE_ANON_KEY\n      \n    配置指南: docs/GITHUB_SECRETS_SETUP.md\n  ");const bi=new mi(vi,yi,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});const _i={TOOLS:"tools",CATEGORIES:"categories",PRODUCTS:"products",PRODUCT_CATEGORIES:"product_categories",USERS:"users",USER_PROFILES:"user_profiles",FAVORITES:"favorites",ORDERS:"orders",ORDER_ITEMS:"order_items",PAYMENTS:"payments",REVIEWS:"reviews",TAGS:"tags",TOOL_TAGS:"tool_tags",ANALYTICS:"analytics"},wi=e=>(console.error("Supabase Error:",e),(null==e?void 0:e.message)?e.message:(null==e?void 0:e.error_description)?e.error_description:"操作失败，请稍后重试"),ki=v("tools",()=>{const e=c([]),t=c(!1),r=c(null),s=c(!1),n=c(""),o=c(!1),i=a(()=>{if(!n.value)return e.value;const t=n.value.toLowerCase();return e.value.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.categories&&e.categories.name.toLowerCase().includes(t))});async function l(){if(!t.value){t.value=!0,r.value=null;try{const{data:t,error:r}=await bi.from("tools").select("\n          *,\n          categories ( * )\n        ").eq("is_active",!0).order("sort_order",{ascending:!0});if(r)throw r;e.value=t||[],s.value=!0}catch(n){console.error("获取工具列表失败:",n),r.value=n}finally{t.value=!1}}}return{tools:e,loading:t,error:r,initialized:s,searchQuery:n,sidebarCollapsed:o,filteredTools:i,fetchTools:l,initialize:async function(){s.value||await l()},toggleSidebar:function(){o.value=!o.value},clearError:function(){r.value=null}}}),Si=v("auth",()=>{const e=c(null),t=c(!1),r=c(!1),s=c(null),n=a(()=>!!e.value),o=a(()=>{var t,r;return"admin"===(null==(t=e.value)?void 0:t.role)||"super_admin"===(null==(r=e.value)?void 0:r.role)});return{user:e,loading:t,initialized:r,error:s,isAuthenticated:n,isAdmin:o,initialize:function(){r.value||(t.value=!0,bi.auth.onAuthStateChange(async(s,n)=>{if(null==n?void 0:n.user){const t=await async function(e){const{data:t,error:r}=await bi.from("user_profiles").select("*").eq("id",e).single();return r?(console.error("获取用户资料失败:",r),null):t}(n.user.id);e.value=t?{...n.user,username:t.username||"未设置用户名",avatar_url:t.avatar_url||"",role:t.role||"user"}:{...n.user,username:n.user.email||"新用户",avatar_url:"",role:"user"}}else e.value=null;r.value=!0,t.value=!1}))},logout:async function(){t.value=!0,s.value=null;try{const{error:e}=await bi.auth.signOut();if(e)throw e}catch(e){s.value=e,console.error("退出登录失败:",e)}finally{t.value=!1}},clearError:function(){s.value=null}}});function Ti(e){return!!b()&&(_(e),!0)}function Ei(e){return"function"==typeof e?e():n(e)}const Pi="undefined"!=typeof window&&"undefined"!=typeof document;"undefined"!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope);const Ci=Object.prototype.toString,ji=()=>{};function Oi(e,t){return function(...r){return new Promise((s,n)=>{Promise.resolve(e(()=>t.apply(this,r),{fn:t,thisArg:this,args:r})).then(s).catch(n)})}}const Ai=e=>e();function Ii(e,t=200,r={}){return Oi(function(e,t={}){let r,s,n=ji;const o=e=>{clearTimeout(e),n(),n=ji};return i=>{const a=Ei(e),l=Ei(t.maxWait);return r&&o(r),a<=0||void 0!==l&&l<=0?(s&&(o(s),s=null),Promise.resolve(i())):new Promise((e,c)=>{n=t.rejectOnCancel?c:e,l&&!s&&(s=setTimeout(()=>{r&&o(r),s=null,e(i())},l)),r=setTimeout(()=>{s&&o(s),s=null,e(i())},a)})}}(t,r),e)}function xi(e,t,r={}){const{eventFilter:s,...n}=r,{eventFilter:o,pause:i,resume:a,isActive:l}=function(e=Ai){const t=c(!0);return{isActive:w(t),pause:function(){t.value=!1},resume:function(){t.value=!0},eventFilter:(...r)=>{t.value&&e(...r)}}}(s),d=function(e,t,r={}){const{eventFilter:s=Ai,...n}=r;return u(e,Oi(s,t),n)}(e,t,{...n,eventFilter:o});return{stop:d,pause:i,resume:a,isActive:l}}function $i(e,t=!0,r){f()?y(e,r):t?e():p(e)}function Ri(e){var t;const r=Ei(e);return null!=(t=null==r?void 0:r.$el)?t:r}const Li=Pi?window:void 0;function Ui(...e){let t,r,s,n;if("string"==typeof e[0]||Array.isArray(e[0])?([r,s,n]=e,t=Li):[t,r,s,n]=e,!t)return ji;Array.isArray(r)||(r=[r]),Array.isArray(s)||(s=[s]);const o=[],i=()=>{o.forEach(e=>e()),o.length=0},a=u(()=>[Ri(t),Ei(n)],([e,t])=>{if(i(),!e)return;const n=(a=t,"[object Object]"===Ci.call(a)?{...t}:t);var a;o.push(...r.flatMap(t=>s.map(r=>((e,t,r,s)=>(e.addEventListener(t,r,s),()=>e.removeEventListener(t,r,s)))(e,t,r,n))))},{immediate:!0,flush:"post"}),l=()=>{a(),i()};return Ti(l),l}function Di(e){const t=function(){const e=c(!1),t=f();return t&&y(()=>{e.value=!0},t),e}();return a(()=>(t.value,Boolean(e())))}function Ni(e,t={}){const{window:r=Li}=t,s=Di(()=>r&&"matchMedia"in r&&"function"==typeof r.matchMedia);let n;const o=c(!1),i=e=>{o.value=e.matches},a=()=>{n&&("removeEventListener"in n?n.removeEventListener("change",i):n.removeListener(i))},l=g(()=>{s.value&&(a(),n=r.matchMedia(Ei(e)),"addEventListener"in n?n.addEventListener("change",i):n.addListener(i),o.value=n.matches)});return Ti(()=>{l(),a(),n=void 0}),o}const qi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Mi="__vueuse_ssr_handlers__",Bi=Vi();function Vi(){return Mi in qi||(qi[Mi]=qi[Mi]||{}),qi[Mi]}const Fi={boolean:{read:e=>"true"===e,write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},zi="vueuse-storage";function Wi(e,t,s,n={}){var o;const{flush:i="pre",deep:a=!0,listenToStorageChanges:l=!0,writeDefaults:u=!0,mergeDefaults:d=!1,shallow:h,window:f=Li,eventFilter:m,onError:g=e=>{console.error(e)},initOnMounted:v}=n,y=(h?r:c)("function"==typeof t?t():t);if(!s)try{s=function(e,t){return Bi[e]||t}("getDefaultStorage",()=>{var e;return null==(e=Li)?void 0:e.localStorage})()}catch(C){g(C)}if(!s)return y;const b=Ei(t),_=function(e){return null==e?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":"boolean"==typeof e?"boolean":"string"==typeof e?"string":"object"==typeof e?"object":Number.isNaN(e)?"any":"number"}(b),w=null!=(o=n.serializer)?o:Fi[_],{pause:k,resume:S}=xi(y,()=>function(t){try{const r=s.getItem(e);if(null==t)T(r,null),s.removeItem(e);else{const n=w.write(t);r!==n&&(s.setItem(e,n),T(r,n))}}catch(C){g(C)}}(y.value),{flush:i,deep:a,eventFilter:m});function T(t,r){f&&f.dispatchEvent(new CustomEvent(zi,{detail:{key:e,oldValue:t,newValue:r,storageArea:s}}))}function E(t){if(!t||t.storageArea===s)if(t&&null==t.key)y.value=b;else if(!t||t.key===e){k();try{(null==t?void 0:t.newValue)!==w.write(y.value)&&(y.value=function(t){const r=t?t.newValue:s.getItem(e);if(null==r)return u&&null!=b&&s.setItem(e,w.write(b)),b;if(!t&&d){const e=w.read(r);return"function"==typeof d?d(e,b):"object"!==_||Array.isArray(e)?e:{...b,...e}}return"string"!=typeof r?r:w.read(r)}(t))}catch(C){g(C)}finally{t?p(S):S()}}}function P(e){E(e.detail)}return f&&l&&$i(()=>{Ui(f,"storage",E),Ui(f,zi,P),v&&E()}),v||E(),y}const Ji={mode:"auto",primaryColor:"#3b82f6",accentColor:"#10b981",borderRadius:"medium",fontSize:"medium",fontFamily:"system",compactMode:!1,highContrast:!1,reducedMotion:!1},Ki=[{id:"default",name:"默认主题",description:"经典的蓝色主题，适合大多数用户",config:{primaryColor:"#3b82f6",accentColor:"#10b981"},preview:{primary:"#3b82f6",secondary:"#10b981",background:"#ffffff",surface:"#f8fafc"}},{id:"purple",name:"紫色主题",description:"优雅的紫色配色方案",config:{primaryColor:"#8b5cf6",accentColor:"#f59e0b"},preview:{primary:"#8b5cf6",secondary:"#f59e0b",background:"#ffffff",surface:"#faf5ff"}},{id:"green",name:"绿色主题",description:"清新的绿色主题，护眼舒适",config:{primaryColor:"#059669",accentColor:"#dc2626"},preview:{primary:"#059669",secondary:"#dc2626",background:"#ffffff",surface:"#f0fdf4"}},{id:"orange",name:"橙色主题",description:"温暖的橙色主题，充满活力",config:{primaryColor:"#ea580c",accentColor:"#7c3aed"},preview:{primary:"#ea580c",secondary:"#7c3aed",background:"#ffffff",surface:"#fff7ed"}},{id:"dark-blue",name:"深蓝主题",description:"专业的深蓝色主题",config:{mode:"dark",primaryColor:"#60a5fa",accentColor:"#34d399"},preview:{primary:"#60a5fa",secondary:"#34d399",background:"#0f172a",surface:"#1e293b"}},{id:"high-contrast",name:"高对比度",description:"高对比度主题，提升可访问性",config:{primaryColor:"#000000",accentColor:"#ffffff",highContrast:!0,borderRadius:"none"},preview:{primary:"#000000",secondary:"#ffffff",background:"#ffffff",surface:"#f5f5f5"}}];function Gi(){const e=function(e){const t=Ni("(prefers-color-scheme: light)",e),r=Ni("(prefers-color-scheme: dark)",e);return a(()=>r.value?"dark":t.value?"light":"no-preference")}(),t=Wi("theme-config",Ji),r=a(()=>"auto"===t.value.mode?"dark"===e.value?"dark":"light":"dark"===t.value.mode?"dark":"light"),s=a(()=>"dark"===r.value),n=a(()=>{const e=t.value,s=r.value,n=e.primaryColor,o=e.accentColor,i={"--color-primary":n,"--color-primary-rgb":l(n),"--color-accent":o,"--color-accent-rgb":l(o),"--border-radius-sm":c(e.borderRadius,"sm"),"--border-radius-md":c(e.borderRadius,"md"),"--border-radius-lg":c(e.borderRadius,"lg"),"--border-radius-xl":c(e.borderRadius,"xl"),"--font-size-xs":d(e.fontSize,"xs"),"--font-size-sm":d(e.fontSize,"sm"),"--font-size-base":d(e.fontSize,"base"),"--font-size-lg":d(e.fontSize,"lg"),"--font-size-xl":d(e.fontSize,"xl"),"--font-size-2xl":d(e.fontSize,"2xl"),"--font-size-3xl":d(e.fontSize,"3xl"),"--font-family":h(e.fontFamily),"--spacing-scale":e.compactMode?"0.875":"1","--transition-duration":e.reducedMotion?"0ms":"150ms","--animation-duration":e.reducedMotion?"0ms":"300ms"};return"dark"===s?Object.assign(i,{"--color-background":e.highContrast?"#000000":"#0f172a","--color-surface":e.highContrast?"#1a1a1a":"#1e293b","--color-surface-hover":e.highContrast?"#333333":"#334155","--color-border":e.highContrast?"#666666":"#475569","--color-text":e.highContrast?"#ffffff":"#f1f5f9","--color-text-secondary":e.highContrast?"#cccccc":"#cbd5e1","--color-text-muted":e.highContrast?"#999999":"#94a3b8"}):Object.assign(i,{"--color-background":(e.highContrast,"#ffffff"),"--color-surface":e.highContrast?"#f5f5f5":"#f8fafc","--color-surface-hover":e.highContrast?"#e5e5e5":"#f1f5f9","--color-border":e.highContrast?"#333333":"#e2e8f0","--color-text":e.highContrast?"#000000":"#1e293b","--color-text-secondary":e.highContrast?"#333333":"#475569","--color-text-muted":e.highContrast?"#666666":"#64748b"}),i}),o=()=>{const e=document.documentElement;e.setAttribute("data-theme",r.value),e.style.colorScheme=r.value,Object.entries(n.value).forEach(([t,r])=>{e.style.setProperty(t,r)}),e.classList.toggle("theme-dark",s.value),e.classList.toggle("theme-light",!s.value),e.classList.toggle("theme-compact",t.value.compactMode),e.classList.toggle("theme-high-contrast",t.value.highContrast),e.classList.toggle("theme-reduced-motion",t.value.reducedMotion)},i=e=>{t.value.mode=e},l=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(t){return`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`}return"0, 0, 0"},c=(e,t)=>({none:{sm:"0",md:"0",lg:"0",xl:"0"},small:{sm:"2px",md:"4px",lg:"6px",xl:"8px"},medium:{sm:"4px",md:"6px",lg:"8px",xl:"12px"},large:{sm:"6px",md:"8px",lg:"12px",xl:"16px"}}[e][t]||"4px"),d=(e,t)=>({small:{xs:"0.6875rem",sm:"0.75rem",base:"0.8125rem",lg:"0.9375rem",xl:"1.0625rem","2xl":"1.3125rem","3xl":"1.6875rem"},medium:{xs:"0.75rem",sm:"0.875rem",base:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem"},large:{xs:"0.8125rem",sm:"0.9375rem",base:"1.0625rem",lg:"1.1875rem",xl:"1.3125rem","2xl":"1.5625rem","3xl":"1.9375rem"}}[e][t]||"1rem"),h=e=>{const t={system:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',inter:'"Inter", -apple-system, BlinkMacSystemFont, sans-serif',roboto:'"Roboto", -apple-system, BlinkMacSystemFont, sans-serif',poppins:'"Poppins", -apple-system, BlinkMacSystemFont, sans-serif'};return t[e]||t.system},f=e=>"object"==typeof e&&null!==e&&["light","dark","auto"].includes(e.mode)&&"string"==typeof e.primaryColor&&"string"==typeof e.accentColor;return u([t,e],o,{deep:!0,immediate:!1}),y(()=>{o()}),{themeConfig:t,activeColorScheme:r,isDark:s,cssVariables:n,themePresets:Ki,setThemeMode:i,toggleDark:()=>{"auto"===t.value.mode?i("dark"===e.value?"light":"dark"):i("dark"===t.value.mode?"light":"dark")},setPrimaryColor:e=>{t.value.primaryColor=e},setAccentColor:e=>{t.value.accentColor=e},applyPreset:e=>{const r=Ki.find(t=>t.id===e);r&&Object.assign(t.value,r.config)},resetTheme:()=>{t.value={...Ji}},exportTheme:()=>JSON.stringify(t.value,null,2),importTheme:e=>{try{const r=JSON.parse(e);return!!f(r)&&(t.value={...Ji,...r},!0)}catch{return!1}},getThemeInfo:()=>({mode:t.value.mode,colorScheme:r.value,isDark:s.value,config:{...t.value}}),applyTheme:o}}const Hi=(e,t)=>{const r=e.__vccOpts||e;for(const[s,n]of t)r[s]=n;return r},Yi={class:"theme-selector"},Xi=["title"],Qi={class:"panel-header"},Zi={class:"panel-content"},ea={class:"setting-group"},ta={class:"theme-mode-options"},ra=["onClick"],sa={class:"setting-group"},na={class:"theme-presets"},oa=["onClick"],ia={class:"preset-preview"},aa={class:"preset-info"},la={class:"preset-name"},ca={class:"preset-description"},ua={class:"setting-group"},da={class:"color-settings"},ha={class:"color-setting"},fa={class:"color-input-wrapper"},pa={class:"color-value"},ma={class:"color-setting"},ga={class:"color-input-wrapper"},va={class:"color-value"},ya={class:"setting-group"},ba={class:"advanced-settings"},_a={class:"setting-row"},wa={class:"setting-row"},ka={class:"setting-row"},Sa={class:"setting-row"},Ta={class:"setting-checkbox"},Ea={class:"setting-row"},Pa={class:"setting-checkbox"},Ca={class:"setting-row"},ja={class:"setting-checkbox"},Oa={class:"panel-actions"},Aa={key:0,class:"export-import-section"},Ia={class:"export-section"},xa=["value"],$a={class:"import-section"},Ra=["disabled"],La={key:0,class:"import-error"};const Ua=Hi(s({__name:"ThemeSelector",setup(e,{expose:t}){t();const{themeConfig:r,isDark:s,themePresets:n,setThemeMode:o,setPrimaryColor:i,setAccentColor:a,applyPreset:l,resetTheme:u,exportTheme:d,importTheme:h}=Gi(),f=c(!1),p=c(!1),m=c(""),g=c(""),v=c(!1),y={themeConfig:r,isDark:s,themePresets:n,setThemeMode:o,setPrimaryColor:i,setAccentColor:a,applyPreset:l,resetTheme:u,exportTheme:d,importTheme:h,showPanel:f,showExportImport:p,importConfig:m,importError:g,copied:v,themeModes:[{value:"light",label:"浅色",icon:k},{value:"dark",label:"深色",icon:S},{value:"auto",label:"自动",icon:T}],isPresetActive:e=>e.config.primaryColor===r.value.primaryColor&&e.config.accentColor===r.value.accentColor,copyThemeConfig:async()=>{try{await navigator.clipboard.writeText(d()),v.value=!0,setTimeout(()=>{v.value=!1},2e3)}catch(e){console.error("复制失败:",e)}},handleImportTheme:()=>{if(g.value="",!m.value.trim())return void(g.value="请输入主题配置");h(m.value)?(m.value="",p.value=!1,f.value=!1):g.value="主题配置格式错误"},get SunIcon(){return k},get MoonIcon(){return S},get XIcon(){return E}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),[["render",function(e,t,r,s,n,o){return q(),P("div",Yi,[C("button",{onClick:t[0]||(t[0]=e=>s.showPanel=!s.showPanel),class:"theme-toggle-button",title:s.isDark?"切换到浅色主题":"切换到深色主题"},[s.isDark?(q(),O(s.SunIcon,{key:0,class:"icon"})):(q(),O(s.MoonIcon,{key:1,class:"icon"}))],8,Xi),s.showPanel?(q(),P("div",{key:0,class:"theme-panel",onClick:t[16]||(t[16]=A(()=>{},["stop"]))},[C("div",Qi,[t[18]||(t[18]=C("h3",{class:"panel-title"},"主题设置",-1)),C("button",{onClick:t[1]||(t[1]=e=>s.showPanel=!1),class:"close-button"},[I(s.XIcon,{class:"icon"})])]),C("div",Zi,[C("div",ea,[t[19]||(t[19]=C("label",{class:"setting-label"},"主题模式",-1)),C("div",ta,[(q(),P(x,null,$(s.themeModes,e=>C("button",{key:e.value,onClick:t=>s.setThemeMode(e.value),class:M(["mode-button",{active:s.themeConfig.mode===e.value}])},[(q(),O(B(e.icon),{class:"mode-icon"})),C("span",null,U(e.label),1)],10,ra)),64))])]),C("div",sa,[t[20]||(t[20]=C("label",{class:"setting-label"},"预设主题",-1)),C("div",na,[(q(!0),P(x,null,$(s.themePresets,e=>(q(),P("div",{key:e.id,onClick:t=>s.applyPreset(e.id),class:M(["preset-card",{active:s.isPresetActive(e)}])},[C("div",ia,[C("div",{class:"preview-color primary",style:V({backgroundColor:e.preview.primary})},null,4),C("div",{class:"preview-color secondary",style:V({backgroundColor:e.preview.secondary})},null,4),C("div",{class:"preview-color background",style:V({backgroundColor:e.preview.background})},null,4),C("div",{class:"preview-color surface",style:V({backgroundColor:e.preview.surface})},null,4)]),C("div",aa,[C("h4",la,U(e.name),1),C("p",ca,U(e.description),1)])],10,oa))),128))])]),C("div",ua,[t[23]||(t[23]=C("label",{class:"setting-label"},"自定义颜色",-1)),C("div",da,[C("div",ha,[t[21]||(t[21]=C("label",{class:"color-label"},"主色调",-1)),C("div",fa,[R(C("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.themeConfig.primaryColor=e),type:"color",class:"color-input",onChange:t[3]||(t[3]=e=>s.setPrimaryColor(s.themeConfig.primaryColor))},null,544),[[L,s.themeConfig.primaryColor]]),C("span",pa,U(s.themeConfig.primaryColor),1)])]),C("div",ma,[t[22]||(t[22]=C("label",{class:"color-label"},"强调色",-1)),C("div",ga,[R(C("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.themeConfig.accentColor=e),type:"color",class:"color-input",onChange:t[5]||(t[5]=e=>s.setAccentColor(s.themeConfig.accentColor))},null,544),[[L,s.themeConfig.accentColor]]),C("span",va,U(s.themeConfig.accentColor),1)])])])]),C("div",ya,[t[33]||(t[33]=C("label",{class:"setting-label"},"高级设置",-1)),C("div",ba,[C("div",_a,[t[25]||(t[25]=C("label",{class:"setting-item-label"},"边框圆角",-1)),R(C("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.themeConfig.borderRadius=e),class:"setting-select"},t[24]||(t[24]=[C("option",{value:"none"},"无圆角",-1),C("option",{value:"small"},"小圆角",-1),C("option",{value:"medium"},"中等圆角",-1),C("option",{value:"large"},"大圆角",-1)]),512),[[D,s.themeConfig.borderRadius]])]),C("div",wa,[t[27]||(t[27]=C("label",{class:"setting-item-label"},"字体大小",-1)),R(C("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>s.themeConfig.fontSize=e),class:"setting-select"},t[26]||(t[26]=[C("option",{value:"small"},"小",-1),C("option",{value:"medium"},"中",-1),C("option",{value:"large"},"大",-1)]),512),[[D,s.themeConfig.fontSize]])]),C("div",ka,[t[29]||(t[29]=C("label",{class:"setting-item-label"},"字体",-1)),R(C("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.themeConfig.fontFamily=e),class:"setting-select"},t[28]||(t[28]=[C("option",{value:"system"},"系统字体",-1),C("option",{value:"inter"},"Inter",-1),C("option",{value:"roboto"},"Roboto",-1),C("option",{value:"poppins"},"Poppins",-1)]),512),[[D,s.themeConfig.fontFamily]])]),C("div",Sa,[C("label",Ta,[R(C("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>s.themeConfig.compactMode=e),type:"checkbox"},null,512),[[N,s.themeConfig.compactMode]]),t[30]||(t[30]=C("span",{class:"checkbox-label"},"紧凑模式",-1))])]),C("div",Ea,[C("label",Pa,[R(C("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>s.themeConfig.highContrast=e),type:"checkbox"},null,512),[[N,s.themeConfig.highContrast]]),t[31]||(t[31]=C("span",{class:"checkbox-label"},"高对比度",-1))])]),C("div",Ca,[C("label",ja,[R(C("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>s.themeConfig.reducedMotion=e),type:"checkbox"},null,512),[[N,s.themeConfig.reducedMotion]]),t[32]||(t[32]=C("span",{class:"checkbox-label"},"减少动画",-1))])])])]),C("div",Oa,[C("button",{onClick:t[12]||(t[12]=(...e)=>s.resetTheme&&s.resetTheme(...e)),class:"action-button secondary"}," 重置主题 "),C("button",{onClick:t[13]||(t[13]=e=>s.showExportImport=!s.showExportImport),class:"action-button secondary"}," 导入/导出 ")]),s.showExportImport?(q(),P("div",Aa,[C("div",Ia,[t[34]||(t[34]=C("label",{class:"setting-label"},"导出主题",-1)),C("textarea",{value:s.exportTheme(),readonly:"",class:"export-textarea",onClick:t[14]||(t[14]=e=>e.target.select())},null,8,xa),C("button",{onClick:s.copyThemeConfig,class:"copy-button"},U(s.copied?"已复制":"复制配置"),1)]),C("div",$a,[t[35]||(t[35]=C("label",{class:"setting-label"},"导入主题",-1)),R(C("textarea",{"onUpdate:modelValue":t[15]||(t[15]=e=>s.importConfig=e),placeholder:"粘贴主题配置...",class:"import-textarea"},null,512),[[L,s.importConfig]]),C("button",{onClick:s.handleImportTheme,disabled:!s.importConfig.trim(),class:"import-button"}," 导入主题 ",8,Ra),s.importError?(q(),P("p",La,U(s.importError),1)):j("",!0)])])):j("",!0)])])):j("",!0),s.showPanel?(q(),P("div",{key:1,class:"panel-overlay",onClick:t[17]||(t[17]=e=>s.showPanel=!1)})):j("",!0)])}],["__scopeId","data-v-13a76bfc"],["__file","/mnt/persist/workspace/src/components/theme/ThemeSelector.vue"]]);const Da=new class{constructor(){t(this,"eventSource")}async getUserNotifications(e,t={}){try{const{page:r=1,limit:s=20,type:n,unread_only:o,important_only:i}=t;let a=bi.from("notifications").select("*",{count:"exact"}).eq("user_id",e);n&&(a=a.eq("type",n)),o&&(a=a.eq("is_read",!1)),i&&(a=a.eq("is_important",!0)),a=a.or("expires_at.is.null,expires_at.gt."+(new Date).toISOString()),a=a.order("is_important",{ascending:!1}).order("created_at",{ascending:!1}).range((r-1)*s,r*s-1);const{data:l,error:c,count:u}=await a;if(c)throw c;return{notifications:l||[],total:u||0,stats:await this.getNotificationStats(e)}}catch(r){throw console.error("获取通知失败:",r),r}}async getNotificationStats(e){try{const{data:t,error:r}=await bi.from("notifications").select("type, is_read, is_important").eq("user_id",e).or("expires_at.is.null,expires_at.gt."+(new Date).toISOString());if(r)throw r;const s={total:(null==t?void 0:t.length)||0,unread:0,important:0,by_type:{}};return null==t||t.forEach(e=>{e.is_read||s.unread++,e.is_important&&s.important++;const t=e.type;s.by_type[t]=(s.by_type[t]||0)+1}),s}catch(t){throw console.error("获取通知统计失败:",t),t}}async createNotification(e){try{const{data:t,error:r}=await bi.from("notifications").insert({...e,is_read:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select().single();if(r)throw r;return this.sendRealTimeNotification(t),t}catch(t){throw console.error("创建通知失败:",t),t}}async createBulkNotifications(e){try{const t=e.map(e=>({...e,is_read:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()})),{data:r,error:s}=await bi.from("notifications").insert(t).select();if(s)throw s;return null==r||r.forEach(e=>{this.sendRealTimeNotification(e)}),r||[]}catch(t){throw console.error("批量创建通知失败:",t),t}}async markAsRead(e,t){try{const{error:r}=await bi.from("notifications").update({is_read:!0,updated_at:(new Date).toISOString()}).eq("id",e).eq("user_id",t);if(r)throw r}catch(r){throw console.error("标记通知已读失败:",r),r}}async markAllAsRead(e,t){try{let r=bi.from("notifications").update({is_read:!0,updated_at:(new Date).toISOString()}).eq("user_id",e).eq("is_read",!1);t&&(r=r.eq("type",t));const{error:s}=await r;if(s)throw s}catch(r){throw console.error("批量标记已读失败:",r),r}}async deleteNotification(e,t){try{const{error:r}=await bi.from("notifications").delete().eq("id",e).eq("user_id",t);if(r)throw r}catch(r){throw console.error("删除通知失败:",r),r}}async cleanupExpiredNotifications(){try{const{error:e}=await bi.from("notifications").delete().lt("expires_at",(new Date).toISOString());if(e)throw e}catch(e){throw console.error("清理过期通知失败:",e),e}}async getUserPreferences(e){try{const{data:t,error:r}=await bi.from("notification_preferences").select("*").eq("user_id",e).single();if(r){if("PGRST116"===r.code)return await this.createDefaultPreferences(e);throw r}return t}catch(t){throw console.error("获取通知偏好失败:",t),t}}async createDefaultPreferences(e){try{const t={user_id:e,email_notifications:!0,push_notifications:!0,system_notifications:!0,product_notifications:!0,order_notifications:!0,marketing_notifications:!1,notification_frequency:"immediate",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{data:r,error:s}=await bi.from("notification_preferences").insert(t).select().single();if(s)throw s;return r}catch(t){throw console.error("创建默认通知偏好失败:",t),t}}async updatePreferences(e,t){try{const{data:r,error:s}=await bi.from("notification_preferences").update({...t,updated_at:(new Date).toISOString()}).eq("user_id",e).select().single();if(s)throw s;return r}catch(r){throw console.error("更新通知偏好失败:",r),r}}sendRealTimeNotification(e){bi.channel("notifications").send({type:"broadcast",event:"new_notification",payload:e})}subscribeToNotifications(e,t){const r=bi.channel(`notifications:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${e}`},e=>{t(e.new)}).subscribe();return()=>{bi.removeChannel(r)}}async requestNotificationPermission(){if(!("Notification"in window))throw new Error("此浏览器不支持桌面通知");if("granted"===Notification.permission)return"granted";if("denied"!==Notification.permission){return await Notification.requestPermission()}return Notification.permission}async showBrowserNotification(e,t={}){try{if("granted"===await this.requestNotificationPermission()){const r=new Notification(e,{icon:"/favicon.ico",badge:"/favicon.ico",...t});setTimeout(()=>{r.close()},5e3)}}catch(r){console.error("显示浏览器通知失败:",r)}}async sendSystemNotification(e,t,r,s={}){try{const n=e.map(e=>({user_id:e,type:s.type||"system",title:t,message:r,action_url:s.action_url,action_text:s.action_text,is_important:s.is_important||!1,expires_at:s.expires_at}));await this.createBulkNotifications(n)}catch(n){throw console.error("发送系统通知失败:",n),n}}},Na={class:"notification-content"},qa={class:"notification-header"},Ma={class:"notification-icon"},Ba={class:"notification-meta"},Va={class:"notification-title"},Fa={class:"notification-time"},za={class:"notification-actions"},Wa={class:"notification-body"},Ja={class:"notification-message"},Ka={key:0,class:"notification-action"},Ga={key:0,class:"unread-indicator"};const Ha=Hi(s({__name:"NotificationItem",props:{notification:{type:Object,required:!0}},emits:["read","delete","action"],setup(e,{expose:t,emit:r}){t();const s=e,n=r,o={props:s,emit:n,getTypeIcon:()=>{switch(s.notification.type){case"success":return H;case"warning":return G;case"error":return K;case"system":return J;case"product":return W;case"order":return z;default:return F}},formatTime:e=>{const t=new Date(e),r=(new Date).getTime()-t.getTime(),s=Math.floor(r/6e4),n=Math.floor(r/36e5),o=Math.floor(r/864e5);return s<1?"刚刚":s<60?`${s}分钟前`:n<24?`${n}小时前`:o<7?`${o}天前`:t.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},markAsRead:()=>{n("read",s.notification.id)},deleteNotification:()=>{n("delete",s.notification.id)},handleAction:()=>{n("action",s.notification)},get CheckIcon(){return X},get XIcon(){return E},get ExternalLinkIcon(){return Y}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),[["render",function(e,t,r,s,n,o){return q(),P("div",{class:M(["notification-item",{"is-unread":!r.notification.is_read,"is-important":r.notification.is_important,[`type-${r.notification.type}`]:!0}])},[C("div",Na,[C("div",qa,[C("div",Ma,[(q(),O(B(s.getTypeIcon()),{class:"icon"}))]),C("div",Ba,[C("h4",Va,U(r.notification.title),1),C("span",Fa,U(s.formatTime(r.notification.created_at)),1)]),C("div",za,[r.notification.is_read?j("",!0):(q(),P("button",{key:0,onClick:s.markAsRead,class:"action-button read-button",title:"标记为已读"},[I(s.CheckIcon,{class:"icon"})])),C("button",{onClick:s.deleteNotification,class:"action-button delete-button",title:"删除通知"},[I(s.XIcon,{class:"icon"})])])]),C("div",Wa,[C("p",Ja,U(r.notification.message),1),r.notification.action_url?(q(),P("div",Ka,[C("button",{onClick:s.handleAction,class:"action-link"},[Q(U(r.notification.action_text||"查看详情")+" ",1),I(s.ExternalLinkIcon,{class:"icon"})])])):j("",!0)])]),r.notification.is_read?j("",!0):(q(),P("div",Ga))],2)}],["__scopeId","data-v-23eeaef7"],["__file","/mnt/persist/workspace/src/components/notifications/NotificationItem.vue"]]),Ya={class:"notification-settings-modal"},Xa={class:"modal-content"},Qa={class:"modal-header"},Za={class:"modal-body"},el={key:0,class:"loading-state"},tl={key:1,class:"settings-form"},rl={class:"setting-section"},sl={class:"setting-grid"},nl={class:"setting-item"},ol={class:"setting-label"},il={class:"setting-item"},al={class:"setting-label"},ll={class:"setting-item"},cl={class:"setting-label"},ul={class:"setting-item"},dl={class:"setting-label"},hl={class:"setting-item"},fl={class:"setting-label"},pl={class:"setting-item"},ml={class:"setting-label"},gl={class:"setting-section"},vl={class:"frequency-options"},yl=["value"],bl={class:"option-content"},_l={class:"option-title"},wl={class:"option-description"},kl={class:"setting-section"},Sl={class:"quiet-hours"},Tl={class:"time-input-group"},El={class:"time-input-group"},Pl={class:"modal-footer"},Cl=["disabled"];const jl=Hi(s({__name:"NotificationSettings",emits:["close","updated"],setup(e,{expose:t,emit:r}){t();const s=r,n=Si(),o=c(!0),i=c(!1),a=c({id:"",user_id:"",email_notifications:!0,push_notifications:!0,system_notifications:!0,product_notifications:!0,order_notifications:!0,marketing_notifications:!1,notification_frequency:"immediate",quiet_hours_start:"22:00",quiet_hours_end:"08:00",created_at:"",updated_at:""}),l=async()=>{if(n.user)try{o.value=!0;const e=await Da.getUserPreferences(n.user.id);e&&(a.value=e)}catch(e){console.error("加载通知偏好失败:",e)}finally{o.value=!1}};y(()=>{l()});const u={emit:s,authStore:n,loading:o,saving:i,preferences:a,frequencyOptions:[{value:"immediate",label:"立即通知",description:"收到通知后立即推送"},{value:"daily",label:"每日汇总",description:"每天汇总一次发送"},{value:"weekly",label:"每周汇总",description:"每周汇总一次发送"},{value:"never",label:"从不",description:"不接收任何通知"}],loadPreferences:l,saveSettings:async()=>{if(n.user&&!i.value)try{i.value=!0,await Da.updatePreferences(n.user.id,a.value),s("updated"),s("close")}catch(e){console.error("保存通知设置失败:",e)}finally{i.value=!1}},get XIcon(){return E}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),[["render",function(e,t,r,s,n,o){return q(),P("div",Ya,[C("div",{class:"modal-overlay",onClick:t[0]||(t[0]=t=>e.$emit("close"))}),C("div",Xa,[C("div",Qa,[t[12]||(t[12]=C("h2",{class:"modal-title"},"通知设置",-1)),C("button",{onClick:t[1]||(t[1]=t=>e.$emit("close")),class:"close-button"},[I(s.XIcon,{class:"icon"})])]),C("div",Za,[s.loading?(q(),P("div",el,t[13]||(t[13]=[C("div",{class:"loading-spinner"},null,-1),C("p",null,"加载设置中...",-1)]))):(q(),P("div",tl,[C("div",rl,[t[26]||(t[26]=C("h3",{class:"section-title"},"通知类型",-1)),C("div",sl,[C("div",nl,[C("label",ol,[R(C("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.preferences.email_notifications=e),type:"checkbox",class:"setting-checkbox"},null,512),[[N,s.preferences.email_notifications]]),t[14]||(t[14]=C("span",{class:"checkbox-text"},"邮件通知",-1))]),t[15]||(t[15]=C("p",{class:"setting-description"},"通过邮件接收重要通知",-1))]),C("div",il,[C("label",al,[R(C("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.preferences.push_notifications=e),type:"checkbox",class:"setting-checkbox"},null,512),[[N,s.preferences.push_notifications]]),t[16]||(t[16]=C("span",{class:"checkbox-text"},"浏览器通知",-1))]),t[17]||(t[17]=C("p",{class:"setting-description"},"在浏览器中显示桌面通知",-1))]),C("div",ll,[C("label",cl,[R(C("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.preferences.system_notifications=e),type:"checkbox",class:"setting-checkbox"},null,512),[[N,s.preferences.system_notifications]]),t[18]||(t[18]=C("span",{class:"checkbox-text"},"系统通知",-1))]),t[19]||(t[19]=C("p",{class:"setting-description"},"接收系统更新和维护通知",-1))]),C("div",ul,[C("label",dl,[R(C("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>s.preferences.product_notifications=e),type:"checkbox",class:"setting-checkbox"},null,512),[[N,s.preferences.product_notifications]]),t[20]||(t[20]=C("span",{class:"checkbox-text"},"产品通知",-1))]),t[21]||(t[21]=C("p",{class:"setting-description"},"接收新产品和更新通知",-1))]),C("div",hl,[C("label",fl,[R(C("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.preferences.order_notifications=e),type:"checkbox",class:"setting-checkbox"},null,512),[[N,s.preferences.order_notifications]]),t[22]||(t[22]=C("span",{class:"checkbox-text"},"订单通知",-1))]),t[23]||(t[23]=C("p",{class:"setting-description"},"接收订单状态更新通知",-1))]),C("div",pl,[C("label",ml,[R(C("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>s.preferences.marketing_notifications=e),type:"checkbox",class:"setting-checkbox"},null,512),[[N,s.preferences.marketing_notifications]]),t[24]||(t[24]=C("span",{class:"checkbox-text"},"营销通知",-1))]),t[25]||(t[25]=C("p",{class:"setting-description"},"接收促销和营销活动通知",-1))])])]),C("div",gl,[t[27]||(t[27]=C("h3",{class:"section-title"},"通知频率",-1)),C("div",vl,[(q(),P(x,null,$(s.frequencyOptions,e=>C("label",{key:e.value,class:M(["frequency-option",{active:s.preferences.notification_frequency===e.value}])},[R(C("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.preferences.notification_frequency=e),value:e.value,type:"radio",class:"frequency-radio"},null,8,yl),[[Z,s.preferences.notification_frequency]]),C("div",bl,[C("span",_l,U(e.label),1),C("span",wl,U(e.description),1)])],2)),64))])]),C("div",kl,[t[31]||(t[31]=C("h3",{class:"section-title"},"免打扰时间",-1)),C("div",Sl,[C("div",Tl,[t[28]||(t[28]=C("label",{class:"time-label"},"开始时间",-1)),R(C("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>s.preferences.quiet_hours_start=e),type:"time",class:"time-input"},null,512),[[L,s.preferences.quiet_hours_start]])]),t[30]||(t[30]=C("div",{class:"time-separator"},"-",-1)),C("div",El,[t[29]||(t[29]=C("label",{class:"time-label"},"结束时间",-1)),R(C("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>s.preferences.quiet_hours_end=e),type:"time",class:"time-input"},null,512),[[L,s.preferences.quiet_hours_end]])])]),t[32]||(t[32]=C("p",{class:"setting-description"},"在此时间段内不会收到通知",-1))])]))]),C("div",Pl,[C("button",{onClick:t[11]||(t[11]=t=>e.$emit("close")),class:"button button-secondary"}," 取消 "),C("button",{onClick:s.saveSettings,disabled:s.saving,class:"button button-primary"},U(s.saving?"保存中...":"保存设置"),9,Cl)])])])}],["__scopeId","data-v-62df20b2"],["__file","/mnt/persist/workspace/src/components/notifications/NotificationSettings.vue"]]),Ol=s({__name:"NotificationCenter",setup(e,{expose:t}){t();const r=Si(),s=c(!1),n=c(!1),o=c(!1),i=c(!1),l=c(!1),d=c([]),h=c({total:0,unread:0,important:0,by_type:{}}),f=c(1),p=c(!1),m=c("all");let g=null;const v=a(()=>[{key:"all",label:"全部",count:h.value.total},{key:"unread",label:"未读",count:h.value.unread},{key:"important",label:"重要",count:h.value.important},{key:"system",label:"系统",count:h.value.by_type.system||0},{key:"product",label:"产品",count:h.value.by_type.product||0},{key:"order",label:"订单",count:h.value.by_type.order||0}]),b=a(()=>{switch(m.value){case"unread":return d.value.filter(e=>!e.is_read);case"important":return d.value.filter(e=>e.is_important);case"system":case"product":case"order":return d.value.filter(e=>e.type===m.value);default:return d.value}}),_=async(e=!0)=>{if(r.user)try{e?(o.value=!0,f.value=1,d.value=[]):i.value=!0;const t={page:f.value,limit:20};"unread"===m.value?t.unread_only=!0:"important"===m.value?t.important_only=!0:["system","product","order"].includes(m.value)&&(t.type=m.value);const s=await Da.getUserNotifications(r.user.id,t);e?d.value=s.notifications:d.value.push(...s.notifications),h.value=s.stats,p.value=d.value.length<s.total}catch(t){console.error("加载通知失败:",t)}finally{o.value=!1,i.value=!1}},w=async e=>{if(r.user)try{await Da.markAsRead(e,r.user.id);const t=d.value.find(t=>t.id===e);t&&(t.is_read=!0,h.value.unread=Math.max(0,h.value.unread-1))}catch(t){console.error("标记已读失败:",t)}},k=()=>{r.user&&(g=Da.subscribeToNotifications(r.user.id,e=>{d.value.unshift(e),h.value.total++,h.value.unread++,e.is_important&&h.value.important++;const t=h.value.by_type[e.type]||0;h.value.by_type[e.type]=t+1,Da.showBrowserNotification(e.title,{body:e.message,tag:e.id,requireInteraction:e.is_important})}))};y(()=>{k(),r.user&&Da.getNotificationStats(r.user.id).then(e=>{h.value=e}).catch(e=>{console.error("加载通知统计失败:",e)})}),ee(()=>{g&&g()}),u(m,()=>{_()}),u(()=>r.user,e=>{e?(k(),s.value&&_()):(g&&(g(),g=null),d.value=[],h.value={total:0,unread:0,important:0,by_type:{}})});const S={authStore:r,showPanel:s,showSettings:n,loading:o,loadingMore:i,markingAllRead:l,notifications:d,stats:h,currentPage:f,hasMore:p,activeFilter:m,get unsubscribe(){return g},set unsubscribe(e){g=e},filters:v,filteredNotifications:b,togglePanel:()=>{s.value=!s.value,s.value&&0===d.value.length&&_()},closePanel:()=>{s.value=!1},loadNotifications:_,loadMore:async()=>{p.value&&!i.value&&(f.value++,await _(!1))},markAllAsRead:async()=>{if(r.user&&!l.value)try{l.value=!0;const e=["system","product","order"].includes(m.value)?m.value:void 0;await Da.markAllAsRead(r.user.id,e),d.value.forEach(t=>{e&&t.type!==e||(t.is_read=!0)}),await _()}catch(e){console.error("标记全部已读失败:",e)}finally{l.value=!1}},handleNotificationRead:w,handleNotificationDelete:async e=>{if(r.user)try{await Da.deleteNotification(e,r.user.id);const t=d.value.findIndex(t=>t.id===e);if(-1!==t){const e=d.value[t];d.value.splice(t,1),h.value.total--,e.is_read||h.value.unread--,e.is_important&&h.value.important--;const r=h.value.by_type[e.type]||0;h.value.by_type[e.type]=Math.max(0,r-1)}}catch(t){console.error("删除通知失败:",t)}},handleNotificationAction:e=>{e.action_url&&window.open(e.action_url,"_blank"),e.is_read||w(e.id)},handleSettingsUpdated:()=>{n.value=!1},getEmptyMessage:()=>{switch(m.value){case"unread":return"所有通知都已阅读";case"important":return"暂无重要通知";case"system":return"暂无系统通知";case"product":return"暂无产品通知";case"order":return"暂无订单通知";default:return"您还没有收到任何通知"}},setupRealtimeSubscription:k,get BellIcon(){return J},get SettingsIcon(){return te},get XIcon(){return E},NotificationItem:Ha,NotificationSettings:jl};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),Al={class:"notification-center"},Il={key:0,class:"notification-badge"},xl={class:"panel-header"},$l={class:"panel-actions"},Rl=["disabled"],Ll={class:"notification-filters"},Ul=["onClick"],Dl={key:0,class:"filter-count"},Nl={class:"notification-list"},ql={key:0,class:"loading-state"},Ml={key:1,class:"empty-state"},Bl={key:2,class:"notifications"},Vl={key:0,class:"load-more"},Fl=["disabled"];const zl=Hi(Ol,[["render",function(e,t,r,s,n,o){return q(),P("div",Al,[C("div",{class:"notification-trigger",onClick:s.togglePanel},[C("button",{class:M(["notification-button",{"has-unread":s.stats.unread>0}])},[I(s.BellIcon,{class:"icon"}),s.stats.unread>0?(q(),P("span",Il,U(s.stats.unread>99?"99+":s.stats.unread),1)):j("",!0)],2)]),s.showPanel?(q(),P("div",{key:0,class:"notification-panel",onClick:t[1]||(t[1]=A(()=>{},["stop"]))},[C("div",xl,[t[3]||(t[3]=C("h3",{class:"panel-title"},"通知中心",-1)),C("div",$l,[s.stats.unread>0?(q(),P("button",{key:0,onClick:s.markAllAsRead,class:"mark-all-read-button",disabled:s.markingAllRead},U(s.markingAllRead?"标记中...":"全部已读"),9,Rl)):j("",!0),C("button",{onClick:t[0]||(t[0]=e=>s.showSettings=!0),class:"settings-button"},[I(s.SettingsIcon,{class:"icon"})]),C("button",{onClick:s.closePanel,class:"close-button"},[I(s.XIcon,{class:"icon"})])])]),C("div",Ll,[(q(!0),P(x,null,$(s.filters,e=>(q(),P("button",{key:e.key,onClick:t=>s.activeFilter=e.key,class:M(["filter-button",{active:s.activeFilter===e.key}])},[Q(U(e.label)+" ",1),e.count>0?(q(),P("span",Dl,U(e.count),1)):j("",!0)],10,Ul))),128))]),C("div",Nl,[s.loading?(q(),P("div",ql,t[4]||(t[4]=[C("div",{class:"loading-spinner"},null,-1),C("p",null,"加载通知中...",-1)]))):0===s.filteredNotifications.length?(q(),P("div",Ml,[t[5]||(t[5]=C("div",{class:"empty-icon"},"🔔",-1)),t[6]||(t[6]=C("h4",null,"暂无通知",-1)),C("p",null,U(s.getEmptyMessage()),1)])):(q(),P("div",Bl,[(q(!0),P(x,null,$(s.filteredNotifications,e=>(q(),O(s.NotificationItem,{key:e.id,notification:e,onRead:s.handleNotificationRead,onDelete:s.handleNotificationDelete,onAction:s.handleNotificationAction},null,8,["notification"]))),128)),s.hasMore?(q(),P("div",Vl,[C("button",{onClick:s.loadMore,disabled:s.loadingMore,class:"load-more-button"},U(s.loadingMore?"加载中...":"加载更多"),9,Fl)])):j("",!0)]))])])):j("",!0),s.showSettings?(q(),O(s.NotificationSettings,{key:1,onClose:t[2]||(t[2]=e=>s.showSettings=!1),onUpdated:s.handleSettingsUpdated})):j("",!0),s.showPanel?(q(),P("div",{key:2,class:"panel-overlay",onClick:s.closePanel})):j("",!0)])}],["__scopeId","data-v-a021628d"],["__file","/mnt/persist/workspace/src/components/notifications/NotificationCenter.vue"]]),Wl={class:"app-header"},Jl={class:"header-content"},Kl={class:"header-left"},Gl={class:"header-center"},Hl={class:"search-container"},Yl={class:"search-actions"},Xl={class:"header-right"},Ql={key:0,class:"user-menu"},Zl=["src","alt"],ec={key:1,class:"avatar-placeholder"},tc={key:0,class:"user-dropdown"},rc={class:"user-info"},sc={class:"user-name"},nc={class:"user-email"};const oc=Hi(s({__name:"AppHeader",setup(e,{expose:t}){t();const r=Ar(),s=ki(),n=Si(),o=c(),i=c(!1),a=()=>{i.value=!1},l=e=>{var t;(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),null==(t=o.value)||t.focus()),"Escape"===e.key&&(i.value=!1)},u=e=>{e.target.closest(".user-menu")||(i.value=!1)};y(()=>{document.addEventListener("keydown",l),document.addEventListener("click",u)}),ee(()=>{document.removeEventListener("keydown",l),document.removeEventListener("click",u)});const d={router:r,toolsStore:s,authStore:n,searchInput:o,showUserMenu:i,handleSearch:()=>{s.searchQuery.trim()&&r.push({name:"Tools",query:{search:s.searchQuery.trim()}})},clearSearch:()=>{var e;s.searchQuery="",null==(e=o.value)||e.focus()},toggleUserMenu:()=>{i.value=!i.value},closeUserMenu:a,handleLogout:async()=>{try{await n.logout(),a(),r.push("/")}catch(e){console.error("退出登录失败:",e)}},handleKeydown:l,handleClickOutside:u,ThemeSelector:Ua,NotificationCenter:zl,get MenuIcon(){return ie},get SearchIcon(){return oe},get XIcon(){return E},get UserIcon(){return ne},get StarIcon(){return se},get PackageIcon(){return W},get SettingsIcon(){return te},get LogOutIcon(){return re}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),[["render",function(e,t,r,s,n,o){var i,a,l,c,u;const d=ae("router-link");return q(),P("header",Wl,[C("div",Jl,[C("div",Kl,[C("button",{class:M(["sidebar-toggle",{active:!s.toolsStore.sidebarCollapsed}]),onClick:t[0]||(t[0]=e=>s.toolsStore.toggleSidebar())},[I(s.MenuIcon,{class:"icon"})],2),I(d,{to:"/",class:"app-title"},{default:le(()=>t[2]||(t[2]=[C("div",{class:"title-icon"},"🚀",-1),C("div",{class:"title-text"},[C("h1",null,"工具导航站"),C("span",null,"让工作更高效")],-1)])),_:1,__:[2]})]),C("div",Gl,[C("div",Hl,[I(s.SearchIcon,{class:"search-icon"}),R(C("input",{ref:"searchInput","onUpdate:modelValue":t[1]||(t[1]=e=>s.toolsStore.searchQuery=e),type:"text",placeholder:"搜索工具、分类或功能...",class:"search-input",onKeydown:[ce(s.handleSearch,["enter"]),ce(s.clearSearch,["esc"])]},null,544),[[L,s.toolsStore.searchQuery]]),C("div",Yl,[s.toolsStore.searchQuery?(q(),P("button",{key:0,class:"clear-search",onClick:s.clearSearch},[I(s.XIcon,{class:"icon"})])):j("",!0),t[3]||(t[3]=C("div",{class:"search-shortcut"},"Ctrl+K",-1))])])]),C("div",Xl,[I(s.ThemeSelector),I(s.NotificationCenter),s.authStore.isAuthenticated?(q(),P("div",Ql,[C("button",{class:"user-avatar",onClick:s.toggleUserMenu},[(null==(i=s.authStore.user)?void 0:i.avatarUrl)?(q(),P("img",{key:0,src:s.authStore.user.avatarUrl,alt:s.authStore.user.username,class:"avatar-image"},null,8,Zl)):(q(),P("div",ec,U(null==(l=null==(a=s.authStore.user)?void 0:a.username)?void 0:l.charAt(0).toUpperCase()),1))]),s.showUserMenu?(q(),P("div",tc,[C("div",rc,[C("div",sc,U(null==(c=s.authStore.user)?void 0:c.username),1),C("div",nc,U(null==(u=s.authStore.user)?void 0:u.email),1)]),t[9]||(t[9]=C("div",{class:"menu-divider"},null,-1)),I(d,{to:"/user/profile",class:"menu-item",onClick:s.closeUserMenu},{default:le(()=>[I(s.UserIcon,{class:"icon"}),t[4]||(t[4]=Q(" 个人资料 "))]),_:1,__:[4]}),I(d,{to:"/user/favorites",class:"menu-item",onClick:s.closeUserMenu},{default:le(()=>[I(s.StarIcon,{class:"icon"}),t[5]||(t[5]=Q(" 我的收藏 "))]),_:1,__:[5]}),I(d,{to:"/user/orders",class:"menu-item",onClick:s.closeUserMenu},{default:le(()=>[I(s.PackageIcon,{class:"icon"}),t[6]||(t[6]=Q(" 我的订单 "))]),_:1,__:[6]}),t[10]||(t[10]=C("div",{class:"menu-divider"},null,-1)),s.authStore.isAdmin?(q(),O(d,{key:0,to:"/admin",class:"menu-item",onClick:s.closeUserMenu},{default:le(()=>[I(s.SettingsIcon,{class:"icon"}),t[7]||(t[7]=Q(" 管理后台 "))]),_:1,__:[7]})):j("",!0),C("button",{class:"menu-item logout",onClick:s.handleLogout},[I(s.LogOutIcon,{class:"icon"}),t[8]||(t[8]=Q(" 退出登录 "))])])):j("",!0)])):(q(),O(d,{key:1,to:"/auth/login",class:"login-btn"},{default:le(()=>[I(s.UserIcon,{class:"icon"}),t[11]||(t[11]=Q(" 登录 "))]),_:1,__:[11]}))])])])}],["__scopeId","data-v-48a13218"],["__file","/mnt/persist/workspace/src/components/AppHeader.vue"]]),ic={class:"app-footer"},ac={class:"footer-content"},lc={class:"footer-main"},cc={class:"footer-section company-info"},uc={class:"social-links"},dc={href:"#",class:"social-link",title:"微信"},hc={href:"#",class:"social-link",title:"微博"},fc={href:"#",class:"social-link",title:"GitHub"},pc={href:"#",class:"social-link",title:"邮箱"},mc={class:"footer-section"},gc={class:"footer-links"},vc={class:"footer-section contact-info"},yc={class:"contact-item"},bc={class:"contact-item"},_c={class:"contact-item"},wc={class:"contact-item"};const kc=Hi(s({__name:"AppFooter",setup(e,{expose:t}){t();const r={get MessageCircleIcon(){return ge},get TwitterIcon(){return me},get GithubIcon(){return pe},get MailIcon(){return fe},get PhoneIcon(){return he},get MapPinIcon(){return de},get ClockIcon(){return ue}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),[["render",function(e,t,r,s,n,o){const i=ae("router-link");return q(),P("footer",ic,[C("div",ac,[C("div",lc,[C("div",cc,[t[0]||(t[0]=C("div",{class:"company-logo"},[C("div",{class:"logo-icon"},"🚀"),C("div",{class:"logo-text"},[C("h3",null,"工具导航站"),C("p",null,"让工作更高效")])],-1)),t[1]||(t[1]=C("p",{class:"company-description"}," 专注于为用户提供优质的工具导航和产品展示服务，致力于提升工作效率，让每个人都能找到最适合的工具和产品。 ",-1)),C("div",uc,[C("a",dc,[I(s.MessageCircleIcon,{class:"icon"})]),C("a",hc,[I(s.TwitterIcon,{class:"icon"})]),C("a",fc,[I(s.GithubIcon,{class:"icon"})]),C("a",pc,[I(s.MailIcon,{class:"icon"})])])]),C("div",mc,[t[7]||(t[7]=C("h4",null,"快速导航",-1)),C("ul",gc,[C("li",null,[I(i,{to:"/"},{default:le(()=>t[2]||(t[2]=[Q("首页")])),_:1,__:[2]})]),C("li",null,[I(i,{to:"/tools"},{default:le(()=>t[3]||(t[3]=[Q("工具导航")])),_:1,__:[3]})]),C("li",null,[I(i,{to:"/products"},{default:le(()=>t[4]||(t[4]=[Q("产品展示")])),_:1,__:[4]})]),C("li",null,[I(i,{to:"/user/favorites"},{default:le(()=>t[5]||(t[5]=[Q("我的收藏")])),_:1,__:[5]})]),C("li",null,[I(i,{to:"/admin"},{default:le(()=>t[6]||(t[6]=[Q("管理后台")])),_:1,__:[6]})])])]),t[13]||(t[13]=ve('<div class="footer-section" data-v-6704560a><h4 data-v-6704560a>产品服务</h4><ul class="footer-links" data-v-6704560a><li data-v-6704560a><a href="#" data-v-6704560a>开发工具</a></li><li data-v-6704560a><a href="#" data-v-6704560a>设计工具</a></li><li data-v-6704560a><a href="#" data-v-6704560a>效率工具</a></li><li data-v-6704560a><a href="#" data-v-6704560a>AI工具</a></li><li data-v-6704560a><a href="#" data-v-6704560a>学习资源</a></li></ul></div><div class="footer-section" data-v-6704560a><h4 data-v-6704560a>帮助支持</h4><ul class="footer-links" data-v-6704560a><li data-v-6704560a><a href="#" data-v-6704560a>使用指南</a></li><li data-v-6704560a><a href="#" data-v-6704560a>常见问题</a></li><li data-v-6704560a><a href="#" data-v-6704560a>意见反馈</a></li><li data-v-6704560a><a href="#" data-v-6704560a>联系我们</a></li><li data-v-6704560a><a href="#" data-v-6704560a>服务条款</a></li></ul></div>',2)),C("div",vc,[t[12]||(t[12]=C("h4",null,"联系我们",-1)),C("div",yc,[I(s.PhoneIcon,{class:"contact-icon"}),t[8]||(t[8]=C("span",null,"400-123-4567",-1))]),C("div",bc,[I(s.MailIcon,{class:"contact-icon"}),t[9]||(t[9]=C("span",null,"contact@ramusi.cn",-1))]),C("div",_c,[I(s.MapPinIcon,{class:"contact-icon"}),t[10]||(t[10]=C("span",null,"北京市朝阳区科技园区",-1))]),C("div",wc,[I(s.ClockIcon,{class:"contact-icon"}),t[11]||(t[11]=C("span",null,"工作时间：9:00-18:00",-1))])])]),t[14]||(t[14]=ve('<div class="footer-bottom" data-v-6704560a><div class="footer-bottom-content" data-v-6704560a><div class="copyright" data-v-6704560a><p data-v-6704560a>© 2024 工具导航站. 保留所有权利.</p><p data-v-6704560a><a href="#" data-v-6704560a>隐私政策</a> | <a href="#" data-v-6704560a>服务条款</a> | <a href="#" data-v-6704560a>网站地图</a></p></div><div class="footer-stats" data-v-6704560a><div class="stat-item" data-v-6704560a><span class="stat-number" data-v-6704560a>1000+</span><span class="stat-label" data-v-6704560a>精选工具</span></div><div class="stat-item" data-v-6704560a><span class="stat-number" data-v-6704560a>50+</span><span class="stat-label" data-v-6704560a>工具分类</span></div><div class="stat-item" data-v-6704560a><span class="stat-number" data-v-6704560a>10000+</span><span class="stat-label" data-v-6704560a>用户使用</span></div></div></div></div>',1))])])}],["__scopeId","data-v-6704560a"],["__file","/mnt/persist/workspace/src/components/AppFooter.vue"]]),Sc={class:"feedback-widget"},Tc={key:0,class:"feedback-badge"},Ec={key:1,class:"feedback-panel"},Pc={class:"panel-header"},Cc={class:"panel-tabs"},jc=["onClick"],Oc={class:"panel-content"},Ac={key:0,class:"submit-feedback"},Ic={class:"form-group"},xc={class:"form-group"},$c={class:"form-group"},Rc={class:"form-group"},Lc={class:"form-group"},Uc={class:"form-label"},Dc={class:"form-actions"},Nc=["disabled"],qc={key:1,class:"feedback-history"},Mc={key:0,class:"loading-state"},Bc={key:1,class:"empty-state"},Vc={key:2,class:"feedback-list"},Fc={class:"feedback-header"},zc={class:"feedback-date"},Wc={class:"feedback-title"},Jc={class:"feedback-content"},Kc={key:0,class:"feedback-response"},Gc={class:"response-date"},Hc={key:2,class:"feedback-stats"},Yc={class:"stats-grid"},Xc={class:"stat-card"},Qc={class:"stat-number"},Zc={class:"stat-card"},eu={class:"stat-number"},tu={class:"stat-card"},ru={class:"stat-number"},su={class:"stat-card"},nu={class:"stat-number"},ou={class:"stats-charts"},iu={class:"chart-section"},au={class:"type-distribution"},lu={class:"type-label"},cu={class:"type-bar"},uu={class:"type-count"},du={key:2,class:"success-message"};const hu=Hi(s({__name:"FeedbackWidget",setup(e,{expose:t}){t();const r=Si(),s=c(!1),n=c("submit"),o=c(!1),i=c(!1),l=c(!1),u=m({type:"",title:"",content:"",priority:"medium",includeSystemInfo:!0}),d=c([]),h=c({total:0,pending:0,resolved:0,response_rate:0,by_type:{}}),f=a(()=>d.value.filter(e=>!e.is_read).length),p=async()=>{if(r.user)try{o.value=!0,console.log("加载反馈历史"),d.value=[{id:"1",type:"feature",title:"希望增加暗色主题",content:"建议增加暗色主题选项，方便夜间使用",priority:"medium",status:"resolved",response:"感谢您的建议！暗色主题功能已经在最新版本中上线。",response_at:"2024-12-25T10:00:00Z",is_read:!0,created_at:"2024-12-24T15:30:00Z"}],h.value={total:5,pending:2,resolved:3,response_rate:80,by_type:{bug:2,feature:2,improvement:1}}}catch(e){console.error("加载反馈历史失败:",e)}finally{o.value=!1}},g=()=>({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,screenResolution:`${screen.width}x${screen.height}`,timestamp:(new Date).toISOString()});y(()=>{r.user&&p()});const v={authStore:r,showPanel:s,activeTab:n,loading:o,submitting:i,showSuccessMessage:l,feedbackForm:u,feedbackList:d,stats:h,tabs:[{id:"submit",label:"提交反馈"},{id:"history",label:"反馈历史"},{id:"stats",label:"反馈统计"}],unreadCount:f,togglePanel:()=>{s.value=!s.value,s.value&&"history"===n.value&&p()},submitFeedback:async()=>{if(r.user)try{i.value=!0;const e={...u,user_id:r.user.id,system_info:u.includeSystemInfo?g():null};console.log("提交反馈:",e),await new Promise(e=>setTimeout(e,1e3)),Object.assign(u,{type:"",title:"",content:"",priority:"medium",includeSystemInfo:!0}),l.value=!0,setTimeout(()=>{l.value=!1},3e3),s.value=!1}catch(e){console.error("提交反馈失败:",e),alert("提交反馈失败，请稍后重试")}finally{i.value=!1}else alert("请先登录后再提交反馈")},loadFeedbackHistory:p,getSystemInfo:g,getTypeLabel:e=>({bug:"Bug 报告",feature:"功能建议",improvement:"改进建议",question:"问题咨询",other:"其他"}[e]||e),getPriorityLabel:e=>({low:"低",medium:"中",high:"高",urgent:"紧急"}[e]||e),formatDate:e=>new Date(e).toLocaleString("zh-CN"),get MessageCircleIcon(){return ge},get XIcon(){return E},get CheckCircleIcon(){return H}};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),[["render",function(e,t,r,s,n,o){return q(),P("div",Sc,[s.showPanel?j("",!0):(q(),P("button",{key:0,onClick:s.togglePanel,class:M(["feedback-button",{"has-feedback":s.unreadCount>0}]),title:"用户反馈"},[I(s.MessageCircleIcon,{class:"icon"}),s.unreadCount>0?(q(),P("span",Tc,U(s.unreadCount),1)):j("",!0)],2)),s.showPanel?(q(),P("div",Ec,[C("div",Pc,[t[5]||(t[5]=C("h3",{class:"panel-title"},"用户反馈",-1)),C("button",{onClick:s.togglePanel,class:"close-button"},[I(s.XIcon,{class:"icon"})])]),C("div",Cc,[(q(),P(x,null,$(s.tabs,e=>C("button",{key:e.id,onClick:t=>s.activeTab=e.id,class:M(["tab-button",{active:s.activeTab===e.id}])},U(e.label),11,jc)),64))]),C("div",Oc,["submit"===s.activeTab?(q(),P("div",Ac,[C("form",{onSubmit:A(s.submitFeedback,["prevent"]),class:"feedback-form"},[C("div",Ic,[t[7]||(t[7]=C("label",{for:"feedback-type",class:"form-label"},"反馈类型",-1)),R(C("select",{id:"feedback-type","onUpdate:modelValue":t[0]||(t[0]=e=>s.feedbackForm.type=e),class:"form-select",required:""},t[6]||(t[6]=[ve('<option value="" data-v-f0a4a50f>请选择反馈类型</option><option value="bug" data-v-f0a4a50f>Bug 报告</option><option value="feature" data-v-f0a4a50f>功能建议</option><option value="improvement" data-v-f0a4a50f>改进建议</option><option value="question" data-v-f0a4a50f>问题咨询</option><option value="other" data-v-f0a4a50f>其他</option>',6)]),512),[[D,s.feedbackForm.type]])]),C("div",xc,[t[8]||(t[8]=C("label",{for:"feedback-title",class:"form-label"},"标题",-1)),R(C("input",{id:"feedback-title","onUpdate:modelValue":t[1]||(t[1]=e=>s.feedbackForm.title=e),type:"text",class:"form-input",placeholder:"简要描述您的反馈",required:""},null,512),[[L,s.feedbackForm.title]])]),C("div",$c,[t[9]||(t[9]=C("label",{for:"feedback-content",class:"form-label"},"详细描述",-1)),R(C("textarea",{id:"feedback-content","onUpdate:modelValue":t[2]||(t[2]=e=>s.feedbackForm.content=e),class:"form-textarea",rows:"4",placeholder:"请详细描述您的反馈内容",required:""},null,512),[[L,s.feedbackForm.content]])]),C("div",Rc,[t[11]||(t[11]=C("label",{for:"feedback-priority",class:"form-label"},"优先级",-1)),R(C("select",{id:"feedback-priority","onUpdate:modelValue":t[3]||(t[3]=e=>s.feedbackForm.priority=e),class:"form-select"},t[10]||(t[10]=[C("option",{value:"low"},"低",-1),C("option",{value:"medium"},"中",-1),C("option",{value:"high"},"高",-1),C("option",{value:"urgent"},"紧急",-1)]),512),[[D,s.feedbackForm.priority]])]),C("div",Lc,[C("label",Uc,[R(C("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.feedbackForm.includeSystemInfo=e),type:"checkbox",class:"form-checkbox"},null,512),[[N,s.feedbackForm.includeSystemInfo]]),t[12]||(t[12]=Q(" 包含系统信息（浏览器、设备等） "))])]),C("div",Dc,[C("button",{type:"submit",disabled:s.submitting,class:"submit-button"},U(s.submitting?"提交中...":"提交反馈"),9,Nc)])],32)])):"history"===s.activeTab?(q(),P("div",qc,[s.loading?(q(),P("div",Mc,t[13]||(t[13]=[C("div",{class:"loading-spinner"},null,-1),C("p",null,"加载反馈历史...",-1)]))):0===s.feedbackList.length?(q(),P("div",Bc,[I(s.MessageCircleIcon,{class:"empty-icon"}),t[14]||(t[14]=C("p",null,"暂无反馈记录",-1))])):(q(),P("div",Vc,[(q(!0),P(x,null,$(s.feedbackList,e=>(q(),P("div",{key:e.id,class:M(["feedback-item",{unread:!e.is_read}])},[C("div",Fc,[C("span",{class:M(["feedback-type",e.type])},U(s.getTypeLabel(e.type)),3),C("span",{class:M(["feedback-priority",e.priority])},U(s.getPriorityLabel(e.priority)),3),C("span",zc,U(s.formatDate(e.created_at)),1)]),C("h4",Wc,U(e.title),1),C("p",Jc,U(e.content),1),e.response?(q(),P("div",Kc,[t[15]||(t[15]=C("h5",null,"开发者回复：",-1)),C("p",null,U(e.response),1),C("span",Gc,U(s.formatDate(e.response_at)),1)])):j("",!0)],2))),128))]))])):"stats"===s.activeTab?(q(),P("div",Hc,[C("div",Yc,[C("div",Xc,[C("div",Qc,U(s.stats.total),1),t[16]||(t[16]=C("div",{class:"stat-label"},"总反馈数",-1))]),C("div",Zc,[C("div",eu,U(s.stats.pending),1),t[17]||(t[17]=C("div",{class:"stat-label"},"待处理",-1))]),C("div",tu,[C("div",ru,U(s.stats.resolved),1),t[18]||(t[18]=C("div",{class:"stat-label"},"已解决",-1))]),C("div",su,[C("div",nu,U(s.stats.response_rate)+"%",1),t[19]||(t[19]=C("div",{class:"stat-label"},"回复率",-1))])]),C("div",ou,[C("div",iu,[t[20]||(t[20]=C("h4",null,"反馈类型分布",-1)),C("div",au,[(q(!0),P(x,null,$(s.stats.by_type,(e,t)=>(q(),P("div",{key:t,class:"type-item"},[C("span",lu,U(s.getTypeLabel(t)),1),C("div",cu,[C("div",{class:"type-fill",style:V({width:e/s.stats.total*100+"%"})},null,4)]),C("span",uu,U(e),1)]))),128))])])])])):j("",!0)])])):j("",!0),s.showSuccessMessage?(q(),P("div",du,[I(s.CheckCircleIcon,{class:"success-icon"}),t[21]||(t[21]=C("span",null,"反馈提交成功！我们会尽快处理您的反馈。",-1))])):j("",!0)])}],["__scopeId","data-v-f0a4a50f"],["__file","/mnt/persist/workspace/src/components/feedback/FeedbackWidget.vue"]]),fu={id:"app"},pu={key:0,class:"global-error"},mu={class:"error-content"},gu={class:"error-message"};const vu=Hi(s({__name:"App",setup(e,{expose:t}){t();const r=c(null);ye((e,t,s)=>(console.error("全局错误:",e,s),r.value=e instanceof Error?e.message:"发生未知错误",!1)),y(()=>{window.addEventListener("error",e=>{var t;console.error("页面加载错误:",e.error),r.value=(null==(t=e.error)?void 0:t.message)||"页面加载失败"}),window.addEventListener("offline",()=>{r.value="网络连接已断开"})});const s={error:r,clearError:()=>{r.value=null},AppHeader:oc,AppFooter:kc,FeedbackWidget:hu};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),[["render",function(e,t,r,s,n,o){const i=ae("RouterView");return q(),P("div",fu,[s.error?(q(),P("div",pu,[C("div",mu,[C("span",gu,U(s.error),1),C("button",{class:"error-close",onClick:s.clearError},"×")])])):j("",!0),I(s.AppHeader),I(i,null,{default:le(({Component:e})=>[I(be,{name:"fade",mode:"out-in"},{default:le(()=>[(q(),O(B(e)))]),_:2},1024)]),_:1}),I(s.AppFooter),I(s.FeedbackWidget)])}],["__scopeId","data-v-7a7a37b1"],["__file","/mnt/persist/workspace/src/App.vue"]]),yu=[{path:"/",name:"Home",component:()=>$r(()=>import("./EnhancedHomeView-DCMv1pAq.js"),__vite__mapDeps([0,1,2]),import.meta.url),meta:{title:"工具导航站",description:"高效的工具导航和产品展示平台"}},{path:"/legacy",name:"LegacyHome",component:()=>$r(()=>import("./HomeView-CuRrGP94.js"),__vite__mapDeps([3,1,4]),import.meta.url),meta:{title:"传统版工具导航站",description:"传统版本的工具导航和产品展示平台"}},{path:"/comparison",name:"Comparison",component:()=>$r(()=>import("./ComparisonView-DCp_pQNB.js"),__vite__mapDeps([5,1,6]),import.meta.url),meta:{title:"代码优化对比",description:"展示原HTML代码与Vue组件化改造后的效果对比"}},{path:"/tools",name:"Tools",component:()=>$r(()=>import("./ToolsView-D6Ct8FFh.js"),__vite__mapDeps([7,1,8]),import.meta.url),meta:{title:"工具导航",description:"发现和管理您的常用工具"}},{path:"/products",name:"Products",component:()=>$r(()=>import("./ProductsView-C_5bxQIX.js"),__vite__mapDeps([9,1,10]),import.meta.url),meta:{title:"产品展示",description:"浏览和购买优质产品"}},{path:"/product/:id",name:"ProductDetail",component:()=>$r(()=>import("./ProductDetailView-DQEVupRP.js"),__vite__mapDeps([11,1,12]),import.meta.url),meta:{title:"产品详情",description:"查看产品详细信息"}},{path:"/user",name:"User",component:()=>$r(()=>import("./UserView-DaUZAuRx.js"),__vite__mapDeps([13,1,14]),import.meta.url),meta:{title:"个人中心",description:"管理您的账户和偏好设置",requiresAuth:!0},children:[{path:"profile",name:"UserProfile",component:()=>$r(()=>import("./ProfileView-OZRHXzQZ.js"),__vite__mapDeps([15,1,16]),import.meta.url),meta:{title:"个人资料",requiresAuth:!0}},{path:"favorites",name:"UserFavorites",component:()=>$r(()=>import("./FavoritesView-Dlz--qF8.js"),__vite__mapDeps([17,1,18]),import.meta.url),meta:{title:"我的收藏",requiresAuth:!0}},{path:"orders",name:"UserOrders",component:()=>$r(()=>import("./OrdersView-DBciq1MA.js"),__vite__mapDeps([19,1,20]),import.meta.url),meta:{title:"我的订单",requiresAuth:!0}}]},{path:"/auth",name:"Auth",component:()=>$r(()=>import("./AuthView-DzPh3Lkn.js"),__vite__mapDeps([21,1,22]),import.meta.url),meta:{title:"登录注册",description:"登录或注册您的账户"},children:[{path:"login",name:"Login",component:()=>$r(()=>import("./LoginView-BEpiVcH3.js"),__vite__mapDeps([23,1,24]),import.meta.url),meta:{title:"登录"}},{path:"register",name:"Register",component:()=>$r(()=>import("./RegisterView-BL3MJKcj.js"),__vite__mapDeps([25,1,26]),import.meta.url),meta:{title:"注册"}},{path:"forgot-password",name:"ForgotPassword",component:()=>$r(()=>import("./ForgotPasswordView-CJ15alYq.js"),__vite__mapDeps([27,1,28]),import.meta.url),meta:{title:"忘记密码"}}]},{path:"/admin",name:"Admin",component:()=>$r(()=>import("./AdminView-Doj9Rcmm.js"),__vite__mapDeps([29,1,30]),import.meta.url),meta:{title:"管理后台",description:"系统管理和数据统计",requiresAuth:!0,requiresAdmin:!0},children:[{path:"dashboard",name:"AdminDashboard",component:()=>$r(()=>import("./DashboardView-Bk2-lAeS.js"),__vite__mapDeps([31,1,32]),import.meta.url),meta:{title:"仪表盘",requiresAuth:!0,requiresAdmin:!0}},{path:"tools",name:"AdminTools",component:()=>$r(()=>import("./AdminToolsView-Cx0SwiKZ.js"),__vite__mapDeps([33,1,34]),import.meta.url),meta:{title:"工具管理",requiresAuth:!0,requiresAdmin:!0}},{path:"products",name:"AdminProducts",component:()=>$r(()=>import("./ProductsManageView-ii6B1tO1.js"),__vite__mapDeps([35,1,36]),import.meta.url),meta:{title:"产品管理",requiresAuth:!0,requiresAdmin:!0}},{path:"local",name:"AdminLocal",component:()=>$r(()=>import("./LocalManagementView-udbKvIY6.js"),__vite__mapDeps([37,1,38,39]),import.meta.url),meta:{title:"本地管理",requiresAuth:!0,requiresAdmin:!0}},{path:"local-test",name:"AdminLocalTest",component:()=>$r(()=>import("./LocalManagementTestView-xgSX56gD.js"),__vite__mapDeps([40,1,38,41]),import.meta.url),meta:{title:"本地管理测试",requiresAuth:!0,requiresAdmin:!0}}]},{path:"/payment",name:"Payment",component:()=>$r(()=>import("./PaymentView-Dn3dsliZ.js"),__vite__mapDeps([42,1,43]),import.meta.url),meta:{title:"支付页面",description:"安全的支付处理",requiresAuth:!0}},{path:"/payment/success",name:"PaymentSuccess",component:()=>$r(()=>import("./PaymentSuccessView-DgHIHj_w.js"),__vite__mapDeps([44,1,45]),import.meta.url),meta:{title:"支付成功",description:"支付完成确认"}},{path:"/payment/cancel",name:"PaymentCancel",component:()=>$r(()=>import("./PaymentCancelView-cS1bBruu.js"),__vite__mapDeps([46,1,47]),import.meta.url),meta:{title:"支付取消",description:"支付已取消"}},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>$r(()=>import("./NotFoundView-CEZAFZKm.js"),__vite__mapDeps([48,1,49]),import.meta.url),meta:{title:"页面未找到",description:"您访问的页面不存在"}}],bu=function(e){const t=Lt(e.routes,e),s=e.parseQuery||Kt,i=e.stringifyQuery||Gt,a=e.history;if(!a)throw new Error('Provide the "history" option when calling "createRouter()": https://router.vuejs.org/api/interfaces/RouterOptions.html#history');const l=tr(),c=tr(),u=tr(),d=r(rt);let h=rt;ke&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const f=Ee.bind(null,e=>""+e),m=Ee.bind(null,Je),g=Ee.bind(null,Ke);function v(e,r){if(r=Te({},r||d.value),"string"==typeof e){const n=He(s,e,r.path),o=t.resolve({path:n.path},r),i=a.createHref(n.fullPath);return i.startsWith("//")?je(`Location "${e}" resolved to "${i}". A resolved location cannot start with multiple slashes.`):o.matched.length||je(`No match found for location with path "${e}"`),Te(n,o,{params:g(o.params),hash:Ke(n.hash),redirectedFrom:void 0,href:i})}if(!vt(e))return je("router.resolve() was passed an invalid location. This will fail in production.\n- Location:",e),v({});let n;if(null!=e.path)"params"in e&&!("name"in e)&&Object.keys(e.params).length&&je(`Path "${e.path}" was passed with params but they will be ignored. Use a named route alongside params instead.`),n=Te({},e,{path:He(s,e.path,r.path).path});else{const t=Te({},e.params);for(const e in t)null==t[e]&&delete t[e];n=Te({},e,{params:m(t)}),r.params=m(r.params)}const o=t.resolve(n,r),l=e.hash||"";l&&!l.startsWith("#")&&je(`A \`hash\` should always start with the character "#". Replace "${l}" with "#${l}".`),o.params=f(g(o.params));const c=function(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r+(t.hash||"")}(i,Te({},e,{hash:(u=l,Fe(u).replace(qe,"{").replace(Be,"}").replace(De,"^")),path:o.path}));var u;const h=a.createHref(c);return h.startsWith("//")?je(`Location "${e}" resolved to "${h}". A resolved location cannot start with multiple slashes.`):o.matched.length||je(`No match found for location with path "${null!=e.path?e.path:e}"`),Te({fullPath:c,hash:l,query:i===Gt?Ht(e.query):e.query||{}},o,{redirectedFrom:void 0,href:h})}function y(e){return"string"==typeof e?He(s,e,d.value.path):Te({},e)}function b(e,t){if(h!==e)return St(8,{from:t,to:e})}function _(e){return k(e)}function w(e){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:r}=t;let s="function"==typeof r?r(e):r;if("string"==typeof s&&(s=s.includes("?")||s.includes("#")?s=y(s):{path:s},s.params={}),null==s.path&&!("name"in s))throw je(`Invalid redirect found:\n${JSON.stringify(s,null,2)}\n when navigating to "${e.fullPath}". A redirect must contain a name or path. This will break in production.`),new Error("Invalid redirect");return Te({query:e.query,hash:e.hash,params:null!=s.path?{}:e.params},s)}}function k(e,t){const r=h=v(e),s=d.value,n=e.state,o=e.force,a=!0===e.replace,l=w(r);if(l)return k(Te(y(l),{state:"object"==typeof l?Te({},n,l.state):n,force:o,replace:a}),t||r);const c=r;let u;return c.redirectedFrom=t,!o&&Xe(i,s,r)&&(u=St(16,{to:c,from:s}),L(s,s,!0,!1)),(u?Promise.resolve(u):E(c,s)).catch(e=>Tt(e)?Tt(e,2)?e:R(e):$(e,c,s)).then(e=>{if(e){if(Tt(e,2))return Xe(i,v(e.to),c)&&t&&(t._count=t._count?t._count+1:1)>30?(je(`Detected a possibly infinite redirection in a navigation guard when going from "${s.fullPath}" to "${c.fullPath}". Aborting to avoid a Stack Overflow.\n Are you always returning a new location within a navigation guard? That would lead to this error. Only return when redirecting or aborting, that should fix this. This might break in production if not fixed.`),Promise.reject(new Error("Infinite redirect in navigation guard"))):k(Te({replace:a},y(e.to),{state:"object"==typeof e.to?Te({},n,e.to.state):n,force:o}),t||c)}else e=C(c,s,!0,a,n);return P(c,s,e),e})}function S(e,t){const r=b(e,t);return r?Promise.reject(r):Promise.resolve()}function T(e){const t=N.values().next().value;return t&&"function"==typeof t.runWithContext?t.runWithContext(e):e()}function E(e,t){let r;const[s,n,o]=function(e,t){const r=[],s=[],n=[],o=Math.max(t.matched.length,e.matched.length);for(let i=0;i<o;i++){const o=t.matched[i];o&&(e.matched.find(e=>Qe(e,o))?s.push(o):r.push(o));const a=e.matched[i];a&&(t.matched.find(e=>Qe(e,a))||n.push(a))}return[r,s,n]}(e,t);r=sr(s.reverse(),"beforeRouteLeave",e,t);for(const a of s)a.leaveGuards.forEach(s=>{r.push(rr(s,e,t))});const i=S.bind(null,e,t);return r.push(i),M(r).then(()=>{r=[];for(const s of l.list())r.push(rr(s,e,t));return r.push(i),M(r)}).then(()=>{r=sr(n,"beforeRouteUpdate",e,t);for(const s of n)s.updateGuards.forEach(s=>{r.push(rr(s,e,t))});return r.push(i),M(r)}).then(()=>{r=[];for(const s of o)if(s.beforeEnter)if(Ce(s.beforeEnter))for(const n of s.beforeEnter)r.push(rr(n,e,t));else r.push(rr(s.beforeEnter,e,t));return r.push(i),M(r)}).then(()=>(e.matched.forEach(e=>e.enterCallbacks={}),r=sr(o,"beforeRouteEnter",e,t,T),r.push(i),M(r))).then(()=>{r=[];for(const s of c.list())r.push(rr(s,e,t));return r.push(i),M(r)}).catch(e=>Tt(e,8)?e:Promise.reject(e))}function P(e,t,r){u.list().forEach(s=>T(()=>s(e,t,r)))}function C(e,t,r,s,n){const o=b(e,t);if(o)return o;const i=t===rt,l=ke?history.state:{};r&&(s||i?a.replace(e.fullPath,Te({scroll:i&&l&&l.scroll},n)):a.push(e.fullPath,n)),d.value=e,L(e,t,r,i),R()}let j;function O(){j||(j=a.listen((e,t,r)=>{if(!q.listening)return;const s=v(e),n=w(s);if(n)return void k(Te(n,{replace:!0,force:!0}),s).catch(Pe);h=s;const o=d.value;var i,l;ke&&(i=ht(o.fullPath,r.delta),l=ut(),ft.set(i,l)),E(s,o).catch(e=>Tt(e,12)?e:Tt(e,2)?(k(Te(y(e.to),{force:!0}),s).then(e=>{Tt(e,20)&&!r.delta&&r.type===st.pop&&a.go(-1,!1)}).catch(Pe),Promise.reject()):(r.delta&&a.go(-r.delta,!1),$(e,s,o))).then(e=>{(e=e||C(s,o,!1))&&(r.delta&&!Tt(e,8)?a.go(-r.delta,!1):r.type===st.pop&&Tt(e,20)&&a.go(-1,!1)),P(s,o,e)}).catch(Pe)}))}let A,I=tr(),x=tr();function $(e,t,r){R(e);const s=x.list();return s.length?s.forEach(s=>s(e,t,r)):(je("uncaught error during route navigation:"),console.error(e)),Promise.reject(e)}function R(e){return A||(A=!e,O(),I.list().forEach(([t,r])=>e?r(e):t()),I.reset()),e}function L(t,r,s,n){const{scrollBehavior:o}=e;if(!ke||!o)return Promise.resolve();const i=!s&&function(e){const t=ft.get(e);return ft.delete(e),t}(ht(t.fullPath,0))||(n||!s)&&history.state&&history.state.scroll||null;return p().then(()=>o(t,r,i)).then(e=>e&&dt(e)).catch(e=>$(e,t,r))}const U=e=>a.go(e);let D;const N=new Set,q={currentRoute:d,listening:!0,addRoute:function(e,r){let s,n;return yt(e)?(s=t.getRecordMatcher(e),s||je(`Parent route "${String(e)}" not found when adding child route`,r),n=r):n=e,t.addRoute(n,s)},removeRoute:function(e){const r=t.getRecordMatcher(e);r?t.removeRoute(r):je(`Cannot remove non-existent route "${String(e)}"`)},clearRoutes:t.clearRoutes,hasRoute:function(e){return!!t.getRecordMatcher(e)},getRoutes:function(){return t.getRoutes().map(e=>e.record)},resolve:v,options:e,push:_,replace:function(e){return _(Te(y(e),{replace:!0}))},go:U,back:()=>U(-1),forward:()=>U(1),beforeEach:l.add,beforeResolve:c.add,afterEach:u.add,onError:x.add,isReady:function(){return A&&d.value!==rt?Promise.resolve():new Promise((e,t)=>{I.add([e,t])})},install(e){const r=this;e.component("RouterLink",ir),e.component("RouterView",ur),e.config.globalProperties.$router=r,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>n(d)}),ke&&!D&&d.value===rt&&(D=!0,_(a.location).catch(e=>{je("Unexpected error when starting the router:",e)}));const s={};for(const t in rt)Object.defineProperty(s,t,{get:()=>d.value[t],enumerable:!0});e.provide(Qt,r),e.provide(Zt,o(s)),e.provide(er,d);const i=e.unmount;N.add(e),e.unmount=function(){N.delete(e),N.size<1&&(h=rt,j&&j(),j=null,d.value=rt,D=!1,A=!1),i()},ke&&pr(e,r,t)}};function M(e){return e.reduce((e,t)=>e.then(()=>T(t)),Promise.resolve())}return q}({history:function(e){const t=gt(e=at(e)),r=function(e,t,r,s){let n=[],o=[],i=null;const a=({state:o})=>{const a=pt(e,location),l=r.value,c=t.value;let u=0;if(o){if(r.value=a,t.value=o,i&&i===l)return void(i=null);u=c?o.position-c.position:0}else s(a);n.forEach(e=>{e(r.value,l,{delta:u,type:st.pop,direction:u?u>0?ot.forward:ot.back:ot.unknown})})};function l(){const{history:e}=window;e.state&&e.replaceState(Te({},e.state,{scroll:ut()}),"")}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",l,{passive:!0}),{pauseListeners:function(){i=r.value},listen:function(e){n.push(e);const t=()=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)};return o.push(t),t},destroy:function(){for(const e of o)e();o=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",l)}}}(e,t.state,t.location,t.replace),s=Te({location:"",base:e,go:function(e,t=!0){t||r.pauseListeners(),history.go(e)},createHref:ct.bind(null,e)},t,r);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>t.state.value}),s}(),routes:yu}),_u=v("categories",()=>{const e=c([]),t=c(!1),r=c(null),s=c(!1);async function n(){if(!t.value){t.value=!0,r.value=null;try{const{data:t,error:r}=await bi.from("categories").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(r)throw r;e.value=t||[],s.value=!0}catch(n){console.error("获取分类失败:",n),r.value=n}finally{t.value=!1}}}return{categories:e,loading:t,error:r,initialized:s,fetchCategories:n,initialize:async function(){s.value||await n()},clearError:function(){r.value=null}}});const wu=_e(vu),ku=we();wu.use(ku),wu.use(bu),async function(){console.log("🚀 Initializing core stores...");const e=Si(),t=_u(),r=ki();try{await Promise.all([e.initialize(),t.initialize(),r.initialize()]),console.log("✅ Core stores initialized successfully.")}catch(s){console.error("❌ Failed to initialize one or more stores:",s)}}().then(()=>{wu.mount("#app")});export{_i as T,Hi as _,_u as a,Ii as b,ki as c,Si as d,Ir as e,wi as h,bi as s,Ar as u};
