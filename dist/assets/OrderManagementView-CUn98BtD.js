import{d as t,r as e,b as a,c as s,w as l,o as n,m as o,q as d,y as r,E as i,u as c,D as u,G as p,I as v,P as m,O as h,F as g,z as y,B as b,t as f,A as w}from"./vendor-B_bmgS9f.js";import{OrderService as O}from"./orderService-CHvwLTGC.js";import{R}from"./refresh-cw-B0BT0kPp.js";import{D as k}from"./download-DVekxx6f.js";import{F as C}from"./file-text-C3be1PCc.js";import{r as S,C as _,S as j,X as D,_ as M}from"./index-C5n2Pyp_.js";import{D as U}from"./dollar-sign-BfhE52ov.js";import{L as x}from"./loader-2-BWm9zdx-.js";import{E as L}from"./eye-cpn-LytD.js";import{P as V}from"./play-YAjyVcAP.js";const A={class:"order-management-view"},E={class:"page-header"},I={class:"header-actions"},N={class:"stats-grid"},$={class:"stat-card"},z={class:"stat-icon"},B={class:"stat-content"},F={class:"stat-card"},J={class:"stat-icon completed"},P={class:"stat-content"},q={class:"stat-card"},G={class:"stat-icon pending"},T={class:"stat-content"},X={class:"stat-card"},Y={class:"stat-icon revenue"},H={class:"stat-content"},K={class:"filters-section"},Q={class:"search-box"},W={class:"filter-controls"},Z={class:"orders-table-container"},tt={key:0,class:"loading-state"},et={key:1,class:"orders-table"},at={class:"order-info"},st={class:"order-details"},lt={class:"user-info"},nt={class:"user-details"},ot={class:"amount"},dt={class:"price"},rt={class:"currency"},it={class:"actions"},ct=["onClick"],ut=["onClick"],pt=["onClick"],vt={class:"pagination"},mt=["disabled"],ht={class:"pagination-info"},gt=["disabled"],yt=M(t({__name:"OrderManagementView",setup(t){const M=e(!1),yt=e([]),bt=e(0),ft=e(1),wt=e(10),Ot=a({search:"",status:"",paymentMethod:"",dateRange:{start:"",end:""}}),Rt=s(()=>({totalOrders:yt.value.length,completedOrders:yt.value.filter(t=>"paid"===t.status).length,pendingOrders:yt.value.filter(t=>"pending"===t.status).length,totalRevenue:yt.value.filter(t=>"paid"===t.status).reduce((t,e)=>t+e.total_amount,0)})),kt=s(()=>Math.ceil(bt.value/wt.value)),Ct=s(()=>yt.value),St=async()=>{try{M.value=!0;const t={search:Ot.search||void 0,status:Ot.status||void 0,paymentMethod:Ot.paymentMethod||void 0,startDate:Ot.dateRange.start||void 0,endDate:Ot.dateRange.end||void 0,page:ft.value,limit:wt.value},e=await O.getAllOrders(t);yt.value=e.orders,bt.value=e.total}catch(t){console.error("加载订单数据失败:",t),alert("加载订单数据失败，请稍后重试")}finally{M.value=!1}},_t=()=>{St()},jt=async()=>{try{const t={status:Ot.status||void 0,startDate:Ot.dateRange.start||void 0,endDate:Ot.dateRange.end||void 0},e=await O.exportOrders(t),a=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),l=URL.createObjectURL(a);s.setAttribute("href",l),s.setAttribute("download",`orders_${(new Date).toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),console.log("订单数据导出成功")}catch(t){console.error("导出订单数据失败:",t),alert("导出订单数据失败，请稍后重试")}},Dt=t=>{switch(t){case"pending":return"待支付";case"paid":return"已支付";case"cancelled":return"已取消";case"refunded":return"已退款";default:return"未知"}},Mt=t=>{switch(t){case"alipay":return"支付宝";case"wechat":return"微信支付";case"credit_card":return"信用卡";default:return"未知"}};return l(()=>[Ot.search,Ot.status,Ot.paymentMethod,Ot.dateRange.start,Ot.dateRange.end],()=>{ft.value=1,St()},{deep:!0}),l([ft,wt],()=>{St()}),n(()=>{St()}),(t,e)=>(w(),o("div",A,[d("div",E,[e[9]||(e[9]=d("div",null,[d("h1",null,"订单管理"),d("p",null,"管理系统订单，查看订单状态和支付信息")],-1)),d("div",I,[d("button",{class:"btn btn-secondary",onClick:_t},[r(c(R),{class:"icon"}),e[7]||(e[7]=i(" 刷新 "))]),d("button",{class:"btn btn-primary",onClick:jt},[r(c(k),{class:"icon"}),e[8]||(e[8]=i(" 导出订单 "))])])]),d("div",N,[d("div",$,[d("div",z,[r(c(C))]),d("div",B,[d("h3",null,u(Rt.value.totalOrders),1),e[10]||(e[10]=d("p",null,"总订单数",-1))])]),d("div",F,[d("div",J,[r(c(S))]),d("div",P,[d("h3",null,u(Rt.value.completedOrders),1),e[11]||(e[11]=d("p",null,"已完成",-1))])]),d("div",q,[d("div",G,[r(c(_))]),d("div",T,[d("h3",null,u(Rt.value.pendingOrders),1),e[12]||(e[12]=d("p",null,"待处理",-1))])]),d("div",X,[d("div",Y,[r(c(U))]),d("div",H,[d("h3",null,"¥"+u(Rt.value.totalRevenue.toLocaleString()),1),e[13]||(e[13]=d("p",null,"总收入",-1))])])]),d("div",K,[d("div",Q,[r(c(j),{class:"search-icon"}),p(d("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>Ot.search=t),type:"text",placeholder:"搜索订单号、用户邮箱...",class:"search-input"},null,512),[[v,Ot.search]])]),d("div",W,[p(d("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>Ot.status=t),class:"filter-select"},e[14]||(e[14]=[h('<option value="" data-v-8e4b83d6>所有状态</option><option value="pending" data-v-8e4b83d6>待处理</option><option value="processing" data-v-8e4b83d6>处理中</option><option value="completed" data-v-8e4b83d6>已完成</option><option value="cancelled" data-v-8e4b83d6>已取消</option>',5)]),512),[[m,Ot.status]]),p(d("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>Ot.paymentMethod=t),class:"filter-select"},e[15]||(e[15]=[d("option",{value:""},"所有支付方式",-1),d("option",{value:"alipay"},"支付宝",-1),d("option",{value:"wechat"},"微信支付",-1),d("option",{value:"credit_card"},"信用卡",-1)]),512),[[m,Ot.paymentMethod]]),p(d("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>Ot.dateRange.start=t),type:"date",class:"filter-select",placeholder:"开始日期"},null,512),[[v,Ot.dateRange.start]]),p(d("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>Ot.dateRange.end=t),type:"date",class:"filter-select",placeholder:"结束日期"},null,512),[[v,Ot.dateRange.end]])])]),d("div",Z,[M.value?(w(),o("div",tt,[r(c(x),{class:"loading-icon"}),e[16]||(e[16]=d("p",null,"加载订单数据中...",-1))])):(w(),o("table",et,[e[17]||(e[17]=d("thead",null,[d("tr",null,[d("th",null,"订单信息"),d("th",null,"用户"),d("th",null,"金额"),d("th",null,"支付方式"),d("th",null,"状态"),d("th",null,"创建时间"),d("th",null,"操作")])],-1)),d("tbody",null,[(w(!0),o(g,null,y(Ct.value,t=>{var e,a,s,l;return w(),o("tr",{key:t.id,class:"order-row"},[d("td",at,[d("div",st,[d("h4",null,"#"+u(t.id.slice(0,8)),1),d("p",null,u((null==(e=t.items)?void 0:e.length)||0)+" 个商品",1)])]),d("td",lt,[d("div",nt,[d("h4",null,u((null==(a=t.user)?void 0:a.full_name)||"未知用户"),1),d("p",null,u((null==(s=t.user)?void 0:s.email)||"N/A"),1)])]),d("td",ot,[d("span",dt,"¥"+u(t.total_amount.toLocaleString()),1),d("span",rt,u(t.currency),1)]),d("td",null,[d("span",{class:b(["payment-method",t.payment_method])},u(Mt(t.payment_method)),3)]),d("td",null,[d("span",{class:b(["status-badge",t.status])},u(Dt(t.status)),3)]),d("td",null,u((l=t.created_at,new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))),1),d("td",it,[d("button",{class:"action-btn view",onClick:e=>(t=>{console.log("查看订单:",t.id)})(t)},[r(c(L))],8,ct),"pending"===t.status?(w(),o("button",{key:0,class:"action-btn process",onClick:e=>(async t=>{try{const e=JSON.parse(localStorage.getItem("user")||"{}");if(!e.id)throw new Error("未找到管理员用户信息");await O.updateOrderStatus(t.id,"paid",e.id),await St(),console.log(`订单 ${t.id} 已标记为已支付`)}catch(e){console.error("处理订单失败:",e),alert("处理订单失败，请稍后重试")}})(t)},[r(c(V))],8,ut)):f("",!0),"cancelled"!==t.status&&"paid"!==t.status?(w(),o("button",{key:1,class:"action-btn cancel",onClick:e=>(async t=>{try{const e=JSON.parse(localStorage.getItem("user")||"{}");if(!e.id)throw new Error("未找到管理员用户信息");if(!confirm(`确定要取消订单 ${t.id} 吗？`))return;await O.updateOrderStatus(t.id,"cancelled",e.id),await St(),console.log(`订单 ${t.id} 已取消`)}catch(e){console.error("取消订单失败:",e),alert("取消订单失败，请稍后重试")}})(t)},[r(c(D))],8,pt)):f("",!0)])])}),128))])]))]),d("div",vt,[d("button",{disabled:1===ft.value,class:"pagination-btn",onClick:e[5]||(e[5]=t=>ft.value--)}," 上一页 ",8,mt),d("span",ht," 第 "+u(ft.value)+" 页，共 "+u(kt.value)+" 页 ",1),d("button",{disabled:ft.value===kt.value,class:"pagination-btn",onClick:e[6]||(e[6]=t=>ft.value++)}," 下一页 ",8,gt)])]))}}),[["__scopeId","data-v-8e4b83d6"]]);export{yt as default};
