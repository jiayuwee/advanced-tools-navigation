import{d as t,r as a,b as e,c as s,w as l,o as n,m as o,q as d,y as r,E as i,u as c,D as u,G as p,I as v,P as m,O as h,F as g,z as y,B as f,t as b,A as w}from"./vendor-dtMHlISa.js";import{OrderService as O}from"./orderService-DsrkZM7H.js";import{R}from"./refresh-cw-sVZGUD43.js";import{D as k}from"./download-C6OAg1E3.js";import{F as C}from"./file-text-Dat_PjbD.js";import{t as S,C as _,S as j,X as D,_ as M}from"./index-DnVHVpUO.js";import{D as U}from"./dollar-sign-BlcwJchx.js";import{L as x}from"./loader-2-DCmx-HPK.js";import{E as L}from"./eye-DQ_sdAJN.js";import{P as V}from"./play-ByRSN9eT.js";const A={class:"order-management-view"},E={class:"page-header"},I={class:"header-actions"},N={class:"stats-grid"},$={class:"stat-card"},z={class:"stat-icon"},B={class:"stat-content"},F={class:"stat-card"},J={class:"stat-icon completed"},P={class:"stat-content"},q={class:"stat-card"},G={class:"stat-icon pending"},T={class:"stat-content"},X={class:"stat-card"},Y={class:"stat-icon revenue"},H={class:"stat-content"},K={class:"filters-section"},Q={class:"search-box"},W={class:"filter-controls"},Z={class:"orders-table-container"},tt={key:0,class:"loading-state"},at={key:1,class:"orders-table"},et={class:"order-info"},st={class:"order-details"},lt={class:"user-info"},nt={class:"user-details"},ot={class:"amount"},dt={class:"price"},rt={class:"currency"},it={class:"actions"},ct=["onClick"],ut=["onClick"],pt=["onClick"],vt={class:"pagination"},mt=["disabled"],ht={class:"pagination-info"},gt=["disabled"],yt=M(t({__name:"OrderManagementView",setup(t){const M=a(!1),yt=a([]),ft=a(0),bt=a(1),wt=a(10),Ot=e({search:"",status:"",paymentMethod:"",dateRange:{start:"",end:""}}),Rt=s(()=>({totalOrders:yt.value.length,completedOrders:yt.value.filter(t=>"paid"===t.status).length,pendingOrders:yt.value.filter(t=>"pending"===t.status).length,totalRevenue:yt.value.filter(t=>"paid"===t.status).reduce((t,a)=>t+a.total_amount,0)})),kt=s(()=>Math.ceil(ft.value/wt.value)),Ct=s(()=>yt.value),loadOrders=async()=>{try{M.value=!0;const t={search:Ot.search||void 0,status:Ot.status||void 0,paymentMethod:Ot.paymentMethod||void 0,startDate:Ot.dateRange.start||void 0,endDate:Ot.dateRange.end||void 0,page:bt.value,limit:wt.value},a=await O.getAllOrders(t);yt.value=a.orders,ft.value=a.total}catch(t){console.error("加载订单数据失败:",t),alert("加载订单数据失败，请稍后重试")}finally{M.value=!1}},refreshOrders=()=>{loadOrders()},exportOrders=async()=>{try{const t={status:Ot.status||void 0,startDate:Ot.dateRange.start||void 0,endDate:Ot.dateRange.end||void 0},a=await O.exportOrders(t),e=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),l=URL.createObjectURL(e);s.setAttribute("href",l),s.setAttribute("download",`orders_${(new Date).toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),console.log("订单数据导出成功")}catch(t){console.error("导出订单数据失败:",t),alert("导出订单数据失败，请稍后重试")}},getStatusText=t=>{switch(t){case"pending":return"待支付";case"paid":return"已支付";case"cancelled":return"已取消";case"refunded":return"已退款";default:return"未知"}},getPaymentMethodText=t=>{switch(t){case"alipay":return"支付宝";case"wechat":return"微信支付";case"credit_card":return"信用卡";default:return"未知"}};return l(()=>[Ot.search,Ot.status,Ot.paymentMethod,Ot.dateRange.start,Ot.dateRange.end],()=>{bt.value=1,loadOrders()},{deep:!0}),l([bt,wt],()=>{loadOrders()}),n(()=>{loadOrders()}),(t,a)=>(w(),o("div",A,[d("div",E,[a[9]||(a[9]=d("div",null,[d("h1",null,"订单管理"),d("p",null,"管理系统订单，查看订单状态和支付信息")],-1)),d("div",I,[d("button",{class:"btn btn-secondary",onClick:refreshOrders},[r(c(R),{class:"icon"}),a[7]||(a[7]=i(" 刷新 "))]),d("button",{class:"btn btn-primary",onClick:exportOrders},[r(c(k),{class:"icon"}),a[8]||(a[8]=i(" 导出订单 "))])])]),d("div",N,[d("div",$,[d("div",z,[r(c(C))]),d("div",B,[d("h3",null,u(Rt.value.totalOrders),1),a[10]||(a[10]=d("p",null,"总订单数",-1))])]),d("div",F,[d("div",J,[r(c(S))]),d("div",P,[d("h3",null,u(Rt.value.completedOrders),1),a[11]||(a[11]=d("p",null,"已完成",-1))])]),d("div",q,[d("div",G,[r(c(_))]),d("div",T,[d("h3",null,u(Rt.value.pendingOrders),1),a[12]||(a[12]=d("p",null,"待处理",-1))])]),d("div",X,[d("div",Y,[r(c(U))]),d("div",H,[d("h3",null,"¥"+u(Rt.value.totalRevenue.toLocaleString()),1),a[13]||(a[13]=d("p",null,"总收入",-1))])])]),d("div",K,[d("div",Q,[r(c(j),{class:"search-icon"}),p(d("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>Ot.search=t),type:"text",placeholder:"搜索订单号、用户邮箱...",class:"search-input"},null,512),[[v,Ot.search]])]),d("div",W,[p(d("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>Ot.status=t),class:"filter-select"},a[14]||(a[14]=[h('<option value="" data-v-71827243>所有状态</option><option value="pending" data-v-71827243>待处理</option><option value="processing" data-v-71827243>处理中</option><option value="completed" data-v-71827243>已完成</option><option value="cancelled" data-v-71827243>已取消</option>',5)]),512),[[m,Ot.status]]),p(d("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>Ot.paymentMethod=t),class:"filter-select"},a[15]||(a[15]=[d("option",{value:""},"所有支付方式",-1),d("option",{value:"alipay"},"支付宝",-1),d("option",{value:"wechat"},"微信支付",-1),d("option",{value:"credit_card"},"信用卡",-1)]),512),[[m,Ot.paymentMethod]]),p(d("input",{"onUpdate:modelValue":a[3]||(a[3]=t=>Ot.dateRange.start=t),type:"date",class:"filter-select",placeholder:"开始日期"},null,512),[[v,Ot.dateRange.start]]),p(d("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>Ot.dateRange.end=t),type:"date",class:"filter-select",placeholder:"结束日期"},null,512),[[v,Ot.dateRange.end]])])]),d("div",Z,[M.value?(w(),o("div",tt,[r(c(x),{class:"loading-icon"}),a[16]||(a[16]=d("p",null,"加载订单数据中...",-1))])):(w(),o("table",at,[a[17]||(a[17]=d("thead",null,[d("tr",null,[d("th",null,"订单信息"),d("th",null,"用户"),d("th",null,"金额"),d("th",null,"支付方式"),d("th",null,"状态"),d("th",null,"创建时间"),d("th",null,"操作")])],-1)),d("tbody",null,[(w(!0),o(g,null,y(Ct.value,t=>{var a,e,s,l;return w(),o("tr",{key:t.id,class:"order-row"},[d("td",et,[d("div",st,[d("h4",null,"#"+u(t.id.slice(0,8)),1),d("p",null,u((null==(a=t.items)?void 0:a.length)||0)+" 个商品",1)])]),d("td",lt,[d("div",nt,[d("h4",null,u((null==(e=t.user)?void 0:e.full_name)||"未知用户"),1),d("p",null,u((null==(s=t.user)?void 0:s.email)||"N/A"),1)])]),d("td",ot,[d("span",dt,"¥"+u(t.total_amount.toLocaleString()),1),d("span",rt,u(t.currency),1)]),d("td",null,[d("span",{class:f(["payment-method",t.payment_method])},u(getPaymentMethodText(t.payment_method)),3)]),d("td",null,[d("span",{class:f(["status-badge",t.status])},u(getStatusText(t.status)),3)]),d("td",null,u((l=t.created_at,new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))),1),d("td",it,[d("button",{class:"action-btn view",onClick:a=>(t=>{console.log("查看订单:",t.id)})(t)},[r(c(L))],8,ct),"pending"===t.status?(w(),o("button",{key:0,class:"action-btn process",onClick:a=>(async t=>{try{const a=JSON.parse(localStorage.getItem("user")||"{}");if(!a.id)throw new Error("未找到管理员用户信息");await O.updateOrderStatus(t.id,"paid",a.id),await loadOrders(),console.log(`订单 ${t.id} 已标记为已支付`)}catch(a){console.error("处理订单失败:",a),alert("处理订单失败，请稍后重试")}})(t)},[r(c(V))],8,ut)):b("",!0),"cancelled"!==t.status&&"paid"!==t.status?(w(),o("button",{key:1,class:"action-btn cancel",onClick:a=>(async t=>{try{const a=JSON.parse(localStorage.getItem("user")||"{}");if(!a.id)throw new Error("未找到管理员用户信息");if(!confirm(`确定要取消订单 ${t.id} 吗？`))return;await O.updateOrderStatus(t.id,"cancelled",a.id),await loadOrders(),console.log(`订单 ${t.id} 已取消`)}catch(a){console.error("取消订单失败:",a),alert("取消订单失败，请稍后重试")}})(t)},[r(c(D))],8,pt)):b("",!0)])])}),128))])]))]),d("div",vt,[d("button",{disabled:1===bt.value,class:"pagination-btn",onClick:a[5]||(a[5]=t=>bt.value--)}," 上一页 ",8,mt),d("span",ht," 第 "+u(bt.value)+" 页，共 "+u(kt.value)+" 页 ",1),d("button",{disabled:bt.value===kt.value,class:"pagination-btn",onClick:a[6]||(a[6]=t=>bt.value++)}," 下一页 ",8,gt)])]))}}),[["__scopeId","data-v-71827243"]]);export{yt as default};
//# sourceMappingURL=OrderManagementView-yyauFcSF.js.map
