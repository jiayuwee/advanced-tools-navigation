import{r as e,c as a,d as s,w as t,m as l,B as r,q as c,y as o,u as i,t as n,G as u,P as v,F as d,z as p,D as g,I as h,N as m,E as y,H as f,v as k,A as b,o as C,X as w,x as _}from"./vendor-dtMHlISa.js";import{e as S,u as U,a as x,X as F,m as O,C as L,S as E,_ as A,I as j,E as q,c as I,d as V}from"./index-DFN97R6u.js";import{T as B}from"./trending-up-BibEG1v8.js";import{F as T,a as D}from"./folder-C-XNkvAJ.js";import{G as H,L as R}from"./list-BNGJtMWj.js";import{E as M}from"./eye-BvNf7oTo.js";
/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=S("ArrowDownIcon",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),Q=S("ArrowUpIcon",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),$=S("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);
/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function useAdvancedSearch(){const s=U(),t=e(""),l=e({category:"",tags:[],rating:0,isFeatured:!1,hasUrl:!1,sortBy:"name",sortOrder:"asc"}),r=e([]),c=e(!1),o=a(()=>{if(!s.tools.length)return[];c.value=!0;try{let e=((e,a)=>{if(!e.trim())return a.map(e=>({item:e,score:1,matches:[]}));const s=e.toLowerCase().split(/\s+/).filter(e=>e.length>0),t=[];return a.forEach(e=>{let a=0;const l=[],r=[{field:"name",weight:10},{field:"description",weight:5},{field:"tags",weight:3},{field:"categories.name",weight:2}];s.forEach(s=>{var t;r.forEach(({field:t,weight:r})=>{const c=getNestedValue(e,t);c&&searchInField(c,s)&&(a+=r,l.includes(t)||l.push(t))}),fuzzyMatch((null==(t=e.name)?void 0:t.toLowerCase())||"",s)&&(a+=2)}),e.is_featured&&(a+=1),e.average_rating&&e.average_rating>4&&(a+=1),a>0&&t.push({item:e,score:a,matches:l})}),t.sort((e,a)=>a.score-e.score)})(t.value,s.tools);return e=(e=>e.filter(({item:e})=>{if(l.value.category&&e.category_id!==l.value.category)return!1;if(l.value.tags.length>0){const a=e.tags||[];if(!l.value.tags.some(e=>a.some(a=>a.toLowerCase().includes(e.toLowerCase()))))return!1}return!(l.value.rating>0&&(e.average_rating||0)<l.value.rating)&&!(l.value.isFeatured&&!e.is_featured||!(!l.value.hasUrl||e.url&&e.url.trim()))}))(e),e=(e=>e.sort((e,a)=>{const{sortBy:s,sortOrder:t}=l.value;let r=0;switch(s){case"name":r=(e.item.name||"").localeCompare(a.item.name||"");break;case"rating":r=(e.item.average_rating||0)-(a.item.average_rating||0);break;case"clicks":r=(e.item.click_count||0)-(a.item.click_count||0);break;case"created_at":r=new Date(e.item.created_at||0).getTime()-new Date(a.item.created_at||0).getTime();break;default:r=a.score-e.score}return"desc"===t?-r:r}))(e),e}finally{c.value=!1}}),i=a(()=>{if(!t.value.trim())return[];const e=t.value.toLowerCase(),a=new Set;return s.tools.forEach(s=>{var t;(null==(t=s.name)?void 0:t.toLowerCase().includes(e))&&a.add(s.name),s.tags&&s.tags.forEach(s=>{s.toLowerCase().includes(e)&&a.add(s)})}),Array.from(a).slice(0,5)}),n=a(()=>{const e=r.value.reduce((e,a)=>(e[a]=(e[a]||0)+1,e),{});return Object.entries(e).sort(([,e],[,a])=>a-e).slice(0,10).map(([e])=>e)}),getNestedValue=(e,a)=>a.split(".").reduce((e,a)=>null==e?void 0:e[a],e),searchInField=(e,a)=>Array.isArray(e)?e.some(e=>"string"==typeof e&&e.toLowerCase().includes(a)):"string"==typeof e&&e.toLowerCase().includes(a),fuzzyMatch=(e,a)=>{const s=a.length,t=e.length;if(s>t)return!1;if(s===t)return a===e;let l=0;for(let r=0;r<t&&l<s;r++)e[r]===a[l]&&l++;return l===s};return{searchQuery:t,filters:l,searchResults:o,searchSuggestions:i,popularSearches:n,searchHistory:r,isSearching:c,search:e=>{t.value=e,e.trim()&&!r.value.includes(e)&&(r.value.unshift(e),r.value.length>50&&(r.value=r.value.slice(0,50)))},clearSearch:()=>{t.value=""},resetFilters:()=>{l.value={category:"",tags:[],rating:0,isFeatured:!1,hasUrl:!1,sortBy:"name",sortOrder:"asc"}}}}const G={class:"panel-header"},N={class:"panel-content"},P={class:"filter-group"},W=["value"],K={class:"filter-group"},X={class:"tags-container"},J={class:"popular-tags"},Y=["onClick"],Z={key:0,class:"selected-tags"},ee=["onClick"],ae={class:"filter-group"},se={class:"rating-filter"},te={class:"rating-stars"},le={class:"rating-text"},re={class:"filter-group"},ce={class:"checkbox-group"},oe={class:"checkbox-item"},ie={class:"checkbox-item"},ne={class:"filter-group"},ue={class:"sort-options"},ve=["title"],de={key:0,class:"filter-group"},pe={class:"search-history"},ge=["onClick"],he={key:1,class:"filter-group"},me={class:"popular-searches"},ye=["onClick"],fe={class:"panel-footer"},ke=A(s({__name:"AdvancedSearchPanel",props:{isOpen:{type:Boolean},filters:{},searchHistory:{},popularSearches:{}},emits:["close","update:filters","search"],setup(s,{emit:C}){const w=s,_=C,S=U(),A=x(),j=e(""),q=e({...w.filters});t(()=>w.filters,e=>{q.value={...e}},{deep:!0});const I=a(()=>A.categories),V=a(()=>{const e=new Map;return S.tools.forEach(a=>{a.tags&&a.tags.forEach(a=>{e.set(a,(e.get(a)||0)+1)})}),Array.from(e.entries()).sort(([,e],[,a])=>a-e).slice(0,10).map(([e])=>e)}),addCustomTag=()=>{const e=j.value.trim();e&&!q.value.tags.includes(e)&&(q.value.tags.push(e),j.value="")},setRating=e=>{q.value.rating=e},toggleSortOrder=()=>{q.value.sortOrder="asc"===q.value.sortOrder?"desc":"asc"},resetFilters=()=>{q.value={category:"",tags:[],rating:0,isFeatured:!1,hasUrl:!1,sortBy:"name",sortOrder:"asc"},applyFilters()},applyFilters=()=>{_("update:filters",{...q.value})};return t(q,()=>{applyFilters()},{deep:!0}),(e,a)=>{return b(),l("div",{class:r(["advanced-search-panel",{"is-open":e.isOpen}])},[c("div",G,[a[7]||(a[7]=c("h3",null,"高级搜索",-1)),c("button",{class:"close-button",onClick:a[0]||(a[0]=a=>e.$emit("close"))},[o(i(F),{class:"icon"})])]),c("div",N,[c("div",P,[a[9]||(a[9]=c("label",{class:"filter-label"},"分类",-1)),u(c("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.category=e),class:"filter-select"},[a[8]||(a[8]=c("option",{value:""},"所有分类",-1)),(b(!0),l(d,null,p(I.value,e=>(b(),l("option",{key:e.id,value:e.id},g(e.name),9,W))),128))],512),[[v,q.value.category]])]),c("div",K,[a[12]||(a[12]=c("label",{class:"filter-label"},"标签",-1)),c("div",X,[c("div",J,[a[10]||(a[10]=c("span",{class:"tags-subtitle"},"热门标签:",-1)),(b(!0),l(d,null,p(V.value,e=>(b(),l("button",{key:e,class:r(["tag-button",{active:q.value.tags.includes(e)}]),onClick:a=>(e=>{const a=q.value.tags.indexOf(e);a>-1?q.value.tags.splice(a,1):q.value.tags.push(e)})(e)},g(e),11,Y))),128))]),u(c("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>j.value=e),placeholder:"输入自定义标签...",class:"tag-input",onKeydown:m(addCustomTag,["enter"])},null,544),[[h,j.value]]),q.value.tags.length>0?(b(),l("div",Z,[a[11]||(a[11]=c("span",{class:"tags-subtitle"},"已选标签:",-1)),(b(!0),l(d,null,p(q.value.tags,e=>(b(),l("span",{key:e,class:"selected-tag"},[y(g(e)+" ",1),c("button",{class:"tag-remove",onClick:a=>(e=>{const a=q.value.tags.indexOf(e);a>-1&&q.value.tags.splice(a,1)})(e)},"×",8,ee)]))),128))])):n("",!0)])]),c("div",ae,[a[13]||(a[13]=c("label",{class:"filter-label"},"最低评分",-1)),c("div",se,[c("div",te,[(b(),l(d,null,p(5,e=>o(i(O),{key:e,class:r([{filled:e<=q.value.rating},"star"]),onClick:a=>setRating(e)},null,8,["class","onClick"])),64))]),c("span",le,g((s=q.value.rating,["不限","1星以上","2星以上","3星以上","4星以上","5星"][s]||"不限")),1),q.value.rating>0?(b(),l("button",{key:0,class:"clear-rating",onClick:a[3]||(a[3]=e=>setRating(0))}," 清除 ")):n("",!0)])]),c("div",re,[a[16]||(a[16]=c("label",{class:"filter-label"},"特殊筛选",-1)),c("div",ce,[c("label",oe,[u(c("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>q.value.isFeatured=e),type:"checkbox"},null,512),[[f,q.value.isFeatured]]),a[14]||(a[14]=c("span",{class:"checkbox-label"},"仅显示特色工具",-1))]),c("label",ie,[u(c("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>q.value.hasUrl=e),type:"checkbox"},null,512),[[f,q.value.hasUrl]]),a[15]||(a[15]=c("span",{class:"checkbox-label"},"仅显示可访问工具",-1))])])]),c("div",ne,[a[18]||(a[18]=c("label",{class:"filter-label"},"排序方式",-1)),c("div",ue,[u(c("select",{"onUpdate:modelValue":a[6]||(a[6]=e=>q.value.sortBy=e),class:"sort-select"},a[17]||(a[17]=[c("option",{value:"name"},"名称",-1),c("option",{value:"rating"},"评分",-1),c("option",{value:"clicks"},"使用次数",-1),c("option",{value:"created_at"},"创建时间",-1)]),512),[[v,q.value.sortBy]]),c("button",{class:"sort-order-button",title:"asc"===q.value.sortOrder?"升序":"降序",onClick:toggleSortOrder},["asc"===q.value.sortOrder?(b(),k(i(Q),{key:0,class:"icon"})):(b(),k(i(z),{key:1,class:"icon"}))],8,ve)])]),e.searchHistory.length>0?(b(),l("div",de,[a[19]||(a[19]=c("label",{class:"filter-label"},"搜索历史",-1)),c("div",pe,[(b(!0),l(d,null,p(e.searchHistory.slice(0,5),(a,s)=>(b(),l("button",{key:s,class:"history-item",onClick:s=>e.$emit("search",a)},[o(i(L),{class:"icon"}),y(" "+g(a),1)],8,ge))),128))])])):n("",!0),e.popularSearches.length>0?(b(),l("div",he,[a[20]||(a[20]=c("label",{class:"filter-label"},"热门搜索",-1)),c("div",me,[(b(!0),l(d,null,p(e.popularSearches.slice(0,5),a=>(b(),l("button",{key:a,class:"popular-item",onClick:s=>e.$emit("search",a)},[o(i(B),{class:"icon"}),y(" "+g(a),1)],8,ye))),128))])])):n("",!0)]),c("div",fe,[c("button",{class:"reset-button",onClick:resetFilters},[o(i($),{class:"icon"}),a[21]||(a[21]=y(" 重置筛选 "))]),c("button",{class:"apply-button",onClick:applyFilters},[o(i(E),{class:"icon"}),a[22]||(a[22]=y(" 应用筛选 "))])])],2);var s}}}),[["__scopeId","data-v-9fc794f0"]]),be={class:"tools-view"},Ce={class:"filters-bar"},we={class:"filters-content"},_e={class:"filter-group search-group"},Se={class:"search-container"},Ue={class:"filter-group"},xe={class:"filter-group"},Fe={class:"filter-group"},Oe={class:"view-options"},Le={class:"results-info"},Ee={class:"results-count"},Ae={class:"tools-content"},je={key:0,class:"loading-state"},qe={key:1,class:"error-state"},Ie={key:2,class:"tools-grid"},Ve={class:"card-header"},Be={class:"tool-icon"},Te=["onClick"],De={class:"card-content"},He={class:"tool-name"},Re={class:"tool-description"},Me={class:"tool-tags"},ze={key:0,class:"tag more"},Qe={class:"card-footer"},$e={class:"tool-stats"},Ge={class:"stat"},Ne={class:"stat"},Pe={class:"tool-actions"},We=["onClick"],Ke=["onClick"],Xe={key:3,class:"tools-list"},Je=["onClick"],Ye={class:"item-left"},Ze={class:"tool-icon"},ea={class:"tool-info"},aa={class:"tool-name"},sa={class:"tool-description"},ta={class:"tool-meta"},la={class:"category"},ra={class:"clicks"},ca={class:"item-right"},oa={class:"tool-tags"},ia={class:"tool-actions"},na=["onClick"],ua={key:4,class:"empty-state"},va={key:0},da={key:1},pa={key:2},ga={class:"empty-actions"},ha=A(s({__name:"ToolsView",setup(s){const m=V(),f=I(),k=U(),{searchQuery:S,filters:x,searchResults:L,popularSearches:A,searchHistory:B,search:z,clearSearch:Q}=useAdvancedSearch(),$=e(),G=e("all"),N=e("name"),P=e(!1),W=e(!1),K=e("grid"),X=a(()=>{if(S.value.trim())return L.value.map(e=>e.item);let e=k.filteredTools;return W.value&&console.warn("收藏功能尚未完全实现"),e=[...e].sort((e,a)=>{switch(N.value){case"click_count":return a.click_count-e.click_count;case"created_at":return new Date(a.created_at).getTime()-new Date(e.created_at).getTime();default:return e.name.localeCompare(a.name)}}),e}),handleSearch=()=>{k.setSearchQuery(S.value)},updateFilters=e=>{Object.assign(x,e)},handleAdvancedSearch=e=>{z(e),P.value=!1},handleToolClick=async e=>{if(console.log("点击工具:",e.name,"URL:",e.url),!e.url||""===e.url.trim())return console.warn("工具URL为空:",e),void alert("该工具暂无可用链接");try{let a=e.url.trim();a.startsWith("http://")||a.startsWith("https://")||(a="https://"+a),await k.incrementClickCount(e.id),window.open(a,"_blank","noopener,noreferrer")}catch(a){console.error("打开链接失败:",a),alert("无法打开该链接，请检查URL是否正确")}},retryLoad=async()=>{k.clearError(),await k.initialize()};return t(()=>m.query,e=>{e.category&&"string"==typeof e.category&&(G.value=e.category),e.search&&"string"==typeof e.search&&(S.value=e.search,k.setSearchQuery(e.search))},{immediate:!0}),t(G,e=>{k.setSelectedCategory(e);const a={...m.query};"all"===e?delete a.category:a.category=e,f.replace({query:a})}),t(S,e=>{const a={...m.query};e?a.search=e:delete a.search,f.replace({query:a})}),C(async()=>{k.initialized||await k.initialize()}),(e,a)=>(b(),l("div",be,[c("div",Ce,[c("div",we,[c("div",_e,[c("div",Se,[o(i(E),{class:"search-icon"}),u(c("input",{ref_key:"searchInput",ref:$,"onUpdate:modelValue":a[0]||(a[0]=e=>w(S)?S.value=e:null),type:"text",placeholder:"搜索工具...",class:"search-input",onInput:handleSearch,onFocus:a[1]||(a[1]=e=>P.value=!1)},null,544),[[h,i(S)]]),i(S)?(b(),l("button",{key:0,class:"clear-search",onClick:a[2]||(a[2]=(...e)=>i(Q)&&i(Q)(...e))},[o(i(F),{class:"icon"})])):n("",!0),c("button",{class:r(["advanced-search-button",{active:P.value}]),title:"高级搜索",onClick:a[3]||(a[3]=e=>P.value=!P.value)},[o(i(T),{class:"icon"})],2),o(ke,{"is-open":P.value,filters:i(x),"search-history":i(B),"popular-searches":i(A),onClose:a[4]||(a[4]=e=>P.value=!1),"onUpdate:filters":updateFilters,onSearch:handleAdvancedSearch},null,8,["is-open","filters","search-history","popular-searches"])])]),c("div",Ue,[a[12]||(a[12]=c("label",{class:"filter-label"},"排序：",-1)),u(c("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>N.value=e),class:"filter-select"},a[11]||(a[11]=[c("option",{value:"name"},"名称",-1),c("option",{value:"click_count"},"热度",-1),c("option",{value:"created_at"},"最新",-1)]),512),[[v,N.value]])]),c("div",xe,[c("button",{class:r(["filter-button",{active:W.value}]),onClick:a[6]||(a[6]=e=>W.value=!W.value)},[o(i(O),{class:"icon"}),a[13]||(a[13]=y(" 只看收藏 "))],2)]),c("div",Fe,[c("div",Oe,[c("button",{class:r(["view-button",{active:"grid"===K.value}]),onClick:a[7]||(a[7]=e=>K.value="grid")},[o(i(H),{class:"icon"})],2),c("button",{class:r(["view-button",{active:"list"===K.value}]),onClick:a[8]||(a[8]=e=>K.value="list")},[o(i(R),{class:"icon"})],2)])]),c("div",Le,[c("span",Ee," 找到 "+g(X.value.length)+" 个工具 ",1)])])]),c("div",Ae,[i(k).loading?(b(),l("div",je,a[14]||(a[14]=[c("div",{class:"loading-spinner"},null,-1),c("p",null,"正在加载工具...",-1)]))):i(k).error?(b(),l("div",qe,[a[15]||(a[15]=c("div",{class:"error-icon"},"❌",-1)),a[16]||(a[16]=c("h3",null,"加载失败",-1)),c("p",null,g(i(k).error),1),c("button",{class:"retry-button",onClick:retryLoad},"重试")])):X.value.length>0&&"grid"===K.value?(b(),l("div",Ie,[(b(!0),l(d,null,p(X.value,e=>{var a;return b(),l("div",{key:e.id,class:"tool-card"},[c("div",Ve,[c("div",Be,g(e.icon||"🔧"),1),c("button",{class:r(["favorite-button",{active:e.isFavorite}]),onClick:_(a=>i(k).toggleFavorite(e.id),["stop"])},[o(i(O),{class:"icon"})],10,Te)]),c("div",De,[c("h3",He,g(e.name),1),c("p",Re,g(e.description),1),c("div",Me,[(b(!0),l(d,null,p((e.tags||[]).slice(0,3),e=>(b(),l("span",{key:e,class:"tag"},g(e),1))),128)),(e.tags||[]).length>3?(b(),l("span",ze," +"+g((e.tags||[]).length-3),1)):n("",!0)])]),c("div",Qe,[c("div",$e,[c("span",Ge,[o(i(M),{class:"stat-icon"}),y(" "+g(e.click_count||0),1)]),c("span",Ne,[o(i(D),{class:"stat-icon"}),y(" "+g((null==(a=e.categories)?void 0:a.name)||"未分类"),1)])]),c("div",Pe,[c("button",{class:"detail-button",title:"查看详情",onClick:_(a=>{return s=e.id,void f.push(`/tools/${s}`);var s},["stop"])},[o(i(j),{class:"icon"})],8,We),c("button",{class:"visit-button",title:"访问工具",onClick:_(a=>handleToolClick(e),["stop"])},[o(i(q),{class:"icon"})],8,Ke)])])])}),128))])):X.value.length>0&&"list"===K.value?(b(),l("div",Xe,[(b(!0),l(d,null,p(X.value,e=>(b(),l("div",{key:e.id,class:"tool-item",onClick:a=>handleToolClick(e)},[c("div",Ye,[c("div",Ze,g(e.icon||"🔧"),1),c("div",ea,[c("h3",aa,g(e.name),1),c("p",sa,g(e.description),1),c("div",ta,[c("span",la,g(e.category.name),1),a[17]||(a[17]=c("span",{class:"separator"},"•",-1)),c("span",ra,g(e.clickCount)+" 次访问",1)])])]),c("div",ca,[c("div",oa,[(b(!0),l(d,null,p((e.tags||[]).slice(0,2),e=>(b(),l("span",{key:e,class:"tag"},g(e),1))),128))]),c("div",ia,[c("button",{class:r(["favorite-button",{active:e.isFavorite}]),onClick:_(a=>i(k).toggleFavorite(e.id),["stop"])},[o(i(O),{class:"icon"})],10,na),o(i(q),{class:"external-icon"})])])],8,Je))),128))])):(b(),l("div",ua,[a[18]||(a[18]=c("div",{class:"empty-icon"},"🔍",-1)),a[19]||(a[19]=c("h3",null,"未找到相关工具",-1)),i(S)?(b(),l("p",va,' 没有找到包含 "'+g(i(S))+'" 的工具，尝试使用其他关键词搜索 ',1)):"all"!==G.value?(b(),l("p",da," 该分类下暂无工具，请选择其他分类 ")):(b(),l("p",pa,"暂无工具数据，请稍后再试")),c("div",ga,[i(S)?(b(),l("button",{key:0,class:"btn btn-primary",onClick:a[9]||(a[9]=(...e)=>i(Q)&&i(Q)(...e))}," 清除搜索条件 ")):n("",!0),"all"!==G.value?(b(),l("button",{key:1,class:"btn btn-secondary",onClick:a[10]||(a[10]=e=>G.value="all")}," 查看全部分类 ")):n("",!0)])]))])]))}}),[["__scopeId","data-v-5be087d0"]]);export{ha as default};
