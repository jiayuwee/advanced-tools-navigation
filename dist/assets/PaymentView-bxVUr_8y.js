const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./orderService-DsrkZM7H.js","./index-DnVHVpUO.js","./vendor-dtMHlISa.js","./index-C3KXLEkF.css"])))=>i.map(i=>d[i]);
import{n as e,d as a,o as l,c as s,_ as t}from"./index-DnVHVpUO.js";import{d as i,r as n,c as r,o,m as d,q as u,t as c,F as m,z as p,D as v,B as y,G as h,J as f,y as _,u as g,I as w,P as q,A as b}from"./vendor-dtMHlISa.js";const V={class:"payment-view"},S={class:"payment-container"},k={class:"payment-content"},P={class:"order-summary"},A={class:"order-items"},E={class:"item-image"},U=["src","alt"],x={class:"item-info"},O={class:"item-name"},j={class:"item-description"},C={class:"item-meta"},D={class:"item-quantity"},I={class:"item-price"},N={class:"order-total"},R={class:"total-row"},T={class:"total-row"},J={class:"discount"},L={class:"total-row final"},M={class:"final-amount"},$={class:"payment-methods"},z={class:"methods-list"},B=["value"],F={class:"method-content"},G={class:"method-icon"},Y=["src","alt"],H={class:"method-info"},K={class:"method-name"},Q={class:"method-description"},W={class:"method-check"},X={class:"billing-address"},Z={class:"address-form"},ee={class:"form-row"},ae={class:"form-group"},le={class:"form-group"},se={class:"form-row"},te={class:"form-group"},ie={class:"form-group"},ne={class:"form-group"},re={class:"payment-actions"},oe=["disabled"],de={key:0,class:"loading-spinner"},ue={key:0,class:"error-message"},ce=t(i({__name:"PaymentView",setup(t){const i=s(),ce=a(),me=n(!1),pe=n(null),ve=n(""),ye=n([{id:"1",name:"高效办公套件",description:"提升办公效率的完整解决方案",quantity:1,price:299,image:"/placeholder.jpg"}]),he=n({full_name:"",email:"",country:"",city:"",address:"",postal_code:""}),fe=[{id:"alipay",name:"支付宝",description:"使用支付宝安全快捷支付",icon:"/payment-alipay.png"},{id:"wechat",name:"微信支付",description:"使用微信支付便捷支付",icon:"/payment-wechat.png"},{id:"stripe",name:"信用卡",description:"支持 Visa、MasterCard 等",icon:"/payment-stripe.png"}],_e=r(()=>ye.value.reduce((e,a)=>e+a.price*a.quantity,0)),ge=r(()=>0),we=r(()=>_e.value-ge.value),qe=r(()=>ve.value&&he.value.full_name&&he.value.email&&he.value.country&&he.value.city&&he.value.address),handlePayment=async()=>{try{me.value=!0,pe.value=null;const{OrderService:e}=await l(async()=>{const{OrderService:e}=await import("./orderService-DsrkZM7H.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useAuthStore:a}=await l(async()=>{const{useAuthStore:e}=await import("./index-DnVHVpUO.js").then(e=>e.w);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),s=a();if(!s.user)throw new Error("请先登录");let t=ce.query.order;if(!t){const a=ce.query.product;if(!a)throw new Error("缺少产品信息");const l={product_id:a,quantity:1,billing_address:he.value};t=(await e.createOrder(l,s.user.id)).id}await new Promise(e=>setTimeout(e,2e3)),await e.processPayment({order_id:t,payment_method:ve.value,payment_id:`PAY_${Date.now()}`,amount:we.value}),i.push({path:"/payment/success",query:{order:t,amount:we.value.toString()}})}catch(e){pe.value=e instanceof Error?e.message:"支付失败，请重试"}finally{me.value=!1}},goBack=()=>{i.go(-1)};return o(()=>{(()=>{const e=ce.query.product,a=ce.query.order;e?console.log("从产品创建订单:",e):a&&console.log("加载现有订单:",a)})(),fe.length>0&&(ve.value=fe[0].id)}),(a,l)=>(b(),d("div",V,[u("div",S,[l[18]||(l[18]=u("div",{class:"payment-header"},[u("h1",null,"支付订单"),u("p",null,"请选择支付方式完成购买")],-1)),u("div",k,[u("div",P,[l[9]||(l[9]=u("h3",null,"订单信息",-1)),u("div",A,[(b(!0),d(m,null,p(ye.value,e=>(b(),d("div",{key:e.id,class:"order-item"},[u("div",E,[u("img",{src:e.image,alt:e.name},null,8,U)]),u("div",x,[u("h4",O,v(e.name),1),u("p",j,v(e.description),1),u("div",C,[u("span",D,"数量: "+v(e.quantity),1),u("span",I,"¥"+v(e.price),1)])])]))),128))]),u("div",N,[u("div",R,[l[6]||(l[6]=u("span",null,"商品总额",-1)),u("span",null,"¥"+v(_e.value),1)]),u("div",T,[l[7]||(l[7]=u("span",null,"优惠折扣",-1)),u("span",J,"-¥"+v(ge.value),1)]),u("div",L,[l[8]||(l[8]=u("span",null,"应付金额",-1)),u("span",M,"¥"+v(we.value),1)])])]),u("div",$,[l[10]||(l[10]=u("h3",null,"选择支付方式",-1)),u("div",z,[(b(),d(m,null,p(fe,a=>u("label",{key:a.id,class:y(["method-option",{selected:ve.value===a.id}])},[h(u("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>ve.value=e),type:"radio",value:a.id,name:"paymentMethod"},null,8,B),[[f,ve.value]]),u("div",F,[u("div",G,[u("img",{src:a.icon,alt:a.name},null,8,Y)]),u("div",H,[u("div",K,v(a.name),1),u("div",Q,v(a.description),1)]),u("div",W,[_(g(e),{class:"check-icon"})])])],2)),64))])]),u("div",X,[l[17]||(l[17]=u("h3",null,"账单地址",-1)),u("form",Z,[u("div",ee,[u("div",ae,[l[11]||(l[11]=u("label",{for:"fullName"},"姓名 *",-1)),h(u("input",{id:"fullName","onUpdate:modelValue":l[1]||(l[1]=e=>he.value.full_name=e),type:"text",required:"",placeholder:"请输入姓名"},null,512),[[w,he.value.full_name]])]),u("div",le,[l[12]||(l[12]=u("label",{for:"email"},"邮箱 *",-1)),h(u("input",{id:"email","onUpdate:modelValue":l[2]||(l[2]=e=>he.value.email=e),type:"email",required:"",placeholder:"请输入邮箱地址"},null,512),[[w,he.value.email]])])]),u("div",se,[u("div",te,[l[14]||(l[14]=u("label",{for:"country"},"国家/地区 *",-1)),h(u("select",{id:"country","onUpdate:modelValue":l[3]||(l[3]=e=>he.value.country=e),required:""},l[13]||(l[13]=[u("option",{value:""},"请选择国家/地区",-1),u("option",{value:"CN"},"中国",-1),u("option",{value:"US"},"美国",-1),u("option",{value:"JP"},"日本",-1)]),512),[[q,he.value.country]])]),u("div",ie,[l[15]||(l[15]=u("label",{for:"city"},"城市 *",-1)),h(u("input",{id:"city","onUpdate:modelValue":l[4]||(l[4]=e=>he.value.city=e),type:"text",required:"",placeholder:"请输入城市"},null,512),[[w,he.value.city]])])]),u("div",ne,[l[16]||(l[16]=u("label",{for:"address"},"详细地址 *",-1)),h(u("input",{id:"address","onUpdate:modelValue":l[5]||(l[5]=e=>he.value.address=e),type:"text",required:"",placeholder:"请输入详细地址"},null,512),[[w,he.value.address]])])])]),u("div",re,[u("button",{class:"cancel-btn",onClick:goBack},"取消订单"),u("button",{class:"pay-btn",disabled:!qe.value||me.value,onClick:handlePayment},[me.value?(b(),d("div",de)):c("",!0),u("span",null,v(me.value?"处理中...":`立即支付 ¥${we.value}`),1)],8,oe)]),pe.value?(b(),d("div",ue,v(pe.value),1)):c("",!0)])])]))}}),[["__scopeId","data-v-5e6663dd"]]);export{ce as default};
//# sourceMappingURL=PaymentView-bxVUr_8y.js.map
