const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./orderService-DsrkZM7H.js","./index-DnVHVpUO.js","./vendor-dtMHlISa.js","./index-C3KXLEkF.css"])))=>i.map(i=>d[i]);
import{o as e,c as t,_ as a}from"./index-DnVHVpUO.js";import{D as r}from"./download-C6OAg1E3.js";import{d as s,r as o,c as l,o as i,m as n,q as d,F as c,z as u,B as p,E as m,D as v,t as y,y as _,u as g,M as h,L as w,A as k}from"./vendor-dtMHlISa.js";const S={class:"orders-view"},f={class:"orders-filters"},b=["onClick"],A={class:"filter-count"},I={class:"orders-content"},O={key:0,class:"loading-state"},C={key:1,class:"orders-list"},D={class:"order-header"},j={class:"order-info"},E={class:"order-number"},P={class:"order-date"},L={class:"order-status"},R={class:"order-items"},T={class:"item-image"},q=["src","alt"],x={class:"item-info"},V={class:"item-name"},z={class:"item-description"},N={class:"item-meta"},$={class:"item-quantity"},B={class:"item-price"},M={class:"item-total"},U={class:"order-footer"},Y={class:"order-total"},F={class:"total-amount"},G={class:"order-actions"},H=["onClick"],J=["onClick"],K=["onClick"],Q=["onClick"],W={key:2,class:"empty-state"},X=a(s({__name:"OrdersView",setup(a){const s=t(),X=o(!0),Z=o("all"),ee=o([]),te=[{key:"all",label:"å…¨éƒ¨è®¢å•"},{key:"pending",label:"å¾…æ”¯ä»˜"},{key:"paid",label:"å·²æ”¯ä»˜"},{key:"cancelled",label:"å·²å–æ¶ˆ"},{key:"refunded",label:"å·²é€€æ¬¾"}],ae=l(()=>"all"===Z.value?ee.value:ee.value.filter(e=>e.status===Z.value));return i(()=>{(async()=>{try{X.value=!0;const{OrderService:a}=await e(async()=>{const{OrderService:e}=await import("./orderService-DsrkZM7H.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useAuthStore:r}=await e(async()=>{const{useAuthStore:e}=await import("./index-DnVHVpUO.js").then(e=>e.w);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),s=r();if(!s.user)return void console.error("ç”¨æˆ·æœªç™»å½•");try{const e=await a.getUserOrders(s.user.id);return void(ee.value=e)}catch(t){console.warn("åŠ è½½çœŸå®è®¢å•æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:",t)}await new Promise(e=>setTimeout(e,1e3)),ee.value=[{id:"order-1",userId:"user-1",items:[{id:"item-1",orderId:"order-1",productId:"product-1",quantity:1,unitPrice:299,totalPrice:299,createdAt:(new Date).toISOString(),product:{id:"product-1",name:"é«˜æ•ˆåŠå…¬å¥—ä»¶",short_description:"æå‡åŠå…¬æ•ˆç‡çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ",images:["/placeholder.jpg"]}}],totalAmount:299,currency:"CNY",status:"paid",paymentMethod:"alipay",createdAt:new Date(Date.now()-864e5).toISOString(),updatedAt:(new Date).toISOString(),completedAt:(new Date).toISOString()},{id:"order-2",userId:"user-1",items:[{id:"item-2",orderId:"order-2",productId:"product-2",quantity:1,unitPrice:199,totalPrice:199,createdAt:(new Date).toISOString(),product:{id:"product-2",name:"è®¾è®¡å¸ˆå·¥å…·åŒ…",short_description:"ä¸“ä¸šè®¾è®¡å¸ˆå¿…å¤‡å·¥å…·é›†åˆ",images:["/placeholder.jpg"]}}],totalAmount:199,currency:"CNY",status:"pending",createdAt:new Date(Date.now()-36e5).toISOString(),updatedAt:(new Date).toISOString()}]}catch(a){console.error("åŠ è½½è®¢å•å¤±è´¥:",a)}finally{X.value=!1}})()}),(t,a)=>{const o=w("router-link");return k(),n("div",S,[a[5]||(a[5]=d("div",{class:"orders-header"},[d("h1",null,"æˆ‘çš„è®¢å•"),d("p",null,"æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„è®¢å•å†å²")],-1)),d("div",f,[(k(),n(c,null,u(te,e=>{return d("button",{key:e.key,class:p(["filter-btn",{active:Z.value===e.key}]),onClick:t=>Z.value=e.key},[m(v(e.label)+" ",1),d("span",A,v((t=e.key,"all"===t?ee.value.length:ee.value.filter(e=>e.status===t).length)),1)],10,b);var t}),64))]),d("div",I,[X.value?(k(),n("div",O,a[0]||(a[0]=[d("div",{class:"loading-spinner"},null,-1),d("p",null,"æ­£åœ¨åŠ è½½è®¢å•...",-1)]))):ae.value.length>0?(k(),n("div",C,[(k(!0),n(c,null,u(ae.value,t=>{return k(),n("div",{key:t.id,class:"order-item"},[d("div",D,[d("div",j,[d("h3",E," è®¢å•å·: "+v(t.id.slice(-8).toUpperCase()),1),d("p",P," ä¸‹å•æ—¶é—´: "+v((l=t.created_at,new Date(l).toLocaleString("zh-CN"))),1)]),d("div",L,[d("span",{class:p(["status-badge",t.status])},v((o=t.status,{pending:"å¾…æ”¯ä»˜",paid:"å·²æ”¯ä»˜",cancelled:"å·²å–æ¶ˆ",refunded:"å·²é€€æ¬¾"}[o]||o)),3)])]),d("div",R,[(k(!0),n(c,null,u(t.items,e=>{var t,a,r,s,o;return k(),n("div",{key:e.id,class:"order-item-detail"},[d("div",T,[d("img",{src:(null==(a=null==(t=e.product)?void 0:t.images)?void 0:a[0])||"/placeholder.jpg",alt:null==(r=e.product)?void 0:r.name},null,8,q)]),d("div",x,[d("h4",V,v(null==(s=e.product)?void 0:s.name),1),d("p",z,v(null==(o=e.product)?void 0:o.short_description),1),d("div",N,[d("span",$,"æ•°é‡: "+v(e.quantity),1),d("span",B,"å•ä»·: Â¥"+v(e.unit_price),1)])]),d("div",M,"Â¥"+v(e.total_price),1)])}),128))]),d("div",U,[d("div",Y,[a[1]||(a[1]=d("span",{class:"total-label"},"è®¢å•æ€»é¢:",-1)),d("span",F,"Â¥"+v(t.total_amount),1)]),d("div",G,["pending"===t.status?(k(),n("button",{key:0,class:"action-btn primary",onClick:e=>(e=>{s.push(`/payment?order=${e.id}`)})(t)}," ç«‹å³æ”¯ä»˜ ",8,H)):y("",!0),"pending"===t.status?(k(),n("button",{key:1,class:"action-btn secondary",onClick:e=>(async e=>{if(confirm("ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ"))try{const t=ee.value.findIndex(t=>t.id===e.id);-1!==t&&(ee.value[t].status="cancelled")}catch(t){console.error("å–æ¶ˆè®¢å•å¤±è´¥:",t)}})(t)}," å–æ¶ˆè®¢å• ",8,J)):y("",!0),"paid"===t.status?(k(),n("button",{key:2,class:"action-btn secondary",onClick:a=>(async t=>{var a;try{if(console.log("ä¸‹è½½è®¢å•äº§å“:",t.id),"paid"!==t.status)return void alert("è®¢å•æœªæ”¯ä»˜ï¼Œæ— æ³•ä¸‹è½½");const{OrderService:r}=await e(async()=>{const{OrderService:e}=await import("./orderService-DsrkZM7H.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useAuthStore:s}=await e(async()=>{const{useAuthStore:e}=await import("./index-DnVHVpUO.js").then(e=>e.w);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),o=s();if(!o.user)return void alert("è¯·å…ˆç™»å½•");const l=await r.getOrderById(t.id,o.user.id);if(!l||"paid"!==l.status)return void alert("è®¢å•çŠ¶æ€å¼‚å¸¸ï¼Œæ— æ³•ä¸‹è½½");let i=0;for(const e of l.items)if(null==(a=e.product)?void 0:a.download_url){const t=document.createElement("a");t.href=e.product.download_url,t.download=`${e.product.name}.zip`,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),i++,await new Promise(e=>setTimeout(e,500))}0===i?alert("è¯¥è®¢å•ä¸­æ²¡æœ‰å¯ä¸‹è½½çš„äº§å“"):console.log(`æˆåŠŸå¯åŠ¨ ${i} ä¸ªäº§å“çš„ä¸‹è½½`)}catch(r){console.error("ä¸‹è½½å¤±è´¥:",r),alert("ä¸‹è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}})(t)},[_(g(r),{class:"icon"}),a[2]||(a[2]=m(" ä¸‹è½½äº§å“ "))],8,K)):y("",!0),d("button",{class:"action-btn secondary",onClick:e=>(e=>{console.log("æŸ¥çœ‹è®¢å•è¯¦æƒ…:",e.id)})(t)}," æŸ¥çœ‹è¯¦æƒ… ",8,Q)])])]);var o,l}),128))])):(k(),n("div",W,[a[4]||(a[4]=d("div",{class:"empty-icon"},"ğŸ“¦",-1)),d("h3",null,v({all:"æš‚æ— è®¢å•",pending:"æš‚æ— å¾…æ”¯ä»˜è®¢å•",paid:"æš‚æ— å·²æ”¯ä»˜è®¢å•",cancelled:"æš‚æ— å·²å–æ¶ˆè®¢å•",refunded:"æš‚æ— å·²é€€æ¬¾è®¢å•"}[Z.value]||"æš‚æ— è®¢å•"),1),d("p",null,v({all:"æ‚¨è¿˜æ²¡æœ‰ä»»ä½•è®¢å•ï¼Œå»è´­ä¹°ä¸€äº›äº§å“å§ï¼",pending:"æ‚¨æ²¡æœ‰å¾…æ”¯ä»˜çš„è®¢å•",paid:"æ‚¨æ²¡æœ‰å·²æ”¯ä»˜çš„è®¢å•",cancelled:"æ‚¨æ²¡æœ‰å·²å–æ¶ˆçš„è®¢å•",refunded:"æ‚¨æ²¡æœ‰å·²é€€æ¬¾çš„è®¢å•"}[Z.value]||"æš‚æ— ç›¸å…³è®¢å•"),1),_(o,{to:"/products",class:"empty-action"},{default:h(()=>a[3]||(a[3]=[m("å»è´­ä¹°äº§å“")])),_:1,__:[3]})]))])])}}}),[["__scopeId","data-v-16a1a0e2"]]);export{X as default};
//# sourceMappingURL=OrdersView-ngFNaKxO.js.map
