const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./orderService-DsrkZM7H.js","./index-DnVHVpUO.js","./vendor-dtMHlISa.js","./index-C3KXLEkF.css"])))=>i.map(i=>d[i]);
import{o as e,c as t,_ as a}from"./index-DnVHVpUO.js";import{D as r}from"./download-C6OAg1E3.js";import{d as s,r as o,c as l,o as i,m as n,q as d,F as c,z as u,B as p,E as m,D as v,t as y,y as _,u as g,M as h,L as w,A as k}from"./vendor-dtMHlISa.js";const S={class:"orders-view"},f={class:"orders-filters"},b=["onClick"],A={class:"filter-count"},I={class:"orders-content"},O={key:0,class:"loading-state"},C={key:1,class:"orders-list"},D={class:"order-header"},j={class:"order-info"},E={class:"order-number"},P={class:"order-date"},L={class:"order-status"},R={class:"order-items"},T={class:"item-image"},q=["src","alt"],x={class:"item-info"},V={class:"item-name"},z={class:"item-description"},N={class:"item-meta"},$={class:"item-quantity"},B={class:"item-price"},M={class:"item-total"},U={class:"order-footer"},Y={class:"order-total"},F={class:"total-amount"},G={class:"order-actions"},H=["onClick"],J=["onClick"],K=["onClick"],Q=["onClick"],W={key:2,class:"empty-state"},X=a(s({__name:"OrdersView",setup(a){const s=t(),X=o(!0),Z=o("all"),ee=o([]),te=[{key:"all",label:"全部订单"},{key:"pending",label:"待支付"},{key:"paid",label:"已支付"},{key:"cancelled",label:"已取消"},{key:"refunded",label:"已退款"}],ae=l(()=>"all"===Z.value?ee.value:ee.value.filter(e=>e.status===Z.value));return i(()=>{(async()=>{try{X.value=!0;const{OrderService:a}=await e(async()=>{const{OrderService:e}=await import("./orderService-DsrkZM7H.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useAuthStore:r}=await e(async()=>{const{useAuthStore:e}=await import("./index-DnVHVpUO.js").then(e=>e.w);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),s=r();if(!s.user)return void console.error("用户未登录");try{const e=await a.getUserOrders(s.user.id);return void(ee.value=e)}catch(t){console.warn("加载真实订单数据失败，使用模拟数据:",t)}await new Promise(e=>setTimeout(e,1e3)),ee.value=[{id:"order-1",userId:"user-1",items:[{id:"item-1",orderId:"order-1",productId:"product-1",quantity:1,unitPrice:299,totalPrice:299,createdAt:(new Date).toISOString(),product:{id:"product-1",name:"高效办公套件",short_description:"提升办公效率的完整解决方案",images:["/placeholder.jpg"]}}],totalAmount:299,currency:"CNY",status:"paid",paymentMethod:"alipay",createdAt:new Date(Date.now()-864e5).toISOString(),updatedAt:(new Date).toISOString(),completedAt:(new Date).toISOString()},{id:"order-2",userId:"user-1",items:[{id:"item-2",orderId:"order-2",productId:"product-2",quantity:1,unitPrice:199,totalPrice:199,createdAt:(new Date).toISOString(),product:{id:"product-2",name:"设计师工具包",short_description:"专业设计师必备工具集合",images:["/placeholder.jpg"]}}],totalAmount:199,currency:"CNY",status:"pending",createdAt:new Date(Date.now()-36e5).toISOString(),updatedAt:(new Date).toISOString()}]}catch(a){console.error("加载订单失败:",a)}finally{X.value=!1}})()}),(t,a)=>{const o=w("router-link");return k(),n("div",S,[a[5]||(a[5]=d("div",{class:"orders-header"},[d("h1",null,"我的订单"),d("p",null,"查看和管理您的订单历史")],-1)),d("div",f,[(k(),n(c,null,u(te,e=>{return d("button",{key:e.key,class:p(["filter-btn",{active:Z.value===e.key}]),onClick:t=>Z.value=e.key},[m(v(e.label)+" ",1),d("span",A,v((t=e.key,"all"===t?ee.value.length:ee.value.filter(e=>e.status===t).length)),1)],10,b);var t}),64))]),d("div",I,[X.value?(k(),n("div",O,a[0]||(a[0]=[d("div",{class:"loading-spinner"},null,-1),d("p",null,"正在加载订单...",-1)]))):ae.value.length>0?(k(),n("div",C,[(k(!0),n(c,null,u(ae.value,t=>{return k(),n("div",{key:t.id,class:"order-item"},[d("div",D,[d("div",j,[d("h3",E," 订单号: "+v(t.id.slice(-8).toUpperCase()),1),d("p",P," 下单时间: "+v((l=t.created_at,new Date(l).toLocaleString("zh-CN"))),1)]),d("div",L,[d("span",{class:p(["status-badge",t.status])},v((o=t.status,{pending:"待支付",paid:"已支付",cancelled:"已取消",refunded:"已退款"}[o]||o)),3)])]),d("div",R,[(k(!0),n(c,null,u(t.items,e=>{var t,a,r,s,o;return k(),n("div",{key:e.id,class:"order-item-detail"},[d("div",T,[d("img",{src:(null==(a=null==(t=e.product)?void 0:t.images)?void 0:a[0])||"/placeholder.jpg",alt:null==(r=e.product)?void 0:r.name},null,8,q)]),d("div",x,[d("h4",V,v(null==(s=e.product)?void 0:s.name),1),d("p",z,v(null==(o=e.product)?void 0:o.short_description),1),d("div",N,[d("span",$,"数量: "+v(e.quantity),1),d("span",B,"单价: ¥"+v(e.unit_price),1)])]),d("div",M,"¥"+v(e.total_price),1)])}),128))]),d("div",U,[d("div",Y,[a[1]||(a[1]=d("span",{class:"total-label"},"订单总额:",-1)),d("span",F,"¥"+v(t.total_amount),1)]),d("div",G,["pending"===t.status?(k(),n("button",{key:0,class:"action-btn primary",onClick:e=>(e=>{s.push(`/payment?order=${e.id}`)})(t)}," 立即支付 ",8,H)):y("",!0),"pending"===t.status?(k(),n("button",{key:1,class:"action-btn secondary",onClick:e=>(async e=>{if(confirm("确定要取消这个订单吗？"))try{const t=ee.value.findIndex(t=>t.id===e.id);-1!==t&&(ee.value[t].status="cancelled")}catch(t){console.error("取消订单失败:",t)}})(t)}," 取消订单 ",8,J)):y("",!0),"paid"===t.status?(k(),n("button",{key:2,class:"action-btn secondary",onClick:a=>(async t=>{var a;try{if(console.log("下载订单产品:",t.id),"paid"!==t.status)return void alert("订单未支付，无法下载");const{OrderService:r}=await e(async()=>{const{OrderService:e}=await import("./orderService-DsrkZM7H.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useAuthStore:s}=await e(async()=>{const{useAuthStore:e}=await import("./index-DnVHVpUO.js").then(e=>e.w);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),o=s();if(!o.user)return void alert("请先登录");const l=await r.getOrderById(t.id,o.user.id);if(!l||"paid"!==l.status)return void alert("订单状态异常，无法下载");let i=0;for(const e of l.items)if(null==(a=e.product)?void 0:a.download_url){const t=document.createElement("a");t.href=e.product.download_url,t.download=`${e.product.name}.zip`,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),i++,await new Promise(e=>setTimeout(e,500))}0===i?alert("该订单中没有可下载的产品"):console.log(`成功启动 ${i} 个产品的下载`)}catch(r){console.error("下载失败:",r),alert("下载失败，请稍后重试")}})(t)},[_(g(r),{class:"icon"}),a[2]||(a[2]=m(" 下载产品 "))],8,K)):y("",!0),d("button",{class:"action-btn secondary",onClick:e=>(e=>{console.log("查看订单详情:",e.id)})(t)}," 查看详情 ",8,Q)])])]);var o,l}),128))])):(k(),n("div",W,[a[4]||(a[4]=d("div",{class:"empty-icon"},"📦",-1)),d("h3",null,v({all:"暂无订单",pending:"暂无待支付订单",paid:"暂无已支付订单",cancelled:"暂无已取消订单",refunded:"暂无已退款订单"}[Z.value]||"暂无订单"),1),d("p",null,v({all:"您还没有任何订单，去购买一些产品吧！",pending:"您没有待支付的订单",paid:"您没有已支付的订单",cancelled:"您没有已取消的订单",refunded:"您没有已退款的订单"}[Z.value]||"暂无相关订单"),1),_(o,{to:"/products",class:"empty-action"},{default:h(()=>a[3]||(a[3]=[m("去购买产品")])),_:1,__:[3]})]))])])}}}),[["__scopeId","data-v-16a1a0e2"]]);export{X as default};
//# sourceMappingURL=OrdersView-ngFNaKxO.js.map
