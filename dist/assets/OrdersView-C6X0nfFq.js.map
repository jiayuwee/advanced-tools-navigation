{"version":3,"mappings":"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","names":["router","useRouter","loading","ref","activeFilter","orders","statusFilters","key","label","filteredOrders","computed","value","filter","order","status","onMounted","async","OrderService","__vitePreload","import","useAuthStore","then","n","w","authStore","user","console","error","userOrders","getUserOrders","id","apiError","warn","Promise","resolve","setTimeout","userId","items","orderId","productId","quantity","unitPrice","totalPrice","createdAt","Date","toISOString","product","name","short_description","images","totalAmount","currency","paymentMethod","now","updatedAt","completedAt","loadOrders","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","class","_hoisted_2","_Fragment","_renderList","active","onClick","$event","_hoisted_4","_toDisplayString","filterKey","length","_hoisted_5","_hoisted_6","_cache","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","slice","toUpperCase","_hoisted_11","dateString","created_at","toLocaleString","_hoisted_12","_normalizeClass","pending","paid","cancelled","refunded","_hoisted_13","item","_hoisted_14","src","_b","_a","alt","_c","_hoisted_16","_hoisted_17","_d","_hoisted_18","_e","_hoisted_19","_hoisted_20","_hoisted_21","unit_price","_hoisted_22","total_price","_hoisted_23","_hoisted_24","_hoisted_25","total_amount","_hoisted_26","push","payOrder","_hoisted_27","confirm","orderIndex","findIndex","o","cancelOrder","_hoisted_28","log","alert","latestOrder","getOrderById","downloadCount","download_url","link","document","createElement","href","download","target","body","appendChild","click","removeChild","downloadOrder","_createVNode","_unref","DownloadIcon","viewOrderDetail","_hoisted_30","_hoisted_31","all","_component_router_link","to"],"ignoreList":[],"sources":["../../src/views/user/OrdersView.vue"],"sourcesContent":["<template>\r\n  <div class=\"orders-view\">\r\n    <div class=\"orders-header\">\r\n      <h1>我的订单</h1>\r\n      <p>查看和管理您的订单历史</p>\r\n    </div>\r\n\r\n    <div class=\"orders-filters\">\r\n      <button\r\n        v-for=\"filter in statusFilters\"\r\n        :key=\"filter.key\"\r\n        class=\"filter-btn\"\r\n        :class=\"{ active: activeFilter === filter.key }\"\r\n        @click=\"activeFilter = filter.key\"\r\n      >\r\n        {{ filter.label }}\r\n        <span class=\"filter-count\">{{ getFilterCount(filter.key) }}</span>\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"orders-content\">\r\n      <div v-if=\"loading\" class=\"loading-state\">\r\n        <div class=\"loading-spinner\"></div>\r\n        <p>正在加载订单...</p>\r\n      </div>\r\n\r\n      <div v-else-if=\"filteredOrders.length > 0\" class=\"orders-list\">\r\n        <div v-for=\"order in filteredOrders\" :key=\"order.id\" class=\"order-item\">\r\n          <div class=\"order-header\">\r\n            <div class=\"order-info\">\r\n              <h3 class=\"order-number\">\r\n                订单号: {{ order.id.slice(-8).toUpperCase() }}\r\n              </h3>\r\n              <p class=\"order-date\">\r\n                下单时间: {{ formatDate(order.created_at) }}\r\n              </p>\r\n            </div>\r\n            <div class=\"order-status\">\r\n              <span class=\"status-badge\" :class=\"order.status\">\r\n                {{ getStatusText(order.status) }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"order-items\">\r\n            <div\r\n              v-for=\"item in order.items\"\r\n              :key=\"item.id\"\r\n              class=\"order-item-detail\"\r\n            >\r\n              <div class=\"item-image\">\r\n                <img\r\n                  :src=\"item.product?.images?.[0] || '/placeholder.jpg'\"\r\n                  :alt=\"item.product?.name\"\r\n                />\r\n              </div>\r\n              <div class=\"item-info\">\r\n                <h4 class=\"item-name\">{{ item.product?.name }}</h4>\r\n                <p class=\"item-description\">\r\n                  {{ item.product?.short_description }}\r\n                </p>\r\n                <div class=\"item-meta\">\r\n                  <span class=\"item-quantity\">数量: {{ item.quantity }}</span>\r\n                  <span class=\"item-price\">单价: ¥{{ item.unit_price }}</span>\r\n                </div>\r\n              </div>\r\n              <div class=\"item-total\">¥{{ item.total_price }}</div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"order-footer\">\r\n            <div class=\"order-total\">\r\n              <span class=\"total-label\">订单总额:</span>\r\n              <span class=\"total-amount\">¥{{ order.total_amount }}</span>\r\n            </div>\r\n            <div class=\"order-actions\">\r\n              <button\r\n                v-if=\"order.status === 'pending'\"\r\n                class=\"action-btn primary\"\r\n                @click=\"payOrder(order)\"\r\n              >\r\n                立即支付\r\n              </button>\r\n              <button\r\n                v-if=\"order.status === 'pending'\"\r\n                class=\"action-btn secondary\"\r\n                @click=\"cancelOrder(order)\"\r\n              >\r\n                取消订单\r\n              </button>\r\n              <button\r\n                v-if=\"order.status === 'paid'\"\r\n                class=\"action-btn secondary\"\r\n                @click=\"downloadOrder(order)\"\r\n              >\r\n                <DownloadIcon class=\"icon\" />\r\n                下载产品\r\n              </button>\r\n              <button\r\n                class=\"action-btn secondary\"\r\n                @click=\"viewOrderDetail(order)\"\r\n              >\r\n                查看详情\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-else class=\"empty-state\">\r\n        <div class=\"empty-icon\">📦</div>\r\n        <h3>{{ getEmptyStateTitle() }}</h3>\r\n        <p>{{ getEmptyStateDescription() }}</p>\r\n        <router-link to=\"/products\" class=\"empty-action\"\r\n          >去购买产品</router-link\r\n        >\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted } from \"vue\";\r\nimport { useRouter } from \"vue-router\";\r\nimport { DownloadIcon } from \"lucide-vue-next\";\r\nimport type { Order } from \"../../types\";\r\n\r\nconst router = useRouter();\r\n\r\n// 响应式状态\r\nconst loading = ref(true);\r\nconst activeFilter = ref(\"all\");\r\nconst orders = ref<Order[]>([]);\r\n\r\nconst statusFilters = [\r\n  { key: \"all\", label: \"全部订单\" },\r\n  { key: \"pending\", label: \"待支付\" },\r\n  { key: \"paid\", label: \"已支付\" },\r\n  { key: \"cancelled\", label: \"已取消\" },\r\n  { key: \"refunded\", label: \"已退款\" },\r\n];\r\n\r\n// 计算属性\r\nconst filteredOrders = computed(() => {\r\n  if (activeFilter.value === \"all\") {\r\n    return orders.value;\r\n  }\r\n  return orders.value.filter((order) => order.status === activeFilter.value);\r\n});\r\n\r\nconst getFilterCount = (filterKey: string) => {\r\n  if (filterKey === \"all\") return orders.value.length;\r\n  return orders.value.filter((order) => order.status === filterKey).length;\r\n};\r\n\r\n// 方法\r\nconst loadOrders = async () => {\r\n  try {\r\n    loading.value = true;\r\n\r\n    // 导入必要的服务\r\n    const { OrderService } = await import(\"@/services/orderService\");\r\n    const { useAuthStore } = await import(\"@/stores/auth\");\r\n\r\n    const authStore = useAuthStore();\r\n    if (!authStore.user) {\r\n      console.error(\"用户未登录\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // 从API加载真实订单数据\r\n      const userOrders = await OrderService.getUserOrders(authStore.user.id);\r\n      orders.value = userOrders;\r\n      return; // 成功加载真实数据，直接返回\r\n    } catch (apiError) {\r\n      console.warn(\"加载真实订单数据失败，使用模拟数据:\", apiError);\r\n    }\r\n\r\n    // 如果API失败，使用模拟数据作为后备\r\n    await new Promise((resolve) => setTimeout(resolve, 1000));\r\n\r\n    orders.value = [\r\n      {\r\n        id: \"order-1\",\r\n        userId: \"user-1\",\r\n        items: [\r\n          {\r\n            id: \"item-1\",\r\n            orderId: \"order-1\",\r\n            productId: \"product-1\",\r\n            quantity: 1,\r\n            unitPrice: 299,\r\n            totalPrice: 299,\r\n            createdAt: new Date().toISOString(),\r\n            product: {\r\n              id: \"product-1\",\r\n              name: \"高效办公套件\",\r\n              short_description: \"提升办公效率的完整解决方案\",\r\n              images: [\"/placeholder.jpg\"],\r\n            },\r\n          },\r\n        ],\r\n        totalAmount: 299,\r\n        currency: \"CNY\",\r\n        status: \"paid\" as const,\r\n        paymentMethod: \"alipay\",\r\n        createdAt: new Date(Date.now() - 86400000).toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n        completedAt: new Date().toISOString(),\r\n      },\r\n      {\r\n        id: \"order-2\",\r\n        userId: \"user-1\",\r\n        items: [\r\n          {\r\n            id: \"item-2\",\r\n            orderId: \"order-2\",\r\n            productId: \"product-2\",\r\n            quantity: 1,\r\n            unitPrice: 199,\r\n            totalPrice: 199,\r\n            createdAt: new Date().toISOString(),\r\n            product: {\r\n              id: \"product-2\",\r\n              name: \"设计师工具包\",\r\n              short_description: \"专业设计师必备工具集合\",\r\n              images: [\"/placeholder.jpg\"],\r\n            },\r\n          },\r\n        ],\r\n        totalAmount: 199,\r\n        currency: \"CNY\",\r\n        status: \"pending\" as const,\r\n        createdAt: new Date(Date.now() - 3600000).toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n      },\r\n    ];\r\n  } catch (error) {\r\n    console.error(\"加载订单失败:\", error);\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\nconst getStatusText = (status: string) => {\r\n  const statusMap = {\r\n    pending: \"待支付\",\r\n    paid: \"已支付\",\r\n    cancelled: \"已取消\",\r\n    refunded: \"已退款\",\r\n  };\r\n  return statusMap[status as keyof typeof statusMap] || status;\r\n};\r\n\r\nconst getEmptyStateTitle = () => {\r\n  const titleMap = {\r\n    all: \"暂无订单\",\r\n    pending: \"暂无待支付订单\",\r\n    paid: \"暂无已支付订单\",\r\n    cancelled: \"暂无已取消订单\",\r\n    refunded: \"暂无已退款订单\",\r\n  };\r\n  return titleMap[activeFilter.value as keyof typeof titleMap] || \"暂无订单\";\r\n};\r\n\r\nconst getEmptyStateDescription = () => {\r\n  const descMap = {\r\n    all: \"您还没有任何订单，去购买一些产品吧！\",\r\n    pending: \"您没有待支付的订单\",\r\n    paid: \"您没有已支付的订单\",\r\n    cancelled: \"您没有已取消的订单\",\r\n    refunded: \"您没有已退款的订单\",\r\n  };\r\n  return descMap[activeFilter.value as keyof typeof descMap] || \"暂无相关订单\";\r\n};\r\n\r\nconst formatDate = (dateString: string) => {\r\n  return new Date(dateString).toLocaleString(\"zh-CN\");\r\n};\r\n\r\nconst payOrder = (order: Order) => {\r\n  router.push(`/payment?order=${order.id}`);\r\n};\r\n\r\nconst cancelOrder = async (order: Order) => {\r\n  if (!confirm(\"确定要取消这个订单吗？\")) return;\r\n\r\n  try {\r\n    // TODO: 实现取消订单逻辑\r\n    // await OrdersService.cancelOrder(order.id)\r\n\r\n    const orderIndex = orders.value.findIndex((o) => o.id === order.id);\r\n    if (orderIndex !== -1) {\r\n      orders.value[orderIndex].status = \"cancelled\";\r\n    }\r\n  } catch (error) {\r\n    console.error(\"取消订单失败:\", error);\r\n  }\r\n};\r\n\r\nconst downloadOrder = async (order: Order) => {\r\n  try {\r\n    console.log(\"下载订单产品:\", order.id);\r\n\r\n    // 检查订单状态\r\n    if (order.status !== \"paid\") {\r\n      alert(\"订单未支付，无法下载\");\r\n      return;\r\n    }\r\n\r\n    // 导入订单服务\r\n    const { OrderService } = await import(\"@/services/orderService\");\r\n    const { useAuthStore } = await import(\"@/stores/auth\");\r\n\r\n    const authStore = useAuthStore();\r\n    if (!authStore.user) {\r\n      alert(\"请先登录\");\r\n      return;\r\n    }\r\n\r\n    // 验证下载权限并获取最新订单信息\r\n    const latestOrder = await OrderService.getOrderById(\r\n      order.id,\r\n      authStore.user.id,\r\n    );\r\n    if (!latestOrder || latestOrder.status !== \"paid\") {\r\n      alert(\"订单状态异常，无法下载\");\r\n      return;\r\n    }\r\n\r\n    // 下载所有产品\r\n    let downloadCount = 0;\r\n    for (const item of latestOrder.items) {\r\n      if (item.product?.download_url) {\r\n        const link = document.createElement(\"a\");\r\n        link.href = item.product.download_url;\r\n        link.download = `${item.product.name}.zip`;\r\n        link.target = \"_blank\";\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        downloadCount++;\r\n\r\n        // 延迟一下避免浏览器阻止多个下载\r\n        await new Promise((resolve) => setTimeout(resolve, 500));\r\n      }\r\n    }\r\n\r\n    if (downloadCount === 0) {\r\n      alert(\"该订单中没有可下载的产品\");\r\n    } else {\r\n      console.log(`成功启动 ${downloadCount} 个产品的下载`);\r\n    }\r\n  } catch (error) {\r\n    console.error(\"下载失败:\", error);\r\n    alert(\"下载失败，请稍后重试\");\r\n  }\r\n};\r\n\r\nconst viewOrderDetail = (order: Order) => {\r\n  // TODO: 实现查看订单详情\r\n  console.log(\"查看订单详情:\", order.id);\r\n};\r\n\r\n// 生命周期\r\nonMounted(() => {\r\n  loadOrders();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.orders-view {\r\n  max-width: 1000px;\r\n  margin: 0 auto;\r\n  padding: 2rem;\r\n}\r\n\r\n.orders-header {\r\n  text-align: center;\r\n  margin-bottom: 3rem;\r\n}\r\n\r\n.orders-header h1 {\r\n  font-size: 2.5rem;\r\n  font-weight: 700;\r\n  color: #323130;\r\n  margin: 0 0 0.5rem 0;\r\n}\r\n\r\n.orders-header p {\r\n  color: #605e5c;\r\n  font-size: 1.125rem;\r\n  margin: 0;\r\n}\r\n\r\n.orders-filters {\r\n  display: flex;\r\n  gap: 0.5rem;\r\n  margin-bottom: 2rem;\r\n  background: white;\r\n  border-radius: 8px;\r\n  padding: 0.5rem;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n  overflow-x: auto;\r\n}\r\n\r\n.filter-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  padding: 0.75rem 1rem;\r\n  background: none;\r\n  border: none;\r\n  border-radius: 6px;\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n  color: #605e5c;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n  white-space: nowrap;\r\n}\r\n\r\n.filter-btn:hover {\r\n  background: #f3f2f1;\r\n}\r\n\r\n.filter-btn.active {\r\n  background: #0078d4;\r\n  color: white;\r\n}\r\n\r\n.filter-count {\r\n  background: rgba(255, 255, 255, 0.2);\r\n  padding: 0.25rem 0.5rem;\r\n  border-radius: 10px;\r\n  font-size: 0.75rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.filter-btn.active .filter-count {\r\n  background: rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n.orders-content {\r\n  min-height: 400px;\r\n}\r\n\r\n.orders-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1.5rem;\r\n}\r\n\r\n.order-item {\r\n  background: white;\r\n  border-radius: 12px;\r\n  padding: 1.5rem;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.order-item:hover {\r\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.order-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  margin-bottom: 1.5rem;\r\n  padding-bottom: 1rem;\r\n  border-bottom: 1px solid #e1dfdd;\r\n}\r\n\r\n.order-number {\r\n  font-size: 1.125rem;\r\n  font-weight: 600;\r\n  color: #323130;\r\n  margin: 0 0 0.25rem 0;\r\n}\r\n\r\n.order-date {\r\n  color: #605e5c;\r\n  font-size: 0.875rem;\r\n  margin: 0;\r\n}\r\n\r\n.status-badge {\r\n  padding: 0.5rem 1rem;\r\n  border-radius: 20px;\r\n  font-size: 0.875rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.status-badge.pending {\r\n  background: #fff4e6;\r\n  color: #d97706;\r\n}\r\n\r\n.status-badge.paid {\r\n  background: #f0fdf4;\r\n  color: #16a34a;\r\n}\r\n\r\n.status-badge.cancelled {\r\n  background: #fef2f2;\r\n  color: #dc2626;\r\n}\r\n\r\n.status-badge.refunded {\r\n  background: #f3f4f6;\r\n  color: #6b7280;\r\n}\r\n\r\n.order-items {\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.order-item-detail {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 1rem;\r\n  padding: 1rem 0;\r\n  border-bottom: 1px solid #f3f2f1;\r\n}\r\n\r\n.order-item-detail:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.item-image {\r\n  width: 60px;\r\n  height: 60px;\r\n  border-radius: 8px;\r\n  overflow: hidden;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.item-image img {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n}\r\n\r\n.item-info {\r\n  flex: 1;\r\n}\r\n\r\n.item-name {\r\n  font-size: 1rem;\r\n  font-weight: 600;\r\n  color: #323130;\r\n  margin: 0 0 0.25rem 0;\r\n}\r\n\r\n.item-description {\r\n  color: #605e5c;\r\n  font-size: 0.875rem;\r\n  margin: 0 0 0.5rem 0;\r\n}\r\n\r\n.item-meta {\r\n  display: flex;\r\n  gap: 1rem;\r\n  font-size: 0.75rem;\r\n  color: #8a8886;\r\n}\r\n\r\n.item-total {\r\n  font-size: 1.125rem;\r\n  font-weight: 700;\r\n  color: #323130;\r\n}\r\n\r\n.order-footer {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding-top: 1rem;\r\n  border-top: 1px solid #e1dfdd;\r\n}\r\n\r\n.order-total {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.total-label {\r\n  color: #605e5c;\r\n  font-weight: 500;\r\n}\r\n\r\n.total-amount {\r\n  font-size: 1.25rem;\r\n  font-weight: 700;\r\n  color: #d13438;\r\n}\r\n\r\n.order-actions {\r\n  display: flex;\r\n  gap: 0.75rem;\r\n}\r\n\r\n.action-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  padding: 0.5rem 1rem;\r\n  border: none;\r\n  border-radius: 6px;\r\n  font-size: 0.875rem;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.action-btn.primary {\r\n  background: #0078d4;\r\n  color: white;\r\n}\r\n\r\n.action-btn.primary:hover {\r\n  background: #106ebe;\r\n}\r\n\r\n.action-btn.secondary {\r\n  background: transparent;\r\n  color: #0078d4;\r\n  border: 1px solid #0078d4;\r\n}\r\n\r\n.action-btn.secondary:hover {\r\n  background: rgba(0, 120, 212, 0.1);\r\n}\r\n\r\n.empty-state {\r\n  text-align: center;\r\n  padding: 4rem 2rem;\r\n  color: #605e5c;\r\n}\r\n\r\n.empty-icon {\r\n  font-size: 4rem;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.empty-state h3 {\r\n  font-size: 1.5rem;\r\n  font-weight: 600;\r\n  color: #323130;\r\n  margin: 0 0 0.75rem 0;\r\n}\r\n\r\n.empty-state p {\r\n  margin: 0 0 1.5rem 0;\r\n  line-height: 1.5;\r\n}\r\n\r\n.empty-action {\r\n  display: inline-block;\r\n  padding: 0.75rem 1.5rem;\r\n  background: #0078d4;\r\n  color: white;\r\n  text-decoration: none;\r\n  border-radius: 6px;\r\n  font-weight: 500;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.empty-action:hover {\r\n  background: #106ebe;\r\n}\r\n\r\n.loading-state {\r\n  text-align: center;\r\n  padding: 4rem 2rem;\r\n  color: #605e5c;\r\n}\r\n\r\n.loading-spinner {\r\n  width: 40px;\r\n  height: 40px;\r\n  border: 4px solid #f3f2f1;\r\n  border-top: 4px solid #0078d4;\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n  margin: 0 auto 1rem;\r\n}\r\n\r\n@keyframes spin {\r\n  0% {\r\n    transform: rotate(0deg);\r\n  }\r\n  100% {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n\r\n.icon {\r\n  width: 16px;\r\n  height: 16px;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .orders-view {\r\n    padding: 1rem;\r\n  }\r\n\r\n  .orders-filters {\r\n    flex-wrap: wrap;\r\n  }\r\n\r\n  .order-header {\r\n    flex-direction: column;\r\n    gap: 1rem;\r\n    align-items: flex-start;\r\n  }\r\n\r\n  .order-footer {\r\n    flex-direction: column;\r\n    gap: 1rem;\r\n    align-items: flex-start;\r\n  }\r\n\r\n  .order-actions {\r\n    width: 100%;\r\n    justify-content: flex-end;\r\n  }\r\n\r\n  .order-item-detail {\r\n    flex-direction: column;\r\n    text-align: center;\r\n  }\r\n\r\n  .item-info {\r\n    text-align: center;\r\n  }\r\n}\r\n</style>\r\n"],"file":"assets/OrdersView-C6X0nfFq.js"}