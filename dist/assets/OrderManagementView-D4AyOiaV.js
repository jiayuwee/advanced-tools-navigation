import{d as a,r as e,b as t,c as s,w as l,o as n,m as d,q as o,z as c,H as i,u as r,b0 as u,aU as p,aY as v,E as h,Q as g,ad as m,a$ as b,R as y,a0 as f,U as w,ae as k,a6 as R,aH as O,F as C,A as _,C as S,t as U,aQ as M,ba as D,X as x,B as V}from"./vendor-BUIb0xSO.js";import{OrderService as A}from"./orderService-CJLlcJ8V.js";import{_ as E}from"./index-CnM1eJMm.js";const L={class:"order-management-view"},$={class:"page-header"},j={class:"header-actions"},I={class:"stats-grid"},N={class:"stat-card"},z={class:"stat-icon"},B={class:"stat-content"},H={class:"stat-card"},J={class:"stat-icon completed"},Q={class:"stat-content"},q={class:"stat-card"},F={class:"stat-icon pending"},T={class:"stat-content"},Y={class:"stat-card"},G={class:"stat-icon revenue"},K={class:"stat-content"},P={class:"filters-section"},W={class:"search-box"},X={class:"filter-controls"},Z={class:"orders-table-container"},aa={key:0,class:"loading-state"},ea={key:1,class:"orders-table"},ta={class:"order-info"},sa={class:"order-details"},la={class:"user-info"},na={class:"user-details"},da={class:"amount"},oa={class:"price"},ca={class:"currency"},ia={class:"actions"},ra=["onClick"],ua=["onClick"],pa=["onClick"],va={class:"pagination"},ha=["disabled"],ga={class:"pagination-info"},ma=["disabled"],ba=E(a({__name:"OrderManagementView",setup(a){const E=e(!1),ba=e([]),ya=e(0),fa=e(1),wa=e(10),ka=t({search:"",status:"",paymentMethod:"",dateRange:{start:"",end:""}}),Ra=s(()=>({totalOrders:ba.value.length,completedOrders:ba.value.filter(a=>"paid"===a.status).length,pendingOrders:ba.value.filter(a=>"pending"===a.status).length,totalRevenue:ba.value.filter(a=>"paid"===a.status).reduce((a,e)=>a+e.total_amount,0)})),Oa=s(()=>Math.ceil(ya.value/wa.value)),Ca=s(()=>ba.value),_a=async()=>{try{E.value=!0;const a={search:ka.search||void 0,status:ka.status||void 0,paymentMethod:ka.paymentMethod||void 0,startDate:ka.dateRange.start||void 0,endDate:ka.dateRange.end||void 0,page:fa.value,limit:wa.value},e=await A.getAllOrders(a);ba.value=e.orders,ya.value=e.total}catch(a){console.error("加载订单数据失败:",a),alert("加载订单数据失败，请稍后重试")}finally{E.value=!1}},Sa=()=>{_a()},Ua=async()=>{try{const a={status:ka.status||void 0,startDate:ka.dateRange.start||void 0,endDate:ka.dateRange.end||void 0},e=await A.exportOrders(a),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),l=URL.createObjectURL(t);s.setAttribute("href",l),s.setAttribute("download",`orders_${(new Date).toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),console.log("订单数据导出成功")}catch(a){console.error("导出订单数据失败:",a),alert("导出订单数据失败，请稍后重试")}},Ma=a=>{switch(a){case"pending":return"待支付";case"paid":return"已支付";case"cancelled":return"已取消";case"refunded":return"已退款";default:return"未知"}},Da=a=>{switch(a){case"alipay":return"支付宝";case"wechat":return"微信支付";case"credit_card":return"信用卡";default:return"未知"}};return l(()=>[ka.search,ka.status,ka.paymentMethod,ka.dateRange.start,ka.dateRange.end],()=>{fa.value=1,_a()},{deep:!0}),l([fa,wa],()=>{_a()}),n(()=>{_a()}),(a,e)=>(V(),d("div",L,[o("div",$,[e[9]||(e[9]=o("div",null,[o("h1",null,"订单管理"),o("p",null,"管理系统订单，查看订单状态和支付信息")],-1)),o("div",j,[o("button",{class:"btn btn-secondary",onClick:Sa},[c(r(u),{class:"icon"}),e[7]||(e[7]=i(" 刷新 "))]),o("button",{class:"btn btn-primary",onClick:Ua},[c(r(p),{class:"icon"}),e[8]||(e[8]=i(" 导出订单 "))])])]),o("div",I,[o("div",N,[o("div",z,[c(r(v))]),o("div",B,[o("h3",null,h(Ra.value.totalOrders),1),e[10]||(e[10]=o("p",null,"总订单数",-1))])]),o("div",H,[o("div",J,[c(r(g))]),o("div",Q,[o("h3",null,h(Ra.value.completedOrders),1),e[11]||(e[11]=o("p",null,"已完成",-1))])]),o("div",q,[o("div",F,[c(r(m))]),o("div",T,[o("h3",null,h(Ra.value.pendingOrders),1),e[12]||(e[12]=o("p",null,"待处理",-1))])]),o("div",Y,[o("div",G,[c(r(b))]),o("div",K,[o("h3",null,"¥"+h(Ra.value.totalRevenue.toLocaleString()),1),e[13]||(e[13]=o("p",null,"总收入",-1))])])]),o("div",P,[o("div",W,[c(r(f),{class:"search-icon"}),y(o("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>ka.search=a),type:"text",placeholder:"搜索订单号、用户邮箱...",class:"search-input"},null,512),[[w,ka.search]])]),o("div",X,[y(o("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>ka.status=a),class:"filter-select"},e[14]||(e[14]=[R('<option value="" data-v-8e4b83d6>所有状态</option><option value="pending" data-v-8e4b83d6>待处理</option><option value="processing" data-v-8e4b83d6>处理中</option><option value="completed" data-v-8e4b83d6>已完成</option><option value="cancelled" data-v-8e4b83d6>已取消</option>',5)]),512),[[k,ka.status]]),y(o("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>ka.paymentMethod=a),class:"filter-select"},e[15]||(e[15]=[o("option",{value:""},"所有支付方式",-1),o("option",{value:"alipay"},"支付宝",-1),o("option",{value:"wechat"},"微信支付",-1),o("option",{value:"credit_card"},"信用卡",-1)]),512),[[k,ka.paymentMethod]]),y(o("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>ka.dateRange.start=a),type:"date",class:"filter-select",placeholder:"开始日期"},null,512),[[w,ka.dateRange.start]]),y(o("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>ka.dateRange.end=a),type:"date",class:"filter-select",placeholder:"结束日期"},null,512),[[w,ka.dateRange.end]])])]),o("div",Z,[E.value?(V(),d("div",aa,[c(r(O),{class:"loading-icon"}),e[16]||(e[16]=o("p",null,"加载订单数据中...",-1))])):(V(),d("table",ea,[e[17]||(e[17]=o("thead",null,[o("tr",null,[o("th",null,"订单信息"),o("th",null,"用户"),o("th",null,"金额"),o("th",null,"支付方式"),o("th",null,"状态"),o("th",null,"创建时间"),o("th",null,"操作")])],-1)),o("tbody",null,[(V(!0),d(C,null,_(Ca.value,a=>{var e,t,s,l;return V(),d("tr",{key:a.id,class:"order-row"},[o("td",ta,[o("div",sa,[o("h4",null,"#"+h(a.id.slice(0,8)),1),o("p",null,h((null==(e=a.items)?void 0:e.length)||0)+" 个商品",1)])]),o("td",la,[o("div",na,[o("h4",null,h((null==(t=a.user)?void 0:t.full_name)||"未知用户"),1),o("p",null,h((null==(s=a.user)?void 0:s.email)||"N/A"),1)])]),o("td",da,[o("span",oa,"¥"+h(a.total_amount.toLocaleString()),1),o("span",ca,h(a.currency),1)]),o("td",null,[o("span",{class:S(["payment-method",a.payment_method])},h(Da(a.payment_method)),3)]),o("td",null,[o("span",{class:S(["status-badge",a.status])},h(Ma(a.status)),3)]),o("td",null,h((l=a.created_at,new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))),1),o("td",ia,[o("button",{class:"action-btn view",onClick:e=>(a=>{console.log("查看订单:",a.id)})(a)},[c(r(M))],8,ra),"pending"===a.status?(V(),d("button",{key:0,class:"action-btn process",onClick:e=>(async a=>{try{const e=JSON.parse(localStorage.getItem("user")||"{}");if(!e.id)throw new Error("未找到管理员用户信息");await A.updateOrderStatus(a.id,"paid",e.id),await _a(),console.log(`订单 ${a.id} 已标记为已支付`)}catch(e){console.error("处理订单失败:",e),alert("处理订单失败，请稍后重试")}})(a)},[c(r(D))],8,ua)):U("",!0),"cancelled"!==a.status&&"paid"!==a.status?(V(),d("button",{key:1,class:"action-btn cancel",onClick:e=>(async a=>{try{const e=JSON.parse(localStorage.getItem("user")||"{}");if(!e.id)throw new Error("未找到管理员用户信息");if(!confirm(`确定要取消订单 ${a.id} 吗？`))return;await A.updateOrderStatus(a.id,"cancelled",e.id),await _a(),console.log(`订单 ${a.id} 已取消`)}catch(e){console.error("取消订单失败:",e),alert("取消订单失败，请稍后重试")}})(a)},[c(r(x))],8,pa)):U("",!0)])])}),128))])]))]),o("div",va,[o("button",{disabled:1===fa.value,class:"pagination-btn",onClick:e[5]||(e[5]=a=>fa.value--)}," 上一页 ",8,ha),o("span",ga," 第 "+h(fa.value)+" 页，共 "+h(Oa.value)+" 页 ",1),o("button",{disabled:fa.value===Oa.value,class:"pagination-btn",onClick:e[6]||(e[6]=a=>fa.value++)}," 下一页 ",8,ma)])]))}}),[["__scopeId","data-v-8e4b83d6"]]);export{ba as default};
