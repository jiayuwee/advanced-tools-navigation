import{b as a,s as l,m as e,_ as s,u as t,d as i,E as n,n as o,c as r}from"./index-DFN97R6u.js";import{d as c,r as u,c as v,o as d,m as p,q as g,D as h,F as y,z as m,y as f,u as k,B as _,Q as w,G as b,I as C,E as x,H as I,t as $,A as M}from"./vendor-dtMHlISa.js";import{A as q}from"./arrow-left-BBRh5Bo0.js";import{T,a as j}from"./thumbs-up-D2jOccFM.js";const A={class:"tool-rating"},D={class:"rating-header"},z={class:"rating-summary"},E={class:"average-rating"},H={class:"rating-score"},L={class:"stars"},V={class:"rating-count"},F={class:"rating-distribution"},U={class:"rating-label"},W={class:"bar-container"},B={class:"rating-count"},G={key:0,class:"user-rating-section"},K={class:"rating-input"},N={class:"stars-input"},P={class:"rating-text"},Q={class:"rating-actions"},R={class:"anonymous-checkbox"},S=["disabled"],J={key:1,class:"login-prompt"},O={class:"reviews-section"},X={key:0,class:"no-reviews"},Y={key:1,class:"reviews-list"},Z={class:"review-header"},aa={class:"reviewer-info"},la={class:"reviewer-name"},ea={class:"review-rating"},sa={class:"review-date"},ta={key:0,class:"review-content"},ia=s(c({__name:"ToolRating",props:{toolId:{}},setup(s){const t=s,i=a(),n=u([]),o=u([]),r=u(null),c=u(0),q=u(0),T=u(""),j=u(!1),ia=u(!1),na=v(()=>{if(0===n.value.length)return 0;return n.value.reduce((a,l)=>a+l.rating,0)/n.value.length}),oa=v(()=>n.value.length),ra=v(()=>{const a={5:0,4:0,3:0,2:0,1:0};return n.value.forEach(l=>{a[l.rating]++}),a});d(async()=>{await loadRatings(),await loadUserRating()});const loadRatings=async()=>{try{const{data:a,error:e}=await l.from("tool_ratings").select("\n        *,\n        user_profiles (username)\n      ").eq("tool_id",t.toolId).order("created_at",{ascending:!1});if(e)throw e;n.value=a||[],o.value=(null==a?void 0:a.filter(a=>a.review))||[]}catch(a){console.error("加载评分失败:",a)}},loadUserRating=async()=>{if(i.user)try{const{data:a,error:e}=await l.from("tool_ratings").select("*").eq("tool_id",t.toolId).eq("user_id",i.user.id).single();a&&(r.value=a,c.value=a.rating,T.value=a.review||"",j.value=a.is_anonymous)}catch(a){}},getBarWidth=a=>0===oa.value?0:a/oa.value*100,submitRating=async()=>{if(c.value&&i.user)try{ia.value=!0;const a={tool_id:t.toolId,user_id:i.user.id,rating:c.value,review:T.value.trim()||null,is_anonymous:j.value};if(r.value){const{error:e}=await l.from("tool_ratings").update(a).eq("id",r.value.id);if(e)throw e}else{const{error:e}=await l.from("tool_ratings").insert(a);if(e)throw e}await loadRatings(),await loadUserRating()}catch(a){console.error("提交评分失败:",a),alert("提交失败，请重试")}finally{ia.value=!1}};return(a,l)=>{return M(),p("div",A,[g("div",D,[l[4]||(l[4]=g("h3",null,"用户评价",-1)),g("div",z,[g("div",E,[g("span",H,h(na.value.toFixed(1)),1),g("div",L,[(M(),p(y,null,m(5,a=>f(k(e),{key:a,class:_([{filled:a<=Math.round(na.value)},"star"])},null,8,["class"])),64))]),g("span",V,"("+h(oa.value)+" 评价)",1)])])]),g("div",F,[(M(!0),p(y,null,m(ra.value,(a,l)=>(M(),p("div",{key:l,class:"rating-bar"},[g("span",U,h(l)+"星",1),g("div",W,[g("div",{class:"bar",style:w({width:getBarWidth(a)+"%"})},null,4)]),g("span",B,h(a),1)]))),128))]),k(i).isAuthenticated?(M(),p("div",G,[g("h4",null,h(r.value?"修改评价":"添加评价"),1),g("div",K,[g("div",N,[(M(),p(y,null,m(5,a=>f(k(e),{key:a,class:_([{filled:a<=c.value,hover:a<=q.value},"star clickable"]),onClick:l=>{return e=a,void(c.value=e);var e},onMouseenter:l=>q.value=a,onMouseleave:l[0]||(l[0]=a=>q.value=0)},null,8,["class","onClick","onMouseenter"])),64))]),g("span",P,h((s=c.value,["","很差","一般","不错","很好","极佳"][s]||"")),1)]),b(g("textarea",{"onUpdate:modelValue":l[1]||(l[1]=a=>T.value=a),placeholder:"分享您的使用体验（可选）",class:"review-input",rows:"3"},null,512),[[C,T.value]]),g("div",Q,[g("label",R,[b(g("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>j.value=a),type:"checkbox"},null,512),[[I,j.value]]),l[5]||(l[5]=x(" 匿名评价 "))]),g("button",{disabled:!c.value||ia.value,class:"submit-button",onClick:submitRating},h(ia.value?"提交中...":r.value?"更新评价":"提交评价"),9,S)])])):(M(),p("div",J,[l[6]||(l[6]=g("p",null,"登录后可以评价工具",-1)),g("button",{class:"login-button",onClick:l[3]||(l[3]=l=>a.$router.push("/auth/login"))}," 立即登录 ")])),g("div",O,[g("h4",null,"用户评价 ("+h(o.value.length)+")",1),0===o.value.length?(M(),p("div",X," 暂无评价，成为第一个评价者吧！ ")):(M(),p("div",Y,[(M(!0),p(y,null,m(o.value,a=>{var l,s;return M(),p("div",{key:a.id,class:"review-item"},[g("div",Z,[g("div",aa,[g("span",la,h(a.is_anonymous?"匿名用户":(null==(l=a.user_profiles)?void 0:l.username)||"用户"),1),g("div",ea,[(M(),p(y,null,m(5,l=>f(k(e),{key:l,class:_([{filled:l<=a.rating},"star small"])},null,8,["class"])),64))])]),g("span",sa,h((s=a.created_at,new Date(s).toLocaleDateString("zh-CN"))),1)]),a.review?(M(),p("p",ta,h(a.review),1)):$("",!0)])}),128))]))])]);var s}}}),[["__scopeId","data-v-7675fed0"]]),na={class:"tool-detail-view"},oa={class:"container"},ra={key:0,class:"tool-detail-card"},ca={class:"tool-header"},ua={class:"tool-icon"},va={class:"tool-info"},da={class:"tool-name"},pa={class:"tool-description"},ga={class:"tool-meta"},ha={class:"category"},ya={class:"clicks"},ma={class:"tool-actions"},fa={key:0,class:"features-section"},ka={class:"features-grid"},_a={key:1,class:"tutorial-section"},wa=["innerHTML"],ba={key:2,class:"video-section"},Ca={class:"video-container"},xa=["src"],Ia={key:3,class:"pros-cons-section"},$a={class:"pros-cons-grid"},Ma={class:"pros"},qa={class:"cons"},Ta={key:4,class:"pricing-section"},ja={class:"pricing-content"},Aa={class:"related-tools-section"},Da={class:"related-tools-grid"},za=["onClick"],Ea={class:"tool-icon"},Ha={class:"tool-name"},La={key:1,class:"loading-state"},Va={key:2,class:"error-state"},Fa=s(c({__name:"ToolDetailView",setup(l){const s=i(),c=r(),w=t(),b=a(),C=u(null),I=u(!0),A=u([]),D=v(()=>!1);d(async()=>{await loadToolDetail()});const loadToolDetail=async()=>{try{I.value=!0;const a=s.params.id;await w.initialize(),C.value=w.tools.find(l=>l.id===a),C.value&&(A.value=w.tools.filter(a=>a.category_id===C.value.category_id&&a.id!==C.value.id).slice(0,4))}catch(a){console.error("加载工具详情失败:",a)}finally{I.value=!1}},goBack=()=>{c.back()},openTool=async()=>{var a;if(null==(a=C.value)?void 0:a.url)try{let a=C.value.url.trim();a.startsWith("http://")||a.startsWith("https://")||(a="https://"+a),await w.incrementClickCount(C.value.id),window.open(a,"_blank","noopener,noreferrer")}catch(l){console.error("打开链接失败:",l),alert("无法打开该链接")}else alert("该工具暂无可用链接")},toggleFavorite=()=>{b.isAuthenticated||c.push("/auth/login")};return(a,l)=>{var s,t;return M(),p("div",na,[g("div",oa,[g("button",{class:"back-button",onClick:goBack},[f(k(q),{class:"icon"}),l[0]||(l[0]=x(" 返回工具列表 "))]),C.value?(M(),p("div",ra,[g("div",ca,[g("div",ua,h(C.value.icon||"🔧"),1),g("div",va,[g("h1",da,h(C.value.name),1),g("p",pa,h(C.value.description),1),g("div",ga,[g("span",ha,h(null==(s=C.value.categories)?void 0:s.name),1),g("span",ya,h(C.value.click_count)+" 次使用",1)])]),g("div",ma,[g("button",{class:"primary-button",onClick:openTool},[f(k(n),{class:"icon"}),l[1]||(l[1]=x(" 访问工具 "))]),g("button",{class:_(["favorite-button",{favorited:D.value}]),onClick:toggleFavorite},[f(k(e),{class:"icon"}),x(" "+h(D.value?"已收藏":"收藏"),1)],2)])]),C.value.features?(M(),p("div",fa,[l[2]||(l[2]=g("h2",null,"主要功能",-1)),g("div",ka,[(M(!0),p(y,null,m(C.value.features,a=>(M(),p("div",{key:a,class:"feature-item"},[f(k(o),{class:"icon"}),x(" "+h(a),1)]))),128))])])):$("",!0),C.value.tutorial_content?(M(),p("div",_a,[l[3]||(l[3]=g("h2",null,"使用教程",-1)),g("div",{class:"tutorial-content",innerHTML:(t=C.value.tutorial_content,t.replace(/### (.*)/g,"<h3>$1</h3>").replace(/## (.*)/g,"<h2>$1</h2>").replace(/# (.*)/g,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"))},null,8,wa)])):$("",!0),C.value.tutorial_video_url?(M(),p("div",ba,[l[4]||(l[4]=g("h2",null,"视频教程",-1)),g("div",Ca,[g("iframe",{src:C.value.tutorial_video_url,frameborder:"0",allowfullscreen:""},null,8,xa)])])):$("",!0),C.value.pros_cons?(M(),p("div",Ia,[l[7]||(l[7]=g("h2",null,"优缺点分析",-1)),g("div",$a,[g("div",Ma,[g("h3",null,[f(k(T),{class:"icon"}),l[5]||(l[5]=x(" 优点"))]),g("ul",null,[(M(!0),p(y,null,m(C.value.pros_cons.pros,a=>(M(),p("li",{key:a},h(a),1))),128))])]),g("div",qa,[g("h3",null,[f(k(j),{class:"icon"}),l[6]||(l[6]=x(" 缺点"))]),g("ul",null,[(M(!0),p(y,null,m(C.value.pros_cons.cons,a=>(M(),p("li",{key:a},h(a),1))),128))])])])])):$("",!0),C.value.pricing_info?(M(),p("div",Ta,[l[8]||(l[8]=g("h2",null,"价格信息",-1)),g("div",ja,h(C.value.pricing_info),1)])):$("",!0),f(ia,{"tool-id":C.value.id},null,8,["tool-id"]),g("div",Aa,[l[9]||(l[9]=g("h2",null,"相关工具推荐",-1)),g("div",Da,[(M(!0),p(y,null,m(A.value,a=>(M(),p("div",{key:a.id,class:"related-tool-card",onClick:l=>{return e=a.id,void c.push(`/tools/${e}`);var e}},[g("div",Ea,h(a.icon||"🔧"),1),g("div",Ha,h(a.name),1)],8,za))),128))])])])):I.value?(M(),p("div",La,l[10]||(l[10]=[g("div",{class:"spinner"},null,-1),g("p",null,"正在加载工具详情...",-1)]))):(M(),p("div",Va,[l[11]||(l[11]=g("p",null,"工具不存在或加载失败",-1)),g("button",{class:"secondary-button",onClick:goBack},"返回")]))])])}}}),[["__scopeId","data-v-b8aed6dd"]]);export{Fa as default};
