import{r as e,c as a,d as s,w as l,m as t,C as c,q as r,z as o,u as i,X as n,t as u,R as v,ae as d,F as p,A as g,E as h,U as m,a1 as y,H as f,a4 as k,T as b,v as C,aK as w,aL as _,ad as U,as as O,aM as S,a0 as x,B as F,o as L,aN as E,ar as B,aO as V,aP as T,y as q,aQ as A,au as H,J as R,I}from"./vendor-BUIb0xSO.js";import{u as Q,_ as j,c as z,d as D}from"./index-qrCbrMbX.js";function $(){const s=Q(),l=e(""),t=e({category:"",tags:[],rating:0,isFeatured:!1,hasUrl:!1,sortBy:"name",sortOrder:"asc"}),c=e([]),r=e(!1),o=a(()=>{if(!s.tools.length)return[];r.value=!0;try{let e=((e,a)=>{if(!e.trim())return a.map(e=>({item:e,score:1,matches:[]}));const s=e.toLowerCase().split(/\s+/).filter(e=>e.length>0),l=[];return a.forEach(e=>{let a=0;const t=[],c=[{field:"name",weight:10},{field:"description",weight:5},{field:"tags",weight:3},{field:"categories.name",weight:2}];s.forEach(s=>{var l;c.forEach(({field:l,weight:c})=>{const r=u(e,l);r&&v(r,s)&&(a+=c,t.includes(l)||t.push(l))}),d((null==(l=e.name)?void 0:l.toLowerCase())||"",s)&&(a+=2)}),e.is_featured&&(a+=1),e.average_rating&&e.average_rating>4&&(a+=1),a>0&&l.push({item:e,score:a,matches:t})}),l.sort((e,a)=>a.score-e.score)})(l.value,s.tools);return e=(e=>e.filter(({item:e})=>{if(t.value.category&&e.category_id!==t.value.category)return!1;if(t.value.tags.length>0){const a=e.tags||[];if(!t.value.tags.some(e=>a.some(a=>a.toLowerCase().includes(e.toLowerCase()))))return!1}return!(t.value.rating>0&&(e.average_rating||0)<t.value.rating)&&!(t.value.isFeatured&&!e.is_featured||!(!t.value.hasUrl||e.url&&e.url.trim()))}))(e),e=(e=>e.sort((e,a)=>{const{sortBy:s,sortOrder:l}=t.value;let c=0;switch(s){case"name":c=(e.item.name||"").localeCompare(a.item.name||"");break;case"rating":c=(e.item.average_rating||0)-(a.item.average_rating||0);break;case"clicks":c=(e.item.click_count||0)-(a.item.click_count||0);break;case"created_at":c=new Date(e.item.created_at||0).getTime()-new Date(a.item.created_at||0).getTime();break;default:c=a.score-e.score}return"desc"===l?-c:c}))(e),e}finally{r.value=!1}}),i=a(()=>{if(!l.value.trim())return[];const e=l.value.toLowerCase(),a=new Set;return s.tools.forEach(s=>{var l;(null==(l=s.name)?void 0:l.toLowerCase().includes(e))&&a.add(s.name),s.tags&&s.tags.forEach(s=>{s.toLowerCase().includes(e)&&a.add(s)})}),Array.from(a).slice(0,5)}),n=a(()=>{const e=c.value.reduce((e,a)=>(e[a]=(e[a]||0)+1,e),{});return Object.entries(e).sort(([,e],[,a])=>a-e).slice(0,10).map(([e])=>e)}),u=(e,a)=>a.split(".").reduce((e,a)=>null==e?void 0:e[a],e),v=(e,a)=>Array.isArray(e)?e.some(e=>"string"==typeof e&&e.toLowerCase().includes(a)):"string"==typeof e&&e.toLowerCase().includes(a),d=(e,a)=>{const s=a.length,l=e.length;if(s>l)return!1;if(s===l)return a===e;let t=0;for(let c=0;c<l&&t<s;c++)e[c]===a[t]&&t++;return t===s};return{searchQuery:l,filters:t,searchResults:o,searchSuggestions:i,popularSearches:n,searchHistory:c,isSearching:r,search:e=>{l.value=e,e.trim()&&!c.value.includes(e)&&(c.value.unshift(e),c.value.length>50&&(c.value=c.value.slice(0,50)))},clearSearch:()=>{l.value=""},resetFilters:()=>{t.value={category:"",tags:[],rating:0,isFeatured:!1,hasUrl:!1,sortBy:"name",sortOrder:"asc"}}}}const K={class:"panel-header"},M={class:"panel-content"},P={class:"filter-group"},W=["value"],J={class:"filter-group"},N={class:"tags-container"},G={class:"popular-tags"},X=["onClick"],Y={key:0,class:"selected-tags"},Z=["onClick"],ee={class:"filter-group"},ae={class:"rating-filter"},se={class:"rating-stars"},le={class:"rating-text"},te={class:"filter-group"},ce={class:"checkbox-group"},re={class:"checkbox-item"},oe={class:"checkbox-item"},ie={class:"filter-group"},ne={class:"sort-options"},ue=["title"],ve={key:0,class:"filter-group"},de={class:"search-history"},pe=["onClick"],ge={key:1,class:"filter-group"},he={class:"popular-searches"},me=["onClick"],ye={class:"panel-footer"},fe=j(s({__name:"AdvancedSearchPanel",props:{isOpen:{type:Boolean},filters:{},searchHistory:{},popularSearches:{}},emits:["close","update:filters","search"],setup(s,{emit:L}){const E=s,B=L,V=Q(),T=e(""),q=e({...E.filters});l(()=>E.filters,e=>{q.value={...e}},{deep:!0});const A=a(()=>V.categories),H=a(()=>{const e=new Map;return V.tools.forEach(a=>{a.tags&&a.tags.forEach(a=>{e.set(a,(e.get(a)||0)+1)})}),Array.from(e.entries()).sort(([,e],[,a])=>a-e).slice(0,10).map(([e])=>e)}),R=()=>{const e=T.value.trim();e&&!q.value.tags.includes(e)&&(q.value.tags.push(e),T.value="")},I=e=>{q.value.rating=e},j=()=>{q.value.sortOrder="asc"===q.value.sortOrder?"desc":"asc"},z=()=>{q.value={category:"",tags:[],rating:0,isFeatured:!1,hasUrl:!1,sortBy:"name",sortOrder:"asc"},D()},D=()=>{B("update:filters",{...q.value})};return l(q,()=>{D()},{deep:!0}),(e,a)=>{return F(),t("div",{class:c(["advanced-search-panel",{"is-open":e.isOpen}])},[r("div",K,[a[7]||(a[7]=r("h3",null,"高级搜索",-1)),r("button",{class:"close-button",onClick:a[0]||(a[0]=a=>e.$emit("close"))},[o(i(n),{class:"icon"})])]),r("div",M,[r("div",P,[a[9]||(a[9]=r("label",{class:"filter-label"},"分类",-1)),v(r("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.category=e),class:"filter-select"},[a[8]||(a[8]=r("option",{value:""},"所有分类",-1)),(F(!0),t(p,null,g(A.value,e=>(F(),t("option",{key:e.id,value:e.id},h(e.name),9,W))),128))],512),[[d,q.value.category]])]),r("div",J,[a[12]||(a[12]=r("label",{class:"filter-label"},"标签",-1)),r("div",N,[r("div",G,[a[10]||(a[10]=r("span",{class:"tags-subtitle"},"热门标签:",-1)),(F(!0),t(p,null,g(H.value,e=>(F(),t("button",{key:e,class:c(["tag-button",{active:q.value.tags.includes(e)}]),onClick:a=>(e=>{const a=q.value.tags.indexOf(e);a>-1?q.value.tags.splice(a,1):q.value.tags.push(e)})(e)},h(e),11,X))),128))]),v(r("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>T.value=e),placeholder:"输入自定义标签...",class:"tag-input",onKeydown:y(R,["enter"])},null,544),[[m,T.value]]),q.value.tags.length>0?(F(),t("div",Y,[a[11]||(a[11]=r("span",{class:"tags-subtitle"},"已选标签:",-1)),(F(!0),t(p,null,g(q.value.tags,e=>(F(),t("span",{key:e,class:"selected-tag"},[f(h(e)+" ",1),r("button",{class:"tag-remove",onClick:a=>(e=>{const a=q.value.tags.indexOf(e);a>-1&&q.value.tags.splice(a,1)})(e)},"×",8,Z)]))),128))])):u("",!0)])]),r("div",ee,[a[13]||(a[13]=r("label",{class:"filter-label"},"最低评分",-1)),r("div",ae,[r("div",se,[(F(),t(p,null,g(5,e=>o(i(k),{key:e,class:c([{filled:e<=q.value.rating},"star"]),onClick:a=>I(e)},null,8,["class","onClick"])),64))]),r("span",le,h((s=q.value.rating,["不限","1星以上","2星以上","3星以上","4星以上","5星"][s]||"不限")),1),q.value.rating>0?(F(),t("button",{key:0,class:"clear-rating",onClick:a[3]||(a[3]=e=>I(0))}," 清除 ")):u("",!0)])]),r("div",te,[a[16]||(a[16]=r("label",{class:"filter-label"},"特殊筛选",-1)),r("div",ce,[r("label",re,[v(r("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>q.value.isFeatured=e),type:"checkbox"},null,512),[[b,q.value.isFeatured]]),a[14]||(a[14]=r("span",{class:"checkbox-label"},"仅显示特色工具",-1))]),r("label",oe,[v(r("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>q.value.hasUrl=e),type:"checkbox"},null,512),[[b,q.value.hasUrl]]),a[15]||(a[15]=r("span",{class:"checkbox-label"},"仅显示可访问工具",-1))])])]),r("div",ie,[a[18]||(a[18]=r("label",{class:"filter-label"},"排序方式",-1)),r("div",ne,[v(r("select",{"onUpdate:modelValue":a[6]||(a[6]=e=>q.value.sortBy=e),class:"sort-select"},a[17]||(a[17]=[r("option",{value:"name"},"名称",-1),r("option",{value:"rating"},"评分",-1),r("option",{value:"clicks"},"使用次数",-1),r("option",{value:"created_at"},"创建时间",-1)]),512),[[d,q.value.sortBy]]),r("button",{class:"sort-order-button",title:"asc"===q.value.sortOrder?"升序":"降序",onClick:j},["asc"===q.value.sortOrder?(F(),C(i(w),{key:0,class:"icon"})):(F(),C(i(_),{key:1,class:"icon"}))],8,ue)])]),e.searchHistory.length>0?(F(),t("div",ve,[a[19]||(a[19]=r("label",{class:"filter-label"},"搜索历史",-1)),r("div",de,[(F(!0),t(p,null,g(e.searchHistory.slice(0,5),(a,s)=>(F(),t("button",{key:s,class:"history-item",onClick:s=>e.$emit("search",a)},[o(i(U),{class:"icon"}),f(" "+h(a),1)],8,pe))),128))])])):u("",!0),e.popularSearches.length>0?(F(),t("div",ge,[a[20]||(a[20]=r("label",{class:"filter-label"},"热门搜索",-1)),r("div",he,[(F(!0),t(p,null,g(e.popularSearches.slice(0,5),a=>(F(),t("button",{key:a,class:"popular-item",onClick:s=>e.$emit("search",a)},[o(i(O),{class:"icon"}),f(" "+h(a),1)],8,me))),128))])])):u("",!0)]),r("div",ye,[r("button",{class:"reset-button",onClick:z},[o(i(S),{class:"icon"}),a[21]||(a[21]=f(" 重置筛选 "))]),r("button",{class:"apply-button",onClick:D},[o(i(x),{class:"icon"}),a[22]||(a[22]=f(" 应用筛选 "))])])],2);var s}}}),[["__scopeId","data-v-76f9a203"]]),ke={class:"tools-view"},be={class:"filters-bar"},Ce={class:"filters-content"},we={class:"filter-group search-group"},_e={class:"search-container"},Ue={class:"filter-group"},Oe={class:"filter-group"},Se={class:"filter-group"},xe={class:"view-options"},Fe={class:"results-info"},Le={class:"results-count"},Ee={class:"tools-content"},Be={key:0,class:"loading-state"},Ve={key:1,class:"error-state"},Te={key:2,class:"tools-grid"},qe={class:"card-header"},Ae={class:"tool-icon"},He=["onClick"],Re={class:"card-content"},Ie={class:"tool-name"},Qe={class:"tool-description"},je={class:"tool-tags"},ze={key:0,class:"tag more"},De={class:"card-footer"},$e={class:"tool-stats"},Ke={class:"stat"},Me={class:"stat"},Pe={class:"tool-actions"},We=["onClick"],Je=["onClick"],Ne={key:3,class:"tools-list"},Ge=["onClick"],Xe={class:"item-left"},Ye={class:"tool-icon"},Ze={class:"tool-info"},ea={class:"tool-name"},aa={class:"tool-description"},sa={class:"tool-meta"},la={class:"category"},ta={class:"clicks"},ca={class:"item-right"},ra={class:"tool-tags"},oa={class:"tool-actions"},ia=["onClick"],na={key:4,class:"empty-state"},ua={key:0},va={key:1},da={key:2},pa={class:"empty-actions"},ga=j(s({__name:"ToolsView",setup(s){const y=D(),b=z(),C=Q(),{searchQuery:w,filters:_,searchResults:U,popularSearches:O,searchHistory:S,search:j,clearSearch:K}=$(),M=e(),P=e("all"),W=e("name"),J=e(!1),N=e(!1),G=e("grid"),X=a(()=>{if(w.value.trim())return U.value.map(e=>e.item);let e=C.filteredTools;return N.value&&(e=e.filter(e=>e.is_favorite)),e=[...e].sort((e,a)=>{switch(W.value){case"click_count":return a.click_count-e.click_count;case"created_at":return new Date(a.created_at).getTime()-new Date(e.created_at).getTime();default:return e.name.localeCompare(a.name)}}),e}),Y=()=>{C.setSearchQuery(w.value)},Z=e=>{Object.assign(_,e)},ee=e=>{j(e),J.value=!1},ae=async e=>{if(console.log("点击工具:",e.name,"URL:",e.url),!e.url||""===e.url.trim())return console.warn("工具URL为空:",e),void alert("该工具暂无可用链接");try{let a=e.url.trim();a.startsWith("http://")||a.startsWith("https://")||(a="https://"+a),await C.incrementClickCount(e.id),window.open(a,"_blank","noopener,noreferrer")}catch(a){console.error("打开链接失败:",a),alert("无法打开该链接，请检查URL是否正确")}},se=async()=>{C.clearError(),await C.initialize()};return l(()=>y.query,e=>{e.category&&"string"==typeof e.category&&(P.value=e.category),e.search&&"string"==typeof e.search&&(w.value=e.search,C.setSearchQuery(e.search))},{immediate:!0}),l(P,e=>{C.setSelectedCategory(e);const a={...y.query};"all"===e?delete a.category:a.category=e,b.replace({query:a})}),l(w,e=>{const a={...y.query};e?a.search=e:delete a.search,b.replace({query:a})}),L(async()=>{C.initialized||await C.initialize()}),(e,a)=>(F(),t("div",ke,[r("div",be,[r("div",Ce,[r("div",we,[r("div",_e,[o(i(x),{class:"search-icon"}),v(r("input",{ref_key:"searchInput",ref:M,"onUpdate:modelValue":a[0]||(a[0]=e=>E(w)?w.value=e:null),type:"text",placeholder:"搜索工具...",class:"search-input",onInput:Y,onFocus:a[1]||(a[1]=e=>J.value=!1)},null,544),[[m,i(w)]]),i(w)?(F(),t("button",{key:0,class:"clear-search",onClick:a[2]||(a[2]=(...e)=>i(K)&&i(K)(...e))},[o(i(n),{class:"icon"})])):u("",!0),r("button",{class:c(["advanced-search-button",{active:J.value}]),title:"高级搜索",onClick:a[3]||(a[3]=e=>J.value=!J.value)},[o(i(B),{class:"icon"})],2),o(fe,{"is-open":J.value,filters:i(_),"search-history":i(S),"popular-searches":i(O),onClose:a[4]||(a[4]=e=>J.value=!1),"onUpdate:filters":Z,onSearch:ee},null,8,["is-open","filters","search-history","popular-searches"])])]),r("div",Ue,[a[12]||(a[12]=r("label",{class:"filter-label"},"排序：",-1)),v(r("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>W.value=e),class:"filter-select"},a[11]||(a[11]=[r("option",{value:"name"},"名称",-1),r("option",{value:"click_count"},"热度",-1),r("option",{value:"created_at"},"最新",-1)]),512),[[d,W.value]])]),r("div",Oe,[r("button",{class:c(["filter-button",{active:N.value}]),onClick:a[6]||(a[6]=e=>N.value=!N.value)},[o(i(k),{class:"icon"}),a[13]||(a[13]=f(" 只看收藏 "))],2)]),r("div",Se,[r("div",xe,[r("button",{class:c(["view-button",{active:"grid"===G.value}]),onClick:a[7]||(a[7]=e=>G.value="grid")},[o(i(V),{class:"icon"})],2),r("button",{class:c(["view-button",{active:"list"===G.value}]),onClick:a[8]||(a[8]=e=>G.value="list")},[o(i(T),{class:"icon"})],2)])]),r("div",Fe,[r("span",Le," 找到 "+h(X.value.length)+" 个工具 ",1)])])]),r("div",Ee,[i(C).loading?(F(),t("div",Be,a[14]||(a[14]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"正在加载工具...",-1)]))):i(C).error?(F(),t("div",Ve,[a[15]||(a[15]=r("div",{class:"error-icon"},"❌",-1)),a[16]||(a[16]=r("h3",null,"加载失败",-1)),r("p",null,h(i(C).error),1),r("button",{class:"retry-button",onClick:se},"重试")])):X.value.length>0&&"grid"===G.value?(F(),t("div",Te,[(F(!0),t(p,null,g(X.value,e=>{var a;return F(),t("div",{key:e.id,class:"tool-card"},[r("div",qe,[r("div",Ae,h(e.icon||"🔧"),1),r("button",{class:c(["favorite-button",{active:e.isFavorite}]),onClick:q(a=>i(C).toggleFavorite(e.id),["stop"])},[o(i(k),{class:"icon"})],10,He)]),r("div",Re,[r("h3",Ie,h(e.name),1),r("p",Qe,h(e.description),1),r("div",je,[(F(!0),t(p,null,g((e.tags||[]).slice(0,3),e=>(F(),t("span",{key:e,class:"tag"},h(e),1))),128)),(e.tags||[]).length>3?(F(),t("span",ze," +"+h((e.tags||[]).length-3),1)):u("",!0)])]),r("div",De,[r("div",$e,[r("span",Ke,[o(i(A),{class:"stat-icon"}),f(" "+h(e.click_count||0),1)]),r("span",Me,[o(i(H),{class:"stat-icon"}),f(" "+h((null==(a=e.categories)?void 0:a.name)||"未分类"),1)])]),r("div",Pe,[r("button",{class:"detail-button",title:"查看详情",onClick:q(a=>{return s=e.id,void b.push(`/tools/${s}`);var s},["stop"])},[o(i(R),{class:"icon"})],8,We),r("button",{class:"visit-button",title:"访问工具",onClick:q(a=>ae(e),["stop"])},[o(i(I),{class:"icon"})],8,Je)])])])}),128))])):X.value.length>0&&"list"===G.value?(F(),t("div",Ne,[(F(!0),t(p,null,g(X.value,e=>(F(),t("div",{key:e.id,class:"tool-item",onClick:a=>ae(e)},[r("div",Xe,[r("div",Ye,h(e.icon||"🔧"),1),r("div",Ze,[r("h3",ea,h(e.name),1),r("p",aa,h(e.description),1),r("div",sa,[r("span",la,h(e.category.name),1),a[17]||(a[17]=r("span",{class:"separator"},"•",-1)),r("span",ta,h(e.clickCount)+" 次访问",1)])])]),r("div",ca,[r("div",ra,[(F(!0),t(p,null,g((e.tags||[]).slice(0,2),e=>(F(),t("span",{key:e,class:"tag"},h(e),1))),128))]),r("div",oa,[r("button",{class:c(["favorite-button",{active:e.isFavorite}]),onClick:q(a=>i(C).toggleFavorite(e.id),["stop"])},[o(i(k),{class:"icon"})],10,ia),o(i(I),{class:"external-icon"})])])],8,Ge))),128))])):(F(),t("div",na,[a[18]||(a[18]=r("div",{class:"empty-icon"},"🔍",-1)),a[19]||(a[19]=r("h3",null,"未找到相关工具",-1)),i(w)?(F(),t("p",ua,' 没有找到包含 "'+h(i(w))+'" 的工具，尝试使用其他关键词搜索 ',1)):"all"!==P.value?(F(),t("p",va," 该分类下暂无工具，请选择其他分类 ")):(F(),t("p",da,"暂无工具数据，请稍后再试")),r("div",pa,[i(w)?(F(),t("button",{key:0,class:"btn btn-primary",onClick:a[9]||(a[9]=(...e)=>i(K)&&i(K)(...e))}," 清除搜索条件 ")):u("",!0),"all"!==P.value?(F(),t("button",{key:1,class:"btn btn-secondary",onClick:a[10]||(a[10]=e=>P.value="all")}," 查看全部分类 ")):u("",!0)])]))])]))}}),[["__scopeId","data-v-c3e7fcee"]]);export{ga as default};
