const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./orderService-XOeuFSLT.js","./index-BbQlNKpj.js","./vendor-dtMHlISa.js","./index-C3KXLEkF.css"])))=>i.map(i=>d[i]);
import{n as e,d as a,o as l,c as s,_ as t}from"./index-BbQlNKpj.js";import{d as i,r,c as n,o,m as d,q as c,t as u,F as m,z as p,D as v,B as y,G as _,J as h,y as f,u as w,I as g,P as S,A as q}from"./vendor-dtMHlISa.js";const b={class:"payment-view"},P={class:"payment-container"},E={class:"payment-content"},V={class:"order-summary"},O={class:"order-items"},A={class:"item-image"},k=["src","alt"],j={class:"item-info"},D={class:"item-name"},U={class:"item-description"},x={class:"item-meta"},I={class:"item-quantity"},R={class:"item-price"},C={class:"order-total"},L={class:"total-row"},T={class:"total-row"},N={class:"discount"},$={class:"total-row final"},J={class:"final-amount"},M={class:"payment-methods"},Y={class:"methods-list"},z=["value"],B={class:"method-content"},F={class:"method-icon"},G=["src","alt"],H={class:"method-info"},K={class:"method-name"},Q={class:"method-description"},W={class:"method-check"},X={class:"billing-address"},Z={class:"address-form"},ee={class:"form-row"},ae={class:"form-group"},le={class:"form-group"},se={class:"form-row"},te={class:"form-group"},ie={class:"form-group"},re={class:"form-group"},ne={class:"payment-actions"},oe=["disabled"],de={key:0,class:"loading-spinner"},ce={key:0,class:"error-message"},ue=t(i({__name:"PaymentView",setup(t){const i=s(),ue=a(),me=r(!1),pe=r(null),ve=r(""),ye=r([{id:"1",name:"高效办公套件",description:"提升办公效率的完整解决方案",quantity:1,price:299,image:"/placeholder.jpg"}]),_e=r({full_name:"",email:"",country:"",city:"",address:"",postal_code:""}),he=[{id:"alipay",name:"支付宝",description:"使用支付宝安全快捷支付",icon:"/payment-alipay.png"},{id:"wechat",name:"微信支付",description:"使用微信支付便捷支付",icon:"/payment-wechat.png"},{id:"stripe",name:"信用卡",description:"支持 Visa、MasterCard 等",icon:"/payment-stripe.png"}],fe=n(()=>ye.value.reduce((e,a)=>e+a.price*a.quantity,0)),we=n(()=>0),ge=n(()=>fe.value-we.value),Se=n(()=>ve.value&&_e.value.full_name&&_e.value.email&&_e.value.country&&_e.value.city&&_e.value.address),handlePayment=async()=>{try{me.value=!0,pe.value=null;const{OrderService:e}=await l(async()=>{const{OrderService:e}=await import("./orderService-XOeuFSLT.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{PaymentService:a}=await l(async()=>{const{PaymentService:e}=await import("./paymentService-BZKge-lz.js");return{PaymentService:e}},[],import.meta.url),{useAuthStore:s}=await l(async()=>{const{useAuthStore:e}=await import("./index-BbQlNKpj.js").then(e=>e.w);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),t=s();if(!t.user)throw new Error("请先登录");let i=ue.query.order;if(!i){const a=ue.query.product;if(!a)throw new Error("缺少产品信息");const l={product_id:a,quantity:1,billing_address:_e.value};i=(await e.createOrder(l,t.user.id)).id}const r=await a.processPayment({order_id:i,payment_method:ve.value,payment_id:`PAY_${Date.now()}`,amount:ge.value},ve.value);if(!r.success)throw new Error(r.message||"支付失败");await processPaymentSuccess(i)}catch(e){pe.value=e instanceof Error?e.message:"支付失败，请重试"}finally{me.value=!1}},processPaymentSuccess=async e=>{const{OrderService:a}=await l(async()=>{const{OrderService:e}=await import("./orderService-XOeuFSLT.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url);await a.processPayment({order_id:e,payment_method:ve.value,payment_id:`PAY_${Date.now()}`,amount:ge.value}),i.push({path:"/payment/success",query:{order:e,amount:ge.value.toString()}})},goBack=()=>{i.go(-1)};return o(()=>{(async()=>{try{const e=ue.query.product,a=ue.query.order;e?console.log("从产品创建订单:",e):a&&console.log("加载现有订单:",a)}catch(e){pe.value="加载订单信息失败"}})(),he.length>0&&(ve.value=he[0].id)}),(a,l)=>(q(),d("div",b,[c("div",P,[l[18]||(l[18]=c("div",{class:"payment-header"},[c("h1",null,"支付订单"),c("p",null,"请选择支付方式完成购买")],-1)),c("div",E,[c("div",V,[l[9]||(l[9]=c("h3",null,"订单信息",-1)),c("div",O,[(q(!0),d(m,null,p(ye.value,e=>(q(),d("div",{key:e.id,class:"order-item"},[c("div",A,[c("img",{src:e.image,alt:e.name},null,8,k)]),c("div",j,[c("h4",D,v(e.name),1),c("p",U,v(e.description),1),c("div",x,[c("span",I,"数量: "+v(e.quantity),1),c("span",R,"¥"+v(e.price),1)])])]))),128))]),c("div",C,[c("div",L,[l[6]||(l[6]=c("span",null,"商品总额",-1)),c("span",null,"¥"+v(fe.value),1)]),c("div",T,[l[7]||(l[7]=c("span",null,"优惠折扣",-1)),c("span",N,"-¥"+v(we.value),1)]),c("div",$,[l[8]||(l[8]=c("span",null,"应付金额",-1)),c("span",J,"¥"+v(ge.value),1)])])]),c("div",M,[l[10]||(l[10]=c("h3",null,"选择支付方式",-1)),c("div",Y,[(q(),d(m,null,p(he,a=>c("label",{key:a.id,class:y(["method-option",{selected:ve.value===a.id}])},[_(c("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>ve.value=e),type:"radio",value:a.id,name:"paymentMethod"},null,8,z),[[h,ve.value]]),c("div",B,[c("div",F,[c("img",{src:a.icon,alt:a.name},null,8,G)]),c("div",H,[c("div",K,v(a.name),1),c("div",Q,v(a.description),1)]),c("div",W,[f(w(e),{class:"check-icon"})])])],2)),64))])]),c("div",X,[l[17]||(l[17]=c("h3",null,"账单地址",-1)),c("form",Z,[c("div",ee,[c("div",ae,[l[11]||(l[11]=c("label",{for:"fullName"},"姓名 *",-1)),_(c("input",{id:"fullName","onUpdate:modelValue":l[1]||(l[1]=e=>_e.value.full_name=e),type:"text",required:"",placeholder:"请输入姓名"},null,512),[[g,_e.value.full_name]])]),c("div",le,[l[12]||(l[12]=c("label",{for:"email"},"邮箱 *",-1)),_(c("input",{id:"email","onUpdate:modelValue":l[2]||(l[2]=e=>_e.value.email=e),type:"email",required:"",placeholder:"请输入邮箱地址"},null,512),[[g,_e.value.email]])])]),c("div",se,[c("div",te,[l[14]||(l[14]=c("label",{for:"country"},"国家/地区 *",-1)),_(c("select",{id:"country","onUpdate:modelValue":l[3]||(l[3]=e=>_e.value.country=e),required:""},l[13]||(l[13]=[c("option",{value:""},"请选择国家/地区",-1),c("option",{value:"CN"},"中国",-1),c("option",{value:"US"},"美国",-1),c("option",{value:"JP"},"日本",-1)]),512),[[S,_e.value.country]])]),c("div",ie,[l[15]||(l[15]=c("label",{for:"city"},"城市 *",-1)),_(c("input",{id:"city","onUpdate:modelValue":l[4]||(l[4]=e=>_e.value.city=e),type:"text",required:"",placeholder:"请输入城市"},null,512),[[g,_e.value.city]])])]),c("div",re,[l[16]||(l[16]=c("label",{for:"address"},"详细地址 *",-1)),_(c("input",{id:"address","onUpdate:modelValue":l[5]||(l[5]=e=>_e.value.address=e),type:"text",required:"",placeholder:"请输入详细地址"},null,512),[[g,_e.value.address]])])])]),c("div",ne,[c("button",{class:"cancel-btn",onClick:goBack},"取消订单"),c("button",{class:"pay-btn",disabled:!Se.value||me.value,onClick:handlePayment},[me.value?(q(),d("div",de)):u("",!0),c("span",null,v(me.value?"处理中...":`立即支付 ¥${ge.value}`),1)],8,oe)]),pe.value?(q(),d("div",ce,v(pe.value),1)):u("",!0)])])]))}}),[["__scopeId","data-v-6fe3cf02"]]);export{ue as default};
//# sourceMappingURL=PaymentView-CZcTR5HP.js.map
