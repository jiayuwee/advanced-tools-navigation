import{d as a,r as e,c as t,o,m as s,q as r,t as l,y as i,N as c,u as n,aE as u,aP as d,A as v,B as m,H as p,C as g,D as y,F as f,z as h,a7 as w,aQ as _,aR as b,v as k,aA as T,aJ as E,X as C,x as O,E as q,G as S}from"./vendor-DNhI5biu.js";import{s as I,T as F,h as L,u as V,a as U,_ as x}from"./index-B1TH_aNL.js";function R(a){var e;return(null==(e=a.category)?void 0:e.id)?a.category.id:a.categoryId?a.categoryId:a.category_id?a.category_id:null}const $="active";class z{static async getTools(a){try{let e=I.from(F.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("status",$);(null==a?void 0:a.query)&&(e=e.or(`name.ilike.%${a.query}%,description.ilike.%${a.query}%`)),(null==a?void 0:a.category)&&"all"!==a.category&&(e=e.eq("category_id",a.category));const t=(null==a?void 0:a.sortBy)||"sort_order",o=(null==a?void 0:a.sortOrder)||"asc";e=e.order(t,{ascending:"asc"===o});const s=(null==a?void 0:a.page)||1,r=(null==a?void 0:a.limit)||20,l=(s-1)*r;e=e.range(l,l+r-1);const{data:i,error:c,count:n}=await e;if(c)throw new Error(L(c));return{items:(i||[]).map(this.transformToolRow),total:n||0,page:s,limit:r,hasMore:(n||0)>l+r}}catch(e){throw console.error("Error fetching tools:",e),e}}static async getTool(a){try{const{data:e,error:t}=await I.from(F.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("id",a).single();if(t)throw new Error(L(t));return this.transformToolRow(e)}catch(e){throw console.error("Error fetching tool:",e),e}}static async createTool(a){try{!function(a,e,t="Entity"){const o=[];for(const s of e)a[s]||o.push(s);if(o.length>0)throw new Error(`${t} validation failed: missing required fields: ${o.join(", ")}`)}(a,["name","description","url"],"Tool");const e=function(a,e="Category"){const t=R(a);if(!t)throw new Error(`${e} is required`);return t}(a),{data:t,error:o}=await I.from(F.TOOLS).insert({name:a.name,description:a.description,url:a.url,category_id:e,icon:a.icon,is_featured:a.is_featured||!1,status:$,meta_title:a.meta_title,meta_description:a.meta_description,sort_order:a.sort_order||0}).select("\n          *,\n          category:categories(*)\n        ").single();if(o)throw new Error(L(o));return this.transformToolRow(t)}catch(e){throw console.error("Error creating tool:",e),e}}static async updateTool(a,e){try{const t={};e.name&&(t.name=e.name),e.description&&(t.description=e.description),e.url&&(t.url=e.url);const o=R(e);o&&(t.category_id=o),void 0!==e.icon&&(t.icon=e.icon),void 0!==e.is_featured&&(t.is_featured=e.is_featured),e.status&&(t.status=e.status),void 0!==e.meta_title&&(t.meta_title=e.meta_title),void 0!==e.meta_description&&(t.meta_description=e.meta_description),void 0!==e.sort_order&&(t.sort_order=e.sort_order),t.updated_at=(new Date).toISOString();const{data:s,error:r}=await I.from(F.TOOLS).update(t).eq("id",a).select("\n          *,\n          category:categories(*)\n        ").single();if(r)throw new Error(L(r));return this.transformToolRow(s)}catch(t){throw console.error("Error updating tool:",t),t}}static async deleteTool(a){try{const{error:e}=await I.from(F.TOOLS).delete().eq("id",a);if(e)throw new Error(L(e))}catch(e){throw console.error("Error deleting tool:",e),e}}static async incrementClickCount(a){try{const{error:e}=await I.rpc("increment_click_count",{tool_id:a});if(e)throw new Error(L(e))}catch(e){throw console.error("Error incrementing click count:",e),e}}static async updateFavoriteStatus(a,e){try{const{error:t}=await I.from(F.TOOLS).update({is_favorite:e,updated_at:(new Date).toISOString()}).eq("id",a);if(t)throw new Error(L(t))}catch(t){throw console.error("Error updating favorite status:",t),t}}static async getPopularTools(a=10){try{const{data:e,error:t}=await I.from(F.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("status",$).order("click_count",{ascending:!1}).limit(a);if(t)throw new Error(L(t));return(e||[]).map(this.transformToolRow)}catch(e){throw console.error("Error fetching popular tools:",e),e}}static async getFeaturedTools(a=6){try{const{data:e,error:t}=await I.from(F.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("status",$).eq("is_featured",!0).order("sort_order",{ascending:!0}).limit(a);if(t)throw new Error(L(t));return(e||[]).map(this.transformToolRow)}catch(e){throw console.error("Error fetching featured tools:",e),e}}static async searchTools(a,e=20){try{const{data:t,error:o}=await I.from(F.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("status",$).or(`name.ilike.%${a}%,description.ilike.%${a}%`).order("click_count",{ascending:!1}).limit(e);if(o)throw new Error(L(o));return(t||[]).map(this.transformToolRow)}catch(t){throw console.error("Error searching tools:",t),t}}static transformToolRow(a){return{id:a.id,name:a.name,description:a.description,url:a.url,icon:a.icon,category_id:a.category_id,tags:[],is_favorite:a.is_favorite,click_count:a.click_count,is_featured:a.is_featured,status:a.status,created_at:a.created_at,updated_at:a.updated_at,created_by:a.created_by,meta_title:a.meta_title,meta_description:a.meta_description,sort_order:a.sort_order}}}const j={class:"admin-tools-view"},A={class:"admin-actions"},D={class:"search-tools"},B={class:"tools-summary"},M={class:"stats-grid"},P={class:"stat-card"},G={class:"stat-number"},H={class:"stat-card"},J={class:"stat-number"},N={class:"stat-card"},Q={class:"stat-number"},K={class:"stat-card"},W={class:"stat-number"},X={class:"tools-management"},Y={class:"tools-header"},Z={class:"filter-controls"},aa=["value"],ea={class:"tools-table"},ta={class:"col-icon"},oa={class:"tool-icon"},sa={class:"col-name"},ra={class:"tool-name"},la={class:"tool-description"},ia={class:"col-category"},ca={class:"category-badge"},na={class:"col-status"},ua={class:"col-clicks"},da={class:"col-actions"},va=["onClick"],ma=["onClick"],pa=["onClick","title"],ga={key:0,class:"pagination"},ya=["disabled"],fa={class:"page-info"},ha=["disabled"],wa={class:"modal-header"},_a={class:"form-grid"},ba={class:"form-group"},ka={class:"form-group"},Ta={class:"form-group full-width"},Ea={class:"form-group"},Ca={class:"form-group"},Oa=["value"],qa={class:"form-group"},Sa={class:"form-group"},Ia={class:"form-actions"},Fa=["disabled"],La=x(a({__name:"AdminToolsView",setup(a){const I=V(),F=U(),L=e(!1),x=e(!1),R=e(""),$=e("success"),La=e(""),Va=e(""),Ua=e(""),xa=e(1),Ra=e(10),$a=e(!1),za=e(!1),ja=e(null),Aa=e({name:"",description:"",url:"",icon:"🔧",categoryId:"",status:"active",isFeatured:!1}),Da=t(()=>{let a=I.tools;if(La.value){const e=La.value.toLowerCase();a=a.filter(a=>a.name.toLowerCase().includes(e)||a.description.toLowerCase().includes(e))}return Va.value&&(a=a.filter(a=>a.categoryId===Va.value)),Ua.value&&(a=a.filter(a=>a.status===Ua.value)),a}),Ba=t(()=>I.tools.filter(a=>a.isFeatured).length),Ma=t(()=>I.tools.filter(a=>"active"===a.status).length),Pa=t(()=>Math.ceil(Da.value.length/Ra.value)),Ga=t(()=>{const a=(xa.value-1)*Ra.value,e=a+Ra.value;return Da.value.slice(a,e)}),Ha=async()=>{try{L.value=!0,await I.initialize(),await F.initialize(),R.value="工具列表已刷新",$.value="success"}catch(a){R.value="刷新失败",$.value="error"}finally{L.value=!1}},Ja=()=>{$a.value=!1,za.value=!1,ja.value=null,Aa.value={name:"",description:"",url:"",icon:"🔧",categoryId:"",status:"active",isFeatured:!1}},Na=async()=>{try{x.value=!0,R.value="",za.value&&ja.value?(await z.updateTool(ja.value.id,{name:Aa.value.name,description:Aa.value.description,url:Aa.value.url,icon:Aa.value.icon,category_id:Aa.value.categoryId,status:Aa.value.status,is_featured:Aa.value.isFeatured}),R.value="工具更新成功！"):(await z.createTool({name:Aa.value.name,description:Aa.value.description,url:Aa.value.url,icon:Aa.value.icon,category_id:Aa.value.categoryId,status:Aa.value.status,is_featured:Aa.value.isFeatured,click_count:0,sort_order:0}),R.value="工具创建成功！"),$.value="success",Ja(),await Ha()}catch(a){console.error("保存工具失败:",a),R.value="保存工具失败: "+(a instanceof Error?a.message:"未知错误"),$.value="error"}finally{x.value=!1}};return o(async()=>{await I.initialize(),await F.initialize()}),(a,e)=>(S(),s("div",j,[e[33]||(e[33]=r("div",{class:"admin-header"},[r("h1",null,"工具管理"),r("p",null,"添加、编辑和管理工具数据")],-1)),r("div",A,[r("button",{class:"action-button primary",onClick:e[0]||(e[0]=a=>$a.value=!0)},[i(n(u),{class:"icon"}),e[14]||(e[14]=c(" 添加新工具 "))]),r("button",{class:"action-button secondary",onClick:Ha},[i(n(d),{class:"icon"}),e[15]||(e[15]=c(" 刷新列表 "))]),r("div",D,[v(r("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>La.value=a),type:"text",placeholder:"搜索工具...",class:"search-input"},null,512),[[m,La.value]])])]),R.value?(S(),s("div",{key:0,class:p(["message",$.value])},g(R.value),3)):l("",!0),r("div",B,[r("div",M,[r("div",P,[r("div",G,g(Da.value.length),1),e[16]||(e[16]=r("div",{class:"stat-label"},"总工具数",-1))]),r("div",H,[r("div",J,g(Ba.value),1),e[17]||(e[17]=r("div",{class:"stat-label"},"推荐工具",-1))]),r("div",N,[r("div",Q,g(n(F).categories.length),1),e[18]||(e[18]=r("div",{class:"stat-label"},"分类数",-1))]),r("div",K,[r("div",W,g(Ma.value),1),e[19]||(e[19]=r("div",{class:"stat-label"},"活跃工具",-1))])])]),r("div",X,[r("div",Y,[e[22]||(e[22]=r("h2",null,"工具列表",-1)),r("div",Z,[v(r("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>Va.value=a),class:"category-filter"},[e[20]||(e[20]=r("option",{value:""},"全部分类",-1)),(S(!0),s(f,null,h(n(F).categories,a=>(S(),s("option",{key:a.id,value:a.id},g(a.name),9,aa))),128))],512),[[y,Va.value]]),v(r("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>Ua.value=a),class:"status-filter"},e[21]||(e[21]=[r("option",{value:""},"全部状态",-1),r("option",{value:"active"},"活跃",-1),r("option",{value:"inactive"},"停用",-1)]),512),[[y,Ua.value]])])]),r("div",ea,[e[23]||(e[23]=w('<div class="table-header" data-v-ea64fe49><div class="col-icon" data-v-ea64fe49>图标</div><div class="col-name" data-v-ea64fe49>名称</div><div class="col-category" data-v-ea64fe49>分类</div><div class="col-status" data-v-ea64fe49>状态</div><div class="col-clicks" data-v-ea64fe49>点击数</div><div class="col-actions" data-v-ea64fe49>操作</div></div>',1)),(S(!0),s(f,null,h(Ga.value,a=>{var e;return S(),s("div",{key:a.id,class:"table-row"},[r("div",ta,[r("span",oa,g(a.icon),1)]),r("div",sa,[r("div",ra,g(a.name),1),r("div",la,g(a.description),1)]),r("div",ia,[r("span",ca,g((null==(e=a.category)?void 0:e.name)||"未分类"),1)]),r("div",na,[r("span",{class:p(["status-badge","active"===a.status?"active":"inactive"])},g("active"===a.status?"活跃":"停用"),3)]),r("div",ua,g(a.clickCount||0),1),r("div",da,[r("button",{class:"action-btn edit",onClick:e=>(a=>{ja.value=a,Aa.value={name:a.name,description:a.description,url:a.url,icon:a.icon,categoryId:a.categoryId,status:a.status,isFeatured:a.isFeatured},za.value=!0})(a),title:"编辑"},[i(n(_),{class:"icon"})],8,va),r("button",{class:"action-btn delete",onClick:e=>(async a=>{if(confirm(`确定要删除工具 "${a.name}" 吗？此操作不可恢复。`))try{await z.deleteTool(a.id),R.value="工具删除成功！",$.value="success",await Ha()}catch(e){console.error("删除工具失败:",e),R.value="删除工具失败: "+(e instanceof Error?e.message:"未知错误"),$.value="error"}})(a),title:"删除"},[i(n(b),{class:"icon"})],8,ma),r("button",{class:"action-btn toggle",onClick:e=>(async a=>{try{const e="active"===a.status?"inactive":"active";await z.updateTool(a.id,{status:e}),R.value=`工具已${"active"===e?"启用":"停用"}！`,$.value="success",await Ha()}catch(e){console.error("切换工具状态失败:",e),R.value="操作失败",$.value="error"}})(a),title:"active"===a.status?"停用":"启用"},["active"===a.status?(S(),k(n(T),{key:0,class:"icon"})):(S(),k(n(E),{key:1,class:"icon"}))],8,pa)])])}),128))]),Pa.value>1?(S(),s("div",ga,[r("button",{disabled:1===xa.value,onClick:e[4]||(e[4]=a=>xa.value--),class:"page-btn"}," 上一页 ",8,ya),r("span",fa," 第 "+g(xa.value)+" 页，共 "+g(Pa.value)+" 页 ",1),r("button",{disabled:xa.value===Pa.value,onClick:e[5]||(e[5]=a=>xa.value++),class:"page-btn"}," 下一页 ",8,ha)])):l("",!0)]),$a.value||za.value?(S(),s("div",{key:1,class:"modal-overlay",onClick:Ja},[r("div",{class:"modal-content",onClick:e[13]||(e[13]=O(()=>{},["stop"]))},[r("div",wa,[r("h3",null,g($a.value?"添加新工具":"编辑工具"),1),r("button",{class:"close-btn",onClick:Ja},[i(n(C),{class:"icon"})])]),r("form",{onSubmit:O(Na,["prevent"]),class:"tool-form"},[r("div",_a,[r("div",ba,[e[24]||(e[24]=r("label",null,"工具名称 *",-1)),v(r("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>Aa.value.name=a),type:"text",required:"",placeholder:"输入工具名称"},null,512),[[m,Aa.value.name]])]),r("div",ka,[e[25]||(e[25]=r("label",null,"工具图标",-1)),v(r("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>Aa.value.icon=a),type:"text",placeholder:"🔧"},null,512),[[m,Aa.value.icon]])]),r("div",Ta,[e[26]||(e[26]=r("label",null,"工具描述 *",-1)),v(r("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>Aa.value.description=a),required:"",placeholder:"描述工具的功能和用途",rows:"3"},null,512),[[m,Aa.value.description]])]),r("div",Ea,[e[27]||(e[27]=r("label",null,"工具链接 *",-1)),v(r("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>Aa.value.url=a),type:"url",required:"",placeholder:"https://example.com"},null,512),[[m,Aa.value.url]])]),r("div",Ca,[e[29]||(e[29]=r("label",null,"分类 *",-1)),v(r("select",{"onUpdate:modelValue":e[10]||(e[10]=a=>Aa.value.categoryId=a),required:""},[e[28]||(e[28]=r("option",{value:""},"选择分类",-1)),(S(!0),s(f,null,h(n(F).categories,a=>(S(),s("option",{key:a.id,value:a.id},g(a.name),9,Oa))),128))],512),[[y,Aa.value.categoryId]])]),r("div",qa,[e[31]||(e[31]=r("label",null,"状态",-1)),v(r("select",{"onUpdate:modelValue":e[11]||(e[11]=a=>Aa.value.status=a)},e[30]||(e[30]=[r("option",{value:"active"},"活跃",-1),r("option",{value:"inactive"},"停用",-1)]),512),[[y,Aa.value.status]])]),r("div",Sa,[r("label",null,[v(r("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>Aa.value.isFeatured=a),type:"checkbox"},null,512),[[q,Aa.value.isFeatured]]),e[32]||(e[32]=c(" 推荐工具 "))])])]),r("div",Ia,[r("button",{type:"button",onClick:Ja,class:"cancel-btn"}," 取消 "),r("button",{type:"submit",disabled:x.value,class:"save-btn"},g(x.value?"保存中...":"保存"),9,Fa)])],32)])])):l("",!0)]))}}),[["__scopeId","data-v-ea64fe49"]]);export{La as default};
