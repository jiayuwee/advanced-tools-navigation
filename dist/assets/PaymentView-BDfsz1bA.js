const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./orderService-CHvwLTGC.js","./index-C5n2Pyp_.js","./vendor-B_bmgS9f.js","./index-pkM5dxC7.css"])))=>i.map(i=>d[i]);
import{n as e,d as a,o as l,c as s,_ as t}from"./index-C5n2Pyp_.js";import{d as i,r,c as n,o,m as d,q as u,t as c,F as m,z as p,D as v,B as y,G as h,J as f,y as g,u as w,I as b,P as q,A as _}from"./vendor-B_bmgS9f.js";const V={class:"payment-view"},S={class:"payment-container"},k={class:"payment-content"},A={class:"order-summary"},P={class:"order-items"},E={class:"item-image"},I=["src","alt"],N={class:"item-info"},U={class:"item-name"},x={class:"item-description"},O={class:"item-meta"},j={class:"item-quantity"},C={class:"item-price"},D={class:"order-total"},M={class:"total-row"},R={class:"total-row"},T={class:"discount"},J={class:"total-row final"},L={class:"final-amount"},$={class:"payment-methods"},z={class:"methods-list"},B=["value"],F={class:"method-content"},G={class:"method-icon"},Y=["src","alt"],H={class:"method-info"},K={class:"method-name"},Q={class:"method-description"},W={class:"method-check"},X={class:"billing-address"},Z={class:"address-form"},ee={class:"form-row"},ae={class:"form-group"},le={class:"form-group"},se={class:"form-row"},te={class:"form-group"},ie={class:"form-group"},re={class:"form-group"},ne={class:"payment-actions"},oe=["disabled"],de={key:0,class:"loading-spinner"},ue={key:0,class:"error-message"},ce=t(i({__name:"PaymentView",setup(t){const i=s(),ce=a(),me=r(!1),pe=r(null),ve=r(""),ye=r([{id:"1",name:"高效办公套件",description:"提升办公效率的完整解决方案",quantity:1,price:299,image:"/placeholder.jpg"}]),he=r({fullName:"",email:"",country:"",city:"",address:""}),fe=[{id:"alipay",name:"支付宝",description:"使用支付宝安全快捷支付",icon:"/payment-alipay.png"},{id:"wechat",name:"微信支付",description:"使用微信支付便捷支付",icon:"/payment-wechat.png"},{id:"stripe",name:"信用卡",description:"支持 Visa、MasterCard 等",icon:"/payment-stripe.png"}],ge=n(()=>ye.value.reduce((e,a)=>e+a.price*a.quantity,0)),we=n(()=>0),be=n(()=>ge.value-we.value),qe=n(()=>ve.value&&he.value.fullName&&he.value.email&&he.value.country&&he.value.city&&he.value.address),_e=async()=>{try{me.value=!0,pe.value=null;const{OrderService:e}=await l(async()=>{const{OrderService:e}=await import("./orderService-CHvwLTGC.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useAuthStore:a}=await l(async()=>{const{useAuthStore:e}=await import("./index-C5n2Pyp_.js").then(e=>e.v);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),s=a();if(!s.user)throw new Error("请先登录");let t=ce.query.order;if(!t){const a=ce.query.product;if(!a)throw new Error("缺少产品信息");const l={productId:a,quantity:1,billingAddress:he.value};t=(await e.createOrder(l,s.user.id)).id}await new Promise(e=>setTimeout(e,2e3)),await e.processPayment({orderId:t,paymentMethod:ve.value,paymentId:`PAY_${Date.now()}`,amount:be.value}),i.push({path:"/payment/success",query:{order:t,amount:be.value.toString()}})}catch(e){pe.value=e instanceof Error?e.message:"支付失败，请重试"}finally{me.value=!1}},Ve=()=>{i.go(-1)};return o(()=>{(()=>{const e=ce.query.product,a=ce.query.order;e?console.log("从产品创建订单:",e):a&&console.log("加载现有订单:",a)})(),fe.length>0&&(ve.value=fe[0].id)}),(a,l)=>(_(),d("div",V,[u("div",S,[l[18]||(l[18]=u("div",{class:"payment-header"},[u("h1",null,"支付订单"),u("p",null,"请选择支付方式完成购买")],-1)),u("div",k,[u("div",A,[l[9]||(l[9]=u("h3",null,"订单信息",-1)),u("div",P,[(_(!0),d(m,null,p(ye.value,e=>(_(),d("div",{key:e.id,class:"order-item"},[u("div",E,[u("img",{src:e.image,alt:e.name},null,8,I)]),u("div",N,[u("h4",U,v(e.name),1),u("p",x,v(e.description),1),u("div",O,[u("span",j,"数量: "+v(e.quantity),1),u("span",C,"¥"+v(e.price),1)])])]))),128))]),u("div",D,[u("div",M,[l[6]||(l[6]=u("span",null,"商品总额",-1)),u("span",null,"¥"+v(ge.value),1)]),u("div",R,[l[7]||(l[7]=u("span",null,"优惠折扣",-1)),u("span",T,"-¥"+v(we.value),1)]),u("div",J,[l[8]||(l[8]=u("span",null,"应付金额",-1)),u("span",L,"¥"+v(be.value),1)])])]),u("div",$,[l[10]||(l[10]=u("h3",null,"选择支付方式",-1)),u("div",z,[(_(),d(m,null,p(fe,a=>u("label",{key:a.id,class:y(["method-option",{selected:ve.value===a.id}])},[h(u("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>ve.value=e),type:"radio",value:a.id,name:"paymentMethod"},null,8,B),[[f,ve.value]]),u("div",F,[u("div",G,[u("img",{src:a.icon,alt:a.name},null,8,Y)]),u("div",H,[u("div",K,v(a.name),1),u("div",Q,v(a.description),1)]),u("div",W,[g(w(e),{class:"check-icon"})])])],2)),64))])]),u("div",X,[l[17]||(l[17]=u("h3",null,"账单地址",-1)),u("form",Z,[u("div",ee,[u("div",ae,[l[11]||(l[11]=u("label",{for:"fullName"},"姓名 *",-1)),h(u("input",{id:"fullName","onUpdate:modelValue":l[1]||(l[1]=e=>he.value.fullName=e),type:"text",required:"",placeholder:"请输入姓名"},null,512),[[b,he.value.fullName]])]),u("div",le,[l[12]||(l[12]=u("label",{for:"email"},"邮箱 *",-1)),h(u("input",{id:"email","onUpdate:modelValue":l[2]||(l[2]=e=>he.value.email=e),type:"email",required:"",placeholder:"请输入邮箱地址"},null,512),[[b,he.value.email]])])]),u("div",se,[u("div",te,[l[14]||(l[14]=u("label",{for:"country"},"国家/地区 *",-1)),h(u("select",{id:"country","onUpdate:modelValue":l[3]||(l[3]=e=>he.value.country=e),required:""},l[13]||(l[13]=[u("option",{value:""},"请选择国家/地区",-1),u("option",{value:"CN"},"中国",-1),u("option",{value:"US"},"美国",-1),u("option",{value:"JP"},"日本",-1)]),512),[[q,he.value.country]])]),u("div",ie,[l[15]||(l[15]=u("label",{for:"city"},"城市 *",-1)),h(u("input",{id:"city","onUpdate:modelValue":l[4]||(l[4]=e=>he.value.city=e),type:"text",required:"",placeholder:"请输入城市"},null,512),[[b,he.value.city]])])]),u("div",re,[l[16]||(l[16]=u("label",{for:"address"},"详细地址 *",-1)),h(u("input",{id:"address","onUpdate:modelValue":l[5]||(l[5]=e=>he.value.address=e),type:"text",required:"",placeholder:"请输入详细地址"},null,512),[[b,he.value.address]])])])]),u("div",ne,[u("button",{class:"cancel-btn",onClick:Ve},"取消订单"),u("button",{class:"pay-btn",disabled:!qe.value||me.value,onClick:_e},[me.value?(_(),d("div",de)):c("",!0),u("span",null,v(me.value?"处理中...":`立即支付 ¥${be.value}`),1)],8,oe)]),pe.value?(_(),d("div",ue,v(pe.value),1)):c("",!0)])])]))}}),[["__scopeId","data-v-b751601b"]]);export{ce as default};
