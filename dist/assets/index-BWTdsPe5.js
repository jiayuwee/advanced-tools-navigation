const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-B0y4bEX3.js","./vendor-DhoxJlSg.js","./EnhancedHomeView-DgOnr2er.js","./categories-9-sMVXcH.js","./EnhancedHomeView-CmvVSbzx.css","./HomeView-CNsvhfrf.js","./HomeView-CsZZ03yk.css","./ComparisonView-LHZLTFwL.js","./ComparisonView-BBLNMYPy.css","./TestStatusBar-uWxu3rI6.js","./TestStatusBar-k2A8_0Fe.css","./ToolsView-Di57xLpg.js","./ToolsView-BiLlEeUJ.css","./ProductsView-BRLoFaI-.js","./ProductsView-DT_bfOFu.css","./ProductDetailView-DtxIwWrZ.js","./ProductDetailView-B1YLHNwr.css","./UserView-CD7Vtb3E.js","./UserView-BGzqa1ua.css","./ProfileView-CVCseMvk.js","./ProfileView-DpPtkwxE.css","./FavoritesView-RY2S6m8S.js","./FavoritesView-RzeM2c7T.css","./OrdersView-DA00h0bP.js","./OrdersView-BY6Q3swg.css","./AuthView-DmNg11n7.js","./AuthView-kJTw_t9R.css","./LoginView-Q5aZqbhJ.js","./LoginView-DqUiEiAL.css","./RegisterView-DSGQNN-t.js","./RegisterView-BfPJesmG.css","./ForgotPasswordView-CB_-B-o_.js","./ForgotPasswordView-CsrSL9dm.css","./AdminView-0P8uLhV8.js","./AdminView-D-c4a1ji.css","./DashboardView-1ywsCO8U.js","./DashboardView-CkbHANYK.css","./AdminToolsView-CCNa5NAB.js","./AdminToolsView-FnuLN_2m.css","./ProductsManageView-BKlo1QpA.js","./ProductsManageView-BMAVYlPv.css","./LocalManagementView-BsYqiZE7.js","./LocalManagementView-BKhuuKM8.css","./LocalManagementTestView-CoOrD3Tx.js","./LocalManagementTestView-CCGHFHjt.css","./PaymentView-waRs3Tfj.js","./PaymentView-dCfgJGjJ.css","./PaymentSuccessView-uqrhQfYv.js","./PaymentSuccessView-BYCqjQvv.css","./PaymentCancelView-B0bt4mOe.js","./PaymentCancelView-5StAoE7K.css","./NotFoundView-bmnCOL72.js","./NotFoundView-J7iPsJwS.css"])))=>i.map(i=>d[i]);
import{d as e,c as t,a as r,b as s,e as n,u as a,M as o,T as i,G as l,f as c,r as u,w as h,P as d,g as f,C as p,h as g,o as m,i as v,j as y,k as w,t as _,l as b,m as k,n as E,p as S,q as T,X as O,F as P,s as j,v as A,x as I,y as C,z as R,A as $,B as L,D as x,E as U,H as D,I as q,J as N,K as M,L as B,N as F,O as V,Q as G,R as z,S as W,U as J,V as H}from"./vendor-DhoxJlSg.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const K={class:"app-footer"},Q={class:"footer-content"},Y={class:"footer-main"},X={class:"footer-section company-info"},Z={class:"social-links"},ee={href:"#",class:"social-link",title:"å¾®ä¿¡"},te={href:"#",class:"social-link",title:"å¾®åš"},re={href:"#",class:"social-link",title:"GitHub"},se={href:"#",class:"social-link",title:"é‚®ç®±"},ne={class:"footer-section"},ae={class:"footer-links"},oe={class:"footer-section contact-info"},ie={class:"contact-item"},le={class:"contact-item"},ce={class:"contact-item"},ue={class:"contact-item"},he=(e,t)=>{const r=e.__vccOpts||e;for(const[s,n]of t)r[s]=n;return r},de=he(e({__name:"AppFooter",setup:e=>(e,v)=>{const y=u("router-link");return m(),t("footer",K,[r("div",Q,[r("div",Y,[r("div",X,[v[0]||(v[0]=r("div",{class:"company-logo"},[r("div",{class:"logo-icon"},"ğŸš€"),r("div",{class:"logo-text"},[r("h3",null,"å·¥å…·å¯¼èˆªç«™"),r("p",null,"è®©å·¥ä½œæ›´é«˜æ•ˆ")])],-1)),v[1]||(v[1]=r("p",{class:"company-description"}," ä¸“æ³¨äºä¸ºç”¨æˆ·æä¾›ä¼˜è´¨çš„å·¥å…·å¯¼èˆªå’Œäº§å“å±•ç¤ºæœåŠ¡ï¼Œè‡´åŠ›äºæå‡å·¥ä½œæ•ˆç‡ï¼Œè®©æ¯ä¸ªäººéƒ½èƒ½æ‰¾åˆ°æœ€é€‚åˆçš„å·¥å…·å’Œäº§å“ã€‚ ",-1)),r("div",Z,[r("a",ee,[n(a(o),{class:"icon"})]),r("a",te,[n(a(i),{class:"icon"})]),r("a",re,[n(a(l),{class:"icon"})]),r("a",se,[n(a(c),{class:"icon"})])])]),r("div",ne,[v[7]||(v[7]=r("h4",null,"å¿«é€Ÿå¯¼èˆª",-1)),r("ul",ae,[r("li",null,[n(y,{to:"/"},{default:h(()=>v[2]||(v[2]=[g("é¦–é¡µ")])),_:1,__:[2]})]),r("li",null,[n(y,{to:"/tools"},{default:h(()=>v[3]||(v[3]=[g("å·¥å…·å¯¼èˆª")])),_:1,__:[3]})]),r("li",null,[n(y,{to:"/products"},{default:h(()=>v[4]||(v[4]=[g("äº§å“å±•ç¤º")])),_:1,__:[4]})]),r("li",null,[n(y,{to:"/user/favorites"},{default:h(()=>v[5]||(v[5]=[g("æˆ‘çš„æ”¶è—")])),_:1,__:[5]})]),r("li",null,[n(y,{to:"/admin"},{default:h(()=>v[6]||(v[6]=[g("ç®¡ç†åå°")])),_:1,__:[6]})])])]),v[13]||(v[13]=s('<div class="footer-section" data-v-88f57f9e><h4 data-v-88f57f9e>äº§å“æœåŠ¡</h4><ul class="footer-links" data-v-88f57f9e><li data-v-88f57f9e><a href="#" data-v-88f57f9e>å¼€å‘å·¥å…·</a></li><li data-v-88f57f9e><a href="#" data-v-88f57f9e>è®¾è®¡å·¥å…·</a></li><li data-v-88f57f9e><a href="#" data-v-88f57f9e>æ•ˆç‡å·¥å…·</a></li><li data-v-88f57f9e><a href="#" data-v-88f57f9e>AIå·¥å…·</a></li><li data-v-88f57f9e><a href="#" data-v-88f57f9e>å­¦ä¹ èµ„æº</a></li></ul></div><div class="footer-section" data-v-88f57f9e><h4 data-v-88f57f9e>å¸®åŠ©æ”¯æŒ</h4><ul class="footer-links" data-v-88f57f9e><li data-v-88f57f9e><a href="#" data-v-88f57f9e>ä½¿ç”¨æŒ‡å—</a></li><li data-v-88f57f9e><a href="#" data-v-88f57f9e>å¸¸è§é—®é¢˜</a></li><li data-v-88f57f9e><a href="#" data-v-88f57f9e>æ„è§åé¦ˆ</a></li><li data-v-88f57f9e><a href="#" data-v-88f57f9e>è”ç³»æˆ‘ä»¬</a></li><li data-v-88f57f9e><a href="#" data-v-88f57f9e>æœåŠ¡æ¡æ¬¾</a></li></ul></div>',2)),r("div",oe,[v[12]||(v[12]=r("h4",null,"è”ç³»æˆ‘ä»¬",-1)),r("div",ie,[n(a(d),{class:"contact-icon"}),v[8]||(v[8]=r("span",null,"400-123-4567",-1))]),r("div",le,[n(a(c),{class:"contact-icon"}),v[9]||(v[9]=r("span",null,"contact@ramusi.cn",-1))]),r("div",ce,[n(a(f),{class:"contact-icon"}),v[10]||(v[10]=r("span",null,"åŒ—äº¬å¸‚æœé˜³åŒºç§‘æŠ€å›­åŒº",-1))]),r("div",ue,[n(a(p),{class:"contact-icon"}),v[11]||(v[11]=r("span",null,"å·¥ä½œæ—¶é—´ï¼š9:00-18:00",-1))])])]),v[14]||(v[14]=s('<div class="footer-bottom" data-v-88f57f9e><div class="footer-bottom-content" data-v-88f57f9e><div class="copyright" data-v-88f57f9e><p data-v-88f57f9e>Â© 2024 å·¥å…·å¯¼èˆªç«™. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p><p data-v-88f57f9e><a href="#" data-v-88f57f9e>éšç§æ”¿ç­–</a> | <a href="#" data-v-88f57f9e>æœåŠ¡æ¡æ¬¾</a> | <a href="#" data-v-88f57f9e>ç½‘ç«™åœ°å›¾</a></p></div><div class="footer-stats" data-v-88f57f9e><div class="stat-item" data-v-88f57f9e><span class="stat-number" data-v-88f57f9e>1000+</span><span class="stat-label" data-v-88f57f9e>ç²¾é€‰å·¥å…·</span></div><div class="stat-item" data-v-88f57f9e><span class="stat-number" data-v-88f57f9e>50+</span><span class="stat-label" data-v-88f57f9e>å·¥å…·åˆ†ç±»</span></div><div class="stat-item" data-v-88f57f9e><span class="stat-number" data-v-88f57f9e>10000+</span><span class="stat-label" data-v-88f57f9e>ç”¨æˆ·ä½¿ç”¨</span></div></div></div></div>',1))])])}}),[["__scopeId","data-v-88f57f9e"]]),fe={class:"simple-status-bar"},pe={class:"simple-status-content"},ge=he(e({__name:"SimpleStatusBar",setup(e){const s=v(""),n=()=>{const e=new Date;s.value=e.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})};let a=null;return y(()=>{n(),a=setInterval(n,1e3)}),w(()=>{a&&clearInterval(a)}),(e,n)=>(m(),t("div",fe,[r("div",pe,[n[0]||(n[0]=r("span",null,"ğŸš€ å·¥å…·å¯¼èˆªç«™",-1)),r("span",null,_(s.value),1),n[1]||(n[1]=r("span",null,"çŠ¶æ€æ æµ‹è¯•",-1))])]))}}),[["__scopeId","data-v-a0f496da"]]),me={},ve=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),a=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));s=Promise.allSettled(t.map(t=>{if(t=function(e,t){return new URL(e,t).href}(t,r),t in me)return;me[t]=!0;const s=t.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(!!r)for(let r=e.length-1;r>=0;r--){const n=e[r];if(n.href===t&&(!s||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${t}"]${n}`))return;const o=document.createElement("link");return o.rel=s?"stylesheet":"modulepreload",s||(o.as="script"),o.crossOrigin="",o.href=t,a&&o.setAttribute("nonce",a),document.head.appendChild(o),s?new Promise((e,r)=>{o.addEventListener("load",e),o.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};class ye extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class we extends ye{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class _e extends ye{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class be extends ye{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ke,Ee;(Ee=ke||(ke={})).Any="any",Ee.ApNortheast1="ap-northeast-1",Ee.ApNortheast2="ap-northeast-2",Ee.ApSouth1="ap-south-1",Ee.ApSoutheast1="ap-southeast-1",Ee.ApSoutheast2="ap-southeast-2",Ee.CaCentral1="ca-central-1",Ee.EuCentral1="eu-central-1",Ee.EuWest1="eu-west-1",Ee.EuWest2="eu-west-2",Ee.EuWest3="eu-west-3",Ee.SaEast1="sa-east-1",Ee.UsEast1="us-east-1",Ee.UsWest1="us-west-1",Ee.UsWest2="us-west-2";var Se=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function i(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((s=s.apply(e,t||[])).next())})};class Te{constructor(e,{headers:t={},customFetch:r,region:s=ke.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ve(async()=>{const{default:e}=await Promise.resolve().then(()=>Me);return{default:e}},void 0,import.meta.url).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Se(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:a}=t;let o,i={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(i["x-region"]=l),a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(i["Content-Type"]="application/octet-stream",o=a):"string"==typeof a?(i["Content-Type"]="text/plain",o=a):"undefined"!=typeof FormData&&a instanceof FormData?o=a:(i["Content-Type"]="application/json",o=JSON.stringify(a)));const c=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},i),this.headers),s),body:o}).catch(e=>{throw new we(e)}),u=c.headers.get("x-relay-error");if(u&&"true"===u)throw new _e(c);if(!c.ok)throw new be(c);let h,d=(null!==(r=c.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return h="application/json"===d?yield c.json():"application/octet-stream"===d?yield c.blob():"text/event-stream"===d?c:"multipart/form-data"===d?yield c.formData():yield c.text(),{data:h,error:null}}catch(s){return{data:null,error:s}}})}}var Oe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Pe(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,s.get?s:{enumerable:!0,get:function(){return e[t]}})}),r}var je={},Ae={},Ie={},Ce={},Re={},$e={},Le=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const xe=Le.fetch,Ue=Le.fetch.bind(Le),De=Le.Headers,qe=Le.Request,Ne=Le.Response,Me=Object.freeze(Object.defineProperty({__proto__:null,Headers:De,Request:qe,Response:Ne,default:Ue,fetch:xe},Symbol.toStringTag,{value:"Module"})),Be=Pe(Me);var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});let Ve=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Fe.default=Ve;var Ge=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($e,"__esModule",{value:!0});const ze=Ge(Be),We=Ge(Fe);$e.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=ze.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,s;let n=null,a=null,o=null,i=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(a="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const s=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");s&&c&&c.length>1&&(o=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(n={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,o=null,i=406,l="Not Acceptable"):a=1===a.length?a[0]:null)}else{const t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(a=[],n=null,i=200,l="OK")}catch(c){404===e.status&&""===t?(i=204,l="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(s=null==n?void 0:n.details)||void 0===s?void 0:s.includes("0 rows"))&&(n=null,i=200,l="OK"),n&&this.shouldThrowOnError)throw new We.default(n)}return{error:n,data:a,count:o,status:i,statusText:l}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}};var Je=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Re,"__esModule",{value:!0});const He=Je($e);let Ke=class extends He.default{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,a=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:a="text"}={}){var o;const i=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${l}"; options=${i};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Re.default=Ke;var Qe=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ce,"__esModule",{value:!0});const Ye=Qe(Re);let Xe=class extends Ye.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const a=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Ce.default=Xe;var Ze=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ie,"__esModule",{value:!0});const et=Ze(Ce);Ie.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let n=!1;const a=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new et.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),r||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new et.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){const a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new et.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new et.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new et.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var tt={},rt={};Object.defineProperty(rt,"__esModule",{value:!0}),rt.version=void 0,rt.version="0.0.0-automated",Object.defineProperty(tt,"__esModule",{value:!0}),tt.DEFAULT_HEADERS=void 0;const st=rt;tt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${st.version}`};var nt=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ae,"__esModule",{value:!0});const at=nt(Ie),ot=nt(Ce),it=tt;Ae.default=class e{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},it.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new at.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let i;r||s?(a=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{o.searchParams.append(e,t)})):(a="POST",i=t);const l=Object.assign({},this.headers);return n&&(l.Prefer=`count=${n}`),new ot.default({method:a,url:o,headers:l,schema:this.schemaName,body:i,fetch:this.fetch,allowEmpty:!1})}};var lt=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(je,"__esModule",{value:!0}),je.PostgrestError=je.PostgrestBuilder=je.PostgrestTransformBuilder=je.PostgrestFilterBuilder=je.PostgrestQueryBuilder=je.PostgrestClient=void 0;const ct=lt(Ae);je.PostgrestClient=ct.default;const ut=lt(Ie);je.PostgrestQueryBuilder=ut.default;const ht=lt(Ce);je.PostgrestFilterBuilder=ht.default;const dt=lt(Re);je.PostgrestTransformBuilder=dt.default;const ft=lt($e);je.PostgrestBuilder=ft.default;const pt=lt(Fe);je.PostgrestError=pt.default;var gt=je.default={PostgrestClient:ct.default,PostgrestQueryBuilder:ut.default,PostgrestFilterBuilder:ht.default,PostgrestTransformBuilder:dt.default,PostgrestBuilder:ft.default,PostgrestError:pt.default};const{PostgrestClient:mt,PostgrestQueryBuilder:vt,PostgrestFilterBuilder:yt,PostgrestTransformBuilder:wt,PostgrestBuilder:_t,PostgrestError:bt}=gt;const kt=function(){if("undefined"!=typeof WebSocket)return WebSocket;if(void 0!==global.WebSocket)return global.WebSocket;if(void 0!==window.WebSocket)return window.WebSocket;if(void 0!==self.WebSocket)return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}();var Et,St,Tt,Ot,Pt,jt,At,It,Ct,Rt,$t;(St=Et||(Et={}))[St.connecting=0]="connecting",St[St.open=1]="open",St[St.closing=2]="closing",St[St.closed=3]="closed",(Ot=Tt||(Tt={})).closed="closed",Ot.errored="errored",Ot.joined="joined",Ot.joining="joining",Ot.leaving="leaving",(jt=Pt||(Pt={})).close="phx_close",jt.error="phx_error",jt.join="phx_join",jt.reply="phx_reply",jt.leave="phx_leave",jt.access_token="access_token",(At||(At={})).websocket="websocket",(Ct=It||(It={})).Connecting="connecting",Ct.Open="open",Ct.Closing="closing",Ct.Closed="closed";class Lt{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+s));a+=s;const i=r.decode(e.slice(a,a+n));a+=n;return{ref:null,topic:o,event:i,payload:JSON.parse(r.decode(e.slice(a,e.byteLength)))}}}class xt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}($t=Rt||(Rt={})).abstime="abstime",$t.bool="bool",$t.date="date",$t.daterange="daterange",$t.float4="float4",$t.float8="float8",$t.int2="int2",$t.int4="int4",$t.int4range="int4range",$t.int8="int8",$t.int8range="int8range",$t.json="json",$t.jsonb="jsonb",$t.money="money",$t.numeric="numeric",$t.oid="oid",$t.reltime="reltime",$t.text="text",$t.time="time",$t.timestamp="timestamp",$t.timestamptz="timestamptz",$t.timetz="timetz",$t.tsrange="tsrange",$t.tstzrange="tstzrange";const Ut=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce((r,s)=>(r[s]=Dt(s,e,t,n),r),{})},Dt=(e,t,r,s)=>{const n=t.find(t=>t.name===e),a=null==n?void 0:n.type,o=r[e];return a&&!s.includes(a)?qt(a,o):Nt(o)},qt=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return Vt(t,r)}switch(e){case Rt.bool:return Mt(t);case Rt.float4:case Rt.float8:case Rt.int2:case Rt.int4:case Rt.int8:case Rt.numeric:case Rt.oid:return Bt(t);case Rt.json:case Rt.jsonb:return Ft(t);case Rt.timestamp:return Gt(t);case Rt.abstime:case Rt.date:case Rt.daterange:case Rt.int4range:case Rt.int8range:case Rt.money:case Rt.reltime:case Rt.text:case Rt.time:case Rt.timestamptz:case Rt.timetz:case Rt.tsrange:case Rt.tstzrange:default:return Nt(t)}},Nt=e=>e,Mt=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Bt=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Ft=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Vt=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const a=e.slice(1,r);try{s=JSON.parse("["+a+"]")}catch(n){s=a?a.split(","):[]}return s.map(e=>qt(t,e))}return e},Gt=e=>"string"==typeof e?e.replace(" ","T"):e,zt=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class Wt{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Jt,Ht,Kt,Qt,Yt,Xt,Zt,er;(Ht=Jt||(Jt={})).SYNC="sync",Ht.JOIN="join",Ht.LEAVE="leave";class tr{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=tr.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=tr.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=tr.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),a=this.transformState(t),o={},i={};return this.map(n,(e,t)=>{a[e]||(i[e]=t)}),this.map(a,(e,t)=>{const r=n[e];if(r){const s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),a=t.filter(e=>n.indexOf(e.presence_ref)<0),l=r.filter(e=>s.indexOf(e.presence_ref)<0);a.length>0&&(o[e]=a),l.length>0&&(i[e]=l)}else o[e]=t}),this.syncDiff(n,{joins:o,leaves:i},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;const a=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),a.length>0){const r=e[t].map(e=>e.presence_ref),s=a.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...s)}r(t,a,s)}),this.map(a,(t,r)=>{let n=e[t];if(!n)return;const a=r.map(e=>e.presence_ref);n=n.filter(e=>a.indexOf(e.presence_ref)<0),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Qt=Kt||(Kt={})).ALL="*",Qt.INSERT="INSERT",Qt.UPDATE="UPDATE",Qt.DELETE="DELETE",(Xt=Yt||(Yt={})).BROADCAST="broadcast",Xt.PRESENCE="presence",Xt.POSTGRES_CHANGES="postgres_changes",Xt.SYSTEM="system",(er=Zt||(Zt={})).SUBSCRIBED="SUBSCRIBED",er.TIMED_OUT="TIMED_OUT",er.CLOSED="CLOSED",er.CHANNEL_ERROR="CHANNEL_ERROR";class rr{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Tt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Wt(this,Pt.join,this.params,this.timeout),this.rejoinTimer=new xt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Tt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Tt.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Tt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Tt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Pt.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new tr(this),this.broadcastEndpointURL=zt(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Tt.closed){const{config:{broadcast:n,presence:a,private:o}}=this.params;this._onError(t=>null==e?void 0:e(Zt.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Zt.CLOSED));const i={},l={broadcast:n,presence:a,postgres_changes:null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],private:o};this.socket.accessTokenValue&&(i.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},i)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,a=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:o,schema:i,table:l,filter:c}}=n,u=t&&t[r];if(!u||u.event!==o||u.schema!==i||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=Tt.errored,void(null==e||e(Zt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},n),{id:u.id}))}return this.bindings.postgres_changes=a,void(e&&e(Zt.SUBSCRIBED))}null==e||e(Zt.SUBSCRIBED)}).receive("error",t=>{this.state=Tt.errored,null==e||e(Zt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Zt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,a;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===a?void 0:a.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:a,payload:o}=e,i={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:o,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Tt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Pt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Wt(this,Pt.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Wt(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const a=e.toLocaleLowerCase(),{close:o,error:i,leave:l,join:c}=Pt;if(r&&[o,i,l,c].indexOf(a)>=0&&r!==this._joinRef())return;let u=this._onMessage(a,t,r);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===a}).map(e=>e.callback(u,r)):null===(n=this.bindings[a])||void 0===n||n.filter(e=>{var r,s,n,o,i,l;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return a&&(null===(s=t.ids)||void 0===s?void 0:s.includes(a))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(i=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===i?void 0:i.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:a}=e,o={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:a};u=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(u,r)})}_isClosed(){return this.state===Tt.closed}_isJoined(){return this.state===Tt.joined}_isJoining(){return this.state===Tt.joining}_isLeaving(){return this.state===Tt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&rr.isEqual(e.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Pt.close,{},e)}_onError(e){this._on(Pt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Tt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Ut(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Ut(e.columns,e.old_record)),t}}const sr=()=>{};class nr{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=sr,this.ref=0,this.logger=sr,this.conn=null,this.sendBuffer=[],this.serializer=new Lt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ve(async()=>{const{default:e}=await import("./index-B0y4bEX3.js");return{default:e}},__vite__mapDeps([0,1]),import.meta.url).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${At.websocket}`,this.httpEndpoint=zt(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new xt(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=kt),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(e=>e.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Et.connecting:return It.Connecting;case Et.open:return It.Open;case Et.closing:return It.Closing;default:return It.Closed}}isConnected(){return this.connectionState()===It.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{const r=new rr(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:s,ref:n}=e,a=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.11.15"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(Pt.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:r,payload:s,ref:n}=e;"phoenix"===t&&"phx_reply"===r&&this.heartbeatCallback("ok"==e.payload.status?"ok":"error"),n&&n===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${r} ${n&&"("+n+")"||""}`,s),Array.from(this.channels).filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Pt.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class ar extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function or(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class ir extends ar{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class lr extends ar{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var cr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function i(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((s=s.apply(e,t||[])).next())})};const ur=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ve(async()=>{const{default:e}=await Promise.resolve().then(()=>Me);return{default:e}},void 0,import.meta.url).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},hr=e=>{if(Array.isArray(e))return e.map(e=>hr(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const s=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=hr(r)}),t};var dr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function i(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((s=s.apply(e,t||[])).next())})};const fr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),pr=(e,t,r)=>dr(void 0,void 0,void 0,function*(){const s=yield cr(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield ve(()=>Promise.resolve().then(()=>Me),void 0,import.meta.url)).Response:Response});e instanceof s&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{t(new ir(fr(r),e.status||500))}).catch(e=>{t(new lr(fr(e),e))}):t(new lr(fr(e),e))});function gr(e,t,r,s,n,a){return dr(this,void 0,void 0,function*(){return new Promise((o,i)=>{e(r,((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),r))})(t,s,n,a)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>pr(e,i,s))})})}function mr(e,t,r,s){return dr(this,void 0,void 0,function*(){return gr(e,"GET",t,r,s)})}function vr(e,t,r,s,n){return dr(this,void 0,void 0,function*(){return gr(e,"POST",t,s,n,r)})}function yr(e,t,r,s,n){return dr(this,void 0,void 0,function*(){return gr(e,"DELETE",t,s,n,r)})}var wr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function i(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((s=s.apply(e,t||[])).next())})};const _r={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},br={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class kr{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ur(s)}uploadOrUpdate(e,t,r,s){return wr(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},br),s);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const i=a.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),i&&n.append("metadata",this.encodeMetadata(i)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",a.cacheControl),i&&n.append("metadata",this.encodeMetadata(i))):(n=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,i&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(i)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:o},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{})),h=yield u.json();if(u.ok)return{data:{path:l,id:h.Id,fullPath:h.Key},error:null};return{data:null,error:h}}catch(n){if(or(n))return{data:null,error:n};throw n}})}upload(e,t,r){return wr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return wr(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:br.upsert},s),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType);const i=yield this.fetch(o.toString(),{method:"PUT",body:e,headers:a}),l=yield i.json();if(i.ok)return{data:{path:n,fullPath:l.Key},error:null};return{data:null,error:l}}catch(i){if(or(i))return{data:null,error:i};throw i}})}createSignedUploadUrl(e,t){return wr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const n=yield vr(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(this.url+n.url),o=a.searchParams.get("token");if(!o)throw new ar("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(r){if(or(r))return{data:null,error:r};throw r}})}update(e,t,r){return wr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return wr(this,void 0,void 0,function*(){try{return{data:yield vr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(or(s))return{data:null,error:s};throw s}})}copy(e,t,r){return wr(this,void 0,void 0,function*(){try{return{data:{path:(yield vr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(or(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return wr(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield vr(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const a=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(s){if(or(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return wr(this,void 0,void 0,function*(){try{const s=yield vr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(s){if(or(s))return{data:null,error:s};throw s}})}download(e,t){return wr(this,void 0,void 0,function*(){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield mr(this.fetch,`${this.url}/${r}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(a){if(or(a))return{data:null,error:a};throw a}})}info(e){return wr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield mr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:hr(e),error:null}}catch(r){if(or(r))return{data:null,error:r};throw r}})}exists(e){return wr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r,s){return dr(this,void 0,void 0,function*(){return gr(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),s)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(or(r)&&r instanceof lr){const e=r.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const a=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&s.push(o);let i=s.join("&");return""!==i&&(i=`?${i}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${i}`)}}}remove(e){return wr(this,void 0,void 0,function*(){try{return{data:yield yr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(or(t))return{data:null,error:t};throw t}})}list(e,t,r){return wr(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},_r),t),{prefix:e||""});return{data:yield vr(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(or(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Er={"X-Client-Info":"storage-js/2.7.1"};var Sr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function i(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((s=s.apply(e,t||[])).next())})};class Tr{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Er),t),this.fetch=ur(r)}listBuckets(){return Sr(this,void 0,void 0,function*(){try{return{data:yield mr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(or(e))return{data:null,error:e};throw e}})}getBucket(e){return Sr(this,void 0,void 0,function*(){try{return{data:yield mr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(or(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Sr(this,void 0,void 0,function*(){try{return{data:yield vr(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(or(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Sr(this,void 0,void 0,function*(){try{const r=yield function(e,t,r,s,n){return dr(this,void 0,void 0,function*(){return gr(e,"PUT",t,s,n,r)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:r,error:null}}catch(r){if(or(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Sr(this,void 0,void 0,function*(){try{return{data:yield vr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(or(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Sr(this,void 0,void 0,function*(){try{return{data:yield yr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(or(t))return{data:null,error:t};throw t}})}}class Or extends Tr{constructor(e,t={},r){super(e,t,r)}from(e){return new kr(this.url,this.headers,e,this.fetch)}}let Pr="";Pr="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const jr={headers:{"X-Client-Info":`supabase-js-${Pr}/2.50.2`}},Ar={schema:"public"},Ir={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Cr={};var Rr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function i(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((s=s.apply(e,t||[])).next())})};const $r=(e,t,r)=>{const s=(e=>{let t;return t=e||("undefined"==typeof fetch?Ue:fetch),(...e)=>t(...e)})(r),n="undefined"==typeof Headers?De:Headers;return(r,a)=>Rr(void 0,void 0,void 0,function*(){var o;const i=null!==(o=yield t())&&void 0!==o?o:e;let l=new n(null==a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${i}`),s(r,Object.assign(Object.assign({},a),{headers:l}))})};var Lr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function i(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((s=s.apply(e,t||[])).next())})};const xr="2.70.0",Ur=3e4,Dr=9e4,qr={"X-Client-Info":`gotrue-js/${xr}`},Nr="X-Supabase-Api-Version",Mr={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Br=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Fr extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Vr(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Gr extends Fr{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class zr extends Fr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Wr extends Fr{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Jr extends Wr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Hr extends Wr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Kr extends Wr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Qr extends Wr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Yr extends Wr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xr extends Wr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Zr(e){return Vr(e)&&"AuthRetryableFetchError"===e.name}class es extends Wr{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class ts extends Wr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const rs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ss=" \t\n\r=".split(""),ns=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<ss.length;t+=1)e[ss[t].charCodeAt(0)]=-2;for(let t=0;t<rs.length;t+=1)e[rs[t].charCodeAt(0)]=t;return e})();function as(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(rs[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(rs[e]),t.queuedBits-=6}}function os(e,t,r){const s=ns[e];if(!(s>-1)){if(-2===s)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function is(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},a=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,s,r)};for(let o=0;o<e.length;o+=1)os(e.charCodeAt(o),n,a);return t.join("")}function ls(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function cs(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let n=0;n<e.length;n+=1)os(e.charCodeAt(n),r,s);return new Uint8Array(t)}function us(e){const t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){const t=1024*(s-55296)&65535;s=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}ls(s,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function hs(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>as(e,r,s)),as(null,r,s),t.join("")}const ds=()=>"undefined"!=typeof window&&"undefined"!=typeof document,fs={tested:!1,writable:!1},ps=()=>{if(!ds())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(fs.tested)return fs.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),fs.tested=!0,fs.writable=!0}catch(t){fs.tested=!0,fs.writable=!1}return fs.writable};const gs=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ve(async()=>{const{default:e}=await Promise.resolve().then(()=>Me);return{default:e}},void 0,import.meta.url).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},ms=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},vs=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(s){return r}},ys=async(e,t)=>{await e.removeItem(t)};class ws{constructor(){this.promise=new ws.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function _s(e){const t=e.split(".");if(3!==t.length)throw new ts("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!Br.test(t[r]))throw new ts("JWT not in base64url format");return{header:JSON.parse(is(t[0])),payload:JSON.parse(is(t[1])),signature:cs(t[2]),raw:{header:t[0],payload:t[1]}}}function bs(e){return("0"+e.toString(16)).substr(-2)}async function ks(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Es(e,t,r=!1){const s=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,bs).join("")}();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await ms(e,`${t}-code-verifier`,n);const a=await ks(s);return[a,s===a?"plain":"s256"]}ws.promiseConstructor=Promise;const Ss=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Ts=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Os(e){if(!Ts.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}const Ps=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),js=[502,503,504];async function As(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new Xr(Ps(e),0);if(js.includes(e.status))throw new Xr(Ps(e),e.status);let s,n;try{s=await e.json()}catch(o){throw new zr(Ps(o),o)}const a=function(e){const t=e.headers.get(Nr);if(!t)return null;if(!t.match(Ss))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(o){return null}}(e);if(a&&a.getTime()>=Mr.timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?n=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(n=s.error_code),n){if("weak_password"===n)throw new es(Ps(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new Jr}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new es(Ps(s),e.status,s.weak_password.reasons);throw new Gr(Ps(s),e.status||500,n)}async function Is(e,t,r,s){var n;const a=Object.assign({},null==s?void 0:s.headers);a[Nr]||(a[Nr]=Mr.name),(null==s?void 0:s.jwt)&&(a.Authorization=`Bearer ${s.jwt}`);const o=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const i=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,r,s,n,a){const o=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,n,a);let i;try{i=await e(r,Object.assign({},o))}catch(l){throw console.error(l),new Xr(Ps(l),0)}i.ok||await As(i);if(null==s?void 0:s.noResolveJson)return i;try{return await i.json()}catch(l){await As(l)}}(e,t,r+i,{headers:a,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function Cs(e){var t;let r=null;var s;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Rs(e){const t=Cs(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function $s(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Ls(e){return{data:e,error:null}}function xs(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a}=e,o=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a},user:Object.assign({},o)},error:null}}function Us(e){return e}const Ds=["global","local","others"];class qs{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=gs(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Ds[0]){if(Ds.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ds.join(", ")}`);try{return await Is(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Vr(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await Is(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:$s})}catch(r){if(Vr(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await Is(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:xs,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Vr(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Is(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$s})}catch(t){if(Vr(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,a,o,i;try{const l={nextPage:null,lastPage:0,total:0},c=await Is(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:Us});if(c.error)throw c.error;const u=await c.json(),h=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,d=null!==(i=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==i?i:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Vr(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Os(e);try{return await Is(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$s})}catch(t){if(Vr(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Os(e);try{return await Is(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:$s})}catch(r){if(Vr(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Os(e);try{return await Is(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:$s})}catch(r){if(Vr(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Os(e.userId);try{const{data:t,error:r}=await Is(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(Vr(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Os(e.userId),Os(e.id);try{return{data:await Is(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Vr(t))return{data:null,error:t};throw t}}}const Ns={getItem:e=>ps()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{ps()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{ps()&&globalThis.localStorage.removeItem(e)}};function Ms(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Bs=!!(globalThis&&ps()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Fs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Vs extends Fs{}async function Gs(e,t,r){Bs&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),Bs&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(!s){if(0===t)throw Bs&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Vs(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Bs)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}Bs&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{Bs&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const zs={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:qr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ws(e,t,r){return await r()}class Js{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Js.nextInstanceID,Js.nextInstanceID+=1,this.instanceID>0&&ds()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},zs),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new qs({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=gs(s.fetch),this.lock=s.lock||Ws,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ds()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Gs:this.lock=Ws,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:ps()?this.storage=Ns:(this.memoryStorage={},this.storage=Ms(this.memoryStorage)):(this.memoryStorage={},this.storage=Ms(this.memoryStorage)),ds()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${xr}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(s){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),ds()&&this.detectSessionInUrl&&"none"!==r){const{data:s,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),function(e){return Vr(e)&&"AuthImplicitGrantRedirectError"===e.name}(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Vr(t)?{error:t}:{error:new zr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const n=await Is(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:Cs}),{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const i=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(n){if(Vr(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,s;try{let n;if("email"in e){const{email:r,password:s,options:a}=e;let o=null,i=null;"pkce"===this.flowType&&([o,i]=await Es(this.storage,this.storageKey)),n=await Is(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==a?void 0:a.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:o,code_challenge_method:i},xform:Cs})}else{if(!("phone"in e))throw new Kr("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:o}=e;n=await Is(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:a,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:Cs})}}const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const i=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(n){if(Vr(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:s,options:n}=e;t=await Is(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Rs})}else{if(!("phone"in e))throw new Kr("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await Is(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Rs})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s}):{data:{user:null,session:null},error:new Hr}}catch(t){if(Vr(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,n,a,o,i,l,c,u,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:h,wallet:d,statement:g,options:m}=e;let v;if(ds())if("object"==typeof d)v=d;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!=typeof d||!(null==m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=d}const y=new URL(null!==(t=null==m?void 0:m.url)&&void 0!==t?t:window.location.href);if("signIn"in v&&v.signIn){const e=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==m?void 0:m.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in v&&"function"==typeof v.signMessage&&"publicKey"in v&&"object"==typeof v&&v.publicKey&&"toBase58"in v.publicKey&&"function"==typeof v.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${y.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${y.href}`,`Issued At: ${null!==(s=null===(r=null==m?void 0:m.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==s?s:(new Date).toISOString()}`,...(null===(n=null==m?void 0:m.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...(null===(a=null==m?void 0:m.signInWithSolana)||void 0===a?void 0:a.expirationTime)?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...(null===(o=null==m?void 0:m.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...(null===(i=null==m?void 0:m.signInWithSolana)||void 0===i?void 0:i.nonce)?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...(null===(l=null==m?void 0:m.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==m?void 0:m.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...m.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await v.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:r}=await Is(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:hs(p)},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Cs});if(r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:r}):{data:{user:null,session:null},error:new Hr}}catch(g){if(Vr(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await vs(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{const{data:t,error:n}=await Is(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Cs});if(await ys(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new Hr}}catch(n){if(Vr(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:a}=e,o=await Is(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Cs}),{data:i,error:l}=o;return l?{data:{user:null,session:null},error:l}:i&&i.session&&i.user?(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:i,error:l}):{data:{user:null,session:null},error:new Hr}}catch(t){if(Vr(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,a;try{if("email"in e){const{email:s,options:n}=e;let a=null,o=null;"pkce"===this.flowType&&([a,o]=await Es(this.storage,this.storageKey));const{error:i}=await Is(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:i}=await Is(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(a=null==r?void 0:r.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:i}}throw new Kr("You must provide either an email or phone number.")}catch(o){if(Vr(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:a,error:o}=await Is(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:Cs});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const i=a.session,l=a.user;return(null==i?void 0:i.access_token)&&(await this._saveSession(i),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",i)),{data:{user:l,session:i},error:null}}catch(s){if(Vr(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let n=null,a=null;return"pkce"===this.flowType&&([n,a]=await Es(this.storage,this.storageKey)),await Is(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:Ls})}catch(n){if(Vr(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Jr;const{error:s}=await Is(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Vr(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:a}=await Is(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:a,error:o}=await Is(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o}}throw new Kr("You must provide either an email or phone number and a type")}catch(t){if(Vr(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await vs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<Dr;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,r,s)=>(t||"user"!==r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,r,s))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Is(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$s}):await this._useSession(async e=>{var t,r,s;const{data:n,error:a}=e;if(a)throw a;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Is(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0,xform:$s}):{data:{user:null},error:new Jr}})}catch(t){if(Vr(t))return function(e){return Vr(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await ys(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new Jr;const a=s.session;let o=null,i=null;"pkce"===this.flowType&&null!=e.email&&([o,i]=await Es(this.storage,this.storageKey));const{data:l,error:c}=await Is(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:i}),jwt:a.access_token,xform:$s});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(Vr(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Jr;const t=Date.now()/1e3;let r=t,s=!0,n=null;const{payload:a}=_s(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:a}=await this._getUser(e.access_token);if(a)throw a;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(Vr(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new Jr;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Vr(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ds())throw new Qr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Qr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Yr("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Qr("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Yr("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:a,expires_in:o,expires_at:i,token_type:l}=e;if(!(n&&o&&a&&l))throw new Qr("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(o);let h=c+u;i&&(h=parseInt(i));const d=h-c;1e3*d<=Ur&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${u}s`);const f=h-u;c-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,h,c):c-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,h,c);const{data:p,error:g}=await this._getUser(n);if(g)throw g;const m={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:u,expires_at:h,refresh_token:a,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(r){if(Vr(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await vs(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const a=null===(r=s.session)||void 0===r?void 0:r.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return Vr(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await ys(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(n){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await Es(this.storage,this.storageKey,!0));try{return await Is(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(Vr(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Vr(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async t=>{var r,s,n,a,o;const{data:i,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await Is(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(a=i.session)||void 0===a?void 0:a.access_token)&&void 0!==o?o:void 0})});if(s)throw s;return ds()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:e.provider,url:null==r?void 0:r.url},error:null}}catch(r){if(Vr(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:a}=t;if(a)throw a;return await Is(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})})}catch(t){if(Vr(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Is(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Cs})),s=(e,t)=>{const r=200*Math.pow(2,e);return t&&Zr(t)&&Date.now()+r-n<Ur},new Promise((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{const t=await r(a);if(!s(a,null,t))return void e(t)}catch(n){if(!s(a,n))return void t(n)}})()}))}catch(n){if(this._debug(t,"error",n),Vr(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ds()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await vs(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r))return this._debug(t,"session is not valid"),void(null!==r&&await this._removeSession());const s=1e3*(null!==(e=r.expires_at)&&void 0!==e?e:1/0)-Date.now()<Dr;if(this._debug(t,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),Zr(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){return this._debug(t,"error",r),void console.error(r)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Jr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new ws;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new Jr;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(n){if(this._debug(s,"error",n),Vr(n)){const e={session:null,error:n};return Zr(n)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(n){s.push(n)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ms(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await ys(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ds()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ur);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-t)/Ur);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Fs))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ds()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await Es(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Is(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Vr(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:i,error:l}=await Is(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(s=null==i?void 0:i.totp)||void 0===s?void 0:s.qr_code)&&(i.totp.qr_code=`data:image/svg+xml;utf-8,${i.totp.qr_code}`),{data:i,error:null})})}catch(t){if(Vr(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await Is(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(Vr(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Is(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Vr(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status),n=r.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=_s(s.access_token);let o=null;a.aal&&(o=a.aal);let i=o;(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(i="aal2");return{data:{currentLevel:o,nextLevel:i,currentAuthenticationMethods:a.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;if(r=this.jwks.keys.find(t=>t.kid===e),r&&this.jwks_cached_at+6e5>Date.now())return r;const{data:s,error:n}=await Is(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!s.keys||0===s.keys.length)throw new ts("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(t=>t.kid===e),!r)throw new ts("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};r=e.session.access_token}const{header:s,payload:n,signature:a,raw:{header:o,payload:i}}=_s(r);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp),!s.kid||"HS256"===s.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:n,header:s,signature:a},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(s.alg),c=await this.fetchJwk(s.kid,t),u=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,u,a,us(`${o}.${i}`))))throw new ts("Invalid JWT signature");return{data:{claims:n,header:s,signature:a},error:null}}catch(r){if(Vr(r))return{data:null,error:r};throw r}}}Js.nextInstanceID=0;const Hs=Js;class Ks extends Hs{constructor(e){super(e)}}var Qs=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function o(e){try{l(s.next(e))}catch(t){a(t)}}function i(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((s=s.apply(e,t||[])).next())})};class Ys{constructor(e,t,r){var s,n,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=(i=e).endsWith("/")?i:i+"/";var i;const l=new URL(o);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u=function(e,t){var r,s;const{db:n,auth:a,realtime:o,global:i}=e,{db:l,auth:c,realtime:u,global:h}=t,d={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),a),realtime:Object.assign(Object.assign({},u),o),global:Object.assign(Object.assign(Object.assign({},h),i),{headers:Object.assign(Object.assign({},null!==(r=null==h?void 0:h.headers)&&void 0!==r?r:{}),null!==(s=null==i?void 0:i.headers)&&void 0!==s?s:{})}),accessToken:()=>Lr(this,void 0,void 0,function*(){return""})};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:Ar,realtime:Cr,auth:Object.assign(Object.assign({},Ir),{storageKey:c}),global:jr});this.storageKey=null!==(s=u.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(n=u.global.headers)&&void 0!==n?n:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(a=u.auth)&&void 0!==a?a:{},this.headers,u.global.fetch),this.fetch=$r(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new mt(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Te(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Or(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Qs(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:a,lock:o,debug:i},l,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ks({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,lock:o,debug:i,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new nr(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=r}}const Xs=new Ys("https://fytiwsutzgmygfxnqoft.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ5dGl3c3V0emdteWdmeG5xb2Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4MDM1ODcsImV4cCI6MjA2NjM3OTU4N30.LM9vazR9QCZ4vLC_Q1lJmtCj3pEVqM6vpW4TKzntAQA",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});const Zs={TOOLS:"tools",CATEGORIES:"categories",PRODUCTS:"products",PRODUCT_CATEGORIES:"product_categories",USERS:"users",USER_PROFILES:"user_profiles",FAVORITES:"favorites",ORDERS:"orders",ORDER_ITEMS:"order_items",PAYMENTS:"payments",REVIEWS:"reviews",TAGS:"tags",TOOL_TAGS:"tool_tags",ANALYTICS:"analytics"},en=e=>(console.error("Supabase Error:",e),(null==e?void 0:e.message)?e.message:(null==e?void 0:e.error_description)?e.error_description:"æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");class tn{static async getCurrentUser(){try{const{data:{user:e}}=await Xs.auth.getUser();if(!e)return null;const{data:t,error:r}=await Xs.from("user_profiles").select("*").eq("id",e.id).single();if(r){if("PGRST116"===r.code)return this.createUserProfile(e.id,e.email);throw r}return this.transformUser(t)}catch(e){return console.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",e),null}}static async getUserProfile(e){try{const{data:t,error:r}=await Xs.from("user_profiles").select("*").eq("id",e).single();if(r)throw r;return t?this.transformUser(t):null}catch(t){return console.error("è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:",t),null}}static async updateProfile(e,t){try{const r={full_name:t.fullName,username:t.username,bio:t.bio,website:t.website,location:t.location,updated_at:(new Date).toISOString()};if(t.avatar){const s=await this.uploadAvatar(e,t.avatar);r.avatar_url=s}const{data:s,error:n}=await Xs.from("user_profiles").update(r).eq("id",e).select("*").single();if(n)throw n;if(!s)throw new Error("æ›´æ–°ç”¨æˆ·èµ„æ–™å¤±è´¥");return this.transformUser(s)}catch(r){throw console.error("æ›´æ–°ç”¨æˆ·èµ„æ–™å¤±è´¥:",r),new Error("æ›´æ–°ç”¨æˆ·èµ„æ–™å¤±è´¥")}}static async createUserProfile(e,t){try{const r={id:e,email:t,role:"user",is_active:!0,email_verified:!1},{data:s,error:n}=await Xs.from("user_profiles").insert(r).select("*").single();if(n)throw n;if(!s)throw new Error("åˆ›å»ºç”¨æˆ·èµ„æ–™å¤±è´¥");return this.transformUser(s)}catch(r){throw console.error("åˆ›å»ºç”¨æˆ·èµ„æ–™å¤±è´¥:",r),new Error("åˆ›å»ºç”¨æˆ·èµ„æ–™å¤±è´¥")}}static async uploadAvatar(e,t){try{const r=t.name.split(".").pop(),s=`avatars/${`${e}-${Date.now()}.${r}`}`,{data:n}=await Xs.storage.from("avatars").list("",{search:e});if(n&&n.length>0){const e=n.map(e=>e.name);await Xs.storage.from("avatars").remove(e)}const{error:a}=await Xs.storage.from("avatars").upload(s,t);if(a)throw a;const{data:o}=Xs.storage.from("avatars").getPublicUrl(s);return o.publicUrl}catch(r){throw console.error("ä¸Šä¼ å¤´åƒå¤±è´¥:",r),new Error("ä¸Šä¼ å¤´åƒå¤±è´¥")}}static async updateLastLogin(e){try{const{error:t}=await Xs.from("user_profiles").update({last_login_at:(new Date).toISOString()}).eq("id",e);if(t)throw t}catch(t){console.error("æ›´æ–°æœ€åç™»å½•æ—¶é—´å¤±è´¥:",t)}}static async checkUsernameAvailability(e,t){try{let r=Xs.from("user_profiles").select("id").eq("username",e);t&&(r=r.neq("id",t));const{data:s,error:n}=await r;if(n)throw n;return!s||0===s.length}catch(r){return console.error("æ£€æŸ¥ç”¨æˆ·åå¯ç”¨æ€§å¤±è´¥:",r),!1}}static async getUserStats(e){try{const[t,r]=await Promise.all([Xs.from("favorites").select("tool_id, product_id").eq("user_id",e),Xs.from("orders").select("total_amount, status").eq("user_id",e)]),s=t.data||[],n=r.data||[],a=s.filter(e=>e.tool_id).length,o=s.filter(e=>e.product_id).length,i=n.length;return{favoriteToolsCount:a,favoriteProductsCount:o,ordersCount:i,totalSpent:n.filter(e=>"paid"===e.status).reduce((e,t)=>e+t.total_amount,0)}}catch(t){return console.error("è·å–ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:",t),{favoriteToolsCount:0,favoriteProductsCount:0,ordersCount:0,totalSpent:0}}}static async deleteAccount(e){try{await Promise.all([Xs.from("favorites").delete().eq("user_id",e),Xs.from("orders").delete().eq("user_id",e),Xs.from("user_profiles").delete().eq("id",e)]);const{error:t}=await Xs.auth.admin.deleteUser(e);if(t)throw t}catch(t){throw console.error("åˆ é™¤ç”¨æˆ·è´¦æˆ·å¤±è´¥:",t),new Error("åˆ é™¤ç”¨æˆ·è´¦æˆ·å¤±è´¥")}}static transformUser(e){return{id:e.id,email:e.email,username:e.username,fullName:e.full_name,avatarUrl:e.avatar_url,bio:e.bio,website:e.website,location:e.location,role:e.role,isActive:e.is_active,emailVerified:e.email_verified,createdAt:e.created_at,updatedAt:e.updated_at,lastLoginAt:e.last_login_at}}}class rn{static async login(e){try{const{data:t,error:r}=await Xs.auth.signInWithPassword({email:e.email,password:e.password});if(r)throw r;if(!t.user)throw new Error("ç™»å½•å¤±è´¥");await tn.updateLastLogin(t.user.id);const s=await tn.getCurrentUser();if(!s)throw new Error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥");return{user:s,session:t.session}}catch(t){throw console.error("ç™»å½•å¤±è´¥:",t),new Error(t instanceof Error?t.message:"ç™»å½•å¤±è´¥")}}static async register(e){try{if(e.username){if(!(await tn.checkUsernameAvailability(e.username)))throw new Error("ç”¨æˆ·åå·²è¢«ä½¿ç”¨")}const{data:t,error:r}=await Xs.auth.signUp({email:e.email,password:e.password,options:{data:{full_name:e.fullName,username:e.username}}});if(r)throw r;if(!t.user)throw new Error("æ³¨å†Œå¤±è´¥");const s=await tn.createUserProfile(t.user.id,e.email);if(e.fullName||e.username){return{user:await tn.updateProfile(t.user.id,{fullName:e.fullName,username:e.username}),session:t.session}}return{user:s,session:t.session}}catch(t){throw console.error("æ³¨å†Œå¤±è´¥:",t),new Error(t instanceof Error?t.message:"æ³¨å†Œå¤±è´¥")}}static async logout(){try{const{error:e}=await Xs.auth.signOut();if(e)throw e}catch(e){throw console.error("ç™»å‡ºå¤±è´¥:",e),new Error("ç™»å‡ºå¤±è´¥")}}static async forgotPassword(e){try{const{error:t}=await Xs.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/auth/reset-password`});if(t)throw t}catch(t){throw console.error("å‘é€é‡ç½®å¯†ç é‚®ä»¶å¤±è´¥:",t),new Error("å‘é€é‡ç½®å¯†ç é‚®ä»¶å¤±è´¥")}}static async resetPassword(e){try{const{error:t}=await Xs.auth.updateUser({password:e});if(t)throw t}catch(t){throw console.error("é‡ç½®å¯†ç å¤±è´¥:",t),new Error("é‡ç½®å¯†ç å¤±è´¥")}}static async changePassword(e){try{const{error:t}=await Xs.auth.updateUser({password:e});if(t)throw t}catch(t){throw console.error("æ›´æ”¹å¯†ç å¤±è´¥:",t),new Error("æ›´æ”¹å¯†ç å¤±è´¥")}}static async updateEmail(e){try{const{error:t}=await Xs.auth.updateUser({email:e});if(t)throw t}catch(t){throw console.error("æ›´æ–°é‚®ç®±å¤±è´¥:",t),new Error("æ›´æ–°é‚®ç®±å¤±è´¥")}}static async verifyEmail(e,t){try{const{error:r}=await Xs.auth.verifyOtp({token_hash:e,type:t});if(r)throw r}catch(r){throw console.error("éªŒè¯é‚®ç®±å¤±è´¥:",r),new Error("éªŒè¯é‚®ç®±å¤±è´¥")}}static async resendVerificationEmail(){try{const{data:{user:e}}=await Xs.auth.getUser();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");const{error:t}=await Xs.auth.resend({type:"signup",email:e.email});if(t)throw t}catch(e){throw console.error("é‡æ–°å‘é€éªŒè¯é‚®ä»¶å¤±è´¥:",e),new Error("é‡æ–°å‘é€éªŒè¯é‚®ä»¶å¤±è´¥")}}static async getSession(){try{const{data:{session:e}}=await Xs.auth.getSession();return e}catch(e){return console.error("è·å–ä¼šè¯å¤±è´¥:",e),null}}static async refreshSession(){try{const{data:e,error:t}=await Xs.auth.refreshSession();if(t)throw t;return e.session}catch(e){throw console.error("åˆ·æ–°ä¼šè¯å¤±è´¥:",e),new Error("åˆ·æ–°ä¼šè¯å¤±è´¥")}}static async isAuthenticated(){try{const{data:{user:e}}=await Xs.auth.getUser();return!!e}catch(e){return!1}}static onAuthStateChange(e){return Xs.auth.onAuthStateChange(e)}static async signInWithGoogle(){try{const{error:e}=await Xs.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(e)throw e}catch(e){throw console.error("Google ç™»å½•å¤±è´¥:",e),new Error("Google ç™»å½•å¤±è´¥")}}static async signInWithGitHub(){try{const{error:e}=await Xs.auth.signInWithOAuth({provider:"github",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(e)throw e}catch(e){throw console.error("GitHub ç™»å½•å¤±è´¥:",e),new Error("GitHub ç™»å½•å¤±è´¥")}}static async deleteAccount(){try{const{data:{user:e}}=await Xs.auth.getUser();if(!e)throw new Error("ç”¨æˆ·æœªç™»å½•");await tn.deleteAccount(e.id)}catch(e){throw console.error("åˆ é™¤è´¦æˆ·å¤±è´¥:",e),new Error("åˆ é™¤è´¦æˆ·å¤±è´¥")}}}const sn=b("auth",()=>{const e=v(null),t=v(null),r=v(!1),s=v(null),n=v(!1),a=k(()=>!!e.value&&!!t.value),o=k(()=>{var t,r;return"admin"===(null==(t=e.value)?void 0:t.role)||"super_admin"===(null==(r=e.value)?void 0:r.role)}),i=k(()=>{var t;return(null==(t=e.value)?void 0:t.fullName)?e.value.fullName.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2):"U"}),l=async()=>{try{const r=await tn.getCurrentUser(),s=await rn.getSession();return r&&s?(e.value=r,t.value=s,!0):(e.value=null,t.value=null,!1)}catch(r){return console.error("æ£€æŸ¥è®¤è¯çŠ¶æ€å¤±è´¥:",r),e.value=null,t.value=null,!1}},c=()=>{if(!a.value)throw new Error("éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®")};return{user:e,session:t,loading:r,error:s,initialized:n,isAuthenticated:a,isAdmin:o,userInitials:i,login:async n=>{try{r.value=!0,s.value=null;const a=await rn.login(n);return e.value=a.user,t.value=a.session,a}catch(a){throw s.value=a instanceof Error?a.message:"ç™»å½•å¤±è´¥",a}finally{r.value=!1}},register:async n=>{try{r.value=!0,s.value=null;const a=await rn.register(n);return e.value=a.user,t.value=a.session,a}catch(a){throw s.value=a instanceof Error?a.message:"æ³¨å†Œå¤±è´¥",a}finally{r.value=!1}},logout:async()=>{try{r.value=!0,s.value=null,await rn.logout(),e.value=null,t.value=null}catch(n){throw s.value=n instanceof Error?n.message:"ç™»å‡ºå¤±è´¥",n}finally{r.value=!1}},forgotPassword:async e=>{try{r.value=!0,s.value=null,await rn.forgotPassword(e)}catch(t){throw s.value=t instanceof Error?t.message:"å‘é€é‡ç½®é‚®ä»¶å¤±è´¥",t}finally{r.value=!1}},resetPassword:async e=>{try{r.value=!0,s.value=null,await rn.resetPassword(e)}catch(t){throw s.value=t instanceof Error?t.message:"é‡ç½®å¯†ç å¤±è´¥",t}finally{r.value=!1}},updateProfile:async t=>{try{if(r.value=!0,s.value=null,!e.value)throw new Error("ç”¨æˆ·æœªç™»å½•");const n=await tn.updateProfile(e.value.id,t);return e.value=n,n}catch(n){throw s.value=n instanceof Error?n.message:"æ›´æ–°èµ„æ–™å¤±è´¥",n}finally{r.value=!1}},refreshSession:async()=>{try{const e=await rn.refreshSession();return t.value=e,e}catch(r){throw console.error("åˆ·æ–°ä¼šè¯å¤±è´¥:",r),e.value=null,t.value=null,r}},checkAuth:l,initialize:async()=>{if(!n.value)try{r.value=!0,await l(),rn.onAuthStateChange((t,r)=>{"SIGNED_IN"===t?l():"SIGNED_OUT"===t?(e.value=null,r.value=null):"TOKEN_REFRESHED"===t&&(r.value=r)}),n.value=!0}catch(t){console.error("åˆå§‹åŒ–è®¤è¯çŠ¶æ€å¤±è´¥:",t)}finally{r.value=!1}},clearError:()=>{s.value=null},requireAuth:c,requireAdmin:()=>{if(c(),!o.value)throw new Error("éœ€è¦ç®¡ç†å‘˜æƒé™")}}}),nn={class:"feedback-widget"},an={key:0,class:"feedback-badge"},on={key:1,class:"feedback-panel"},ln={class:"panel-header"},cn={class:"panel-tabs"},un=["onClick"],hn={class:"panel-content"},dn={key:0,class:"submit-feedback"},fn={class:"form-group"},pn={class:"form-group"},gn={class:"form-group"},mn={class:"form-group"},vn={class:"form-group"},yn={class:"form-label"},wn={class:"form-actions"},_n=["disabled"],bn={key:1,class:"feedback-history"},kn={key:0,class:"loading-state"},En={key:1,class:"empty-state"},Sn={key:2,class:"feedback-list"},Tn={class:"feedback-header"},On={class:"feedback-date"},Pn={class:"feedback-title"},jn={class:"feedback-content"},An={key:0,class:"feedback-response"},In={class:"response-date"},Cn={key:2,class:"feedback-stats"},Rn={class:"stats-grid"},$n={class:"stat-card"},Ln={class:"stat-number"},xn={class:"stat-card"},Un={class:"stat-number"},Dn={class:"stat-card"},qn={class:"stat-number"},Nn={class:"stat-card"},Mn={class:"stat-number"},Bn={class:"stats-charts"},Fn={class:"chart-section"},Vn={class:"type-distribution"},Gn={class:"type-label"},zn={class:"type-bar"},Wn={class:"type-count"},Jn={key:2,class:"success-message"},Hn=he(e({__name:"FeedbackWidget",setup(e){const i=sn(),l=v(!1),c=v("submit"),u=v(!1),h=v(!1),d=v(!1),f=E({type:"",title:"",content:"",priority:"medium",includeSystemInfo:!0}),p=v([]),w=v({total:0,pending:0,resolved:0,response_rate:0,by_type:{}}),b=[{id:"submit",label:"æäº¤åé¦ˆ"},{id:"history",label:"åé¦ˆå†å²"},{id:"stats",label:"åé¦ˆç»Ÿè®¡"}],U=k(()=>p.value.filter(e=>!e.is_read).length),D=()=>{l.value=!l.value,l.value&&"history"===c.value&&N()},q=async()=>{if(i.user)try{h.value=!0;const e={...f,user_id:i.user.id,system_info:f.includeSystemInfo?M():null};console.log("æäº¤åé¦ˆ:",e),await new Promise(e=>setTimeout(e,1e3)),Object.assign(f,{type:"",title:"",content:"",priority:"medium",includeSystemInfo:!0}),d.value=!0,setTimeout(()=>{d.value=!1},3e3),l.value=!1}catch(e){console.error("æäº¤åé¦ˆå¤±è´¥:",e),alert("æäº¤åé¦ˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{h.value=!1}else alert("è¯·å…ˆç™»å½•åå†æäº¤åé¦ˆ")},N=async()=>{if(i.user)try{u.value=!0,console.log("åŠ è½½åé¦ˆå†å²"),p.value=[{id:"1",type:"feature",title:"å¸Œæœ›å¢åŠ æš—è‰²ä¸»é¢˜",content:"å»ºè®®å¢åŠ æš—è‰²ä¸»é¢˜é€‰é¡¹ï¼Œæ–¹ä¾¿å¤œé—´ä½¿ç”¨",priority:"medium",status:"resolved",response:"æ„Ÿè°¢æ‚¨çš„å»ºè®®ï¼æš—è‰²ä¸»é¢˜åŠŸèƒ½å·²ç»åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ä¸Šçº¿ã€‚",response_at:"2024-12-25T10:00:00Z",is_read:!0,created_at:"2024-12-24T15:30:00Z"}],w.value={total:5,pending:2,resolved:3,response_rate:80,by_type:{bug:2,feature:2,improvement:1}}}catch(e){console.error("åŠ è½½åé¦ˆå†å²å¤±è´¥:",e)}finally{u.value=!1}},M=()=>({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,screenResolution:`${screen.width}x${screen.height}`,timestamp:(new Date).toISOString()}),B=e=>({bug:"Bug æŠ¥å‘Š",feature:"åŠŸèƒ½å»ºè®®",improvement:"æ”¹è¿›å»ºè®®",question:"é—®é¢˜å’¨è¯¢",other:"å…¶ä»–"}[e]||e),F=e=>new Date(e).toLocaleString("zh-CN");return y(()=>{i.user&&N()}),(e,i)=>(m(),t("div",nn,[l.value?S("",!0):(m(),t("button",{key:0,onClick:D,class:T(["feedback-button",{"has-feedback":U.value>0}]),title:"ç”¨æˆ·åé¦ˆ"},[n(a(o),{class:"icon"}),U.value>0?(m(),t("span",an,_(U.value),1)):S("",!0)],2)),l.value?(m(),t("div",on,[r("div",ln,[i[5]||(i[5]=r("h3",{class:"panel-title"},"ç”¨æˆ·åé¦ˆ",-1)),r("button",{onClick:D,class:"close-button"},[n(a(O),{class:"icon"})])]),r("div",cn,[(m(),t(P,null,j(b,e=>r("button",{key:e.id,onClick:t=>c.value=e.id,class:T(["tab-button",{active:c.value===e.id}])},_(e.label),11,un)),64))]),r("div",hn,["submit"===c.value?(m(),t("div",dn,[r("form",{onSubmit:A(q,["prevent"]),class:"feedback-form"},[r("div",fn,[i[7]||(i[7]=r("label",{for:"feedback-type",class:"form-label"},"åé¦ˆç±»å‹",-1)),I(r("select",{id:"feedback-type","onUpdate:modelValue":i[0]||(i[0]=e=>f.type=e),class:"form-select",required:""},i[6]||(i[6]=[s('<option value="" data-v-5862e757>è¯·é€‰æ‹©åé¦ˆç±»å‹</option><option value="bug" data-v-5862e757>Bug æŠ¥å‘Š</option><option value="feature" data-v-5862e757>åŠŸèƒ½å»ºè®®</option><option value="improvement" data-v-5862e757>æ”¹è¿›å»ºè®®</option><option value="question" data-v-5862e757>é—®é¢˜å’¨è¯¢</option><option value="other" data-v-5862e757>å…¶ä»–</option>',6)]),512),[[C,f.type]])]),r("div",pn,[i[8]||(i[8]=r("label",{for:"feedback-title",class:"form-label"},"æ ‡é¢˜",-1)),I(r("input",{id:"feedback-title","onUpdate:modelValue":i[1]||(i[1]=e=>f.title=e),type:"text",class:"form-input",placeholder:"ç®€è¦æè¿°æ‚¨çš„åé¦ˆ",required:""},null,512),[[R,f.title]])]),r("div",gn,[i[9]||(i[9]=r("label",{for:"feedback-content",class:"form-label"},"è¯¦ç»†æè¿°",-1)),I(r("textarea",{id:"feedback-content","onUpdate:modelValue":i[2]||(i[2]=e=>f.content=e),class:"form-textarea",rows:"4",placeholder:"è¯·è¯¦ç»†æè¿°æ‚¨çš„åé¦ˆå†…å®¹",required:""},null,512),[[R,f.content]])]),r("div",mn,[i[11]||(i[11]=r("label",{for:"feedback-priority",class:"form-label"},"ä¼˜å…ˆçº§",-1)),I(r("select",{id:"feedback-priority","onUpdate:modelValue":i[3]||(i[3]=e=>f.priority=e),class:"form-select"},i[10]||(i[10]=[r("option",{value:"low"},"ä½",-1),r("option",{value:"medium"},"ä¸­",-1),r("option",{value:"high"},"é«˜",-1),r("option",{value:"urgent"},"ç´§æ€¥",-1)]),512),[[C,f.priority]])]),r("div",vn,[r("label",yn,[I(r("input",{"onUpdate:modelValue":i[4]||(i[4]=e=>f.includeSystemInfo=e),type:"checkbox",class:"form-checkbox"},null,512),[[$,f.includeSystemInfo]]),i[12]||(i[12]=g(" åŒ…å«ç³»ç»Ÿä¿¡æ¯ï¼ˆæµè§ˆå™¨ã€è®¾å¤‡ç­‰ï¼‰ "))])]),r("div",wn,[r("button",{type:"submit",disabled:h.value,class:"submit-button"},_(h.value?"æäº¤ä¸­...":"æäº¤åé¦ˆ"),9,_n)])],32)])):"history"===c.value?(m(),t("div",bn,[u.value?(m(),t("div",kn,i[13]||(i[13]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"åŠ è½½åé¦ˆå†å²...",-1)]))):0===p.value.length?(m(),t("div",En,[n(a(o),{class:"empty-icon"}),i[14]||(i[14]=r("p",null,"æš‚æ— åé¦ˆè®°å½•",-1))])):(m(),t("div",Sn,[(m(!0),t(P,null,j(p.value,e=>{return m(),t("div",{key:e.id,class:T(["feedback-item",{unread:!e.is_read}])},[r("div",Tn,[r("span",{class:T(["feedback-type",e.type])},_(B(e.type)),3),r("span",{class:T(["feedback-priority",e.priority])},_((s=e.priority,{low:"ä½",medium:"ä¸­",high:"é«˜",urgent:"ç´§æ€¥"}[s]||s)),3),r("span",On,_(F(e.created_at)),1)]),r("h4",Pn,_(e.title),1),r("p",jn,_(e.content),1),e.response?(m(),t("div",An,[i[15]||(i[15]=r("h5",null,"å¼€å‘è€…å›å¤ï¼š",-1)),r("p",null,_(e.response),1),r("span",In,_(F(e.response_at)),1)])):S("",!0)],2);var s}),128))]))])):"stats"===c.value?(m(),t("div",Cn,[r("div",Rn,[r("div",$n,[r("div",Ln,_(w.value.total),1),i[16]||(i[16]=r("div",{class:"stat-label"},"æ€»åé¦ˆæ•°",-1))]),r("div",xn,[r("div",Un,_(w.value.pending),1),i[17]||(i[17]=r("div",{class:"stat-label"},"å¾…å¤„ç†",-1))]),r("div",Dn,[r("div",qn,_(w.value.resolved),1),i[18]||(i[18]=r("div",{class:"stat-label"},"å·²è§£å†³",-1))]),r("div",Nn,[r("div",Mn,_(w.value.response_rate)+"%",1),i[19]||(i[19]=r("div",{class:"stat-label"},"å›å¤ç‡",-1))])]),r("div",Bn,[r("div",Fn,[i[20]||(i[20]=r("h4",null,"åé¦ˆç±»å‹åˆ†å¸ƒ",-1)),r("div",Vn,[(m(!0),t(P,null,j(w.value.by_type,(e,s)=>(m(),t("div",{key:s,class:"type-item"},[r("span",Gn,_(B(s)),1),r("div",zn,[r("div",{class:"type-fill",style:x({width:e/w.value.total*100+"%"})},null,4)]),r("span",Wn,_(e),1)]))),128))])])])])):S("",!0)])])):S("",!0),d.value?(m(),t("div",Jn,[n(a(L),{class:"success-icon"}),i[21]||(i[21]=r("span",null,"åé¦ˆæäº¤æˆåŠŸï¼æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†æ‚¨çš„åé¦ˆã€‚",-1))])):S("",!0)]))}}),[["__scopeId","data-v-5862e757"]]),Kn={id:"app"},Qn={key:0,class:"global-error"},Yn={class:"error-content"},Xn={class:"error-message"},Zn=he(e({__name:"App",setup(e){const s=v(null),o=()=>{s.value=null};return U((e,t,r)=>(console.error("å…¨å±€é”™è¯¯:",e,r),s.value=e instanceof Error?e.message:"å‘ç”ŸæœªçŸ¥é”™è¯¯",!1)),y(()=>{window.addEventListener("error",e=>{var t;console.error("é¡µé¢åŠ è½½é”™è¯¯:",e.error),s.value=(null==(t=e.error)?void 0:t.message)||"é¡µé¢åŠ è½½å¤±è´¥"}),window.addEventListener("offline",()=>{s.value="ç½‘ç»œè¿æ¥å·²æ–­å¼€"})}),(e,i)=>{const l=u("RouterView");return m(),t("div",Kn,[s.value?(m(),t("div",Qn,[r("div",Yn,[r("span",Xn,_(s.value),1),r("button",{class:"error-close",onClick:o},"Ã—")])])):S("",!0),n(l,null,{default:h(({Component:e})=>[n(q,{name:"fade",mode:"out-in"},{default:h(()=>[(m(),D(N(e)))]),_:2},1024)]),_:1}),n(de),a(false)?(m(),D(ge,{key:1})):S("",!0),n(Hn)])}}}),[["__scopeId","data-v-6914bece"]]),ea="undefined"!=typeof document;function ta(e){return"object"==typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}const ra=Object.assign;function sa(e,t){const r={};for(const s in t){const n=t[s];r[s]=aa(n)?n.map(e):e(n)}return r}const na=()=>{},aa=Array.isArray,oa=/#/g,ia=/&/g,la=/\//g,ca=/=/g,ua=/\?/g,ha=/\+/g,da=/%5B/g,fa=/%5D/g,pa=/%5E/g,ga=/%60/g,ma=/%7B/g,va=/%7C/g,ya=/%7D/g,wa=/%20/g;function _a(e){return encodeURI(""+e).replace(va,"|").replace(da,"[").replace(fa,"]")}function ba(e){return _a(e).replace(ha,"%2B").replace(wa,"+").replace(oa,"%23").replace(ia,"%26").replace(ga,"`").replace(ma,"{").replace(ya,"}").replace(pa,"^")}function ka(e){return ba(e).replace(ca,"%3D")}function Ea(e){return null==e?"":function(e){return _a(e).replace(oa,"%23").replace(ua,"%3F")}(e).replace(la,"%2F")}function Sa(e){try{return decodeURIComponent(""+e)}catch(t){}return""+e}const Ta=/\/$/;function Oa(e,t,r="/"){let s,n={},a="",o="";const i=t.indexOf("#");let l=t.indexOf("?");return i<l&&i>=0&&(l=-1),l>-1&&(s=t.slice(0,l),a=t.slice(l+1,i>-1?i:t.length),n=e(a)),i>-1&&(s=s||t.slice(0,i),o=t.slice(i,t.length)),s=function(e,t){if(e.startsWith("/"))return e;if(!e)return t;const r=t.split("/"),s=e.split("/"),n=s[s.length-1];".."!==n&&"."!==n||s.push("");let a,o,i=r.length-1;for(a=0;a<s.length;a++)if(o=s[a],"."!==o){if(".."!==o)break;i>1&&i--}return r.slice(0,i).join("/")+"/"+s.slice(a).join("/")}(null!=s?s:t,r),{fullPath:s+(a&&"?")+a+o,path:s,query:n,hash:Sa(o)}}function Pa(e,t){return t&&e.toLowerCase().startsWith(t.toLowerCase())?e.slice(t.length)||"/":e}function ja(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function Aa(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!Ia(e[r],t[r]))return!1;return!0}function Ia(e,t){return aa(e)?Ca(e,t):aa(t)?Ca(t,e):e===t}function Ca(e,t){return aa(t)?e.length===t.length&&e.every((e,r)=>e===t[r]):1===e.length&&e[0]===t}const Ra={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var $a,La,xa,Ua;function Da(e){if(!e)if(ea){const t=document.querySelector("base");e=(e=t&&t.getAttribute("href")||"/").replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),e.replace(Ta,"")}(La=$a||($a={})).pop="pop",La.push="push",(Ua=xa||(xa={})).back="back",Ua.forward="forward",Ua.unknown="";const qa=/^[^#]+#/;function Na(e,t){return e.replace(qa,"#")+t}const Ma=()=>({left:window.scrollX,top:window.scrollY});function Ba(e){let t;if("el"in e){const r=e.el,s="string"==typeof r&&r.startsWith("#"),n="string"==typeof r?s?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!n)return;t=function(e,t){const r=document.documentElement.getBoundingClientRect(),s=e.getBoundingClientRect();return{behavior:t.behavior,left:s.left-r.left-(t.left||0),top:s.top-r.top-(t.top||0)}}(n,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.scrollX,null!=t.top?t.top:window.scrollY)}function Fa(e,t){return(history.state?history.state.position-t:-1)+e}const Va=new Map;function Ga(e,t){const{pathname:r,search:s,hash:n}=t,a=e.indexOf("#");if(a>-1){let t=n.includes(e.slice(a))?e.slice(a).length:1,r=n.slice(t);return"/"!==r[0]&&(r="/"+r),Pa(r,"")}return Pa(r,e)+s+n}function za(e,t,r,s=!1,n=!1){return{back:e,current:t,forward:r,replaced:s,position:window.history.length,scroll:n?Ma():null}}function Wa(e){const{history:t,location:r}=window,s={value:Ga(e,r)},n={value:t.state};function a(s,a,o){const i=e.indexOf("#"),l=i>-1?(r.host&&document.querySelector("base")?e:e.slice(i))+s:location.protocol+"//"+location.host+e+s;try{t[o?"replaceState":"pushState"](a,"",l),n.value=a}catch(c){console.error(c),r[o?"replace":"assign"](l)}}return n.value||a(s.value,{back:null,current:s.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:s,state:n,push:function(e,r){const o=ra({},n.value,t.state,{forward:e,scroll:Ma()});a(o.current,o,!0),a(e,ra({},za(s.value,e,null),{position:o.position+1},r),!1),s.value=e},replace:function(e,r){a(e,ra({},t.state,za(n.value.back,e,n.value.forward,!0),r,{position:n.value.position}),!0),s.value=e}}}function Ja(e){return"string"==typeof e||"symbol"==typeof e}const Ha=Symbol("");var Ka,Qa;function Ya(e,t){return ra(new Error,{type:e,[Ha]:!0},t)}function Xa(e,t){return e instanceof Error&&Ha in e&&(null==t||!!(e.type&t))}(Qa=Ka||(Ka={}))[Qa.aborted=4]="aborted",Qa[Qa.cancelled=8]="cancelled",Qa[Qa.duplicated=16]="duplicated";const Za="[^/]+?",eo={sensitive:!1,strict:!1,start:!0,end:!0},to=/[.+*?^${}()[\]/\\]/g;function ro(e,t){let r=0;for(;r<e.length&&r<t.length;){const s=t[r]-e[r];if(s)return s;r++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function so(e,t){let r=0;const s=e.score,n=t.score;for(;r<s.length&&r<n.length;){const e=ro(s[r],n[r]);if(e)return e;r++}if(1===Math.abs(n.length-s.length)){if(no(s))return 1;if(no(n))return-1}return n.length-s.length}function no(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const ao={type:0,value:""},oo=/[a-zA-Z0-9_]/;function io(e,t,r){const s=function(e,t){const r=ra({},eo,t),s=[];let n=r.start?"^":"";const a=[];for(const l of e){const e=l.length?[]:[90];r.strict&&!l.length&&(n+="/");for(let t=0;t<l.length;t++){const s=l[t];let o=40+(r.sensitive?.25:0);if(0===s.type)t||(n+="/"),n+=s.value.replace(to,"\\$&"),o+=40;else if(1===s.type){const{value:e,repeatable:r,optional:c,regexp:u}=s;a.push({name:e,repeatable:r,optional:c});const h=u||Za;if(h!==Za){o+=10;try{new RegExp(`(${h})`)}catch(i){throw new Error(`Invalid custom RegExp for param "${e}" (${h}): `+i.message)}}let d=r?`((?:${h})(?:/(?:${h}))*)`:`(${h})`;t||(d=c&&l.length<2?`(?:/${d})`:"/"+d),c&&(d+="?"),n+=d,o+=20,c&&(o+=-8),r&&(o+=-20),".*"===h&&(o+=-50)}e.push(o)}s.push(e)}if(r.strict&&r.end){const e=s.length-1;s[e][s[e].length-1]+=.7000000000000001}r.strict||(n+="/?"),r.end?n+="$":r.strict&&!n.endsWith("/")&&(n+="(?:/|$)");const o=new RegExp(n,r.sensitive?"":"i");return{re:o,score:s,keys:a,parse:function(e){const t=e.match(o),r={};if(!t)return null;for(let s=1;s<t.length;s++){const e=t[s]||"",n=a[s-1];r[n.name]=e&&n.repeatable?e.split("/"):e}return r},stringify:function(t){let r="",s=!1;for(const n of e){s&&r.endsWith("/")||(r+="/"),s=!1;for(const e of n)if(0===e.type)r+=e.value;else if(1===e.type){const{value:a,repeatable:o,optional:i}=e,l=a in t?t[a]:"";if(aa(l)&&!o)throw new Error(`Provided param "${a}" is an array but it is not repeatable (* or + modifiers)`);const c=aa(l)?l.join("/"):l;if(!c){if(!i)throw new Error(`Missing required param "${a}"`);n.length<2&&(r.endsWith("/")?r=r.slice(0,-1):s=!0)}r+=c}}return r||"/"}}}(function(e){if(!e)return[[]];if("/"===e)return[[ao]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(e){throw new Error(`ERR (${r})/"${c}": ${e}`)}let r=0,s=r;const n=[];let a;function o(){a&&n.push(a),a=[]}let i,l=0,c="",u="";function h(){c&&(0===r?a.push({type:0,value:c}):1===r||2===r||3===r?(a.length>1&&("*"===i||"+"===i)&&t(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),a.push({type:1,value:c,regexp:u,repeatable:"*"===i||"+"===i,optional:"*"===i||"?"===i})):t("Invalid state to consume buffer"),c="")}function d(){c+=i}for(;l<e.length;)if(i=e[l++],"\\"!==i||2===r)switch(r){case 0:"/"===i?(c&&h(),o()):":"===i?(h(),r=1):d();break;case 4:d(),r=s;break;case 1:"("===i?r=2:oo.test(i)?d():(h(),r=0,"*"!==i&&"?"!==i&&"+"!==i&&l--);break;case 2:")"===i?"\\"==u[u.length-1]?u=u.slice(0,-1)+i:r=3:u+=i;break;case 3:h(),r=0,"*"!==i&&"?"!==i&&"+"!==i&&l--,u="";break;default:t("Unknown state")}else s=r,r=4;return 2===r&&t(`Unfinished custom RegExp for param "${c}"`),h(),o(),n}(e.path),r),n=ra(s,{record:e,parent:t,children:[],alias:[]});return t&&!n.record.aliasOf==!t.record.aliasOf&&t.children.push(n),n}function lo(e,t){const r=[],s=new Map;function n(e,r,s){const i=!s,l=uo(e);l.aliasOf=s&&s.record;const c=go(t,e),u=[l];if("alias"in e){const t="string"==typeof e.alias?[e.alias]:e.alias;for(const e of t)u.push(uo(ra({},l,{components:s?s.record.components:l.components,path:e,aliasOf:s?s.record:l})))}let h,d;for(const t of u){const{path:u}=t;if(r&&"/"!==u[0]){const e=r.record.path,s="/"===e[e.length-1]?"":"/";t.path=r.record.path+(u&&s+u)}if(h=io(t,r,c),s?s.alias.push(h):(d=d||h,d!==h&&d.alias.push(h),i&&e.name&&!fo(h)&&a(e.name)),mo(h)&&o(h),l.children){const e=l.children;for(let t=0;t<e.length;t++)n(e[t],h,s&&s.children[t])}s=s||h}return d?()=>{a(d)}:na}function a(e){if(Ja(e)){const t=s.get(e);t&&(s.delete(e),r.splice(r.indexOf(t),1),t.children.forEach(a),t.alias.forEach(a))}else{const t=r.indexOf(e);t>-1&&(r.splice(t,1),e.record.name&&s.delete(e.record.name),e.children.forEach(a),e.alias.forEach(a))}}function o(e){const t=function(e,t){let r=0,s=t.length;for(;r!==s;){const n=r+s>>1;so(e,t[n])<0?s=n:r=n+1}const n=function(e){let t=e;for(;t=t.parent;)if(mo(t)&&0===so(e,t))return t;return}(e);n&&(s=t.lastIndexOf(n,s-1));return s}(e,r);r.splice(t,0,e),e.record.name&&!fo(e)&&s.set(e.record.name,e)}return t=go({strict:!1,end:!0,sensitive:!1},t),e.forEach(e=>n(e)),{addRoute:n,resolve:function(e,t){let n,a,o,i={};if("name"in e&&e.name){if(n=s.get(e.name),!n)throw Ya(1,{location:e});o=n.record.name,i=ra(co(t.params,n.keys.filter(e=>!e.optional).concat(n.parent?n.parent.keys.filter(e=>e.optional):[]).map(e=>e.name)),e.params&&co(e.params,n.keys.map(e=>e.name))),a=n.stringify(i)}else if(null!=e.path)a=e.path,n=r.find(e=>e.re.test(a)),n&&(i=n.parse(a),o=n.record.name);else{if(n=t.name?s.get(t.name):r.find(e=>e.re.test(t.path)),!n)throw Ya(1,{location:e,currentLocation:t});o=n.record.name,i=ra({},t.params,e.params),a=n.stringify(i)}const l=[];let c=n;for(;c;)l.unshift(c.record),c=c.parent;return{name:o,path:a,params:i,matched:l,meta:po(l)}},removeRoute:a,clearRoutes:function(){r.length=0,s.clear()},getRoutes:function(){return r},getRecordMatcher:function(e){return s.get(e)}}}function co(e,t){const r={};for(const s of t)s in e&&(r[s]=e[s]);return r}function uo(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:ho(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function ho(e){const t={},r=e.props||!1;if("component"in e)t.default=r;else for(const s in e.components)t[s]="object"==typeof r?r[s]:r;return t}function fo(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function po(e){return e.reduce((e,t)=>ra(e,t.meta),{})}function go(e,t){const r={};for(const s in e)r[s]=s in t?t[s]:e[s];return r}function mo({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function vo(e){const t={};if(""===e||"?"===e)return t;const r=("?"===e[0]?e.slice(1):e).split("&");for(let s=0;s<r.length;++s){const e=r[s].replace(ha," "),n=e.indexOf("="),a=Sa(n<0?e:e.slice(0,n)),o=n<0?null:Sa(e.slice(n+1));if(a in t){let e=t[a];aa(e)||(e=t[a]=[e]),e.push(o)}else t[a]=o}return t}function yo(e){let t="";for(let r in e){const s=e[r];if(r=ka(r),null==s){void 0!==s&&(t+=(t.length?"&":"")+r);continue}(aa(s)?s.map(e=>e&&ba(e)):[s&&ba(s)]).forEach(e=>{void 0!==e&&(t+=(t.length?"&":"")+r,null!=e&&(t+="="+e))})}return t}function wo(e){const t={};for(const r in e){const s=e[r];void 0!==s&&(t[r]=aa(s)?s.map(e=>null==e?null:""+e):null==s?s:""+s)}return t}const _o=Symbol(""),bo=Symbol(""),ko=Symbol(""),Eo=Symbol(""),So=Symbol("");function To(){let e=[];return{add:function(t){return e.push(t),()=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)}},list:()=>e.slice(),reset:function(){e=[]}}}function Oo(e,t,r,s,n,a=e=>e()){const o=s&&(s.enterCallbacks[n]=s.enterCallbacks[n]||[]);return()=>new Promise((i,l)=>{const c=e=>{var a;!1===e?l(Ya(4,{from:r,to:t})):e instanceof Error?l(e):"string"==typeof(a=e)||a&&"object"==typeof a?l(Ya(2,{from:t,to:e})):(o&&s.enterCallbacks[n]===o&&"function"==typeof e&&o.push(e),i())},u=a(()=>e.call(s&&s.instances[n],t,r,c));let h=Promise.resolve(u);e.length<3&&(h=h.then(c)),h.catch(e=>l(e))})}function Po(e,t,r,s,n=e=>e()){const a=[];for(const o of e)for(const e in o.components){let i=o.components[e];if("beforeRouteEnter"===t||o.instances[e])if(ta(i)){const l=(i.__vccOpts||i)[t];l&&a.push(Oo(l,r,s,o,e,n))}else{let l=i();a.push(()=>l.then(a=>{if(!a)throw new Error(`Couldn't resolve component "${e}" at "${o.path}"`);const i=(l=a).__esModule||"Module"===l[Symbol.toStringTag]||l.default&&ta(l.default)?a.default:a;var l;o.mods[e]=a,o.components[e]=i;const c=(i.__vccOpts||i)[t];return c&&Oo(c,r,s,o,e,n)()}))}}return a}function jo(e){const t=W(ko),r=W(Eo),s=k(()=>{const r=a(e.to);return t.resolve(r)}),n=k(()=>{const{matched:e}=s.value,{length:t}=e,n=e[t-1],a=r.matched;if(!n||!a.length)return-1;const o=a.findIndex(ja.bind(null,n));if(o>-1)return o;const i=Co(e[t-2]);return t>1&&Co(n)===i&&a[a.length-1].path!==i?a.findIndex(ja.bind(null,e[t-2])):o}),o=k(()=>n.value>-1&&function(e,t){for(const r in t){const s=t[r],n=e[r];if("string"==typeof s){if(s!==n)return!1}else if(!aa(n)||n.length!==s.length||s.some((e,t)=>e!==n[t]))return!1}return!0}(r.params,s.value.params)),i=k(()=>n.value>-1&&n.value===r.matched.length-1&&Aa(r.params,s.value.params));return{route:s,href:k(()=>s.value.href),isActive:o,isExactActive:i,navigate:function(r={}){if(function(e){if(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)return;if(e.defaultPrevented)return;if(void 0!==e.button&&0!==e.button)return;if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}e.preventDefault&&e.preventDefault();return!0}(r)){const r=t[a(e.replace)?"replace":"push"](a(e.to)).catch(na);return e.viewTransition&&"undefined"!=typeof document&&"startViewTransition"in document&&document.startViewTransition(()=>r),r}return Promise.resolve()}}}const Ao=e({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:jo,setup(e,{slots:t}){const r=E(jo(e)),{options:s}=W(ko),n=k(()=>({[Ro(e.activeClass,s.linkActiveClass,"router-link-active")]:r.isActive,[Ro(e.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive}));return()=>{const s=t.default&&(1===(a=t.default(r)).length?a[0]:a);var a;return e.custom?s:G("a",{"aria-current":r.isExactActive?e.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:n.value},s)}}}),Io=Ao;function Co(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const Ro=(e,t,r)=>null!=e?e:null!=t?t:r;function $o(e,t){if(!e)return null;const r=e(t);return 1===r.length?r[0]:r}const Lo=e({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:r}){const s=W(So),n=k(()=>e.route||s.value),o=W(bo,0),i=k(()=>{let e=a(o);const{matched:t}=n.value;let r;for(;(r=t[e])&&!r.components;)e++;return e}),l=k(()=>n.value.matched[i.value]);F(bo,k(()=>i.value+1)),F(_o,l),F(So,n);const c=v();return V(()=>[c.value,l.value,e.name],([e,t,r],[s,n,a])=>{t&&(t.instances[r]=e,n&&n!==t&&e&&e===s&&(t.leaveGuards.size||(t.leaveGuards=n.leaveGuards),t.updateGuards.size||(t.updateGuards=n.updateGuards))),!e||!t||n&&ja(t,n)&&s||(t.enterCallbacks[r]||[]).forEach(t=>t(e))},{flush:"post"}),()=>{const s=n.value,a=e.name,o=l.value,i=o&&o.components[a];if(!i)return $o(r.default,{Component:i,route:s});const u=o.props[a],h=u?!0===u?s.params:"function"==typeof u?u(s):u:null,d=G(i,ra({},h,t,{onVnodeUnmounted:e=>{e.component.isUnmounted&&(o.instances[a]=null)},ref:c}));return $o(r.default,{Component:d,route:s})||d}}});function xo(){return W(ko)}function Uo(e){return W(Eo)}const Do=[{path:"/",name:"Home",component:()=>ve(()=>import("./EnhancedHomeView-DgOnr2er.js"),__vite__mapDeps([2,1,3,4]),import.meta.url),meta:{title:"å·¥å…·å¯¼èˆªç«™",description:"é«˜æ•ˆçš„å·¥å…·å¯¼èˆªå’Œäº§å“å±•ç¤ºå¹³å°"}},{path:"/legacy",name:"LegacyHome",component:()=>ve(()=>import("./HomeView-CNsvhfrf.js"),__vite__mapDeps([5,1,6]),import.meta.url),meta:{title:"ä¼ ç»Ÿç‰ˆå·¥å…·å¯¼èˆªç«™",description:"ä¼ ç»Ÿç‰ˆæœ¬çš„å·¥å…·å¯¼èˆªå’Œäº§å“å±•ç¤ºå¹³å°"}},{path:"/comparison",name:"Comparison",component:()=>ve(()=>import("./ComparisonView-LHZLTFwL.js"),__vite__mapDeps([7,1,8]),import.meta.url),meta:{title:"ä»£ç ä¼˜åŒ–å¯¹æ¯”",description:"å±•ç¤ºåŸHTMLä»£ç ä¸Vueç»„ä»¶åŒ–æ”¹é€ åçš„æ•ˆæœå¯¹æ¯”"}},{path:"/test-statusbar",name:"TestStatusBar",component:()=>ve(()=>import("./TestStatusBar-uWxu3rI6.js"),__vite__mapDeps([9,1,10]),import.meta.url),meta:{title:"çŠ¶æ€æ æµ‹è¯•",description:"æµ‹è¯•åº•éƒ¨çŠ¶æ€æ ç»„ä»¶åŠŸèƒ½"}},{path:"/tools",name:"Tools",component:()=>ve(()=>import("./ToolsView-Di57xLpg.js"),__vite__mapDeps([11,1,12]),import.meta.url),meta:{title:"å·¥å…·å¯¼èˆª",description:"å‘ç°å’Œç®¡ç†æ‚¨çš„å¸¸ç”¨å·¥å…·"}},{path:"/products",name:"Products",component:()=>ve(()=>import("./ProductsView-BRLoFaI-.js"),__vite__mapDeps([13,1,14]),import.meta.url),meta:{title:"äº§å“å±•ç¤º",description:"æµè§ˆå’Œè´­ä¹°ä¼˜è´¨äº§å“"}},{path:"/product/:id",name:"ProductDetail",component:()=>ve(()=>import("./ProductDetailView-DtxIwWrZ.js"),__vite__mapDeps([15,1,16]),import.meta.url),meta:{title:"äº§å“è¯¦æƒ…",description:"æŸ¥çœ‹äº§å“è¯¦ç»†ä¿¡æ¯"}},{path:"/user",name:"User",component:()=>ve(()=>import("./UserView-CD7Vtb3E.js"),__vite__mapDeps([17,1,18]),import.meta.url),meta:{title:"ä¸ªäººä¸­å¿ƒ",description:"ç®¡ç†æ‚¨çš„è´¦æˆ·å’Œåå¥½è®¾ç½®",requiresAuth:!0},children:[{path:"profile",name:"UserProfile",component:()=>ve(()=>import("./ProfileView-CVCseMvk.js"),__vite__mapDeps([19,1,20]),import.meta.url),meta:{title:"ä¸ªäººèµ„æ–™",requiresAuth:!0}},{path:"favorites",name:"UserFavorites",component:()=>ve(()=>import("./FavoritesView-RY2S6m8S.js"),__vite__mapDeps([21,1,22]),import.meta.url),meta:{title:"æˆ‘çš„æ”¶è—",requiresAuth:!0}},{path:"orders",name:"UserOrders",component:()=>ve(()=>import("./OrdersView-DA00h0bP.js"),__vite__mapDeps([23,1,24]),import.meta.url),meta:{title:"æˆ‘çš„è®¢å•",requiresAuth:!0}}]},{path:"/auth",name:"Auth",component:()=>ve(()=>import("./AuthView-DmNg11n7.js"),__vite__mapDeps([25,1,26]),import.meta.url),meta:{title:"ç™»å½•æ³¨å†Œ",description:"ç™»å½•æˆ–æ³¨å†Œæ‚¨çš„è´¦æˆ·"},children:[{path:"login",name:"Login",component:()=>ve(()=>import("./LoginView-Q5aZqbhJ.js"),__vite__mapDeps([27,1,28]),import.meta.url),meta:{title:"ç™»å½•"}},{path:"register",name:"Register",component:()=>ve(()=>import("./RegisterView-DSGQNN-t.js"),__vite__mapDeps([29,1,30]),import.meta.url),meta:{title:"æ³¨å†Œ"}},{path:"forgot-password",name:"ForgotPassword",component:()=>ve(()=>import("./ForgotPasswordView-CB_-B-o_.js"),__vite__mapDeps([31,1,32]),import.meta.url),meta:{title:"å¿˜è®°å¯†ç "}}]},{path:"/admin",name:"Admin",component:()=>ve(()=>import("./AdminView-0P8uLhV8.js"),__vite__mapDeps([33,1,34]),import.meta.url),meta:{title:"ç®¡ç†åå°",description:"ç³»ç»Ÿç®¡ç†å’Œæ•°æ®ç»Ÿè®¡",requiresAuth:!0,requiresAdmin:!0},children:[{path:"dashboard",name:"AdminDashboard",component:()=>ve(()=>import("./DashboardView-1ywsCO8U.js"),__vite__mapDeps([35,1,36]),import.meta.url),meta:{title:"ä»ªè¡¨ç›˜",requiresAuth:!0,requiresAdmin:!0}},{path:"tools",name:"AdminTools",component:()=>ve(()=>import("./AdminToolsView-CCNa5NAB.js"),__vite__mapDeps([37,3,1,38]),import.meta.url),meta:{title:"å·¥å…·ç®¡ç†",requiresAuth:!0,requiresAdmin:!0}},{path:"products",name:"AdminProducts",component:()=>ve(()=>import("./ProductsManageView-BKlo1QpA.js"),__vite__mapDeps([39,1,40]),import.meta.url),meta:{title:"äº§å“ç®¡ç†",requiresAuth:!0,requiresAdmin:!0}},{path:"local",name:"AdminLocal",component:()=>ve(()=>import("./LocalManagementView-BsYqiZE7.js"),__vite__mapDeps([41,1,42]),import.meta.url),meta:{title:"æœ¬åœ°ç®¡ç†",requiresAuth:!0,requiresAdmin:!0}},{path:"local-test",name:"AdminLocalTest",component:()=>ve(()=>import("./LocalManagementTestView-CoOrD3Tx.js"),__vite__mapDeps([43,1,44]),import.meta.url),meta:{title:"æœ¬åœ°ç®¡ç†æµ‹è¯•",requiresAuth:!0,requiresAdmin:!0}}]},{path:"/payment",name:"Payment",component:()=>ve(()=>import("./PaymentView-waRs3Tfj.js"),__vite__mapDeps([45,1,46]),import.meta.url),meta:{title:"æ”¯ä»˜é¡µé¢",description:"å®‰å…¨çš„æ”¯ä»˜å¤„ç†",requiresAuth:!0}},{path:"/payment/success",name:"PaymentSuccess",component:()=>ve(()=>import("./PaymentSuccessView-uqrhQfYv.js"),__vite__mapDeps([47,1,48]),import.meta.url),meta:{title:"æ”¯ä»˜æˆåŠŸ",description:"æ”¯ä»˜å®Œæˆç¡®è®¤"}},{path:"/payment/cancel",name:"PaymentCancel",component:()=>ve(()=>import("./PaymentCancelView-B0bt4mOe.js"),__vite__mapDeps([49,1,50]),import.meta.url),meta:{title:"æ”¯ä»˜å–æ¶ˆ",description:"æ”¯ä»˜å·²å–æ¶ˆ"}},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>ve(()=>import("./NotFoundView-bmnCOL72.js"),__vite__mapDeps([51,1,52]),import.meta.url),meta:{title:"é¡µé¢æœªæ‰¾åˆ°",description:"æ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨"}}],qo=function(e){const t=lo(e.routes,e),r=e.parseQuery||vo,s=e.stringifyQuery||yo,n=e.history,o=To(),i=To(),l=To(),c=M(Ra);let u=Ra;ea&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=sa.bind(null,e=>""+e),d=sa.bind(null,Ea),f=sa.bind(null,Sa);function p(e,a){if(a=ra({},a||c.value),"string"==typeof e){const s=Oa(r,e,a.path),o=t.resolve({path:s.path},a),i=n.createHref(s.fullPath);return ra(s,o,{params:f(o.params),hash:Sa(s.hash),redirectedFrom:void 0,href:i})}let o;if(null!=e.path)o=ra({},e,{path:Oa(r,e.path,a.path).path});else{const t=ra({},e.params);for(const e in t)null==t[e]&&delete t[e];o=ra({},e,{params:d(t)}),a.params=d(a.params)}const i=t.resolve(o,a),l=e.hash||"";i.params=h(f(i.params));const u=function(e,t){const r=t.query?e(t.query):"";return t.path+(r&&"?")+r+(t.hash||"")}(s,ra({},e,{hash:(p=l,_a(p).replace(ma,"{").replace(ya,"}").replace(pa,"^")),path:i.path}));var p;const g=n.createHref(u);return ra({fullPath:u,hash:l,query:s===yo?wo(e.query):e.query||{}},i,{redirectedFrom:void 0,href:g})}function g(e){return"string"==typeof e?Oa(r,e,c.value.path):ra({},e)}function m(e,t){if(u!==e)return Ya(8,{from:t,to:e})}function v(e){return w(e)}function y(e){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:r}=t;let s="function"==typeof r?r(e):r;return"string"==typeof s&&(s=s.includes("?")||s.includes("#")?s=g(s):{path:s},s.params={}),ra({query:e.query,hash:e.hash,params:null!=s.path?{}:e.params},s)}}function w(e,t){const r=u=p(e),n=c.value,a=e.state,o=e.force,i=!0===e.replace,l=y(r);if(l)return w(ra(g(l),{state:"object"==typeof l?ra({},a,l.state):a,force:o,replace:i}),t||r);const h=r;let d;return h.redirectedFrom=t,!o&&function(e,t,r){const s=t.matched.length-1,n=r.matched.length-1;return s>-1&&s===n&&ja(t.matched[s],r.matched[n])&&Aa(t.params,r.params)&&e(t.query)===e(r.query)&&t.hash===r.hash}(s,n,r)&&(d=Ya(16,{to:h,from:n}),R(n,n,!0,!1)),(d?Promise.resolve(d):k(h,n)).catch(e=>Xa(e)?Xa(e,2)?e:C(e):I(e,h,n)).then(e=>{if(e){if(Xa(e,2))return w(ra({replace:i},g(e.to),{state:"object"==typeof e.to?ra({},a,e.to.state):a,force:o}),t||h)}else e=S(h,n,!0,i,a);return E(h,n,e),e})}function _(e,t){const r=m(e,t);return r?Promise.reject(r):Promise.resolve()}function b(e){const t=x.values().next().value;return t&&"function"==typeof t.runWithContext?t.runWithContext(e):e()}function k(e,t){let r;const[s,n,a]=function(e,t){const r=[],s=[],n=[],a=Math.max(t.matched.length,e.matched.length);for(let o=0;o<a;o++){const a=t.matched[o];a&&(e.matched.find(e=>ja(e,a))?s.push(a):r.push(a));const i=e.matched[o];i&&(t.matched.find(e=>ja(e,i))||n.push(i))}return[r,s,n]}(e,t);r=Po(s.reverse(),"beforeRouteLeave",e,t);for(const o of s)o.leaveGuards.forEach(s=>{r.push(Oo(s,e,t))});const l=_.bind(null,e,t);return r.push(l),D(r).then(()=>{r=[];for(const s of o.list())r.push(Oo(s,e,t));return r.push(l),D(r)}).then(()=>{r=Po(n,"beforeRouteUpdate",e,t);for(const s of n)s.updateGuards.forEach(s=>{r.push(Oo(s,e,t))});return r.push(l),D(r)}).then(()=>{r=[];for(const s of a)if(s.beforeEnter)if(aa(s.beforeEnter))for(const n of s.beforeEnter)r.push(Oo(n,e,t));else r.push(Oo(s.beforeEnter,e,t));return r.push(l),D(r)}).then(()=>(e.matched.forEach(e=>e.enterCallbacks={}),r=Po(a,"beforeRouteEnter",e,t,b),r.push(l),D(r))).then(()=>{r=[];for(const s of i.list())r.push(Oo(s,e,t));return r.push(l),D(r)}).catch(e=>Xa(e,8)?e:Promise.reject(e))}function E(e,t,r){l.list().forEach(s=>b(()=>s(e,t,r)))}function S(e,t,r,s,a){const o=m(e,t);if(o)return o;const i=t===Ra,l=ea?history.state:{};r&&(s||i?n.replace(e.fullPath,ra({scroll:i&&l&&l.scroll},a)):n.push(e.fullPath,a)),c.value=e,R(e,t,r,i),C()}let T;function O(){T||(T=n.listen((e,t,r)=>{if(!U.listening)return;const s=p(e),a=y(s);if(a)return void w(ra(a,{replace:!0,force:!0}),s).catch(na);u=s;const o=c.value;var i,l;ea&&(i=Fa(o.fullPath,r.delta),l=Ma(),Va.set(i,l)),k(s,o).catch(e=>Xa(e,12)?e:Xa(e,2)?(w(ra(g(e.to),{force:!0}),s).then(e=>{Xa(e,20)&&!r.delta&&r.type===$a.pop&&n.go(-1,!1)}).catch(na),Promise.reject()):(r.delta&&n.go(-r.delta,!1),I(e,s,o))).then(e=>{(e=e||S(s,o,!1))&&(r.delta&&!Xa(e,8)?n.go(-r.delta,!1):r.type===$a.pop&&Xa(e,20)&&n.go(-1,!1)),E(s,o,e)}).catch(na)}))}let P,j=To(),A=To();function I(e,t,r){C(e);const s=A.list();return s.length?s.forEach(s=>s(e,t,r)):console.error(e),Promise.reject(e)}function C(e){return P||(P=!e,O(),j.list().forEach(([t,r])=>e?r(e):t()),j.reset()),e}function R(t,r,s,n){const{scrollBehavior:a}=e;if(!ea||!a)return Promise.resolve();const o=!s&&function(e){const t=Va.get(e);return Va.delete(e),t}(Fa(t.fullPath,0))||(n||!s)&&history.state&&history.state.scroll||null;return z().then(()=>a(t,r,o)).then(e=>e&&Ba(e)).catch(e=>I(e,t,r))}const $=e=>n.go(e);let L;const x=new Set,U={currentRoute:c,listening:!0,addRoute:function(e,r){let s,n;return Ja(e)?(s=t.getRecordMatcher(e),n=r):n=e,t.addRoute(n,s)},removeRoute:function(e){const r=t.getRecordMatcher(e);r&&t.removeRoute(r)},clearRoutes:t.clearRoutes,hasRoute:function(e){return!!t.getRecordMatcher(e)},getRoutes:function(){return t.getRoutes().map(e=>e.record)},resolve:p,options:e,push:v,replace:function(e){return v(ra(g(e),{replace:!0}))},go:$,back:()=>$(-1),forward:()=>$(1),beforeEach:o.add,beforeResolve:i.add,afterEach:l.add,onError:A.add,isReady:function(){return P&&c.value!==Ra?Promise.resolve():new Promise((e,t)=>{j.add([e,t])})},install(e){e.component("RouterLink",Io),e.component("RouterView",Lo),e.config.globalProperties.$router=this,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>a(c)}),ea&&!L&&c.value===Ra&&(L=!0,v(n.location).catch(e=>{}));const t={};for(const s in Ra)Object.defineProperty(t,s,{get:()=>c.value[s],enumerable:!0});e.provide(ko,this),e.provide(Eo,B(t)),e.provide(So,c);const r=e.unmount;x.add(e),e.unmount=function(){x.delete(e),x.size<1&&(u=Ra,T&&T(),T=null,c.value=Ra,L=!1,P=!1),r()}}};function D(e){return e.reduce((e,t)=>e.then(()=>b(t)),Promise.resolve())}return U}({history:function(e){const t=Wa(e=Da(e)),r=function(e,t,r,s){let n=[],a=[],o=null;const i=({state:a})=>{const i=Ga(e,location),l=r.value,c=t.value;let u=0;if(a){if(r.value=i,t.value=a,o&&o===l)return void(o=null);u=c?a.position-c.position:0}else s(i);n.forEach(e=>{e(r.value,l,{delta:u,type:$a.pop,direction:u?u>0?xa.forward:xa.back:xa.unknown})})};function l(){const{history:e}=window;e.state&&e.replaceState(ra({},e.state,{scroll:Ma()}),"")}return window.addEventListener("popstate",i),window.addEventListener("beforeunload",l,{passive:!0}),{pauseListeners:function(){o=r.value},listen:function(e){n.push(e);const t=()=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)};return a.push(t),t},destroy:function(){for(const e of a)e();a=[],window.removeEventListener("popstate",i),window.removeEventListener("beforeunload",l)}}}(e,t.state,t.location,t.replace),s=ra({location:"",base:e,go:function(e,t=!0){t||r.pauseListeners(),history.go(e)},createHref:Na.bind(null,e)},t,r);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>t.state.value}),s}(),routes:Do});function No(e){var t;return(null==(t=e.category)?void 0:t.id)?e.category.id:e.categoryId?e.categoryId:e.category_id?e.category_id:null}class Mo{static async getTools(e){try{let t=Xs.from(Zs.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("status","active");(null==e?void 0:e.query)&&(t=t.or(`name.ilike.%${e.query}%,description.ilike.%${e.query}%`)),(null==e?void 0:e.category)&&"all"!==e.category&&(t=t.eq("category_id",e.category));const r=(null==e?void 0:e.sortBy)||"sort_order",s=(null==e?void 0:e.sortOrder)||"asc";t=t.order(r,{ascending:"asc"===s});const n=(null==e?void 0:e.page)||1,a=(null==e?void 0:e.limit)||20,o=(n-1)*a;t=t.range(o,o+a-1);const{data:i,error:l,count:c}=await t;if(l)throw new Error(en(l));return{items:(i||[]).map(this.transformToolRow),total:c||0,page:n,limit:a,hasMore:(c||0)>o+a}}catch(t){throw console.error("Error fetching tools:",t),t}}static async getTool(e){try{const{data:t,error:r}=await Xs.from(Zs.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("id",e).single();if(r)throw new Error(en(r));return this.transformToolRow(t)}catch(t){throw console.error("Error fetching tool:",t),t}}static async createTool(e){try{!function(e,t,r="Entity"){const s=[];for(const n of t)e[n]||s.push(n);if(s.length>0)throw new Error(`${r} validation failed: missing required fields: ${s.join(", ")}`)}(e,["name","description","url"],"Tool");const t=function(e,t="Category"){const r=No(e);if(!r)throw new Error(`${t} is required`);return r}(e),{data:r,error:s}=await Xs.from(Zs.TOOLS).insert({name:e.name,description:e.description,url:e.url,category_id:t,icon:e.icon,is_featured:e.isFeatured||!1,status:"active",meta_title:e.metaTitle,meta_description:e.metaDescription,sort_order:e.sortOrder||0}).select("\n          *,\n          category:categories(*)\n        ").single();if(s)throw new Error(en(s));return this.transformToolRow(r)}catch(t){throw console.error("Error creating tool:",t),t}}static async updateTool(e,t){try{const r={};t.name&&(r.name=t.name),t.description&&(r.description=t.description),t.url&&(r.url=t.url);const s=No(t);s&&(r.category_id=s),void 0!==t.icon&&(r.icon=t.icon),void 0!==t.isFeatured&&(r.is_featured=t.isFeatured),t.status&&(r.status=t.status),void 0!==t.metaTitle&&(r.meta_title=t.metaTitle),void 0!==t.metaDescription&&(r.meta_description=t.metaDescription),void 0!==t.sortOrder&&(r.sort_order=t.sortOrder),r.updated_at=(new Date).toISOString();const{data:n,error:a}=await Xs.from(Zs.TOOLS).update(r).eq("id",e).select("\n          *,\n          category:categories(*)\n        ").single();if(a)throw new Error(en(a));return this.transformToolRow(n)}catch(r){throw console.error("Error updating tool:",r),r}}static async deleteTool(e){try{const{error:t}=await Xs.from(Zs.TOOLS).delete().eq("id",e);if(t)throw new Error(en(t))}catch(t){throw console.error("Error deleting tool:",t),t}}static async incrementClickCount(e){try{const{data:t,error:r}=await Xs.from(Zs.TOOLS).select("click_count").eq("id",e).single();if(r)throw new Error(en(r));const{error:s}=await Xs.from(Zs.TOOLS).update({click_count:((null==t?void 0:t.click_count)||0)+1,updated_at:(new Date).toISOString()}).eq("id",e);if(s)throw new Error(en(s))}catch(t){throw console.error("Error incrementing click count:",t),t}}static async getPopularTools(e=10){try{const{data:t,error:r}=await Xs.from(Zs.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("status","active").order("click_count",{ascending:!1}).limit(e);if(r)throw new Error(en(r));return(t||[]).map(this.transformToolRow)}catch(t){throw console.error("Error fetching popular tools:",t),t}}static async getFeaturedTools(e=6){try{const{data:t,error:r}=await Xs.from(Zs.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("status","active").eq("is_featured",!0).order("sort_order",{ascending:!0}).limit(e);if(r)throw new Error(en(r));return(t||[]).map(this.transformToolRow)}catch(t){throw console.error("Error fetching featured tools:",t),t}}static async searchTools(e,t=20){try{const{data:r,error:s}=await Xs.from(Zs.TOOLS).select("\n          *,\n          category:categories(*)\n        ").eq("status","active").or(`name.ilike.%${e}%,description.ilike.%${e}%`).order("click_count",{ascending:!1}).limit(t);if(s)throw new Error(en(s));return(r||[]).map(this.transformToolRow)}catch(r){throw console.error("Error searching tools:",r),r}}static transformToolRow(e){return{id:e.id,name:e.name,description:e.description,url:e.url,icon:e.icon,category_id:e.category_id,tags:[],isFavorite:!1,click_count:e.click_count,is_featured:e.is_featured,status:e.status,created_at:e.created_at,updated_at:e.updated_at,created_by:e.created_by,meta_title:e.meta_title,meta_description:e.meta_description,sort_order:e.sort_order}}}class Bo{static async getCategories(){try{const{data:e,error:t}=await Xs.from(Zs.CATEGORIES).select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(t)throw new Error(en(t));const r=(e||[]).map(this.transformCategoryRow);return this.buildCategoryTree(r)}catch(e){throw console.error("Error fetching categories:",e),e}}static async getCategory(e){try{const{data:t,error:r}=await Xs.from(Zs.CATEGORIES).select("*").eq("id",e).single();if(r)throw new Error(en(r));return this.transformCategoryRow(t)}catch(t){throw console.error("Error fetching category:",t),t}}static async createCategory(e){try{const{data:t,error:r}=await Xs.from(Zs.CATEGORIES).insert({name:e.name,description:e.description,icon:e.icon,color:e.color,parent_id:e.parentId,sort_order:e.sortOrder||0,is_active:!0}).select().single();if(r)throw new Error(en(r));return this.transformCategoryRow(t)}catch(t){throw console.error("Error creating category:",t),t}}static async updateCategory(e,t){try{const r={};t.name&&(r.name=t.name),void 0!==t.description&&(r.description=t.description),t.icon&&(r.icon=t.icon),t.color&&(r.color=t.color),void 0!==t.parentId&&(r.parent_id=t.parentId),void 0!==t.sortOrder&&(r.sort_order=t.sortOrder),void 0!==t.isActive&&(r.is_active=t.isActive),r.updated_at=(new Date).toISOString();const{data:s,error:n}=await Xs.from(Zs.CATEGORIES).update(r).eq("id",e).select().single();if(n)throw new Error(en(n));return this.transformCategoryRow(s)}catch(r){throw console.error("Error updating category:",r),r}}static async deleteCategory(e){try{const{data:t,error:r}=await Xs.from(Zs.CATEGORIES).select("id").eq("parent_id",e);if(r)throw new Error(en(r));if(t&&t.length>0)throw new Error("æ— æ³•åˆ é™¤åŒ…å«å­åˆ†ç±»çš„åˆ†ç±»ï¼Œè¯·å…ˆåˆ é™¤æˆ–ç§»åŠ¨å­åˆ†ç±»");const{data:s,error:n}=await Xs.from(Zs.TOOLS).select("id").eq("category_id",e);if(n)throw new Error(en(n));if(s&&s.length>0)throw new Error("æ— æ³•åˆ é™¤åŒ…å«å·¥å…·çš„åˆ†ç±»ï¼Œè¯·å…ˆåˆ é™¤æˆ–ç§»åŠ¨å·¥å…·");const{error:a}=await Xs.from(Zs.CATEGORIES).delete().eq("id",e);if(a)throw new Error(en(a))}catch(t){throw console.error("Error deleting category:",t),t}}static async getCategoryStats(){try{const{data:e,error:t}=await Xs.from(Zs.TOOLS).select("category_id").eq("status","active");if(t)throw new Error(en(t));const r=new Map;return null==e||e.forEach(e=>{const t=r.get(e.category_id)||0;r.set(e.category_id,t+1)}),Array.from(r.entries()).map(([e,t])=>({categoryId:e,count:t}))}catch(e){throw console.error("Error fetching category stats:",e),e}}static async getCategoriesWithStats(){try{const[e,t]=await Promise.all([this.getCategories(),this.getCategoryStats()]),r=new Map(t.map(e=>[e.categoryId,e.count])),s=e=>{var t;const n=r.get(e.id)||0,a=(null==(t=e.children)?void 0:t.map(s))||[],o=a.reduce((e,t)=>e+t.count,0);return{...e,count:n+o,children:a}};return e.map(s)}catch(e){throw console.error("Error fetching categories with stats:",e),e}}static buildCategoryTree(e){const t=new Map,r=[];return e.forEach(e=>{t.set(e.id,{...e,children:[]})}),e.forEach(e=>{const s=t.get(e.id);if(e.parentId){const n=t.get(e.parentId);n?(n.children=n.children||[],n.children.push(s)):r.push(s)}else r.push(s)}),r}static transformCategoryRow(e){return{id:e.id,name:e.name,description:e.description,icon:e.icon,color:e.color,parentId:e.parent_id,count:0,sortOrder:e.sort_order,isActive:e.is_active,createdAt:e.created_at,updatedAt:e.updated_at}}}const Fo=b("tools",()=>{const e=v(""),t=v("all"),r=v(!1),s=v(!1),n=v(!1),a=v(null),o=v(!1),i=v([{id:"1",name:"Visual Studio Code",description:"å¾®è½¯å¼€å‘çš„å…è´¹ä»£ç ç¼–è¾‘å™¨ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€",url:"https://code.visualstudio.com/",icon:"ğŸ“",category_id:"1",tags:["ç¼–è¾‘å™¨","å¼€å‘","å…è´¹","å¾®è½¯"],is_featured:!0,click_count:1250,isFavorite:!1,status:"active",sort_order:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),meta_title:"Visual Studio Code - å¼ºå¤§çš„ä»£ç ç¼–è¾‘å™¨",meta_description:"å¾®è½¯å‡ºå“çš„è½»é‡çº§ä½†åŠŸèƒ½å¼ºå¤§çš„ä»£ç ç¼–è¾‘å™¨ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€"},{id:"2",name:"GitHub",description:"å…¨çƒæœ€å¤§çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œæ”¯æŒGitç‰ˆæœ¬æ§åˆ¶å’Œåä½œå¼€å‘",url:"https://github.com/",icon:"ğŸ™",category_id:"1",tags:["ä»£ç æ‰˜ç®¡","Git","åä½œ","å¼€æº"],is_featured:!0,click_count:2100,isFavorite:!1,status:"active",sort_order:2,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),meta_title:"GitHub - ä»£ç æ‰˜ç®¡å¹³å°",meta_description:"å…¨çƒæœ€å¤§çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œæ”¯æŒGitç‰ˆæœ¬æ§åˆ¶å’Œå¼€æºåä½œ"}]),l=v([{id:"1",name:"å¼€å‘å·¥å…·",description:"ç¼–ç¨‹å¼€å‘ç›¸å…³å·¥å…·",icon:"ğŸ’»",color:"#3498db",count:5,sort_order:1,is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{id:"2",name:"è®¾è®¡å·¥å…·",description:"UI/UXè®¾è®¡å·¥å…·",icon:"ğŸ¨",color:"#e74c3c",count:3,sort_order:2,is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]),c=k(()=>{let s=i.value;if(e.value){const t=e.value.toLowerCase();s=s.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))}return"all"!==t.value&&(s=s.filter(e=>e.category_id===t.value)),r.value&&(s=s.filter(e=>e.isFavorite)),s}),u=k(()=>i.value.filter(e=>e.isFavorite)),h=k(()=>[...i.value].sort((e,t)=>t.click_count-e.click_count).slice(0,5)),d=k(()=>i.value.filter(e=>e.is_featured)),f=async()=>{try{const e=await Mo.getTools();i.value=e.items?e.items:e}catch(e){throw new Error("åŠ è½½å·¥å…·å¤±è´¥")}},p=async()=>{try{const e=await Bo.getCategories();l.value=e}catch(e){throw new Error("åŠ è½½åˆ†ç±»å¤±è´¥")}};return{searchQuery:e,selectedCategory:t,showFavoritesOnly:r,sidebarCollapsed:s,loading:n,error:a,initialized:o,tools:i,categories:l,filteredTools:c,favoriteTools:u,popularTools:h,featuredTools:d,initialize:async()=>{if(!o.value)try{n.value=!0,a.value=null,await Promise.all([f(),p()]),o.value=!0}catch(e){a.value=e instanceof Error?e.message:"åˆå§‹åŒ–å¤±è´¥",console.error("Error initializing state:",e)}finally{n.value=!1}},toggleFavorite:async e=>{const t=i.value.find(t=>t.id===e);t&&(t.isFavorite=!t.isFavorite)},incrementClickCount:async e=>{const t=i.value.find(t=>t.id===e);t&&t.click_count++},clearError:()=>{a.value=null},setSearchQuery:t=>e.value=t,setSelectedCategory:e=>t.value=e,setSidebarCollapsed:e=>s.value=e,toggleSidebar:()=>s.value=!s.value}});const Vo={TOOLS:"local_tools",CATEGORIES:"local_categories",USER_PREFERENCES:"user_preferences",THEME_CONFIG:"theme_config",OFFLINE_QUEUE:"offline_queue",LAST_SYNC:"last_sync_time",APP_CONFIG:"app_config"};class Go{static getLocalTools(){try{const e=localStorage.getItem(Vo.TOOLS);return e?JSON.parse(e):[]}catch(e){return console.error("è·å–æœ¬åœ°å·¥å…·æ•°æ®å¤±è´¥:",e),[]}}static saveLocalTools(e){try{localStorage.setItem(Vo.TOOLS,JSON.stringify(e))}catch(t){console.error("ä¿å­˜æœ¬åœ°å·¥å…·æ•°æ®å¤±è´¥:",t)}}static addLocalTool(e){const t={...e,localId:`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,isLocal:!0,lastModified:(new Date).toISOString(),syncStatus:"pending"},r=this.getLocalTools();return r.push(t),this.saveLocalTools(r),this.addOfflineAction({type:"create",entity:"tool",data:t}),t}static updateLocalTool(e,t){try{const r=this.getLocalTools(),s=r.findIndex(t=>t.id===e||t.localId===e);return-1!==s&&(r[s]={...r[s],...t,lastModified:(new Date).toISOString(),syncStatus:"pending"},this.saveLocalTools(r),this.addOfflineAction({type:"update",entity:"tool",data:{id:e,updates:t}}),!0)}catch(r){return console.error("æ›´æ–°æœ¬åœ°å·¥å…·å¤±è´¥:",r),!1}}static deleteLocalTool(e){try{const t=this.getLocalTools(),r=t.findIndex(t=>t.id===e||t.localId===e);if(-1===r)return!1;const s=t[r];return t.splice(r,1),this.saveLocalTools(t),this.addOfflineAction({type:"delete",entity:"tool",data:{id:s.id||s.localId}}),!0}catch(t){return console.error("åˆ é™¤æœ¬åœ°å·¥å…·å¤±è´¥:",t),!1}}static getLocalCategories(){try{const e=localStorage.getItem(Vo.CATEGORIES);return e?JSON.parse(e):[]}catch(e){return console.error("è·å–æœ¬åœ°åˆ†ç±»æ•°æ®å¤±è´¥:",e),[]}}static saveLocalCategories(e){try{localStorage.setItem(Vo.CATEGORIES,JSON.stringify(e))}catch(t){console.error("ä¿å­˜æœ¬åœ°åˆ†ç±»æ•°æ®å¤±è´¥:",t)}}static getUserPreferences(){try{const e=localStorage.getItem(Vo.USER_PREFERENCES),t={theme:"auto",language:"zh-CN",sidebarCollapsed:!1,defaultView:"grid",autoSync:!0,offlineMode:!1};return e?{...t,...JSON.parse(e)}:t}catch(e){return console.error("è·å–ç”¨æˆ·åå¥½è®¾ç½®å¤±è´¥:",e),{theme:"auto",language:"zh-CN",sidebarCollapsed:!1,defaultView:"grid",autoSync:!0,offlineMode:!1}}}static saveUserPreferences(e){try{const t={...this.getUserPreferences(),...e};localStorage.setItem(Vo.USER_PREFERENCES,JSON.stringify(t))}catch(t){console.error("ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®å¤±è´¥:",t)}}static getOfflineQueue(){try{const e=localStorage.getItem(Vo.OFFLINE_QUEUE);return e?JSON.parse(e):[]}catch(e){return console.error("è·å–ç¦»çº¿é˜Ÿåˆ—å¤±è´¥:",e),[]}}static addOfflineAction(e){try{const t=this.getOfflineQueue(),r={...e,id:`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:(new Date).toISOString()};t.push(r),localStorage.setItem(Vo.OFFLINE_QUEUE,JSON.stringify(t))}catch(t){console.error("æ·»åŠ ç¦»çº¿æ“ä½œå¤±è´¥:",t)}}static clearOfflineQueue(){try{localStorage.removeItem(Vo.OFFLINE_QUEUE)}catch(e){console.error("æ¸…ç©ºç¦»çº¿é˜Ÿåˆ—å¤±è´¥:",e)}}static getLastSyncTime(){return localStorage.getItem(Vo.LAST_SYNC)}static setLastSyncTime(e=(new Date).toISOString()){localStorage.setItem(Vo.LAST_SYNC,e)}static clearAllLocalData(){try{Object.values(Vo).forEach(e=>{localStorage.removeItem(e)})}catch(e){console.error("æ¸…ç©ºæœ¬åœ°æ•°æ®å¤±è´¥:",e)}}static getStorageInfo(){try{let e=0;for(const r in localStorage)localStorage.hasOwnProperty(r)&&(e+=localStorage[r].length);const t=5242880;return{used:e,total:t,percentage:e/t*100}}catch(e){return console.error("è·å–å­˜å‚¨ä¿¡æ¯å¤±è´¥:",e),{used:0,total:0,percentage:0}}}}const zo=b("localManagement",()=>{const e=v(!1),t=v(!1),r=v(null),s=v(null),n=v(Go.getUserPreferences()),a=v([]),o=v([]),i=v([]),l=k(()=>i.value.length),c=k(()=>a.value.some(e=>"pending"===e.syncStatus)||o.value.some(e=>"pending"===e.syncStatus)),u=k(()=>Go.getStorageInfo()),h=k(()=>navigator.onLine&&!e.value),d=async()=>{e.value=!1,n.value.autoSync&&l.value>0&&await g()},f=()=>{e.value=!0},p=e=>{try{Go.saveUserPreferences(e),n.value=Go.getUserPreferences()}catch(t){throw console.error("æ›´æ–°ç”¨æˆ·åå¥½å¤±è´¥:",t),t}},g=async()=>{if(!t.value&&h.value)try{t.value=!0,r.value=null;const e=Go.getOfflineQueue();for(const t of e)await m(t);Go.clearOfflineQueue(),i.value=[];const n=(new Date).toISOString();Go.setLastSyncTime(n),s.value=n,_()}catch(e){throw console.error("æ•°æ®åŒæ­¥å¤±è´¥:",e),r.value=e instanceof Error?e.message:"åŒæ­¥å¤±è´¥",e}finally{t.value=!1}},m=async e=>{try{switch(e.entity){case"tool":await y(e);break;case"category":await w(e);break;default:console.warn("æœªçŸ¥çš„ç¦»çº¿æ“ä½œç±»å‹:",e)}}catch(t){throw console.error("å¤„ç†ç¦»çº¿æ“ä½œå¤±è´¥:",e,t),t}},y=async e=>{switch(e.type){case"create":await Mo.createTool(e.data);break;case"update":await Mo.updateTool(e.data.id,e.data.updates);break;case"delete":await Mo.deleteTool(e.data.id)}},w=async e=>{switch(e.type){case"create":await Bo.createCategory(e.data);break;case"update":await Bo.updateCategory(e.data.id,e.data.updates);break;case"delete":await Bo.deleteCategory(e.data.id)}},_=()=>{a.value=a.value.map(e=>({...e,syncStatus:"synced"})),Go.saveLocalTools(a.value),o.value=o.value.map(e=>({...e,syncStatus:"synced"})),Go.saveLocalCategories(o.value)};return{isOfflineMode:e,isSyncing:t,syncError:r,lastSyncTime:s,userPreferences:n,localTools:a,localCategories:o,offlineQueue:i,pendingSyncCount:l,hasLocalChanges:c,storageInfo:u,isOnline:h,initialize:async()=>{try{a.value=Go.getLocalTools(),o.value=Go.getLocalCategories(),i.value=Go.getOfflineQueue(),s.value=Go.getLastSyncTime(),window.addEventListener("online",d),window.addEventListener("offline",f),h.value&&n.value.autoSync&&l.value>0&&await g()}catch(e){console.error("åˆå§‹åŒ–æœ¬åœ°ç®¡ç†å¤±è´¥:",e)}},addLocalTool:e=>{try{const t=Go.addLocalTool(e);return a.value.push(t),i.value=Go.getOfflineQueue(),t}catch(t){throw console.error("æ·»åŠ æœ¬åœ°å·¥å…·å¤±è´¥:",t),t}},updateLocalTool:(e,t)=>{try{const r=Go.updateLocalTool(e,t);return r&&(a.value=Go.getLocalTools(),i.value=Go.getOfflineQueue()),r}catch(r){throw console.error("æ›´æ–°æœ¬åœ°å·¥å…·å¤±è´¥:",r),r}},deleteLocalTool:e=>{try{const t=Go.deleteLocalTool(e);return t&&(a.value=Go.getLocalTools(),i.value=Go.getOfflineQueue()),t}catch(t){throw console.error("åˆ é™¤æœ¬åœ°å·¥å…·å¤±è´¥:",t),t}},updateUserPreferences:p,syncData:g,forceSyncData:async()=>{if(!h.value)throw new Error("ç½‘ç»œä¸å¯ç”¨ï¼Œæ— æ³•åŒæ­¥æ•°æ®");await g()},toggleOfflineMode:()=>{e.value=!e.value,p({offlineMode:e.value})},clearLocalData:()=>{try{Go.clearAllLocalData(),a.value=[],o.value=[],i.value=[],s.value=null,n.value=Go.getUserPreferences()}catch(e){throw console.error("æ¸…ç©ºæœ¬åœ°æ•°æ®å¤±è´¥:",e),e}},exportLocalData:()=>{try{const e={tools:a.value,categories:o.value,preferences:n.value,exportTime:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=`local-data-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}catch(e){throw console.error("å¯¼å‡ºæœ¬åœ°æ•°æ®å¤±è´¥:",e),e}},importLocalData:async e=>{try{const t=await e.text(),r=JSON.parse(t);r.tools&&(a.value=r.tools,Go.saveLocalTools(r.tools)),r.categories&&(o.value=r.categories,Go.saveLocalCategories(r.categories)),r.preferences&&p(r.preferences)}catch(t){throw console.error("å¯¼å…¥æœ¬åœ°æ•°æ®å¤±è´¥:",t),t}}}}),Wo=J(Zn),Jo=H();Wo.use(Jo),Wo.use(qo),qo.beforeEach(async(e,t,r)=>{const s=sn(),n=Fo(),a=["Home","EnhancedHome","Products","ProductDetail","NotFound"].includes(e.name);try{const t=e.meta.title;if(t&&(document.title=`${t} - å·¥å…·å¯¼èˆªç«™`),a&&!e.meta.requiresAuth&&!e.meta.requiresAdmin)return r();if(e.meta.requiresAuth||e.meta.requiresAdmin){if(await s.initialize(),e.meta.requiresAuth&&!s.isAuthenticated)return r({name:"Login",query:{redirect:e.fullPath},replace:!0});if(e.meta.requiresAdmin&&!s.isAdmin)return r({name:"Home",replace:!0})}if(!n.initialized)try{await n.initialize()}catch(o){console.error("åˆå§‹åŒ–å·¥å…·æ•°æ®å¤±è´¥:",o)}r()}catch(o){console.error("è·¯ç”±å®ˆå«é”™è¯¯:",o),r({name:"Home",replace:!0})}}),qo.afterEach(()=>{});zo().initialize(),Wo.mount("#app");export{rn as A,Bo as C,Go as L,Zs as T,tn as U,he as _,Fo as a,sn as b,Uo as c,zo as d,Pe as g,Xs as s,xo as u};
