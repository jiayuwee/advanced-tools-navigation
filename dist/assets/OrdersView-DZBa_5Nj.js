const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./orderService-BKP3fvOY.js","./index-DfMIV_22.js","./vendor-CnBwbdGX.js","./index-CK0XRuJs.css"])))=>i.map(i=>d[i]);
import{f as e,c as t,_ as a}from"./index-DfMIV_22.js";import{d as r,r as s,c as l,o as i,m as o,q as n,F as d,A as c,C as u,H as p,E as m,t as v,z as y,u as g,aU as h,$ as k,_ as w,B as _}from"./vendor-CnBwbdGX.js";const f={class:"orders-view"},S={class:"orders-filters"},b=["onClick"],A={class:"filter-count"},I={class:"orders-content"},O={key:0,class:"loading-state"},D={key:1,class:"orders-list"},C={class:"order-header"},P={class:"order-info"},E={class:"order-number"},j={class:"order-date"},T={class:"order-status"},q={class:"order-items"},x={class:"item-image"},L=["src","alt"],U={class:"item-info"},V={class:"item-name"},R={class:"item-description"},$={class:"item-meta"},z={class:"item-quantity"},N={class:"item-price"},B={class:"item-total"},Y={class:"order-footer"},F={class:"order-total"},H={class:"total-amount"},M={class:"order-actions"},G=["onClick"],J=["onClick"],K=["onClick"],Q=["onClick"],W={key:2,class:"empty-state"},X=a(r({__name:"OrdersView",setup(a){const r=t(),X=s(!0),Z=s("all"),ee=s([]),te=[{key:"all",label:"å…¨éƒ¨è®¢å•"},{key:"pending",label:"å¾…æ”¯ä»˜"},{key:"paid",label:"å·²æ”¯ä»˜"},{key:"cancelled",label:"å·²å–æ¶ˆ"},{key:"refunded",label:"å·²é€€æ¬¾"}],ae=l(()=>"all"===Z.value?ee.value:ee.value.filter(e=>e.status===Z.value));return i(()=>{(async()=>{try{X.value=!0;const{OrderService:a}=await e(async()=>{const{OrderService:e}=await import("./orderService-BKP3fvOY.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useAuthStore:r}=await e(async()=>{const{useAuthStore:e}=await import("./index-DfMIV_22.js").then(e=>e.g);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),s=r();if(!s.user)return void console.error("ç”¨æˆ·æœªç™»å½•");try{const e=await a.getUserOrders(s.user.id);return void(ee.value=e)}catch(t){console.warn("åŠ è½½çœŸå®è®¢å•æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:",t)}await new Promise(e=>setTimeout(e,1e3)),ee.value=[{id:"order-1",userId:"user-1",items:[{id:"item-1",orderId:"order-1",productId:"product-1",quantity:1,unitPrice:299,totalPrice:299,createdAt:(new Date).toISOString(),product:{id:"product-1",name:"é«˜æ•ˆåŠå…¬å¥—ä»¶",shortDescription:"æå‡åŠå…¬æ•ˆç‡çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ",images:["/placeholder.jpg"]}}],totalAmount:299,currency:"CNY",status:"paid",paymentMethod:"alipay",createdAt:new Date(Date.now()-864e5).toISOString(),updatedAt:(new Date).toISOString(),completedAt:(new Date).toISOString()},{id:"order-2",userId:"user-1",items:[{id:"item-2",orderId:"order-2",productId:"product-2",quantity:1,unitPrice:199,totalPrice:199,createdAt:(new Date).toISOString(),product:{id:"product-2",name:"è®¾è®¡å¸ˆå·¥å…·åŒ…",shortDescription:"ä¸“ä¸šè®¾è®¡å¸ˆå¿…å¤‡å·¥å…·é›†åˆ",images:["/placeholder.jpg"]}}],totalAmount:199,currency:"CNY",status:"pending",createdAt:new Date(Date.now()-36e5).toISOString(),updatedAt:(new Date).toISOString()}]}catch(a){console.error("åŠ è½½è®¢å•å¤±è´¥:",a)}finally{X.value=!1}})()}),(t,a)=>{const s=w("router-link");return _(),o("div",f,[a[5]||(a[5]=n("div",{class:"orders-header"},[n("h1",null,"æˆ‘çš„è®¢å•"),n("p",null,"æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„è®¢å•å†å²")],-1)),n("div",S,[(_(),o(d,null,c(te,e=>{return n("button",{key:e.key,class:u(["filter-btn",{active:Z.value===e.key}]),onClick:t=>Z.value=e.key},[p(m(e.label)+" ",1),n("span",A,m((t=e.key,"all"===t?ee.value.length:ee.value.filter(e=>e.status===t).length)),1)],10,b);var t}),64))]),n("div",I,[X.value?(_(),o("div",O,a[0]||(a[0]=[n("div",{class:"loading-spinner"},null,-1),n("p",null,"æ­£åœ¨åŠ è½½è®¢å•...",-1)]))):ae.value.length>0?(_(),o("div",D,[(_(!0),o(d,null,c(ae.value,t=>{return _(),o("div",{key:t.id,class:"order-item"},[n("div",C,[n("div",P,[n("h3",E," è®¢å•å·: "+m(t.id.slice(-8).toUpperCase()),1),n("p",j," ä¸‹å•æ—¶é—´: "+m((l=t.createdAt,new Date(l).toLocaleString("zh-CN"))),1)]),n("div",T,[n("span",{class:u(["status-badge",t.status])},m((s=t.status,{pending:"å¾…æ”¯ä»˜",paid:"å·²æ”¯ä»˜",cancelled:"å·²å–æ¶ˆ",refunded:"å·²é€€æ¬¾"}[s]||s)),3)])]),n("div",q,[(_(!0),o(d,null,c(t.items,e=>{var t,a,r,s,l;return _(),o("div",{key:e.id,class:"order-item-detail"},[n("div",x,[n("img",{src:(null==(a=null==(t=e.product)?void 0:t.images)?void 0:a[0])||"/placeholder.jpg",alt:null==(r=e.product)?void 0:r.name},null,8,L)]),n("div",U,[n("h4",V,m(null==(s=e.product)?void 0:s.name),1),n("p",R,m(null==(l=e.product)?void 0:l.shortDescription),1),n("div",$,[n("span",z,"æ•°é‡: "+m(e.quantity),1),n("span",N,"å•ä»·: Â¥"+m(e.unitPrice),1)])]),n("div",B,"Â¥"+m(e.totalPrice),1)])}),128))]),n("div",Y,[n("div",F,[a[1]||(a[1]=n("span",{class:"total-label"},"è®¢å•æ€»é¢:",-1)),n("span",H,"Â¥"+m(t.totalAmount),1)]),n("div",M,["pending"===t.status?(_(),o("button",{key:0,class:"action-btn primary",onClick:e=>(e=>{r.push(`/payment?order=${e.id}`)})(t)}," ç«‹å³æ”¯ä»˜ ",8,G)):v("",!0),"pending"===t.status?(_(),o("button",{key:1,class:"action-btn secondary",onClick:e=>(async e=>{if(confirm("ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ"))try{const t=ee.value.findIndex(t=>t.id===e.id);-1!==t&&(ee.value[t].status="cancelled")}catch(t){console.error("å–æ¶ˆè®¢å•å¤±è´¥:",t)}})(t)}," å–æ¶ˆè®¢å• ",8,J)):v("",!0),"paid"===t.status?(_(),o("button",{key:2,class:"action-btn secondary",onClick:a=>(async t=>{var a;try{if(console.log("ä¸‹è½½è®¢å•äº§å“:",t.id),"paid"!==t.status)return void alert("è®¢å•æœªæ”¯ä»˜ï¼Œæ— æ³•ä¸‹è½½");const{OrderService:r}=await e(async()=>{const{OrderService:e}=await import("./orderService-BKP3fvOY.js");return{OrderService:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useAuthStore:s}=await e(async()=>{const{useAuthStore:e}=await import("./index-DfMIV_22.js").then(e=>e.g);return{useAuthStore:e}},__vite__mapDeps([1,2,3]),import.meta.url),l=s();if(!l.user)return void alert("è¯·å…ˆç™»å½•");const i=await r.getOrderById(t.id,l.user.id);if(!i||"paid"!==i.status)return void alert("è®¢å•çŠ¶æ€å¼‚å¸¸ï¼Œæ— æ³•ä¸‹è½½");let o=0;for(const e of i.items)if(null==(a=e.product)?void 0:a.downloadUrl){const t=document.createElement("a");t.href=e.product.downloadUrl,t.download=`${e.product.name}.zip`,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),o++,await new Promise(e=>setTimeout(e,500))}0===o?alert("è¯¥è®¢å•ä¸­æ²¡æœ‰å¯ä¸‹è½½çš„äº§å“"):console.log(`æˆåŠŸå¯åŠ¨ ${o} ä¸ªäº§å“çš„ä¸‹è½½`)}catch(r){console.error("ä¸‹è½½å¤±è´¥:",r),alert("ä¸‹è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}})(t)},[y(g(h),{class:"icon"}),a[2]||(a[2]=p(" ä¸‹è½½äº§å“ "))],8,K)):v("",!0),n("button",{class:"action-btn secondary",onClick:e=>(e=>{console.log("æŸ¥çœ‹è®¢å•è¯¦æƒ…:",e.id)})(t)}," æŸ¥çœ‹è¯¦æƒ… ",8,Q)])])]);var s,l}),128))])):(_(),o("div",W,[a[4]||(a[4]=n("div",{class:"empty-icon"},"ğŸ“¦",-1)),n("h3",null,m({all:"æš‚æ— è®¢å•",pending:"æš‚æ— å¾…æ”¯ä»˜è®¢å•",paid:"æš‚æ— å·²æ”¯ä»˜è®¢å•",cancelled:"æš‚æ— å·²å–æ¶ˆè®¢å•",refunded:"æš‚æ— å·²é€€æ¬¾è®¢å•"}[Z.value]||"æš‚æ— è®¢å•"),1),n("p",null,m({all:"æ‚¨è¿˜æ²¡æœ‰ä»»ä½•è®¢å•ï¼Œå»è´­ä¹°ä¸€äº›äº§å“å§ï¼",pending:"æ‚¨æ²¡æœ‰å¾…æ”¯ä»˜çš„è®¢å•",paid:"æ‚¨æ²¡æœ‰å·²æ”¯ä»˜çš„è®¢å•",cancelled:"æ‚¨æ²¡æœ‰å·²å–æ¶ˆçš„è®¢å•",refunded:"æ‚¨æ²¡æœ‰å·²é€€æ¬¾çš„è®¢å•"}[Z.value]||"æš‚æ— ç›¸å…³è®¢å•"),1),y(s,{to:"/products",class:"empty-action"},{default:k(()=>a[3]||(a[3]=[p("å»è´­ä¹°äº§å“")])),_:1,__:[3]})]))])])}}}),[["__scopeId","data-v-90d66720"]]);export{X as default};
