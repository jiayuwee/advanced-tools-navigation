name: Health Check

on:
  push:
    branches: [main]
  schedule:
    - cron: "0 */6 * * *" # æ¯6å°æ—¶è¿è¡Œä¸€æ¬¡
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    name: Website Health Check
    timeout-minutes: 10
    steps:
      - name: Check website accessibility
        run: |
          echo "â±ï¸ æ£€æŸ¥å¼€å§‹æ—¶é—´: $(date)"
          echo "ğŸ” æ£€æŸ¥ç½‘ç«™å¯è®¿é—®æ€§..."
          response=$(curl -s -o /dev/null -w "%{http_code}" https://ramusi.cn)
          if [ "$response" = "200" ]; then
            echo "âœ… ç½‘ç«™æ­£å¸¸è®¿é—® (HTTP $response)"
          else
            echo "âŒ ç½‘ç«™è®¿é—®å¼‚å¸¸ (HTTP $response)"
            exit 1
          fi
          echo "â±ï¸ æ£€æŸ¥ç»“æŸæ—¶é—´: $(date)"
        timeout-minutes: 3

      - name: Check basic functionality
        run: |
          echo "â±ï¸ æ£€æŸ¥å¼€å§‹æ—¶é—´: $(date)"
          echo "ğŸ” æ£€æŸ¥åŸºæœ¬åŠŸèƒ½..."
          content=$(curl -s https://ramusi.cn)
          if echo "$content" | grep -q "Ramusi"; then
            echo "âœ… ç½‘ç«™å†…å®¹æ­£å¸¸"
          else
            echo "âŒ ç½‘ç«™å†…å®¹å¼‚å¸¸"
            exit 1
          fi
          echo "â±ï¸ æ£€æŸ¥ç»“æŸæ—¶é—´: $(date)"
        timeout-minutes: 3

      - name: Health check summary
        run: |
          echo "ğŸ“Š å¥åº·æ£€æŸ¥å®Œæˆ"
          echo "âœ… ç½‘ç«™å¯è®¿é—®æ€§: æ­£å¸¸"
          echo "âœ… åŸºæœ¬åŠŸèƒ½: æ­£å¸¸"
