# å·¥å…·æµè§ˆä¸åˆ†ç±»å±•ç¤º

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨æ–‡ä»¶**  
- [ToolsView.vue](file://src/views/ToolsView.vue)
- [tools.ts](file://src/stores/tools.ts)
- [toolsService.ts](file://src/services/toolsService.ts)
- [useAdvancedSearch.ts](file://src/composables/useAdvancedSearch.ts)
- [AdvancedSearchPanel.vue](file://src/components/search/AdvancedSearchPanel.vue)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [ç»„ä»¶ä¸çŠ¶æ€ç®¡ç†](#ç»„ä»¶ä¸çŠ¶æ€ç®¡ç†)
3. [æ•°æ®è·å–ä¸æœåŠ¡å±‚äº¤äº’](#æ•°æ®è·å–ä¸æœåŠ¡å±‚äº¤äº’)
4. [å·¥å…·åˆ†ç±»è¿‡æ»¤ä¸æœç´¢é€»è¾‘](#å·¥å…·åˆ†ç±»è¿‡æ»¤ä¸æœç´¢é€»è¾‘)
5. [å·¥å…·å¡ç‰‡æ¸²æŸ“ä¸æ‡’åŠ è½½](#å·¥å…·å¡ç‰‡æ¸²æŸ“ä¸æ‡’åŠ è½½)
6. [ç”¨æˆ·æ“ä½œæµç¨‹å›¾](#ç”¨æˆ·æ“ä½œæµç¨‹å›¾)
7. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
8. [å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—](#å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹
æœ¬ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„å·¥å…·æµè§ˆåŠŸèƒ½ï¼Œé€šè¿‡ `ToolsView.vue` ç»„ä»¶ç»“åˆ Pinia çŠ¶æ€ç®¡ç†ï¼ˆ`tools store`ï¼‰å’Œåç«¯æœåŠ¡ï¼ˆ`toolsService`ï¼‰ï¼Œæä¾›å·¥å…·åˆ—è¡¨å±•ç¤ºã€åˆ†ç±»ç­›é€‰ã€æœç´¢è¿‡æ»¤ã€æ’åºåŠå“åº”å¼æ›´æ–°èƒ½åŠ›ã€‚ç”¨æˆ·å¯æŒ‰ç±»åˆ«æµè§ˆå·¥å…·ï¼Œæ”¯æŒç½‘æ ¼ä¸åˆ—è¡¨ä¸¤ç§è§†å›¾æ¨¡å¼ï¼Œå¹¶é›†æˆé«˜çº§æœç´¢ä¸æ”¶è—åŠŸèƒ½ã€‚

## ç»„ä»¶ä¸çŠ¶æ€ç®¡ç†

`ToolsView.vue` æ˜¯å·¥å…·æµè§ˆçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å±•ç¤ºå·¥å…·åˆ—è¡¨å¹¶å¤„ç†ç”¨æˆ·äº¤äº’ã€‚è¯¥ç»„ä»¶é€šè¿‡ `useToolsStore()` ä» Pinia store ä¸­è·å–å·¥å…·æ•°æ®å’ŒçŠ¶æ€ã€‚

### æ ¸å¿ƒçŠ¶æ€å±æ€§
- **tools**: å­˜å‚¨æ‰€æœ‰å·¥å…·çš„åŸå§‹æ•°æ®
- **loading**: è¡¨ç¤ºæ•°æ®åŠ è½½çŠ¶æ€
- **error**: å­˜å‚¨é”™è¯¯ä¿¡æ¯
- **initialized**: æ ‡è®°æ˜¯å¦å·²å®Œæˆåˆå§‹åŒ–
- **searchQuery**: å½“å‰æœç´¢å…³é”®è¯
- **selectedCategory**: å½“å‰é€‰ä¸­çš„åˆ†ç±»
- **sidebarCollapsed**: ä¾§è¾¹æ æŠ˜å çŠ¶æ€

### è®¡ç®—å±æ€§
```ts
const filteredTools = computed(() => {
  if (!searchQuery.value) {
    return tools.value;
  }
  const lowerCaseQuery = searchQuery.value.toLowerCase();
  return tools.value.filter(
    (tool) =>
      tool.name.toLowerCase().includes(lowerCaseQuery) ||
      tool.description.toLowerCase().includes(lowerCaseQuery) ||
      (tool.categories && tool.categories.name.toLowerCase().includes(lowerCaseQuery))
  );
});
```

è¯¥è®¡ç®—å±æ€§å®ç°äº†åŸºç¡€æœç´¢è¿‡æ»¤åŠŸèƒ½ï¼Œæ ¹æ® `searchQuery` å¯¹å·¥å…·åç§°ã€æè¿°å’Œåˆ†ç±»åç§°è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚

**Section sources**
- [tools.ts](file://src/stores/tools.ts#L35-L74)
- [ToolsView.vue](file://src/views/ToolsView.vue#L275-L324)

## æ•°æ®è·å–ä¸æœåŠ¡å±‚äº¤äº’

å·¥å…·æ•°æ®é€šè¿‡åˆ†å±‚æ¶æ„ä»åç«¯è·å–ï¼Œæµç¨‹å¦‚ä¸‹ï¼š

```mermaid
sequenceDiagram
participant ToolsView as ToolsView.vue
participant ToolsStore as tools store
participant ToolsService as toolsService
participant Supabase as Supabase API
ToolsView->>ToolsStore : initialize()
ToolsStore->>ToolsStore : fetchTools()
ToolsStore->>ToolsService : getTools()
ToolsService->>Supabase : SELECT * FROM tools
Supabase-->>ToolsService : è¿”å›å·¥å…·æ•°æ®
ToolsService-->>ToolsStore : å¤„ç†å¹¶è¿”å›æ•°æ®
ToolsStore-->>ToolsView : æ›´æ–°çŠ¶æ€
```

**Diagram sources**
- [tools.ts](file://src/stores/tools.ts#L78-L187)
- [toolsService.ts](file://src/services/toolsService.ts#L43-L90)

### åˆå§‹åŒ–æµç¨‹
1. ç»„ä»¶æŒ‚è½½æ—¶è°ƒç”¨ `toolsStore.initialize()`
2. è‹¥æœªåˆå§‹åŒ–ï¼Œåˆ™æ‰§è¡Œ `fetchTools()`
3. æ£€æŸ¥ Supabase ç¯å¢ƒå˜é‡é…ç½®
4. å‘èµ·æ•°æ®åº“æŸ¥è¯¢è·å–å·¥å…·æ•°æ®
5. å¤„ç†å…³è”æ•°æ®ï¼ˆåˆ†ç±»ã€æ ‡ç­¾ï¼‰
6. æ›´æ–°æœ¬åœ°çŠ¶æ€

### é”™è¯¯å¤„ç†ä¸é™çº§ç­–ç•¥
å½“ Supabase é…ç½®ç¼ºå¤±æˆ–è¯·æ±‚å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œç¡®ä¿é¡µé¢åŸºæœ¬åŠŸèƒ½å¯ç”¨ã€‚

**Section sources**
- [tools.ts](file://src/stores/tools.ts#L78-L226)
- [toolsService.ts](file://src/services/toolsService.ts#L43-L141)

## å·¥å…·åˆ†ç±»è¿‡æ»¤ä¸æœç´¢é€»è¾‘

### åˆ†ç±»ç­›é€‰æœºåˆ¶
åˆ†ç±»ç­›é€‰é€šè¿‡ `selectedCategory` çŠ¶æ€å®ç°ï¼Œæ”¯æŒè·¯ç”±å‚æ•°åŒæ­¥ï¼š

```ts
watch(selectedCategory, (newCategory) => {
  toolsStore.setSelectedCategory(newCategory);
  // æ›´æ–° URL å‚æ•°
  const query = { ...route.query };
  if (newCategory === "all") {
    delete query.category;
  } else {
    query.category = newCategory;
  }
  router.replace({ query });
});
```

### æœç´¢åŠŸèƒ½å®ç°
ç³»ç»Ÿæä¾›ä¸¤çº§æœç´¢ï¼š
1. **åŸºç¡€æœç´¢**ï¼šé€šè¿‡è¾“å…¥æ¡†å®æ—¶è¿‡æ»¤
2. **é«˜çº§æœç´¢**ï¼šé€šè¿‡ `AdvancedSearchPanel` æä¾›å¤šç»´åº¦ç­›é€‰

é«˜çº§æœç´¢ä½¿ç”¨ `useAdvancedSearch` ç»„åˆå¼å‡½æ•°ï¼Œæ”¯æŒæŒ‰åˆ†ç±»ã€æ ‡ç­¾ã€è¯„åˆ†ç­‰æ¡ä»¶è¿‡æ»¤ã€‚

```mermaid
flowchart TD
Start([å¼€å§‹æœç´¢]) --> ValidateInput["éªŒè¯è¾“å…¥å‚æ•°"]
ValidateInput --> InputValid{"è¾“å…¥æœ‰æ•ˆ?"}
InputValid --> |å¦| ReturnEmpty["è¿”å›ç©ºç»“æœ"]
InputValid --> |æ˜¯| ApplyCategory["åº”ç”¨åˆ†ç±»è¿‡æ»¤"]
ApplyCategory --> ApplyTextSearch["åº”ç”¨æ–‡æœ¬æœç´¢"]
ApplyTextSearch --> ApplyTags["åº”ç”¨æ ‡ç­¾è¿‡æ»¤"]
ApplyTags --> SortResults["æ’åºç»“æœ"]
SortResults --> ReturnResults["è¿”å›æœ€ç»ˆç»“æœ"]
```

**Diagram sources**
- [ToolsView.vue](file://src/views/ToolsView.vue#L275-L324)
- [useAdvancedSearch.ts](file://src/composables/useAdvancedSearch.ts#L0-L53)

**Section sources**
- [ToolsView.vue](file://src/views/ToolsView.vue#L275-L324)
- [useAdvancedSearch.ts](file://src/composables/useAdvancedSearch.ts#L0-L53)
- [AdvancedSearchPanel.vue](file://src/components/search/AdvancedSearchPanel.vue#L200-L254)

## å·¥å…·å¡ç‰‡æ¸²æŸ“ä¸æ‡’åŠ è½½

### æ¸²æŸ“ç»“æ„
å·¥å…·å¡ç‰‡æ”¯æŒç½‘æ ¼å’Œåˆ—è¡¨ä¸¤ç§è§†å›¾æ¨¡å¼ï¼š

#### ç½‘æ ¼è§†å›¾
```html
<div class="tools-grid">
  <div v-for="tool in filteredTools" :key="tool.id" class="tool-card">
    <div class="card-header">
      <div class="tool-icon">{{ tool.icon || "ğŸ”§" }}</div>
      <button class="favorite-button" @click.stop="toggleFavorite(tool.id)">
        <StarIcon class="icon" />
      </button>
    </div>
    <div class="card-content">
      <h3 class="tool-name">{{ tool.name }}</h3>
      <p class="tool-description">{{ tool.description }}</p>
      <div class="tool-tags">...</div>
    </div>
    <div class="card-footer">...</div>
  </div>
</div>
```

#### åˆ—è¡¨è§†å›¾
åˆ—è¡¨è§†å›¾æä¾›æ›´ç´§å‡‘çš„å¸ƒå±€ï¼Œé€‚åˆç§»åŠ¨è®¾å¤‡ã€‚

### æ‡’åŠ è½½ä¼˜åŒ–
è™½ç„¶å½“å‰å®ç°æœªä½¿ç”¨åˆ†é¡µåŠ è½½ï¼Œä½†å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–ï¼š
- å®ç°è™šæ‹Ÿæ»šåŠ¨ï¼ˆVirtual Scrollingï¼‰
- æ·»åŠ æ— é™æ»šåŠ¨ï¼ˆInfinite Scrollï¼‰æ”¯æŒ
- ä½¿ç”¨ Intersection Observer æ‡’åŠ è½½å›¾ç‰‡

**Section sources**
- [ToolsView.vue](file://src/views/ToolsView.vue#L153-L193)

## ç”¨æˆ·æ“ä½œæµç¨‹å›¾

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant View as ToolsView
participant Store as tools store
participant Service as toolsService
User->>View : è¿›å…¥å·¥å…·é¡µé¢
View->>Store : initialize()
Store->>Service : getTools()
Service->>Supabase : æŸ¥è¯¢å·¥å…·æ•°æ®
Supabase-->>Service : è¿”å›æ•°æ®
Service-->>Store : å¤„ç†æ•°æ®
Store-->>View : æ›´æ–°çŠ¶æ€
View-->>User : å±•ç¤ºå·¥å…·åˆ—è¡¨
User->>View : é€‰æ‹©"è®¾è®¡å·¥å…·"åˆ†ç±»
View->>Store : setSelectedCategory("design")
Store->>Store : æ›´æ–°filteredTools
Store-->>View : è§¦å‘é‡æ–°æ¸²æŸ“
View-->>User : å±•ç¤ºè®¾è®¡ç±»å·¥å…·
```

**Diagram sources**
- [ToolsView.vue](file://src/views/ToolsView.vue#L275-L324)
- [tools.ts](file://src/stores/tools.ts#L258-L275)

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®ç¼“å­˜ç­–ç•¥
å½“å‰ `toolsService` å·²å®ç°ç¼“å­˜æœºåˆ¶ï¼Œå»ºè®®ï¼š
- å¢åŠ ç¼“å­˜å¤±æ•ˆç­–ç•¥
- å®ç°æ›´ç²¾ç»†çš„ç¼“å­˜ç²’åº¦
- æ·»åŠ ç¼“å­˜å¤§å°é™åˆ¶

### 2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–
- å¯¹ `v-for` åˆ—è¡¨æ·»åŠ  `key` å±æ€§ä¼˜åŒ–
- ä½¿ç”¨ `v-memo` è·³è¿‡ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- å®ç°å·¥å…·å¡ç‰‡çš„æ‡’åŠ è½½

### 3. ç½‘ç»œè¯·æ±‚ä¼˜åŒ–
- åˆå¹¶å¤šä¸ªå°è¯·æ±‚ä¸ºæ‰¹é‡è¯·æ±‚
- ä½¿ç”¨ WebSocket å®ç°æ•°æ®å®æ—¶åŒæ­¥
- æ·»åŠ è¯·æ±‚èŠ‚æµå’Œé˜²æŠ–

### 4. å†…å­˜ç®¡ç†
- ç›‘å¬ç»„ä»¶é”€æ¯äº‹ä»¶æ¸…ç†è®¢é˜…
- é¿å…åœ¨è®¡ç®—å±æ€§ä¸­åˆ›å»ºæ–°å¯¹è±¡
- ä½¿ç”¨ WeakMap å­˜å‚¨ä¸´æ—¶æ•°æ®

## å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—

### é—®é¢˜1ï¼šæ•°æ®æœªæ›´æ–°
**å¯èƒ½åŸå› **ï¼š
- store æœªæ­£ç¡®åˆå§‹åŒ–
- API è¯·æ±‚å¤±è´¥
- è®¡ç®—å±æ€§ä¾èµ–æœªæ­£ç¡®å£°æ˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `toolsStore.initialized` æ˜¯å¦ä¸º `true`
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ç½‘ç»œé”™è¯¯
3. ç¡®è®¤ `filteredTools` è®¡ç®—å±æ€§çš„ä¾èµ–é¡¹

```ts
onMounted(async () => {
  if (!toolsStore.initialized) {
    await toolsStore.initialize();
  }
});
```

### é—®é¢˜2ï¼šåˆ†ç±»ç­›é€‰å¤±æ•ˆ
**å¯èƒ½åŸå› **ï¼š
- `selectedCategory` çŠ¶æ€æœªæ­£ç¡®æ›´æ–°
- è·¯ç”±å‚æ•°æœªåŒæ­¥
- è¿‡æ»¤é€»è¾‘æœ‰è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `setSelectedCategory` æ–¹æ³•è°ƒç”¨
2. éªŒè¯ `watch` ç›‘å¬å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œ
3. ç¡®è®¤åˆ†ç±» ID åŒ¹é…é€»è¾‘

### é—®é¢˜3ï¼šæœç´¢åŠŸèƒ½æ— å“åº”
**å¯èƒ½åŸå› **ï¼š
- `searchQuery` åŒå‘ç»‘å®šå¤±æ•ˆ
- `handleSearch` äº‹ä»¶æœªè§¦å‘
- é«˜çº§æœç´¢ç»„ä»¶æœªæ­£ç¡®é›†æˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `v-model` ç»‘å®š
2. éªŒè¯ `@input` äº‹ä»¶ç›‘å¬
3. ç¡®è®¤ `useAdvancedSearch` æ­£ç¡®å¯¼å…¥

### é—®é¢˜4ï¼šç‚¹å‡»ç»Ÿè®¡ä¸å‡†ç¡®
**å¯èƒ½åŸå› **ï¼š
- RPC è°ƒç”¨å¤±è´¥
- æœ¬åœ°çŠ¶æ€æœªåŒæ­¥æ›´æ–°
- å¹¶å‘è¯·æ±‚å†²çª

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `increment_click_count` å‡½æ•°æ˜¯å¦å­˜åœ¨
2. éªŒè¯ Supabase æƒé™ç­–ç•¥
3. ç¡®ä¿æœ¬åœ°è®¡æ•°å™¨åŒæ­¥æ›´æ–°

## ç»“è®º
æœ¬ç³»ç»Ÿé€šè¿‡ `ToolsView.vue` ç»„ä»¶ä¸ `tools store` çš„ç´§å¯†é…åˆï¼Œå®ç°äº†åŠŸèƒ½å®Œæ•´çš„å·¥å…·æµè§ˆåŠŸèƒ½ã€‚æ•°æ®æµæ¸…æ™°ï¼ŒçŠ¶æ€ç®¡ç†è§„èŒƒï¼Œå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ã€‚å»ºè®®åç»­å¢åŠ åˆ†é¡µåŠ è½½ã€æ›´ç²¾ç»†çš„ç¼“å­˜æ§åˆ¶å’Œæ›´å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä»¥æå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿæ€§èƒ½ã€‚