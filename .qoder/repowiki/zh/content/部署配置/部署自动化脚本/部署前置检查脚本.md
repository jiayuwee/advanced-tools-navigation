
# éƒ¨ç½²å‰ç½®æ£€æŸ¥è„šæœ¬

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨æ–‡ä»¶**  
- [pre-deploy-check.mjs](file://scripts/deployment/pre-deploy-check.mjs)
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs)
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js)
- [check-github-secrets.js](file://scripts/deployment/check-github-secrets.js)
- [check-netlify-config.js](file://scripts/deployment/check-netlify-config.js)
- [netlify.toml](file://netlify.toml)
- [package.json](file://package.json)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)  
2. [æ ¸å¿ƒæ£€æŸ¥è„šæœ¬ä½“ç³»](#æ ¸å¿ƒæ£€æŸ¥è„šæœ¬ä½“ç³»)  
3. [pre-deploy-check.mjs ä¸ enhanced-pre-deploy-check.mjs åŠŸèƒ½å¯¹æ¯”](#pre-deploy-checkmjs-ä¸-enhanced-pre-deploy-checkmjs-åŠŸèƒ½å¯¹æ¯”)  
4. [é…ç½®ä¸€è‡´æ€§éªŒè¯æœºåˆ¶](#é…ç½®ä¸€è‡´æ€§éªŒè¯æœºåˆ¶)  
5. [GitHub Secrets æ£€æµ‹é€»è¾‘åˆ†æ](#github-secrets-æ£€æµ‹é€»è¾‘åˆ†æ)  
6. [Netlify é…ç½®æ£€æµ‹æœºåˆ¶åˆ†æ](#netlify-é…ç½®æ£€æµ‹æœºåˆ¶åˆ†æ)  
7. [è‡ªå®šä¹‰æ–°å¢æ£€æŸ¥é¡¹å¼€å‘æŒ‡å—](#è‡ªå®šä¹‰æ–°å¢æ£€æŸ¥é¡¹å¼€å‘æŒ‡å—)  
8. [å¸¸è§æ£€æŸ¥å¤±è´¥åœºæ™¯åŠè§£å†³æ–¹æ¡ˆ](#å¸¸è§æ£€æŸ¥å¤±è´¥åœºæ™¯åŠè§£å†³æ–¹æ¡ˆ)  
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹

éƒ¨ç½²å‰ç½®æ£€æŸ¥è„šæœ¬ä½“ç³»æ˜¯ä¿éšœé¡¹ç›®ç¨³å®šä¸Šçº¿çš„å…³é”®ç¯èŠ‚ã€‚è¯¥ä½“ç³»é€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬åœ¨éƒ¨ç½²å‰å¯¹é¡¹ç›®è¿›è¡Œå…¨é¢éªŒè¯ï¼Œæ¶µç›– Node.js ç‰ˆæœ¬ã€ä¾èµ–å®Œæ•´æ€§ã€ç¯å¢ƒå˜é‡é…ç½®ã€GitHub Secrets å­˜åœ¨æ€§ä»¥åŠ Netlify é…ç½®åŒ¹é…åº¦ç­‰å¤šä¸ªç»´åº¦ã€‚æœ¬æ–‡æ¡£å°†æ·±å…¥è§£æ `pre-deploy-check.mjs` ä¸ `enhanced-pre-deploy-check.mjs` çš„åŠŸèƒ½å·®å¼‚ä¸æ¼”è¿›å…³ç³»ï¼Œå¹¶è¯¦ç»†è¯´æ˜å„æ£€æŸ¥æ¨¡å—çš„å®ç°æœºåˆ¶ã€‚

**Section sources**  
- [pre-deploy-check.mjs](file://scripts/deployment/pre-deploy-check.mjs#L1-L370)  
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs#L1-L362)

## æ ¸å¿ƒæ£€æŸ¥è„šæœ¬ä½“ç³»

éƒ¨ç½²å‰ç½®æ£€æŸ¥è„šæœ¬ä½äº `scripts/deployment/` ç›®å½•ä¸‹ï¼Œæ„æˆä¸€ä¸ªå®Œæ•´çš„è´¨é‡ä¿éšœé“¾æ¡ï¼š

- **pre-deploy-check.mjs**: åŸºç¡€éƒ¨ç½²å‰æ£€æŸ¥ï¼Œè¦†ç›–é¡¹ç›®ç»“æ„ã€ä¾èµ–ã€æµ‹è¯•ç­‰åŸºæœ¬è¦ç´ 
- **enhanced-pre-deploy-check.mjs**: å¢å¼ºç‰ˆæ£€æŸ¥è„šæœ¬ï¼Œå¼•å…¥å¼‚æ­¥æ‰§è¡Œå’Œæ›´ç»†ç²’åº¦çš„éªŒè¯
- **verify-config-match.js**: éªŒè¯æœ¬åœ°ä¸è¿œç¨‹é…ç½®çš„ä¸€è‡´æ€§
- **check-github-secrets.js**: æ£€æŸ¥ GitHub Secrets çš„é…ç½®çŠ¶æ€
- **check-netlify-config.js**: éªŒè¯ Netlify æ„å»ºé…ç½®çš„æ­£ç¡®æ€§

è¿™äº›è„šæœ¬é€šè¿‡ npm è„šæœ¬ï¼ˆå¦‚ `pre-deploy`, `pre-deploy:enhanced`, `config:verify`ï¼‰é›†æˆåˆ° CI/CD æµç¨‹ä¸­ï¼Œç¡®ä¿æ¯æ¬¡éƒ¨ç½²éƒ½ç»è¿‡ä¸¥æ ¼éªŒè¯ã€‚

```mermaid
graph TD
A[ä»£ç æäº¤] --> B{è§¦å‘CIæµç¨‹}
B --> C[è¿è¡Œ pre-deploy-check.mjs]
B --> D[è¿è¡Œ enhanced-pre-deploy-check.mjs]
C --> E[éªŒè¯é€šè¿‡?]
D --> E
E --> |æ˜¯| F[ç»§ç»­æ„å»º]
E --> |å¦| G[ç»ˆæ­¢æµç¨‹å¹¶æŠ¥å‘Šé”™è¯¯]
F --> H[è¿è¡Œ verify-config-match.js]
H --> I[æ£€æŸ¥é…ç½®ä¸€è‡´æ€§]
I --> J[éƒ¨ç½²åˆ°Netlify]
```

**Diagram sources**  
- [pre-deploy-check.mjs](file://scripts/deployment/pre-deploy-check.mjs#L1-L370)  
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs#L1-L362)  
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L1-L254)

**Section sources**  
- [pre-deploy-check.mjs](file://scripts/deployment/pre-deploy-check.mjs#L1-L370)  
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs#L1-L362)  
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L1-L254)

## pre-deploy-check.mjs ä¸ enhanced-pre-deploy-check.mjs åŠŸèƒ½å¯¹æ¯”

### åŠŸèƒ½å·®å¼‚åˆ†æ

`pre-deploy-check.mjs` å’Œ `enhanced-pre-deploy-check.mjs` è™½ç„¶ç›®æ ‡ä¸€è‡´ï¼Œä½†åœ¨å®ç°æ–¹å¼å’ŒåŠŸèƒ½è¦†ç›–ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚

#### pre-deploy-check.mjs ç‰¹ç‚¹ï¼š
- åŒæ­¥æ‰§è¡Œæ¨¡å¼
- æ£€æŸ¥é¡¹åŒ…æ‹¬ï¼šé¡¹ç›®ç»“æ„ã€package.json é…ç½®ã€TypeScript ç±»å‹æ£€æŸ¥ã€ESLint ä»£ç è´¨é‡ã€æµ‹è¯•è¿è¡Œã€æ„å»ºéªŒè¯ã€ä¾èµ–å®‰å…¨å®¡è®¡ç­‰
- ä½¿ç”¨ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å­è¿›ç¨‹è°ƒç”¨
- é”™è¯¯ä¸è­¦å‘Šåˆ†ç±»æ˜ç¡®ï¼Œæä¾›è¯¦ç»†çš„æŠ¥å‘Šè¾“å‡º

#### enhanced-pre-deploy-check.mjs ç‰¹ç‚¹ï¼š
- å¼‚æ­¥æ‰§è¡Œæ¨¡å¼ï¼ˆä½¿ç”¨ `promisify(exec)`ï¼‰
- æ–°å¢ Git çŠ¶æ€æ£€æŸ¥ï¼ˆå·¥ä½œåŒºæ˜¯å¦å¹²å‡€ã€å½“å‰åˆ†æ”¯ä¿¡æ¯ï¼‰
- æ›´ä¸°å¯Œçš„æ—¥å¿—å›¾æ ‡ç³»ç»Ÿï¼ˆâ„¹ï¸âœ…âš ï¸âŒï¼‰
- æ”¯æŒè¶…æ—¶æ§åˆ¶ï¼ˆå¦‚ç±»å‹æ£€æŸ¥è®¾ç½® 30 ç§’è¶…æ—¶ï¼‰
- æ„å»ºæµ‹è¯•å¢åŠ è€—æ—¶ç»Ÿè®¡
- é‡‡ç”¨ç±»å°è£…ç»“æ„ï¼Œä¾¿äºæ‰©å±•

```mermaid
classDiagram
class PreDeployChecker {
+errors : string[]
+warnings : string[]
+checks : object[]
+log(message, type)
+addError(message)
+addWarning(message)
+addSuccess(message)
+checkRequiredFiles()
+checkPackageJson()
+checkEnvironmentVariables()
+checkTypeScript()
+checkBuildConfiguration()
+checkDependencies()
+checkGitStatus()
+checkBuildTest()
+generateReport()
+runAllChecks()
}
PreDeployChecker --> "uses" execAsync : child_process.promisify
PreDeployChecker --> "reads" fs : Node.js å†…ç½®æ¨¡å—
PreDeployChecker --> "uses" path : Node.js å†…ç½®æ¨¡å—
```

**Diagram sources**  
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs#L1-L362)

### æ¼”è¿›å…³ç³»

`enhanced-pre-deploy-check.mjs` æ˜¯å¯¹ `pre-deploy-check.mjs` çš„ç°ä»£åŒ–é‡æ„ï¼Œä½“ç°äº†ä»¥ä¸‹æ¼”è¿›è¶‹åŠ¿ï¼š

1. **ä»åŒæ­¥åˆ°å¼‚æ­¥**ï¼šåˆ©ç”¨ç°ä»£ JavaScript çš„å¼‚æ­¥ç‰¹æ€§æå‡æ‰§è¡Œæ•ˆç‡å’Œå“åº”èƒ½åŠ›
2. **ä»ç®€å•åˆ°ç²¾ç»†**ï¼šå¢åŠ äº† Git çŠ¶æ€ç›‘æ§ç­‰æ›´ç»†è‡´çš„æ£€æŸ¥ç»´åº¦
3. **ä»åŸºç¡€åˆ°å¥å£®**ï¼šå¼•å…¥è¶…æ—¶æœºåˆ¶é˜²æ­¢æ— é™ç­‰å¾…ï¼Œå¢å¼ºè„šæœ¬ç¨³å®šæ€§
4. **ä»å•ä¸€åˆ°å¯æ‰©å±•**ï¼šæ¸…æ™°çš„ç±»ç»“æ„ä¸ºæœªæ¥æ·»åŠ æ–°æ£€æŸ¥é¡¹æä¾›äº†è‰¯å¥½åŸºç¡€

ä¸¤è€…å…±å­˜å…è®¸å›¢é˜Ÿæ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒçº§åˆ«çš„æ£€æŸ¥å¼ºåº¦ã€‚

**Section sources**  
- [pre-deploy-check.mjs](file://scripts/deployment/pre-deploy-check.mjs#L1-L370)  
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs#L1-L362)

## é…ç½®ä¸€è‡´æ€§éªŒè¯æœºåˆ¶

`verify-config-match.js` è´Ÿè´£æ¯”å¯¹æœ¬åœ°é…ç½®ä¸è¿œç¨‹éƒ¨ç½²ç¯å¢ƒä¹‹é—´çš„ä¸€è‡´æ€§ï¼Œç¡®ä¿å…³é”®å‚æ•°å‡†ç¡®æ— è¯¯ã€‚

### éªŒè¯èŒƒå›´

è¯¥è„šæœ¬ä¸»è¦éªŒè¯ä»¥ä¸‹å‡ ç±»é…ç½®ï¼š

| é…ç½®ç±»å‹ | æ£€æŸ¥æ–‡ä»¶ | å…³é”®å­—æ®µ |
|---------|--------|--------|
| GitHub å·¥ä½œæµ | `.github/workflows/*.yml` | åŸŸåã€ç«™ç‚¹IDã€ä»“åº“å |
| Netlify é…ç½® | `netlify.toml` | å‘å¸ƒåŸŸå |
| Supabase è®¤è¯ | `supabase/config.toml` | é‡å®šå‘URL |
| DNS è®¾ç½® | `public/CNAME` | è‡ªå®šä¹‰åŸŸå |

### å®ç°é€»è¾‘

è„šæœ¬é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é¢„è®¾çš„æœŸæœ›å€¼ï¼Œé€ä¸ªæ‰«ææŒ‡å®šæ–‡ä»¶ä¸­çš„å…³é”®é…ç½®é¡¹æ˜¯å¦å­˜åœ¨ä¸”æ­£ç¡®ã€‚

```mermaid
flowchart TD
Start([å¼€å§‹éªŒè¯]) --> LoadConfig["åŠ è½½é¢„æœŸé…ç½®å€¼"]
LoadConfig --> CheckFiles["éå†é…ç½®æ–‡ä»¶åˆ—è¡¨"]
CheckFiles --> ReadFile["è¯»å–æ–‡ä»¶å†…å®¹"]
ReadFile --> MatchPattern["åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼"]
MatchPattern --> Found{"åŒ¹é…æˆåŠŸ?"}
Found --> |æ˜¯| LogSuccess["è®°å½•æˆåŠŸ"]
Found --> |å¦| LogError["è®°å½•å¤±è´¥"]
LogSuccess --> NextFile
LogError --> NextFile
NextFile --> MoreFiles{"è¿˜æœ‰æ›´å¤šæ–‡ä»¶?"}
MoreFiles --> |æ˜¯| CheckFiles
MoreFiles --> |å¦| GenerateSummary["ç”Ÿæˆé…ç½®æ€»ç»“"]
GenerateSummary --> FinalReport["è¾“å‡ºæœ€ç»ˆç»“æœ"]
FinalReport --> End([ç»“æŸ])
```

**Diagram sources**  
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L1-L254)

æ­¤å¤–ï¼Œè„šæœ¬è¿˜æ£€æŸ¥ç›¸å…³è„šæœ¬æ–‡ä»¶ï¼ˆå¦‚ `check-github-secrets.js`ï¼‰ä¸­ç¡¬ç¼–ç çš„é…ç½®å€¼æ˜¯å¦ä¸€è‡´ï¼Œå½¢æˆé—­ç¯éªŒè¯ã€‚

**Section sources**  
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L1-L254)

## GitHub Secrets æ£€æµ‹é€»è¾‘åˆ†æ

`check-github-secrets.js` æä¾›äº†å…¨é¢çš„ GitHub Secrets é…ç½®æŒ‡å¯¼å’ŒéªŒè¯åŠŸèƒ½ã€‚

### æ£€æµ‹æœºåˆ¶

è¯¥è„šæœ¬å¹¶ä¸ç›´æ¥è®¿é—® GitHub API è·å– secretsï¼Œè€Œæ˜¯é€šè¿‡ä»¥ä¸‹æ–¹å¼é—´æ¥éªŒè¯ï¼š

1. **æœ¬åœ°ç¯å¢ƒå˜é‡æ£€æŸ¥**ï¼šè¯»å– `.env.local` æ–‡ä»¶ä¸­çš„ `VITE_SUPABASE_URL` å’Œ `VITE_SUPABASE_ANON_KEY`
2. **Supabase è¿æ¥æµ‹è¯•**ï¼šä½¿ç”¨æœ¬åœ°é…ç½®çš„å®é™…å€¼å°è¯•è¿æ¥æ•°æ®åº“ï¼ŒéªŒè¯å…¶æœ‰æ•ˆæ€§
3. **é…ç½®æŒ‡å—è¾“å‡º**ï¼šåˆ—å‡ºæ‰€æœ‰å¿…éœ€çš„ secrets åŠå…¶è·å–æ–¹å¼
4. **å·¥ä½œæµè¯´æ˜**ï¼šè§£é‡Šä¸åŒ GitHub Actions å·¥ä½œæµå¯¹ secrets çš„éœ€æ±‚

### è¿æ¥æµ‹è¯•æµç¨‹

å½“æœ¬åœ°ç¯å¢ƒå˜é‡å­˜åœ¨æ—¶ï¼Œè„šæœ¬ä¼šåˆ›å»º Supabase å®¢æˆ·ç«¯å®ä¾‹å¹¶æ‰§è¡Œç®€å•çš„æŸ¥è¯¢æ“ä½œæ¥æµ‹è¯•è¿æ¥å¯ç”¨æ€§ã€‚

```mermaid
sequenceDiagram
participant Script as check-github-secrets.js
participant Env as .env.local
participant Supabase as Supabase Client
participant DB as Supabase Database
Script->>Env : è¯»å– VITE_SUPABASE_URL å’Œ VITE_SUPABASE_ANON_KEY
alt ç¯å¢ƒå˜é‡å­˜åœ¨
Script->>Supabase : createClient(url, key)
Supabase->>DB : SELECT count FROM categories LIMIT 1
DB-->>Supabase : è¿”å›ç»“æœæˆ–é”™è¯¯
Supabase-->>Script : è¿”å›æŸ¥è¯¢ç»“æœ
Script->>Script : åˆ¤æ–­æ˜¯å¦æˆåŠŸ
alt æŸ¥è¯¢æˆåŠŸ
Script->>Console : è¾“å‡º"æ•°æ®åº“è¿æ¥æ­£å¸¸"
else æŸ¥è¯¢å¤±è´¥
Script->>Console : è¾“å‡º"æ•°æ®åº“è¿æ¥å¤±è´¥"
end
else ç¯å¢ƒå˜é‡ä¸å­˜åœ¨
Script->>Console : æç¤ºæœªé…ç½®æœ¬åœ°ç¯å¢ƒå˜é‡
end
```

**Diagram sources**  
- [check-github-secrets.js](file://scripts/deployment/check-github-secrets.js#L1-L170)

è¿™ç§è®¾è®¡æ—¢é¿å…äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œåˆèƒ½æœ‰æ•ˆéªŒè¯é…ç½®çš„æ­£ç¡®æ€§ã€‚

**Section sources**  
- [check-github-secrets.js](file://scripts/deployment/check-github-secrets.js#L1-L170)

## Netlify é…ç½®æ£€æµ‹æœºåˆ¶åˆ†æ

`check-netlify-config.js` ä¸“æ³¨äºéªŒè¯ Netlify æ„å»ºå’Œéƒ¨ç½²ç›¸å…³çš„é…ç½®æ­£ç¡®æ€§ã€‚

### æ£€æŸ¥å†…å®¹

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹å¼ | æ­£ç¡®ç¤ºä¾‹ |
|-------|--------|--------|
| netlify.toml å­˜åœ¨æ€§ | fs.existsSync | âœ… æ–‡ä»¶å­˜åœ¨ |
| æ„å»ºå‘½ä»¤ | å­—ç¬¦ä¸²åŒ…å«æ£€æŸ¥ | `npm ci && npm run build` |
| å‘å¸ƒç›®å½• | å­—ç¬¦ä¸²åŒ…å«æ£€æŸ¥ | `publish = "dist"` |
| ç¯å¢ƒå˜é‡ç¡¬ç¼–ç  | æ’é™¤æ£€æŸ¥ | ä¸åº”åŒ…å« `VITE_SUPABASE_URL =` |
| æœ¬åœ°ç¯å¢ƒæ–‡ä»¶ | å­˜åœ¨æ€§å’Œå†…å®¹æ£€æŸ¥ | .env.local åŒ…å«å¿…è¦å˜é‡ |
| æ„å»ºè„šæœ¬ | package.json è„šæœ¬æ£€æŸ¥ | scripts.build å­˜åœ¨ |
| Vite é…ç½® | é…ç½®æ–‡ä»¶å­˜åœ¨æ€§ | vite.config.ts å­˜åœ¨ |

### å®ç°ç»†èŠ‚

è„šæœ¬é‡‡ç”¨åŒæ­¥æ–‡ä»¶è¯»å–æ–¹å¼ï¼Œä¾æ¬¡æ£€æŸ¥å„é¡¹é…ç½®ã€‚å¯¹äº `netlify.toml`ï¼Œç‰¹åˆ«å…³æ³¨æ˜¯å¦åŒ…å«ç¡¬ç¼–ç çš„ç¯å¢ƒå˜é‡ï¼Œè¿™å¯èƒ½å¯¼è‡´å®‰å…¨é£é™©æˆ–é…ç½®å†²çªã€‚

```mermaid
flowchart LR
A[å¼€å§‹æ£€æŸ¥] --> B{netlify.toml å­˜åœ¨?}
B --> |æ˜¯| C[æ£€æŸ¥æ„å»ºå‘½ä»¤]
B --> |å¦| D[æ ‡è®°ä¸ºç¼ºå¤±]
C --> E{å‘½ä»¤æ­£ç¡®?}
E --> |æ˜¯| F[æ£€æŸ¥å‘å¸ƒç›®å½•]
E --> |å¦| G[è­¦å‘Šå¯èƒ½æœ‰é—®é¢˜]
F --> H{ç›®å½•æ­£ç¡®?}
H --> |æ˜¯| I[æ£€æŸ¥ç¯å¢ƒå˜é‡ç¡¬ç¼–ç ]
H --> |å¦| J[è­¦å‘Šå¯èƒ½æœ‰é—®é¢˜]
I --> K{æœ‰ç¡¬ç¼–ç ?}
K --> |æ˜¯| L[è­¦å‘Šå»ºè®®ç§»é™¤]
K --> |å¦| M[ç¡®è®¤å®‰å…¨]
```

**Diagram sources**  
- [check-netlify-config.js](file://scripts/deployment/check-netlify-config.js#L1-L110)

åŒæ—¶ï¼Œè„šæœ¬è¿˜ä¼šæç¤ºç”¨æˆ·åœ¨ Netlify æ§åˆ¶å°ä¸­æ­£ç¡®è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå½¢æˆå®Œæ•´çš„é…ç½®é—­ç¯ã€‚

**Section sources**  
- [check-netlify-config.js](file://scripts/deployment/check-netlify-config.js#L1-L110)

## è‡ªå®šä¹‰æ–°å¢æ£€æŸ¥é¡¹å¼€å‘æŒ‡å—

ä¸ºç°æœ‰æ£€æŸ¥ä½“ç³»æ·»åŠ æ–°çš„æ£€æŸ¥é¡¹æ˜¯ä¸€é¡¹å¸¸è§éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯å¼€å‘æŒ‡å—ï¼š

### åœ¨ pre-deploy-check.mjs ä¸­æ·»åŠ æ£€æŸ¥é¡¹

1. åœ¨ `PreDeployChecker` ç±»ä¸­å®šä¹‰æ–°æ–¹æ³•ï¼š
```javascript
// ç¤ºä¾‹ï¼šæ£€æŸ¥æ–°åŠŸèƒ½æ¨¡å—
checkNewFeatures() {
  this.log("æ£€æŸ¥æ–°åŠŸèƒ½æ¨¡å—...");
  const newFeatureFiles = [
    "src/services/searchService.ts",
    // ...å…¶ä»–æ–‡ä»¶
  ];
  for (const file of newFeatureFiles) {
    const filePath = path.join(this.projectRoot, file);
    if (!fs.existsSync(filePath)) {
      this.addWarning(`æ–°åŠŸèƒ½æ–‡ä»¶ç¼ºå¤±: ${file}`);
    }
  }
  this.log("æ–°åŠŸèƒ½æ¨¡å—æ£€æŸ¥å®Œæˆ", "success");
}
```

2. åœ¨ `runAllChecks()` æ–¹æ³•ä¸­è°ƒç”¨æ–°æ–¹æ³•ï¼š
```javascript
async runAllChecks() {
  // ...å…¶ä»–æ£€æŸ¥
  this.checkNewFeatures(); // æ·»åŠ è¿™ä¸€è¡Œ
  return this.generateReport();
}
```

### åœ¨ enhanced-pre-deploy-check.mjs ä¸­æ·»åŠ å¼‚æ­¥æ£€æŸ¥

å¯¹äºéœ€è¦å¼‚æ­¥æ“ä½œçš„æ£€æŸ¥ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œåº”ä½¿ç”¨ async/awaitï¼š

```javascript
async checkExternalAPI() {
  this.log("ğŸ” æ£€æŸ¥å¤–éƒ¨APIè¿é€šæ€§...");
  try {
    await fetch('https://api.example.com/health');
    this.addSuccess("å¤–éƒ¨APIå¯è®¿é—®");
  } catch (error) {
    this.addError(`å¤–éƒ¨APIä¸å¯è¾¾: ${error.message}`);
  }
}
```

ç„¶ååœ¨ `runAllChecks()` ä¸­ await è°ƒç”¨ã€‚

### æœ€ä½³å®è·µ

- ä½¿ç”¨ `addError()` å’Œ `addWarning()` ç»Ÿä¸€å¤„ç†é—®é¢˜ä¸ŠæŠ¥
- ä¿æŒæ—¥å¿—æ ¼å¼ä¸€è‡´ï¼Œä½¿ç”¨æ ‡å‡†å›¾æ ‡å‰ç¼€
- å¯¹äºè€—æ—¶æ“ä½œï¼Œè€ƒè™‘æ·»åŠ è¶…æ—¶ä¿æŠ¤
- å°½é‡å¤ç”¨å·²æœ‰å·¥å…·å‡½æ•°å’Œè·¯å¾„å¸¸é‡
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šè¯´æ˜æ£€æŸ¥ç›®çš„å’Œä¾æ®

**Section sources**  
- [pre-deploy-check.mjs](file://scripts/deployment/pre-deploy-check.mjs#L1-L370)  
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs#L1-L362)

## å¸¸è§æ£€æŸ¥å¤±è´¥åœºæ™¯åŠè§£å†³æ–¹æ¡ˆ

### 1. Node.js ç‰ˆæœ¬ä¸å…¼å®¹

**é”™è¯¯æ—¥å¿—**ï¼š
```
âŒ Node.js ç‰ˆæœ¬è¿‡ä½ï¼Œéœ€è¦ >= 18
```

**åŸå› **ï¼šé¡¹ç›®è¦æ±‚ Node.js 18+ï¼Œä½†å½“å‰ç¯å¢ƒç‰ˆæœ¬è¾ƒä½ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ nvm å®‰è£…å¹¶åˆ‡æ¢åˆ° Node.js 18 æˆ–æ›´é«˜ç‰ˆæœ¬
```bash
nvm install 18
nvm use 18
```

### 2. ä¾èµ–å®‰è£…ä¸å®Œæ•´

**é”™è¯¯æ—¥å¿—**ï¼š
```
âŒ node_modules ç›®å½•ä¸å­˜åœ¨ï¼Œè¯·è¿è¡Œ npm install
```

**åŸå› **ï¼šç¼ºå°‘ä¾èµ–åŒ…æˆ–å®‰è£…ä¸­æ–­ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps
```

### 3. ç¯å¢ƒå˜é‡æœªé…ç½®

**é”™è¯¯æ—¥å¿—**ï¼š
```
âŒ æœ¬åœ°ç¯å¢ƒå˜é‡æœªé…ç½®
è¯·æ£€æŸ¥ .env.local æ–‡ä»¶ä¸­çš„é…ç½®
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»º `.env.local` æ–‡ä»¶å¹¶å¡«å…¥æ­£ç¡®å€¼ï¼š
```
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
```

### 4. GitHub Secrets ç¼ºå¤±

**é”™è¯¯æ—¥å¿—**ï¼š
```
âŒ Secrets æœªé…ç½®æˆ–é…ç½®é”™è¯¯
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
å‰å¾€ GitHub ä»“åº“ Settings > Secrets and variables > Actionsï¼Œæ·»åŠ ä»¥ä¸‹ secretsï¼š
- SUPABASE_ACCESS_TOKEN
- SUPABASE_PROJECT_REF  
- VITE_SUPABASE_URL
- VITE_SUPABASE_ANON_KEY

### 5. æ„å»ºå‘½ä»¤ä¸åŒ¹é…

**é”™è¯¯æ—¥å¿—**ï¼š
```
âš ï¸ æ„å»ºå‘½ä»¤å¯èƒ½æœ‰é—®é¢˜
```

**åŸå› **ï¼š`netlify.toml` ä¸­çš„ command ä¸å®é™…éœ€æ±‚ä¸ç¬¦ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ›´æ–° `net