# é…ç½®ä¸€è‡´æ€§æ ¡éªŒæœºåˆ¶

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js)
- [pre-deploy-check.mjs](file://scripts/deployment/pre-deploy-check.mjs)
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs)
- [check-github-secrets.js](file://scripts/deployment/check-github-secrets.js)
- [envValidation.ts](file://src/utils/envValidation.ts)
- [supabaseClient.ts](file://src/lib/supabaseClient.ts)
- [netlify.toml](file://netlify.toml)
- [supabase/config.toml](file://supabase/config.toml)
- [build-verification.yml](file://.github/workflows/build-verification.yml)
- [deploy.yml](file://.github/workflows/deploy.yml)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„æ¦‚è§ˆ](#é¡¹ç›®ç»“æ„æ¦‚è§ˆ)
3. [æ ¸å¿ƒé…ç½®æ ¡éªŒç»„ä»¶](#æ ¸å¿ƒé…ç½®æ ¡éªŒç»„ä»¶)
4. [é…ç½®æ¯”å¯¹èŒƒå›´åˆ†æ](#é…ç½®æ¯”å¯¹èŒƒå›´åˆ†æ)
5. [è§£æä¸æ ‡å‡†åŒ–å¤„ç†](#è§£æä¸æ ‡å‡†åŒ–å¤„ç†)
6. [å·®å¼‚åˆ†ææœºåˆ¶](#å·®å¼‚åˆ†ææœºåˆ¶)
7. [é¢„éƒ¨ç½²æ£€æŸ¥ä½“ç³»](#é¢„éƒ¨ç½²æ£€æŸ¥ä½“ç³»)
8. [è‡ªåŠ¨æ£€æµ‹ä¸ä¿®å¤](#è‡ªåŠ¨æ£€æµ‹ä¸ä¿®å¤)
9. [å…¸å‹é…ç½®æ¼‚ç§»æ¡ˆä¾‹](#å…¸å‹é…ç½®æ¼‚ç§»æ¡ˆä¾‹)
10. [æœ€ä½³å®è·µä¸æ•…éšœæ’é™¤](#æœ€ä½³å®è·µä¸æ•…éšœæ’é™¤)
11. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

é…ç½®ä¸€è‡´æ€§æ ¡éªŒæœºåˆ¶æ˜¯ç°ä»£Webåº”ç”¨éƒ¨ç½²æµæ°´çº¿ä¸­çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œå®ƒç¡®ä¿æœ¬åœ°å¼€å‘ç¯å¢ƒä¸è¿œç¨‹éƒ¨ç½²ç¯å¢ƒä¹‹é—´çš„é…ç½®å®Œå…¨ä¸€è‡´ã€‚æœ¬æ–‡æ¡£æ·±å…¥åˆ†æäº†`verify-config-match.js`è„šæœ¬å¦‚ä½•å®ç°è¿™ä¸€ç›®æ ‡ï¼ŒåŒ…æ‹¬å…¶æ¯”å¯¹èŒƒå›´ã€è§£æå¤„ç†é€»è¾‘ã€å·®å¼‚åˆ†æç®—æ³•ä»¥åŠåœ¨é¢„éƒ¨ç½²æ£€æŸ¥ä¸­çš„é‡è¦ä½œç”¨ã€‚

è¯¥æœºåˆ¶é€šè¿‡å¤šå±‚æ¬¡çš„é…ç½®éªŒè¯ï¼Œè¦†ç›–äº†APIç«¯ç‚¹ã€åŠŸèƒ½å¼€å…³ã€ç¬¬ä¸‰æ–¹æœåŠ¡å‡­è¯ç­‰å…³é”®é…ç½®è¦ç´ ï¼Œä¸ºå¼€å‘è€…æä¾›äº†å®Œæ•´çš„é…ç½®ä¸€è‡´æ€§ä¿éšœä½“ç³»ã€‚

## é¡¹ç›®ç»“æ„æ¦‚è§ˆ

è¯¥é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–çš„é…ç½®ç®¡ç†æ¶æ„ï¼Œå°†ä¸åŒç±»å‹çš„é…ç½®æ–‡ä»¶åˆ†æ•£åœ¨å¤šä¸ªç›®å½•ä¸­ï¼š

```mermaid
graph TB
subgraph "é…ç½®æ–‡ä»¶å±‚æ¬¡ç»“æ„"
A[æ ¹ç›®å½•] --> B[scripts/deployment/]
A --> C[src/utils/]
A --> D[supabase/]
A --> E[.github/workflows/]
B --> F[verify-config-match.js]
B --> G[pre-deploy-check.mjs]
B --> H[check-github-secrets.js]
C --> I[envValidation.ts]
C --> J[supabaseClient.ts]
D --> K[config.toml]
D --> L[migrations/]
E --> M[build-verification.yml]
E --> N[deploy.yml]
end
```

**å›¾è¡¨æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L1-L255)
- [envValidation.ts](file://src/utils/envValidation.ts#L1-L293)

## æ ¸å¿ƒé…ç½®æ ¡éªŒç»„ä»¶

### verify-config-match.js æ ¸å¿ƒæ¶æ„

`verify-config-match.js`æ˜¯é…ç½®ä¸€è‡´æ€§æ ¡éªŒçš„æ ¸å¿ƒè„šæœ¬ï¼Œå®ƒå®ç°äº†å…¨é¢çš„é…ç½®æ¯”å¯¹åŠŸèƒ½ï¼š

```javascript
// é¢„æœŸçš„é…ç½®å€¼ï¼ˆåŸºäºç”¨æˆ·çš„å®é™…é¡¹ç›®ï¼‰
const expectedConfig = {
  github: {
    owner: "jiayuwee",
    repo: "advanced-tools-navigation",
  },
  netlify: {
    siteId: "spiffy-torrone-5454e1",
    domain: "ramusi.cn",
  },
  supabase: {
    projectRef: "ndmxwdejswybvbwrxsai",
    url: "https://your-supabase-project.supabase.co",
  },
};
```

è¯¥è„šæœ¬é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶å®ç°é…ç½®éªŒè¯ï¼š

1. **é…ç½®æ–‡ä»¶æ£€æŸ¥å™¨**ï¼šæ‰«æå¤šä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å…³é”®é…ç½®é¡¹
2. **è„šæœ¬æ–‡ä»¶éªŒè¯å™¨**ï¼šæ£€æŸ¥éƒ¨ç½²è„šæœ¬ä¸­çš„ç¡¬ç¼–ç é…ç½®
3. **ç¯å¢ƒå˜é‡éªŒè¯å™¨**ï¼šç¡®ä¿æœ¬åœ°ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
4. **é…ç½®æ‘˜è¦ç”Ÿæˆå™¨**ï¼šæä¾›æ¸…æ™°çš„é…ç½®æŒ‡å¯¼ä¿¡æ¯

**ç« èŠ‚æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L1-L30)

### é…ç½®æ–‡ä»¶æ‰«ææœºåˆ¶

è„šæœ¬å®šä¹‰äº†è¯¦ç»†çš„é…ç½®æ–‡ä»¶æ‰«æè§„åˆ™ï¼š

```javascript
const configFiles = [
  {
    path: ".github/workflows/deploy.yml",
    checks: [
      { pattern: /ramusi\.cn/, expected: "ramusi.cn", description: "åŸŸåé…ç½®" },
      {
        pattern: /spiffy-torrone-5454e1/,
        expected: "spiffy-torrone-5454e1",
        description: "Netlify ç«™ç‚¹ ID",
      },
    ],
  },
  // ... æ›´å¤šé…ç½®æ–‡ä»¶æ£€æŸ¥è§„åˆ™
];
```

è¿™ç§æ¨¡å¼åŒ–çš„è®¾è®¡ä½¿å¾—é…ç½®éªŒè¯å…·æœ‰é«˜åº¦çš„å¯æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ã€‚

**ç« èŠ‚æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L32-L85)

## é…å¯¹æ¯”å¯¹èŒƒå›´åˆ†æ

### APIç«¯ç‚¹é…ç½®éªŒè¯

é…ç½®æ ¡éªŒæœºåˆ¶è¦†ç›–äº†åº”ç”¨ä¸­æ‰€æœ‰å…³é”®çš„APIç«¯ç‚¹é…ç½®ï¼š

```mermaid
flowchart TD
A[APIç«¯ç‚¹é…ç½®éªŒè¯] --> B[Supabase API URL]
A --> C[Netlify APIç«¯ç‚¹]
A --> D[ç¬¬ä¸‰æ–¹æœåŠ¡ç«¯ç‚¹]
B --> B1[URLæ ¼å¼éªŒè¯]
B --> B2[åŸŸååŒ¹é…æ£€æŸ¥]
B --> B3[HTTPSåè®®éªŒè¯]
C --> C1[ç«™ç‚¹IDéªŒè¯]
C --> C2[åŸŸåé‡å®šå‘é…ç½®]
C --> C3[å¤‡ç”¨URLæ£€æŸ¥]
D --> D1[Stripeç«¯ç‚¹]
D --> D2[æ”¯ä»˜å®ç«¯ç‚¹]
D --> D3[å¾®ä¿¡æ”¯ä»˜ç«¯ç‚¹]
```

**å›¾è¡¨æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L40-L85)
- [supabase/config.toml](file://supabase/config.toml#L1-L50)

### åŠŸèƒ½å¼€å…³é…ç½®æ£€æŸ¥

ç³»ç»Ÿé€šè¿‡ä¸¥æ ¼çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ¥éªŒè¯å„ç§åŠŸèƒ½å¼€å…³ï¼š

```javascript
// åŠŸèƒ½å¼€å…³æ£€æŸ¥ç¤ºä¾‹
{
  pattern: /VITE_DEBUG_MODE\s*=\s*"true"/,
  expected: "VITE_DEBUG_MODE=true",
  description: "è°ƒè¯•æ¨¡å¼å¼€å…³"
},
{
  pattern: /VITE_ENABLE_ANALYTICS\s*=\s*"true"/,
  expected: "VITE_ENABLE_ANALYTICS=true",
  description: "åˆ†æç»Ÿè®¡å¼€å…³"
}
```

### ç¬¬ä¸‰æ–¹æœåŠ¡å‡­è¯éªŒè¯

è„šæœ¬ç‰¹åˆ«å…³æ³¨ç¬¬ä¸‰æ–¹æœåŠ¡çš„å‡­è¯é…ç½®ï¼ŒåŒ…æ‹¬ï¼š

- **Supabaseå‡­è¯**ï¼šé¡¹ç›®å¼•ç”¨IDã€è®¿é—®ä»¤ç‰Œã€åŒ¿åå¯†é’¥
- **Netlifyå‡­è¯**ï¼šç«™ç‚¹IDã€è®¤è¯ä»¤ç‰Œ
- **æ”¯ä»˜æœåŠ¡å‡­è¯**ï¼šStripeå…¬é’¥/ç§é’¥ã€æ”¯ä»˜å®åº”ç”¨IDã€å¾®ä¿¡å•†æˆ·å·

**ç« èŠ‚æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L86-L120)
- [check-github-secrets.js](file://scripts/deployment/check-github-secrets.js#L15-L50)

## è§£æä¸æ ‡å‡†åŒ–å¤„ç†

### é…ç½®æå–ç­–ç•¥

é…ç½®æ ¡éªŒæœºåˆ¶é‡‡ç”¨äº†å¤šç§é…ç½®æå–ç­–ç•¥ï¼š

```mermaid
sequenceDiagram
participant Script as éªŒè¯è„šæœ¬
participant ConfigFile as é…ç½®æ–‡ä»¶
participant RegexEngine as æ­£åˆ™å¼•æ“
participant Validator as éªŒè¯å™¨
Script->>ConfigFile : è¯»å–é…ç½®å†…å®¹
ConfigFile-->>Script : è¿”å›æ–‡ä»¶å†…å®¹
Script->>RegexEngine : åº”ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
RegexEngine-->>Script : è¿”å›åŒ¹é…ç»“æœ
Script->>Validator : æ ‡å‡†åŒ–é…ç½®å€¼
Validator-->>Script : è¿”å›æ ‡å‡†åŒ–ç»“æœ
```

**å›¾è¡¨æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L87-L110)

### æ ‡å‡†åŒ–å¤„ç†æµç¨‹

ç³»ç»Ÿå®ç°äº†ç»Ÿä¸€çš„é…ç½®æ ‡å‡†åŒ–å¤„ç†æµç¨‹ï¼š

1. **åŸå§‹é…ç½®æå–**ï¼šä»å„ç§é…ç½®æ–‡ä»¶ä¸­æå–åŸå§‹é…ç½®å€¼
2. **æ ¼å¼è§„èŒƒåŒ–**ï¼šç»Ÿä¸€é…ç½®å€¼çš„æ ¼å¼å’Œå‘½åçº¦å®š
3. **ç±»å‹éªŒè¯**ï¼šç¡®ä¿é…ç½®å€¼ç¬¦åˆé¢„æœŸçš„æ•°æ®ç±»å‹
4. **èŒƒå›´æ£€æŸ¥**ï¼šéªŒè¯é…ç½®å€¼æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…

### ç¯å¢ƒå˜é‡æ ‡å‡†åŒ–

ç¯å¢ƒå˜é‡é…ç½®é€šè¿‡ä¸“é—¨çš„éªŒè¯æœºåˆ¶è¿›è¡Œæ ‡å‡†åŒ–ï¼š

```typescript
// ç¯å¢ƒå˜é‡éªŒè¯æ¥å£
interface EnvConfig {
  supabaseUrl: string;
  supabaseAnonKey: string;
  appEnv: "development" | "production" | "test";
  appVersion: string;
  debugMode: boolean;
  enableAnalytics: boolean;
}
```

**ç« èŠ‚æ¥æº**
- [envValidation.ts](file://src/utils/envValidation.ts#L1-L30)
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L170-L200)

## å·®å¼‚åˆ†ææœºåˆ¶

### è‡ªåŠ¨æ£€æµ‹ä¸ä¸€è‡´é¡¹

é…ç½®æ ¡éªŒè„šæœ¬é€šè¿‡æ™ºèƒ½çš„å·®å¼‚åˆ†æç®—æ³•è‡ªåŠ¨æ£€æµ‹é…ç½®ä¸ä¸€è‡´ï¼š

```javascript
function checkFile(filePath, checks) {
  try {
    const content = readFileSync(filePath, "utf8");
    const results = [];

    for (const check of checks) {
      const matches = content.match(check.pattern);
      if (matches) {
        console.log(`  âœ… ${check.description}: æ‰¾åˆ°åŒ¹é…é¡¹`);
        results.push({ ...check, status: "found", matches });
      } else {
        console.log(`  âŒ ${check.description}: æœªæ‰¾åˆ°åŒ¹é…é¡¹`);
        results.push({ ...check, status: "missing" });
      }
    }
    return results;
  } catch (error) {
    console.log(`  âš ï¸  æ— æ³•è¯»å–æ–‡ä»¶: ${error.message}`);
    return checks.map((check) => ({
      ...check,
      status: "error",
      error: error.message,
    }));
  }
}
```

### å·®å¼‚åˆ†ç±»ä¸ä¼˜å…ˆçº§

ç³»ç»Ÿå°†é…ç½®å·®å¼‚åˆ†ä¸ºä¸‰ä¸ªç­‰çº§ï¼š

1. **è‡´å‘½é”™è¯¯**ï¼šå¯¼è‡´åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œçš„å…³é”®é…ç½®ç¼ºå¤±
2. **ä¸¥é‡è­¦å‘Š**ï¼šå¯èƒ½å½±å“åŠŸèƒ½ä½†ä¸ä¼šå¯¼è‡´å´©æºƒçš„é…ç½®é—®é¢˜
3. **è½»å¾®è­¦å‘Š**ï¼šä¼˜åŒ–å»ºè®®æˆ–æœ€ä½³å®è·µç›¸å…³çš„é…ç½®é—®é¢˜

### ä¿®å¤å»ºè®®ç”Ÿæˆ

å½“æ£€æµ‹åˆ°é…ç½®å·®å¼‚æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆé’ˆå¯¹æ€§çš„ä¿®å¤å»ºè®®ï¼š

```javascript
// ç”Ÿæˆé…ç½®æ€»ç»“
function generateConfigSummary() {
  console.log("\nğŸ“‹ é…ç½®æ€»ç»“");
  console.log("=====================================");
  console.log("æ ¹æ®æ‚¨çš„é¡¹ç›®ï¼Œä»¥ä¸‹æ˜¯æ­£ç¡®çš„é…ç½®å€¼ï¼š");
  
  console.log("ğŸ” GitHub Secrets åº”è¯¥é…ç½®ä¸ºï¼š");
  console.log(`- SUPABASE_PROJECT_REF: ${expectedConfig.supabase.projectRef}`);
  console.log(`- VITE_SUPABASE_URL: ${expectedConfig.supabase.url}`);
  console.log("- SUPABASE_ACCESS_TOKEN: [ä» Supabase Dashboard è·å–]");
  console.log("- VITE_SUPABASE_ANON_KEY: [ä» Supabase Dashboard è·å–]");
}
```

**ç« èŠ‚æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L87-L179)

## é¢„éƒ¨ç½²æ£€æŸ¥ä½“ç³»

### å¤šå±‚æ¬¡æ£€æŸ¥æ¶æ„

é¢„éƒ¨ç½²æ£€æŸ¥ä½“ç³»é‡‡ç”¨åˆ†å±‚éªŒè¯æ¶æ„ï¼š

```mermaid
graph TB
subgraph "é¢„éƒ¨ç½²æ£€æŸ¥ä½“ç³»"
A[é¡¹ç›®ç»“æ„æ£€æŸ¥] --> B[é…ç½®æ–‡ä»¶éªŒè¯]
B --> C[ç¯å¢ƒå˜é‡æ£€æŸ¥]
C --> D[ä¾èµ–å…³ç³»éªŒè¯]
D --> E[æ„å»ºé…ç½®æ£€æŸ¥]
E --> F[GitçŠ¶æ€æ£€æŸ¥]
F --> G[æ¨¡æ‹Ÿæ„å»ºæµ‹è¯•]
A1[å¿…éœ€æ–‡ä»¶æ£€æŸ¥] --> A
B1[é…ç½®å€¼åŒ¹é…] --> B
C1[ç¯å¢ƒå˜é‡å®Œæ•´æ€§] --> C
D1[ä¾èµ–ç‰ˆæœ¬éªŒè¯] --> D
E1[Viteé…ç½®æ£€æŸ¥] --> E
F1[æœªæäº¤æ›´æ”¹æ£€æŸ¥] --> F
G1[æ„å»ºäº§ç‰©éªŒè¯] --> G
end
```

**å›¾è¡¨æ¥æº**
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs#L1-L100)
- [pre-deploy-check.mjs](file://scripts/deployment/pre-deploy-check.mjs#L1-L100)

### check-github-secrets.js é›†æˆ

è¯¥è„šæœ¬ä¸“é—¨è´Ÿè´£GitHub Secretsçš„é…ç½®æ£€æŸ¥ï¼š

```javascript
// GitHub Secrets é…ç½®æ£€æŸ¥æŒ‡å—
const requiredSecrets = [
  {
    name: "SUPABASE_ACCESS_TOKEN",
    description: "Supabase è®¿é—®ä»¤ç‰Œ",
    howToGet: "ä» Supabase Dashboard > Settings > API > Personal access tokens è·å–",
  },
  {
    name: "SUPABASE_PROJECT_REF",
    description: "é¡¹ç›®å¼•ç”¨ ID",
    howToGet: "ä»é¡¹ç›® URL ä¸­è·å–ï¼Œæ‚¨çš„é¡¹ç›® ID: ndmxwdejswybvbwrxsai",
  },
];
```

### ä¸CI/CDæµæ°´çº¿çš„é›†æˆ

é…ç½®æ ¡éªŒæœºåˆ¶æ·±åº¦é›†æˆåˆ°CI/CDæµæ°´çº¿ä¸­ï¼š

```yaml
# GitHub Actions å·¥ä½œæµé›†æˆ
- name: ğŸ” éªŒè¯é…ç½®åŒ¹é…æ€§
  run: |
    node scripts/deployment/verify-config-match.js
    echo "âœ… é…ç½®éªŒè¯é€šè¿‡"
```

**ç« èŠ‚æ¥æº**
- [check-github-secrets.js](file://scripts/deployment/check-github-secrets.js#L15-L50)
- [build-verification.yml](file://.github/workflows/build-verification.yml#L1-L50)

## è‡ªåŠ¨æ£€æµ‹ä¸ä¿®å¤

### å®æ—¶é…ç½®ç›‘æ§

ç³»ç»Ÿå®ç°äº†å®æ—¶çš„é…ç½®ç›‘æ§æœºåˆ¶ï¼š

```mermaid
stateDiagram-v2
[*] --> æ£€æŸ¥å¼€å§‹
æ£€æŸ¥å¼€å§‹ --> é…ç½®æ–‡ä»¶æ‰«æ
é…ç½®æ–‡ä»¶æ‰«æ --> ç¯å¢ƒå˜é‡æ£€æŸ¥
ç¯å¢ƒå˜é‡æ£€æŸ¥ --> è„šæœ¬æ–‡ä»¶éªŒè¯
è„šæœ¬æ–‡ä»¶éªŒè¯ --> æ€»ç»“ç”Ÿæˆ
é…ç½®æ–‡ä»¶æ‰«æ --> é…ç½®å‘ç°
é…ç½®å‘ç° --> åŒ¹é…éªŒè¯
åŒ¹é…éªŒè¯ --> å·®å¼‚æŠ¥å‘Š
ç¯å¢ƒå˜é‡æ£€æŸ¥ --> å˜é‡éªŒè¯
å˜é‡éªŒè¯ --> çŠ¶æ€æ›´æ–°
è„šæœ¬æ–‡ä»¶éªŒè¯ --> ä»£ç åˆ†æ
ä»£ç åˆ†æ --> ç»“æœæ±‡æ€»
æ€»ç»“ç”Ÿæˆ --> [*]
å·®å¼‚æŠ¥å‘Š --> [*]
çŠ¶æ€æ›´æ–° --> [*]
ç»“æœæ±‡æ€» --> [*]
```

**å›¾è¡¨æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L214-L255)

### æ™ºèƒ½ä¿®å¤å»ºè®®

å½“æ£€æµ‹åˆ°é…ç½®é—®é¢˜æ—¶ï¼Œç³»ç»Ÿä¼šæä¾›æ™ºèƒ½çš„ä¿®å¤å»ºè®®ï¼š

1. **é…ç½®æ¨¡æ¿ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆæ­£ç¡®çš„é…ç½®æ–‡ä»¶æ¨¡æ¿
2. **ç¯å¢ƒå˜é‡è®¾ç½®æŒ‡å—**ï¼šæä¾›è¯¦ç»†çš„ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜
3. **GitHub Secretsé…ç½®å‘å¯¼**ï¼šæŒ‡å¯¼ç”¨æˆ·æ­£ç¡®é…ç½®GitHub Secrets
4. **éƒ¨ç½²è„šæœ¬æ›´æ–°å»ºè®®**ï¼šé’ˆå¯¹å‘ç°çš„é—®é¢˜æä¾›å…·ä½“çš„ä¿®å¤æ–¹æ¡ˆ

### é¢„é˜²æ€§é…ç½®æ£€æŸ¥

ç³»ç»Ÿä¸ä»…æ£€æµ‹ç°æœ‰é…ç½®é—®é¢˜ï¼Œè¿˜å…·å¤‡é¢„é˜²æ€§æ£€æŸ¥èƒ½åŠ›ï¼š

```javascript
// é¢„é˜²æ€§æ£€æŸ¥ç¤ºä¾‹
if (optionalVars.VITE_APP_ENV === "production") {
  if (optionalVars.VITE_DEBUG_MODE === "true") {
    warnings.push("ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­è°ƒè¯•æ¨¡å¼ (VITE_DEBUG_MODE=false)");
  }
  if (optionalVars.VITE_ENABLE_ANALYTICS !== "true") {
    warnings.push("ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨åˆ†æ (VITE_ENABLE_ANALYTICS=true)");
  }
}
```

**ç« èŠ‚æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L214-L255)
- [envValidation.ts](file://src/utils/envValidation.ts#L103-L154)

## å…¸å‹é…ç½®æ¼‚ç§»æ¡ˆä¾‹

### æ¡ˆä¾‹ä¸€ï¼šåŸŸåé…ç½®æ¼‚ç§»

**é—®é¢˜æè¿°**ï¼š
å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨çš„åŸŸåä¸ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´APIè°ƒç”¨å¤±è´¥ã€‚

**æ£€æµ‹è¿‡ç¨‹**ï¼š
```javascript
// æ£€æµ‹åŸŸåé…ç½®
{
  pattern: /ramusi\.cn/,
  expected: "ramusi.cn",
  description: "åŸŸåé…ç½®"
}
```

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
1. æ›´æ–°`.env.local`æ–‡ä»¶ä¸­çš„åŸŸåé…ç½®
2. ä¿®æ”¹`netlify.toml`ä¸­çš„åŸŸåè®¾ç½®
3. æ›´æ–°Supabaseé…ç½®ä¸­çš„é‡å®šå‘URL

### æ¡ˆä¾‹äºŒï¼šSupabaseå‡­è¯å¤±æ•ˆ

**é—®é¢˜æè¿°**ï¼š
Supabaseé¡¹ç›®å¼•ç”¨IDæˆ–è®¿é—®ä»¤ç‰Œè¿‡æœŸæˆ–é…ç½®é”™è¯¯ã€‚

**æ£€æµ‹æœºåˆ¶**ï¼š
```javascript
// æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
try {
  const envContent = readFileSync(".env.local", "utf8");
  if (envContent.includes(expectedConfig.supabase.url)) {
    console.log("âœ… VITE_SUPABASE_URL é…ç½®æ­£ç¡®");
  } else {
    console.log("âŒ VITE_SUPABASE_URL å¯èƒ½ä¸æ­£ç¡®");
    console.log(`   åº”è¯¥æ˜¯: ${expectedConfig.supabase.url}`);
  }
} catch (error) {
  console.log("âš ï¸  æœªæ‰¾åˆ° .env.local æ–‡ä»¶");
}
```

**ä¿®å¤æµç¨‹**ï¼š
1. ä»Supabase Dashboardé‡æ–°è·å–é¡¹ç›®å¼•ç”¨ID
2. æ›´æ–°`.env.local`æ–‡ä»¶ä¸­çš„é…ç½®
3. é‡æ–°è¿è¡Œé…ç½®éªŒè¯è„šæœ¬

### æ¡ˆä¾‹ä¸‰ï¼šGitHub Secretsé…ç½®é—æ¼

**é—®é¢˜æè¿°**ï¼š
éƒ¨ç½²æµæ°´çº¿ä¸­ç¼ºå°‘å¿…è¦çš„GitHub Secretsé…ç½®ã€‚

**æ£€æµ‹ä¸ä¿®å¤**ï¼š
```javascript
// æ£€æŸ¥GitHub Secretsé…ç½®
const requiredSecrets = [
  "SUPABASE_ACCESS_TOKEN",
  "SUPABASE_PROJECT_REF", 
  "VITE_SUPABASE_URL",
  "VITE_SUPABASE_ANON_KEY",
];

// è‡ªåŠ¨ç”Ÿæˆé…ç½®æŒ‡å—
console.log("ğŸ”§ é…ç½®æ­¥éª¤:");
console.log("1. è®¿é—® GitHub ä»“åº“");
console.log('2. ç‚¹å‡» "Settings" æ ‡ç­¾é¡µ');
console.log('3. åœ¨å·¦ä¾§èœå•ä¸­ç‚¹å‡» "Secrets and variables" > "Actions"');
console.log('4. ç‚¹å‡» "New repository secret" æŒ‰é’®');
```

**ç« èŠ‚æ¥æº**
- [verify-config-match.js](file://scripts/deployment/verify-config-match.js#L170-L200)
- [check-github-secrets.js](file://scripts/deployment/check-github-secrets.js#L15-L80)

## æœ€ä½³å®è·µä¸æ•…éšœæ’é™¤

### é…ç½®ç®¡ç†æœ€ä½³å®è·µ

1. **ç‰ˆæœ¬æ§åˆ¶é…ç½®æ–‡ä»¶**ï¼šç¡®ä¿æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½çº³å…¥ç‰ˆæœ¬æ§åˆ¶
2. **ç¯å¢ƒéš”ç¦»**ï¼šä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶
3. **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
4. **è‡ªåŠ¨åŒ–éªŒè¯**ï¼šåœ¨æ¯æ¬¡éƒ¨ç½²å‰è‡ªåŠ¨éªŒè¯é…ç½®ä¸€è‡´æ€§

### å¸¸è§é—®é¢˜è¯Šæ–­

```mermaid
flowchart TD
A[é…ç½®é—®é¢˜] --> B{é—®é¢˜ç±»å‹}
B --> |æ–‡ä»¶ç¼ºå¤±| C[æ£€æŸ¥æ–‡ä»¶è·¯å¾„]
B --> |æ ¼å¼é”™è¯¯| D[éªŒè¯é…ç½®è¯­æ³•]
B --> |å€¼ä¸åŒ¹é…| E[å¯¹æ¯”é¢„æœŸå€¼]
B --> |æƒé™é—®é¢˜| F[æ£€æŸ¥æ–‡ä»¶æƒé™]
C --> C1[ç¡®è®¤æ–‡ä»¶å­˜åœ¨]
C --> C2[æ£€æŸ¥æ–‡ä»¶è·¯å¾„]
D --> D1[ä½¿ç”¨JSON/YAMLéªŒè¯å™¨]
D --> D2[æ£€æŸ¥ç¼©è¿›å’Œæ ¼å¼]
E --> E1[å¯¹æ¯”é¢„æœŸé…ç½®]
E --> E2[æ›´æ–°é…ç½®å€¼]
F --> F1[æ£€æŸ¥æ–‡ä»¶æƒé™]
F --> F2[ä¿®æ”¹æƒé™è®¾ç½®]
```

### æ•…éšœæ’é™¤æ¸…å•

**é…ç½®éªŒè¯å¤±è´¥**ï¼š
1. æ£€æŸ¥`.env.local`æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
2. éªŒè¯æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡æ˜¯å¦å·²è®¾ç½®
3. ç¡®è®¤GitHub Secretsé…ç½®å®Œæ•´
4. è¿è¡Œ`npm run config:verify`é‡æ–°éªŒè¯

**éƒ¨ç½²å¤±è´¥**ï¼š
1. æ£€æŸ¥CI/CDæµæ°´çº¿ä¸­çš„é…ç½®éªŒè¯æ­¥éª¤
2. ç¡®è®¤æ‰€æœ‰éƒ¨ç½²å‰æ£€æŸ¥éƒ½é€šè¿‡
3. éªŒè¯æ„å»ºäº§ç‰©çš„é…ç½®æ­£ç¡®æ€§
4. æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œç¬¬ä¸‰æ–¹æœåŠ¡å¯ç”¨æ€§

### é¢„é˜²æªæ–½

1. **å®šæœŸé…ç½®å®¡è®¡**ï¼šæ¯æœˆè¿è¡Œä¸€æ¬¡é…ç½®ä¸€è‡´æ€§æ£€æŸ¥
2. **è‡ªåŠ¨åŒ–ç›‘æ§**ï¼šè®¾ç½®é…ç½®å˜åŒ–çš„è‡ªåŠ¨ç›‘æ§å‘Šè­¦
3. **å›¢é˜ŸåŸ¹è®­**ï¼šç¡®ä¿å›¢é˜Ÿæˆå‘˜ç†Ÿæ‚‰é…ç½®ç®¡ç†æµç¨‹
4. **æ–‡æ¡£ç»´æŠ¤**ï¼šåŠæ—¶æ›´æ–°é…ç½®ç®¡ç†æ–‡æ¡£

**ç« èŠ‚æ¥æº**
- [enhanced-pre-deploy-check.mjs](file://scripts/deployment/enhanced-pre-deploy-check.mjs#L300-L363)
- [check-github-secrets.js](file://scripts/deployment/check-github-secrets.js#L120-L171)

## æ€»ç»“

é…ç½®ä¸€è‡´æ€§æ ¡éªŒæœºåˆ¶æ˜¯ç°ä»£Webåº”ç”¨éƒ¨ç½²æµæ°´çº¿ä¸­çš„å…³é”®åŸºç¡€è®¾æ–½ã€‚é€šè¿‡`verify-config-match.js`åŠå…¶ç›¸å…³ç»„ä»¶ï¼Œç³»ç»Ÿå®ç°äº†å…¨é¢çš„é…ç½®éªŒè¯ã€å·®å¼‚æ£€æµ‹å’Œè‡ªåŠ¨ä¿®å¤åŠŸèƒ½ã€‚

### æ ¸å¿ƒä¼˜åŠ¿

1. **å…¨é¢è¦†ç›–**ï¼šæ¶µç›–APIç«¯ç‚¹ã€åŠŸèƒ½å¼€å…³ã€ç¬¬ä¸‰æ–¹æœåŠ¡å‡­è¯ç­‰æ‰€æœ‰å…³é”®é…ç½®è¦ç´ 
2. **æ™ºèƒ½æ£€æµ‹**ï¼šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å’Œæ¨¡å¼åŒ¹é…å®ç°ç²¾å‡†çš„é…ç½®å·®å¼‚æ£€æµ‹
3. **è‡ªåŠ¨åŒ–ä¿®å¤**ï¼šæä¾›è¯¦ç»†çš„ä¿®å¤å»ºè®®å’Œé…ç½®æ¨¡æ¿
4. **é›†æˆå‹å¥½**ï¼šæ— ç¼é›†æˆåˆ°CI/CDæµæ°´çº¿å’Œé¢„éƒ¨ç½²æ£€æŸ¥ä½“ç³»ä¸­

### æŠ€æœ¯åˆ›æ–°

- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„ç»„ä»¶èŒè´£æ˜ç¡®ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **æ­£åˆ™è¡¨è¾¾å¼é©±åŠ¨**ï¼šçµæ´»åº”å¯¹å„ç§é…ç½®æ ¼å¼å’Œå˜åŒ–
- **å¤šå±‚æ¬¡éªŒè¯**ï¼šä»æ–‡ä»¶çº§åˆ«åˆ°ç¯å¢ƒå˜é‡çº§åˆ«çš„å…¨æ–¹ä½æ£€æŸ¥
- **å®æ—¶åé¦ˆ**ï¼šå³æ—¶æä¾›é…ç½®çŠ¶æ€å’Œä¿®å¤å»ºè®®

### åº”ç”¨ä»·å€¼

è¯¥é…ç½®ä¸€è‡´æ€§æ ¡éªŒæœºåˆ¶æ˜¾è‘—æå‡äº†åº”ç”¨éƒ¨ç½²çš„å¯é æ€§å’Œæ•ˆç‡ï¼Œå‡å°‘äº†å› é…ç½®é—®é¢˜å¯¼è‡´çš„éƒ¨ç½²å¤±è´¥å’Œç”Ÿäº§ç¯å¢ƒæ•…éšœï¼Œä¸ºå›¢é˜Ÿæä¾›äº†å¼ºæœ‰åŠ›çš„é…ç½®ç®¡ç†ä¿éšœã€‚

é€šè¿‡æŒç»­çš„æ”¹è¿›å’Œä¼˜åŒ–ï¼Œè¿™å¥—é…ç½®æ ¡éªŒä½“ç³»å°†ç»§ç»­ä¸ºç°ä»£Webåº”ç”¨çš„ç¨³å®šéƒ¨ç½²æä¾›åšå®çš„æŠ€æœ¯æ”¯æ’‘ã€‚