# éƒ¨ç½²è¯Šæ–­ä¸ä¿®å¤è„šæœ¬

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**  
- [diagnose-deployment.js](file://scripts/deployment/diagnose-deployment.js)
- [diagnose-update-issues.js](file://scripts/deployment/diagnose-update-issues.js)
- [fix-netlify-root-directory.mjs](file://scripts/deployment/fix-netlify-root-directory.mjs)
- [clean-dependencies.js](file://scripts/deployment/clean-dependencies.js)
- [quick-fix-deployment.js](file://scripts/deployment/quick-fix-deployment.js)
- [netlify-domain-migration.js](file://scripts/deployment/netlify-domain-migration.js)
- [netlify-domain-migration.ps1](file://scripts/deployment/netlify-domain-migration.ps1)
- [netlify.toml](file://netlify.toml)
- [check-netlify-config.js](file://scripts/deployment/check-netlify-config.js)
- [check-deployment-status.js](file://scripts/deployment/check-deployment-status.js)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [éƒ¨ç½²è¯Šæ–­è„šæœ¬åˆ†æ](#éƒ¨ç½²è¯Šæ–­è„šæœ¬åˆ†æ)
3. [æ›´æ–°å‘å¸ƒé—®é¢˜è¯Šæ–­æœºåˆ¶](#æ›´æ–°å‘å¸ƒé—®é¢˜è¯Šæ–­æœºåˆ¶)
4. [Netlifyæ ¹ç›®å½•é…ç½®ä¿®å¤](#netlifyæ ¹ç›®å½•é…ç½®ä¿®å¤)
5. [ä¾èµ–æ¸…ç†ç­–ç•¥](#ä¾èµ–æ¸…ç†ç­–ç•¥)
6. [å¿«é€Ÿä¿®å¤æµç¨‹](#å¿«é€Ÿä¿®å¤æµç¨‹)
7. [åŸŸåè¿ç§»è„šæœ¬è¯¦è§£](#åŸŸåè¿ç§»è„šæœ¬è¯¦è§£)
8. [CI/CDé›†æˆä¸è°ƒç”¨ç­–ç•¥](#cicdé›†æˆä¸è°ƒç”¨ç­–ç•¥)
9. [è¯Šæ–­æ—¥å¿—åˆ†ææŒ‡å—](#è¯Šæ–­æ—¥å¿—åˆ†ææŒ‡å—)
10. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹
æœ¬æ–‡ä»¶æ·±å…¥è§£æéƒ¨ç½²é—®é¢˜è¯Šæ–­ä¸è‡ªåŠ¨åŒ–ä¿®å¤è„šæœ¬ç³»ç»Ÿï¼Œæ¶µç›–ä»é—®é¢˜å®šä½ã€è¯Šæ–­åˆ†æåˆ°è‡ªåŠ¨ä¿®å¤çš„å®Œæ•´æµç¨‹ã€‚é‡ç‚¹é˜è¿°`diagnose-deployment.js`å’Œ`diagnose-update-issues.js`å¦‚ä½•æ”¶é›†éƒ¨ç½²æ—¥å¿—ã€ç¯å¢ƒä¿¡æ¯å’Œé”™è¯¯å †æ ˆä»¥å®šä½é—®é¢˜æ ¹æºï¼›è¯´æ˜`fix-netlify-root-directory.mjs`å¦‚ä½•æ£€æµ‹å¹¶ä¿®æ­£Netlifyéƒ¨ç½²æ ¹ç›®å½•é…ç½®é”™è¯¯ï¼›åˆ†æ`clean-dependencies.js`åœ¨ä¾èµ–å†²çªæˆ–ç¼“å­˜æ±¡æŸ“æ—¶çš„æ¸…ç†ç­–ç•¥ï¼›è§£é‡Š`quick-fix-deployment.js`å¦‚ä½•æ‰§è¡Œä¸€ç³»åˆ—é¢„è®¾ä¿®å¤æ“ä½œä»¥æ¢å¤éƒ¨ç½²èƒ½åŠ›ï¼›æè¿°`netlify-domain-migration`ç³»åˆ—è„šæœ¬ï¼ˆ.js/.ps1ï¼‰åœ¨åŸŸåè¿ç§»åœºæ™¯ä¸‹çš„é…ç½®æ›´æ–°ä¸é‡å®šå‘è®¾ç½®ã€‚ç»“åˆå®é™…éƒ¨ç½²æ•…éšœæ¡ˆä¾‹ï¼Œè¯´æ˜è¿™äº›è„šæœ¬çš„è°ƒç”¨æ—¶æœºã€ä¿®å¤æ•ˆæœéªŒè¯æ–¹æ³•åŠä¸CI/CDç³»ç»Ÿçš„é›†æˆç­–ç•¥ï¼Œå¹¶æä¾›è¯Šæ–­æ—¥å¿—åˆ†ææŒ‡å—ã€‚

## éƒ¨ç½²è¯Šæ–­è„šæœ¬åˆ†æ

`diagnose-deployment.js` æ˜¯ä¸€ä¸ªå…¨é¢çš„éƒ¨ç½²è¯Šæ–­å·¥å…·ï¼ŒåŸºäº Context7 æœ€ä½³å®è·µæ„å»ºï¼Œç”¨äºç³»ç»Ÿæ€§åœ°æ£€æŸ¥éƒ¨ç½²ç¯å¢ƒçš„å¥åº·çŠ¶æ€ã€‚

è¯¥è„šæœ¬é€šè¿‡ä»¥ä¸‹äº”ä¸ªç»´åº¦è¿›è¡Œè¯Šæ–­ï¼š
1. **GitHub Actions çŠ¶æ€æ£€æŸ¥**ï¼šæŸ¥è¯¢æœ€è¿‘çš„å·¥ä½œæµè¿è¡Œè®°å½•ï¼Œè¯†åˆ«å¤±è´¥çš„æ„å»ºä»»åŠ¡
2. **ç½‘ç»œè¿æ¥è¯Šæ–­**ï¼šæµ‹è¯•å…³é”®ç«¯ç‚¹ï¼ˆGitHub APIã€Netlify APIã€è‡ªå®šä¹‰åŸŸåï¼‰çš„å¯è¾¾æ€§
3. **Supabase è¿æ¥éªŒè¯**ï¼šæ£€æŸ¥ Supabase æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
4. **æ–‡ä»¶ç³»ç»ŸçŠ¶æ€æ£€æŸ¥**ï¼šéªŒè¯å…³é”®æ–‡ä»¶ï¼ˆpackage.jsonã€netlify.tomlã€dist/index.htmlï¼‰æ˜¯å¦å­˜åœ¨
5. **æ•…éšœæ’é™¤å»ºè®®ç”Ÿæˆ**ï¼šæä¾›è¯¦ç»†çš„ç½‘ç»œã€Netlify é…ç½®ã€æ„å»ºæµç¨‹å’Œ Supabase é›†æˆçš„æ’æŸ¥æ­¥éª¤

è„šæœ¬é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸ªè¯Šæ–­æ¨¡å—ç‹¬ç«‹æ‰§è¡Œå¹¶è¾“å‡ºç»“æœï¼Œæœ€åæ±‡æ€»æˆå®Œæ•´çš„è¯Šæ–­æŠ¥å‘Šã€‚å…¶è®¾è®¡éµå¾ª"å…ˆæ£€æŸ¥ï¼Œåå»ºè®®"çš„åŸåˆ™ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤ŸæŒ‰æ­¥éª¤è§£å†³é—®é¢˜ã€‚

**ä¸­æ–‡(ä¸­æ–‡)**
- [diagnose-deployment.js](file://scripts/deployment/diagnose-deployment.js#L1-L170)

## æ›´æ–°å‘å¸ƒé—®é¢˜è¯Šæ–­æœºåˆ¶

`diagnose-update-issues.js` ä¸“é—¨ç”¨äºè¯Šæ–­åˆæ¬¡å‘å¸ƒæˆåŠŸä½†æ›´æ–°å‘å¸ƒå¤±è´¥çš„é—®é¢˜ï¼Œé‡‡ç”¨é¢å‘å¯¹è±¡çš„è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡ `UpdateDeploymentDiagnostic` ç±»å°è£…æ‰€æœ‰è¯Šæ–­é€»è¾‘ã€‚

è¯¥è„šæœ¬æ‰§è¡Œä»¥ä¸‹å…³é”®æ£€æŸ¥ï¼š
- **åŒ…ç®¡ç†å™¨ä¸€è‡´æ€§æ£€æŸ¥**ï¼šæ£€æµ‹ package-lock.jsonã€yarn.lockã€pnpm-lock.yaml æ˜¯å¦å­˜åœ¨å†²çª
- **Netlify é…ç½®æ£€æŸ¥**ï¼šéªŒè¯ netlify.toml ä¸­çš„æ„å»ºå‘½ä»¤ä¸é¡¹ç›®å®é™…ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨æ˜¯å¦åŒ¹é…
- **ä¾èµ–é—®é¢˜æ£€æŸ¥**ï¼šè¯†åˆ«å¹³å°ç‰¹å®šä¾èµ–å’Œ Rollup ç›¸å…³çš„æ½œåœ¨é—®é¢˜
- **ç¯å¢ƒå˜é‡é…ç½®æ£€æŸ¥**ï¼šç¡®è®¤å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼ˆVITE_SUPABASE_URLã€VITE_SUPABASE_ANON_KEYï¼‰æ˜¯å¦é…ç½®
- **æ„å»ºé…ç½®æ£€æŸ¥**ï¼šéªŒè¯ Vite å’Œ TypeScript é…ç½®æ˜¯å¦ç¬¦åˆæœ€ä½³å®è·µ
- **ç¼“å­˜é—®é¢˜æ£€æŸ¥**ï¼šè¯„ä¼° node_modules å’Œ dist ç›®å½•çš„çŠ¶æ€

è„šæœ¬çš„äº®ç‚¹åœ¨äºèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä¿®å¤è„šæœ¬ `fix-update-deployment.sh`ï¼ŒåŒ…å«æ¸…ç†ä¾èµ–ã€ç»Ÿä¸€åŒ…ç®¡ç†å™¨ã€é‡æ–°å®‰è£…ä¾èµ–ã€éªŒè¯æ„å»ºç­‰å®Œæ•´ä¿®å¤æµç¨‹ã€‚è¯Šæ–­ç»“æœä»¥ç»“æ„åŒ–æŠ¥å‘Šå½¢å¼è¾“å‡ºï¼Œæ˜ç¡®åŒºåˆ†é—®é¢˜ã€è­¦å‘Šå’Œå»ºè®®ï¼Œå¹¶æä¾›å¿«é€Ÿä¿®å¤æ­¥éª¤ã€‚

```mermaid
classDiagram
class UpdateDeploymentDiagnostic {
+Array issues
+Array warnings
+Array suggestions
+log(message, type)
+addIssue(message)
+addWarning(message)
+addSuggestion(message)
+checkPackageManagerConsistency()
+checkNetlifyConfig()
+checkDependencyIssues()
+checkEnvironmentVariables()
+checkBuildConfiguration()
+checkCacheIssues()
+generateFixScript()
+generateReport()
+runDiagnostic()
}
```

**å›¾æº**  
- [diagnose-update-issues.js](file://scripts/deployment/diagnose-update-issues.js#L1-L377)

**ä¸­æ–‡(ä¸­æ–‡)**
- [diagnose-update-issues.js](file://scripts/deployment/diagnose-update-issues.js#L1-L377)

## Netlifyæ ¹ç›®å½•é…ç½®ä¿®å¤

`fix-netlify-root-directory.mjs` ä¸“é—¨è§£å†³ Netlify éƒ¨ç½²ä¸­å¸¸è§çš„æ ¹ç›®å½•é…ç½®é”™è¯¯é—®é¢˜ã€‚å½“å‡ºç° "The specified Root Directory 'jiayuwee' does not exist" é”™è¯¯æ—¶ï¼Œæ­¤è„šæœ¬æä¾›å®Œæ•´çš„ä¿®å¤æŒ‡å¯¼ã€‚

è„šæœ¬æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. **é—®é¢˜åˆ†æ**ï¼šæ˜ç¡®æŒ‡å‡ºé”™è¯¯åŸå› å’Œè§£å†³æ–¹æ¡ˆ
2. **é¡¹ç›®ç»“æ„æ£€æŸ¥**ï¼šéªŒè¯å…³é”®æ–‡ä»¶ï¼ˆpackage.jsonã€netlify.tomlã€vite.config.tsï¼‰æ˜¯å¦å­˜åœ¨
3. **netlify.toml é…ç½®æ£€æŸ¥**ï¼šç¡®è®¤å‘å¸ƒç›®å½•å’Œæ„å»ºå‘½ä»¤é…ç½®æ­£ç¡®
4. **æä¾›è¯¦ç»†ä¿®å¤æ­¥éª¤**ï¼šæŒ‡å¯¼ç”¨æˆ·åœ¨ Netlify æ§åˆ¶å°ä¸­ä¿®æ”¹ Base directoryã€Build command å’Œ Publish directory è®¾ç½®
5. **ç¯å¢ƒå˜é‡æ£€æŸ¥**ï¼šæé†’ç”¨æˆ·ç¡®ä¿ VITE_SUPABASE_URL å’Œ VITE_SUPABASE_ANON_KEY å·²è®¾ç½®
6. **æä¾›å¿«é€Ÿé“¾æ¥**ï¼šåŒ…å« Netlify ç«™ç‚¹è®¾ç½®ã€ç¯å¢ƒå˜é‡ã€GitHub ä»“åº“å’Œéƒ¨ç½²æ—¥å¿—çš„ç›´æ¥è®¿é—®é“¾æ¥

è¯¥è„šæœ¬æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªäº¤äº’å¼æŒ‡å—ï¼Œé€šè¿‡è¯¦ç»†çš„æ–‡æœ¬è¾“å‡ºå¼•å¯¼ç”¨æˆ·å®Œæˆä¿®å¤è¿‡ç¨‹ï¼Œç‰¹åˆ«é€‚åˆæ–°æ‰‹å¼€å‘è€…å¿«é€Ÿè§£å†³é—®é¢˜ã€‚

**ä¸­æ–‡(ä¸­æ–‡)**
- [fix-netlify-root-directory.mjs](file://scripts/deployment/fix-netlify-root-directory.mjs#L1-L122)

## ä¾èµ–æ¸…ç†ç­–ç•¥

`clean-dependencies.js` å®ç°äº†ä¸€å¥—å®Œæ•´çš„ä¾èµ–æ¸…ç†å’Œé‡æ–°å®‰è£…ç­–ç•¥ï¼Œç”¨äºè§£å†³ä¾èµ–å†²çªæˆ–ç¼“å­˜æ±¡æŸ“é—®é¢˜ã€‚

è„šæœ¬æ‰§è¡Œä»¥ä¸‹æ¸…ç†æµç¨‹ï¼š
1. **åˆ é™¤ package-lock.json**ï¼šæ¸…é™¤æ—§çš„ä¾èµ–é”å®šä¿¡æ¯
2. **åˆ é™¤ node_modules**ï¼šå½»åº•æ¸…ç†å®‰è£…çš„ä¾èµ–åŒ…
3. **æ¸…ç† npm ç¼“å­˜**ï¼šä½¿ç”¨ `npm cache clean --force` æ¸…é™¤å…¨å±€ç¼“å­˜
4. **é‡æ–°å®‰è£…ä¾èµ–**ï¼šä½¿ç”¨ `npm install` é‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–ï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡é¿å…å¹³å°ç‰¹å®šä¾èµ–é—®é¢˜
5. **éªŒè¯å®‰è£…**ï¼šè¿è¡Œç±»å‹æ£€æŸ¥å’Œæ„å»ºæµ‹è¯•ï¼Œç¡®ä¿æ–°å®‰è£…çš„ä¾èµ–å·¥ä½œæ­£å¸¸

è„šæœ¬çš„å…³é”®ä¼˜åŠ¿åœ¨äºå…¶å¥å£®çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå½“æ¸…ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯æ—¶ï¼Œä¼šæä¾›è¯¦ç»†çš„æ•…éšœæ’é™¤å»ºè®®ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç£ç›˜ç©ºé—´ã€ç½‘ç»œè¿æ¥ã€Node.js ç‰ˆæœ¬å…¼å®¹æ€§ç­‰ã€‚æ¸…ç†å®Œæˆåï¼Œè„šæœ¬ä¼šè¾“å‡ºå®Œæˆçš„æ“ä½œæ¸…å•å’Œä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®ã€‚

```mermaid
flowchart TD
Start([å¼€å§‹æ¸…ç†]) --> DeleteLock["åˆ é™¤ package-lock.json"]
DeleteLock --> DeleteNodeModules["åˆ é™¤ node_modules"]
DeleteNodeModules --> CleanCache["æ¸…ç† npm ç¼“å­˜"]
CleanCache --> Reinstall["é‡æ–°å®‰è£…ä¾èµ–"]
Reinstall --> Validate["éªŒè¯å®‰è£…"]
Validate --> TypeCheck["è¿è¡Œç±»å‹æ£€æŸ¥"]
Validate --> BuildTest["è¿è¡Œæ„å»ºæµ‹è¯•"]
BuildTest --> Success["æ¸…ç†å®Œæˆ"]
BuildTest --> Failure["æ„å»ºæµ‹è¯•å¤±è´¥"]
Failure --> Troubleshooting["æä¾›æ•…éšœæ’é™¤å»ºè®®"]
Success --> End([ç»“æŸ])
Failure --> End
```

**å›¾æº**  
- [clean-dependencies.js](file://scripts/deployment/clean-dependencies.js#L1-L89)

**ä¸­æ–‡(ä¸­æ–‡)**
- [clean-dependencies.js](file://scripts/deployment/clean-dependencies.js#L1-L89)

## å¿«é€Ÿä¿®å¤æµç¨‹

`quick-fix-deployment.js` æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„å¿«é€Ÿä¿®å¤æµç¨‹ï¼ŒåŸºäº Context7 æœ€ä½³å®è·µï¼Œç”¨äºè§£å†³å¸¸è§çš„éƒ¨ç½²é—®é¢˜ã€‚

è„šæœ¬åŒ…å«ä»¥ä¸‹æ ¸å¿ƒå†…å®¹ï¼š
- **å½“å‰çŠ¶æ€æ£€æŸ¥**ï¼šæ˜ç¡®æŒ‡å‡º GitHub Actions æ„å»ºæˆåŠŸä½†ç½‘ç«™æ— æ³•è®¿é—®çš„é—®é¢˜
- **ç«‹å³è¡ŒåŠ¨æ­¥éª¤**ï¼šæä¾›å››æ­¥è¯Šæ–­æµç¨‹ï¼ŒåŒ…æ‹¬æ£€æŸ¥ Netlify ç«™ç‚¹çŠ¶æ€ã€éªŒè¯åŸŸåé…ç½®ã€æ£€æŸ¥æ„å»ºé…ç½®å’Œæµ‹è¯•æœ¬åœ°æ„å»º
- **å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**ï¼šé’ˆå¯¹åŸŸåé…ç½®ã€SSL è¯ä¹¦ã€æ„å»ºå¤±è´¥ç­‰å¸¸è§é—®é¢˜æä¾›å…·ä½“è§£å†³æ–¹æ¡ˆ
- **éªŒè¯æ­¥éª¤**ï¼šåˆ—å‡ºéƒ¨ç½²ä¿®å¤åçš„éªŒè¯æ¸…å•
- **åº”æ€¥å¤‡ç”¨æ–¹æ¡ˆ**ï¼šå½“é—®é¢˜æ— æ³•ç«‹å³è§£å†³æ—¶ï¼Œå»ºè®®ä½¿ç”¨ Netlify é»˜è®¤åŸŸåæˆ–å…¶ä»–éƒ¨ç½²å¹³å°

è¯¥è„šæœ¬çš„è®¾è®¡ç†å¿µæ˜¯"å¿«é€Ÿå“åº”ã€é€æ­¥æ’æŸ¥"ï¼Œé€šè¿‡ç»“æ„åŒ–çš„è¾“å‡ºå¼•å¯¼ç”¨æˆ·æŒ‰æ­¥éª¤è§£å†³é—®é¢˜ï¼Œç‰¹åˆ«é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒå‡ºç°ç´§æ€¥æ•…éšœæ—¶å¿«é€Ÿæ¢å¤æœåŠ¡ã€‚

**ä¸­æ–‡(ä¸­æ–‡)**
- [quick-fix-deployment.js](file://scripts/deployment/quick-fix-deployment.js#L1-L90)

## åŸŸåè¿ç§»è„šæœ¬è¯¦è§£

`netlify-domain-migration.js` å’Œ `netlify-domain-migration.ps1` æ˜¯ä¸€ç»„è·¨å¹³å°çš„åŸŸåè¿ç§»å·¥å…·ï¼Œç”¨äºåœ¨ Netlify ç«™ç‚¹ä¹‹é—´è¿ç§»è‡ªå®šä¹‰åŸŸåã€‚

### JavaScript ç‰ˆæœ¬åˆ†æ

JavaScript ç‰ˆæœ¬é‡‡ç”¨é¢å‘å¯¹è±¡è®¾è®¡ï¼Œé€šè¿‡ `NetlifyDomainMigrator` ç±»å°è£…æ‰€æœ‰åŠŸèƒ½ï¼š

```mermaid
classDiagram
class NetlifyDomainMigrator {
-string accessToken
-string baseUrl
-string apiVersion
+makeRequest(method, path, data)
+getSite(siteId)
+getAllSites()
+findSiteByDomain(domain)
+updateSiteDomain(siteId, customDomain, domainAliases)
+removeDomainFromSite(siteId)
+migrateDomain(domain, fromSiteId, toSiteId)
+autoMigrateDomain(domain, toSiteId)
}
```

**å›¾æº**  
- [netlify-domain-migration.js](file://scripts/deployment/netlify-domain-migration.js#L1-L276)

### PowerShell ç‰ˆæœ¬åˆ†æ

PowerShell ç‰ˆæœ¬æä¾›äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ›´é€‚åˆ Windows ç¯å¢ƒå’Œç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨ï¼š

```mermaid
flowchart TD
Start([å¼€å§‹è¿ç§»]) --> ValidateParams["éªŒè¯å‚æ•°"]
ValidateParams --> FindSourceSite["æŸ¥æ‰¾æºç«™ç‚¹"]
FindSourceSite --> VerifyTargetSite["éªŒè¯ç›®æ ‡ç«™ç‚¹"]
VerifyTargetSite --> RemoveDomain["ä»æºç«™ç‚¹ç§»é™¤åŸŸå"]
RemoveDomain --> Wait["ç­‰å¾…æ›´æ”¹ç”Ÿæ•ˆ"]
Wait --> AddDomain["æ·»åŠ åŸŸååˆ°ç›®æ ‡ç«™ç‚¹"]
AddDomain --> Success["è¿ç§»æˆåŠŸ"]
AddDomain --> Failure["è¿ç§»å¤±è´¥"]
Failure --> Troubleshooting["æä¾›æ•…éšœæ’é™¤å»ºè®®"]
Success --> End([ç»“æŸ])
Failure --> End
```

**å›¾æº**  
- [netlify-domain-migration.ps1](file://scripts/deployment/netlify-domain-migration.ps1#L1-L216)

### å…±åŒç‰¹æ€§

ä¸¤ä¸ªç‰ˆæœ¬éƒ½å®ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š
- **API å°è£…**ï¼šå°è£… Netlify API è°ƒç”¨ï¼Œå¤„ç†è®¤è¯å’Œé”™è¯¯
- **ç«™ç‚¹æŸ¥æ‰¾**ï¼šæ ¹æ®åŸŸåè‡ªåŠ¨æŸ¥æ‰¾å½“å‰ä½¿ç”¨çš„ç«™ç‚¹
- **è¿ç§»æµç¨‹**ï¼šå…ˆä»æºç«™ç‚¹ç§»é™¤åŸŸåï¼Œå†æ·»åŠ åˆ°ç›®æ ‡ç«™ç‚¹
- **é”™è¯¯å¤„ç†**ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ•…éšœæ’é™¤å»ºè®®
- **è¿›åº¦åé¦ˆ**ï¼šå®æ—¶è¾“å‡ºè¿ç§»è¿›åº¦å’Œç»“æœ

è„šæœ¬é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ¥æ”¶è®¿é—®ä»¤ç‰Œã€åŸŸåå’Œç›®æ ‡ç«™ç‚¹ IDï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ–çš„åŸŸåè¿ç§»æµç¨‹ï¼Œå¤§å¤§ç®€åŒ–äº†æ‰‹åŠ¨æ“ä½œçš„å¤æ‚æ€§ã€‚

**ä¸­æ–‡(ä¸­æ–‡)**
- [netlify-domain-migration.js](file://scripts/deployment/netlify-domain-migration.js#L1-L276)
- [netlify-domain-migration.ps1](file://scripts/deployment/netlify-domain-migration.ps1#L1-L216)

## CI/CDé›†æˆä¸è°ƒç”¨ç­–ç•¥

è¿™äº›è¯Šæ–­ä¸ä¿®å¤è„šæœ¬å¯ä»¥æ·±åº¦é›†æˆåˆ° CI/CD ç³»ç»Ÿä¸­ï¼Œå½¢æˆè‡ªåŠ¨åŒ–çš„éƒ¨ç½²ä¿éšœæœºåˆ¶ã€‚

### è°ƒç”¨æ—¶æœº

| è„šæœ¬ | è§¦å‘æ—¶æœº |
|------|----------|
| `diagnose-deployment.js` | éƒ¨ç½²å‰é¢„æ£€ã€éƒ¨ç½²å¤±è´¥åè‡ªåŠ¨è¯Šæ–­ |
| `diagnose-update-issues.js` | æ›´æ–°å‘å¸ƒå¤±è´¥æ—¶è‡ªåŠ¨è¿è¡Œ |
| `clean-dependencies.js` | ä¾èµ–ç›¸å…³é”™è¯¯æ—¶æ‰‹åŠ¨æˆ–è‡ªåŠ¨è§¦å‘ |
| `quick-fix-deployment.js` | ç”Ÿäº§ç¯å¢ƒç´§æ€¥æ•…éšœæ—¶å¿«é€Ÿå“åº” |
| `netlify-domain-migration.*` | åŸŸåå˜æ›´æˆ–ç«™ç‚¹è¿ç§»æ—¶ |

### é›†æˆç­–ç•¥

1. **GitHub Actions é›†æˆ**ï¼šåœ¨å·¥ä½œæµä¸­æ·»åŠ è¯Šæ–­æ­¥éª¤ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨è¿è¡Œç›¸åº”è„šæœ¬
2. **é¢„éƒ¨ç½²æ£€æŸ¥**ï¼šåœ¨éƒ¨ç½²å‰è¿è¡Œ `diagnose-deployment.js` å’Œ `check-netlify-config.js`
3. **å¤±è´¥åè‡ªåŠ¨è¯Šæ–­**ï¼šéƒ¨ç½²å¤±è´¥æ—¶è§¦å‘ `diagnose-update-issues.js` ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
4. **å®šæ—¶å¥åº·æ£€æŸ¥**ï¼šé€šè¿‡ `health-check.yml` å®šæœŸè¿è¡Œè¯Šæ–­è„šæœ¬
5. **æ‰‹åŠ¨ä¿®å¤å…¥å£**ï¼šåœ¨é¡¹ç›®æ–‡æ¡£ä¸­æä¾›æ¸…æ™°çš„è„šæœ¬è°ƒç”¨æŒ‡å—

### å®é™…æ¡ˆä¾‹

å½“å‡ºç°"æ›´æ–°å‘å¸ƒå¤±è´¥"é—®é¢˜æ—¶ï¼ŒCI/CD ç³»ç»Ÿå¯ä»¥ï¼š
1. è‡ªåŠ¨è¿è¡Œ `diagnose-update-issues.js` è¯Šæ–­é—®é¢˜
2. æ ¹æ®è¯Šæ–­ç»“æœç”Ÿæˆ `fix-update-deployment.sh` ä¿®å¤è„šæœ¬
3. é€šçŸ¥å¼€å‘è€…æŸ¥çœ‹è¯Šæ–­æŠ¥å‘Š
4. å¼€å‘è€…ç¡®è®¤åï¼Œå¯é€‰æ‹©è‡ªåŠ¨æ‰§è¡Œä¿®å¤è„šæœ¬
5. é‡æ–°è§¦å‘éƒ¨ç½²æµç¨‹

è¿™ç§é›†æˆç­–ç•¥å¤§å¤§æé«˜äº†é—®é¢˜è¯Šæ–­å’Œä¿®å¤çš„æ•ˆç‡ï¼Œå‡å°‘äº†äººå·¥å¹²é¢„çš„éœ€æ±‚ã€‚

**ä¸­æ–‡(ä¸­æ–‡)**
- [check-netlify-config.js](file://scripts/deployment/check-netlify-config.js#L1-L112)
- [check-deployment-status.js](file://scripts/deployment/check-deployment-status.js#L1-L192)

## è¯Šæ–­æ—¥å¿—åˆ†ææŒ‡å—

æœ‰æ•ˆçš„è¯Šæ–­æ—¥å¿—åˆ†ææ˜¯å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜çš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯é’ˆå¯¹æœ¬ç³»ç»Ÿè„šæœ¬çš„åˆ†ææŒ‡å—ï¼š

### æ—¥å¿—ç»“æ„

æ‰€æœ‰è„šæœ¬éƒ½é‡‡ç”¨ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼ï¼š
- **æ—¶é—´æˆ³**ï¼šæ¯æ¡æ—¥å¿—åŒ…å«æ—¶é—´ä¿¡æ¯
- **å›¾æ ‡æ ‡è¯†**ï¼šä½¿ç”¨è¡¨æƒ…ç¬¦å·åŒºåˆ†ä¿¡æ¯ç±»å‹ï¼ˆâœ…æˆåŠŸã€âŒé”™è¯¯ã€âš ï¸è­¦å‘Šã€ğŸ”§å»ºè®®ï¼‰
- **åˆ†ç±»è¾“å‡º**ï¼šå°†é—®é¢˜ã€è­¦å‘Šã€å»ºè®®åˆ†å¼€æ˜¾ç¤º
- **ç»“æ„åŒ–æŠ¥å‘Š**ï¼šæœ€ç»ˆç”ŸæˆåŒ…å«é—®é¢˜ã€è­¦å‘Šã€å»ºè®®å’Œä¿®å¤æ­¥éª¤çš„å®Œæ•´æŠ¥å‘Š

### åˆ†ææ–¹æ³•

1. **ä»é”™è¯¯å¼€å§‹**ï¼šé¦–å…ˆå…³æ³¨ `âŒ` æ ‡è¯†çš„é”™è¯¯ä¿¡æ¯
2. **æ£€æŸ¥è­¦å‘Š**ï¼šç„¶åæŸ¥çœ‹ `âš ï¸` æ ‡è¯†çš„æ½œåœ¨é—®é¢˜
3. **æ‰§è¡Œå»ºè®®**ï¼šæŒ‰ç…§ `ğŸ”§` æ ‡è¯†çš„å»ºè®®é€æ­¥ä¿®å¤
4. **éªŒè¯ç»“æœ**ï¼šä¿®å¤åé‡æ–°è¿è¡Œè¯Šæ–­è„šæœ¬éªŒè¯æ•ˆæœ

### å¸¸è§æ¨¡å¼

| æ—¥å¿—æ¨¡å¼ | å«ä¹‰ | è§£å†³æ–¹æ¡ˆ |
|---------|------|----------|
| "åŒæ—¶å­˜åœ¨ package-lock.json å’Œ yarn.lock" | åŒ…ç®¡ç†å™¨å†²çª | ç»Ÿä¸€ä½¿ç”¨ä¸€ç§åŒ…ç®¡ç†å™¨ |
| "netlify.toml ä½¿ç”¨ npm ci ä½†é¡¹ç›®æœ‰ yarn.lock" | æ„å»ºé…ç½®ä¸ä¸€è‡´ | ç»Ÿä¸€æ„å»ºå‘½ä»¤ |
| "node_modules å·²è¶…è¿‡ 24 å°æ—¶æœªæ›´æ–°" | ç¼“å­˜è€åŒ– | æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ– |
| "ç¼ºå°‘ VITE_SUPABASE_URL" | ç¯å¢ƒå˜é‡ç¼ºå¤± | åœ¨ Netlify æ§åˆ¶å°è®¾ç½®ç¯å¢ƒå˜é‡ |

### é«˜çº§æŠ€å·§

- **å¯¹æ¯”åˆ†æ**ï¼šæ¯”è¾ƒæˆåŠŸå’Œå¤±è´¥éƒ¨ç½²çš„è¯Šæ–­æ—¥å¿—å·®å¼‚
- **è¶‹åŠ¿åˆ†æ**ï¼šå®šæœŸè¿è¡Œè¯Šæ–­è„šæœ¬ï¼Œè§‚å¯Ÿé—®é¢˜å‘å±•è¶‹åŠ¿
- **è‡ªåŠ¨åŒ–åˆ†æ**ï¼šç¼–å†™è„šæœ¬è‡ªåŠ¨è§£æè¯Šæ–­æ—¥å¿—ï¼Œæå–å…³é”®é—®é¢˜
- **çŸ¥è¯†åº“æ„å»º**ï¼šå°†å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆæ•´ç†æˆçŸ¥è¯†åº“

é€šè¿‡ç³»ç»ŸåŒ–çš„æ—¥å¿—åˆ†æï¼Œå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜æ ¹æºï¼Œé¿å…é‡å¤æ’æŸ¥ï¼Œæé«˜è¿ç»´æ•ˆç‡ã€‚

**ä¸­æ–‡(ä¸­æ–‡)**
- [diagnose-deployment.js](file://scripts/deployment/diagnose-deployment.js#L1-L170)
- [diagnose-update-issues.js](file://scripts/deployment/diagnose-update-issues.js#L1-L377)

## ç»“è®º

æœ¬å¥—éƒ¨ç½²è¯Šæ–­ä¸ä¿®å¤è„šæœ¬ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ¶µç›–äº†ä»é—®é¢˜è¯Šæ–­åˆ°è‡ªåŠ¨ä¿®å¤çš„å…¨æµç¨‹ã€‚é€šè¿‡ `diagnose-deployment.js` å’Œ `diagnose-update-issues.js` çš„æ·±åº¦åˆ†æèƒ½åŠ›ï¼Œ`fix-netlify-root-directory.mjs` çš„ç²¾å‡†ä¿®å¤åŠŸèƒ½ï¼Œ`clean-dependencies.js` çš„å½»åº•æ¸…ç†ç­–ç•¥ï¼Œ`quick-fix-deployment.js` çš„å¿«é€Ÿå“åº”æœºåˆ¶ï¼Œä»¥åŠ `netlify-domain-migration` ç³»åˆ—è„šæœ¬çš„è·¨å¹³å°è¿ç§»èƒ½åŠ›ï¼Œå½¢æˆäº†ä¸€ä¸ªå¼ºå¤§çš„éƒ¨ç½²ä¿éšœä½“ç³»ã€‚

è¿™äº›è„šæœ¬ä¸ä»…èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å’Œè§£å†³éƒ¨ç½²é—®é¢˜ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸ CI/CD ç³»ç»Ÿçš„æ·±åº¦é›†æˆï¼Œå®ç°è‡ªåŠ¨åŒ–çš„é—®é¢˜è¯Šæ–­å’Œä¿®å¤ï¼Œå¤§å¤§æé«˜äº†éƒ¨ç½²çš„å¯é æ€§å’Œæ•ˆç‡ã€‚ç»“åˆç³»ç»Ÿçš„è¯Šæ–­æ—¥å¿—åˆ†ææŒ‡å—ï¼Œå›¢é˜Ÿå¯ä»¥å»ºç«‹æ ‡å‡†åŒ–çš„é—®é¢˜å¤„ç†æµç¨‹ï¼Œç§¯ç´¯è¿ç»´çŸ¥è¯†ï¼ŒæŒç»­ä¼˜åŒ–éƒ¨ç½²å®è·µã€‚

æœªæ¥å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•è¿™äº›è„šæœ¬çš„åŠŸèƒ½ï¼Œå¦‚å¢åŠ æ›´å¤šè‡ªåŠ¨åŒ–ä¿®å¤åœºæ™¯ã€æ”¯æŒæ›´å¤šéƒ¨ç½²å¹³å°ã€é›†æˆç›‘æ§å‘Šè­¦ç³»ç»Ÿç­‰ï¼Œæ„å»ºæ›´åŠ æ™ºèƒ½å’Œå…¨é¢çš„éƒ¨ç½²è¿ç»´ä½“ç³»ã€‚