# å·¥ä½œæµä¼˜åŒ–æ€»ç»“æŠ¥å‘Š

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

æœ¬æ¬¡å…¨å±€å·¥ä½œæµæ£€æŸ¥å’Œä¼˜åŒ–æ¶µç›–äº†ä»¥ä¸‹å‡ ä¸ªå…³é”®æ–¹é¢ï¼š

### âœ… å·²å®Œæˆçš„ä¼˜åŒ–

1. **æ¸…ç†é‡å¤çš„å·¥ä½œæµæ–‡ä»¶**
2. **éªŒè¯ GitHub Secrets é…ç½®**
3. **ä¼˜åŒ–ä¾èµ–ç®¡ç†**
4. **æµ‹è¯•å®Œæ•´éƒ¨ç½²æµç¨‹**
5. **è®¾ç½®ç›‘æ§å’Œå‘Šè­¦**

## ğŸ”§ å…·ä½“ä¼˜åŒ–å†…å®¹

### 1. å·¥ä½œæµæ–‡ä»¶æ¸…ç†

**é—®é¢˜**: å­˜åœ¨å¤šä¸ªé‡å¤å’Œæµ‹è¯•æ€§çš„ GitHub Actions å·¥ä½œæµæ–‡ä»¶
**è§£å†³æ–¹æ¡ˆ**:

- åˆ é™¤äº†é‡å¤çš„å·¥ä½œæµæ–‡ä»¶ï¼š
  - `simple-test.yml`
  - `test-basic.yml`
  - `supabase-deploy.yml`
  - `supabase-deploy-simple.yml`
- ä¿ç•™äº†æ ¸å¿ƒå·¥ä½œæµï¼š
  - `deploy.yml` - ä¸»è¦éƒ¨ç½²å·¥ä½œæµ
  - `supabase-deploy-fixed.yml` - Supabase éƒ¨ç½²å·¥ä½œæµ
  - `ci.yml` - æŒç»­é›†æˆå·¥ä½œæµ
  - `health-check.yml` - æ–°å¢çš„å¥åº·æ£€æŸ¥å·¥ä½œæµ

### 2. GitHub Secrets é…ç½®éªŒè¯

**æ–°å¢å·¥å…·**: `scripts/deployment/check-github-secrets.js`
**åŠŸèƒ½**:

- æ£€æŸ¥æ‰€æœ‰å¿…éœ€çš„ GitHub Secrets é…ç½®
- æä¾›è¯¦ç»†çš„é…ç½®æŒ‡å—
- æµ‹è¯•æœ¬åœ°ç¯å¢ƒå˜é‡
- éªŒè¯ Supabase è¿æ¥

**ä½¿ç”¨æ–¹æ³•**:

```bash
npm run secrets:check
```

### 3. ä¾èµ–ç®¡ç†ä¼˜åŒ–

**é—®é¢˜**: package-lock.json åŒ…å« Windows ç‰¹å®šä¾èµ–ï¼Œå½±å“ Netlify æ„å»º
**è§£å†³æ–¹æ¡ˆ**:

- åˆ›å»ºäº† `.npmrc` é…ç½®æ–‡ä»¶ï¼Œç¦ç”¨å¹³å°ç‰¹å®šä¾èµ–
- æ›´æ–°äº† `netlify.toml` æ„å»ºé…ç½®
- æ–°å¢ä¾èµ–æ¸…ç†è„šæœ¬ `scripts/deployment/clean-dependencies.js`

**æ–°å¢é…ç½®**:

```toml
# netlify.toml
[build.environment]
  NPM_CONFIG_OPTIONAL = "false"
  NPM_CONFIG_TARGET_PLATFORM = ""
  NPM_CONFIG_TARGET_ARCH = ""
```

**ä½¿ç”¨æ–¹æ³•**:

```bash
npm run deps:clean  # æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
```

### 4. å®Œæ•´éƒ¨ç½²æµç¨‹æµ‹è¯•

**æ–°å¢å·¥å…·**: `scripts/deployment/test-deployment-workflow.js`
**æµ‹è¯•é¡¹ç›®**:

- ç¯å¢ƒæ£€æŸ¥ (Node.js ç‰ˆæœ¬ã€ç¯å¢ƒå˜é‡)
- ä¾èµ–å®‰è£…æµ‹è¯•
- ä»£ç è´¨é‡æ£€æŸ¥ (ESLintã€TypeScript)
- æ„å»ºæµ‹è¯•
- Supabase è¿æ¥æµ‹è¯•
- ç½‘ç«™å¯è®¿é—®æ€§æµ‹è¯•

**ä½¿ç”¨æ–¹æ³•**:

```bash
npm run test:deployment
```

### 5. ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

**æ–°å¢å·¥å…·**: `scripts/deployment/monitor-deployment.js`
**ç›‘æ§é¡¹ç›®**:

- ç½‘ç«™å¯è®¿é—®æ€§ç›‘æ§
- GitHub Actions çŠ¶æ€ç›‘æ§
- Supabase æ•°æ®åº“å¥åº·æ£€æŸ¥

**æ–°å¢å·¥ä½œæµ**: `.github/workflows/health-check.yml`

- æ¯å°æ—¶è‡ªåŠ¨è¿è¡Œå¥åº·æ£€æŸ¥
- å¤±è´¥æ—¶è‡ªåŠ¨åˆ›å»º GitHub Issue
- æ”¯æŒæ‰‹åŠ¨è§¦å‘

**ä½¿ç”¨æ–¹æ³•**:

```bash
npm run monitor:health  # å•æ¬¡å¥åº·æ£€æŸ¥
npm run monitor:watch   # æŒç»­ç›‘æ§æ¨¡å¼
```

## ğŸ“Š å·¥ä½œæµæ¶æ„

### å½“å‰å·¥ä½œæµç»“æ„

```
.github/workflows/
â”œâ”€â”€ ci.yml                    # æŒç»­é›†æˆ (ä»£ç æ£€æŸ¥ã€æ„å»ºæµ‹è¯•)
â”œâ”€â”€ deploy.yml               # ä¸»è¦éƒ¨ç½² (Netlify è‡ªåŠ¨éƒ¨ç½²)
â”œâ”€â”€ supabase-deploy-fixed.yml # Supabase éƒ¨ç½² (æ•°æ®åº“è¿ç§»)
â””â”€â”€ health-check.yml         # å¥åº·æ£€æŸ¥ (ç³»ç»Ÿç›‘æ§)
```

### å·¥ä½œæµè§¦å‘æ¡ä»¶

| å·¥ä½œæµ          | è§¦å‘æ¡ä»¶                 | åŠŸèƒ½                    |
| --------------- | ------------------------ | ----------------------- |
| CI              | æ¨é€ã€PR                 | ä»£ç è´¨é‡æ£€æŸ¥å’Œæ„å»ºæµ‹è¯•  |
| Deploy          | æ¨é€åˆ° main              | å‰ç«¯æ„å»ºå’Œ Netlify éƒ¨ç½² |
| Supabase Deploy | supabase/ å˜æ›´ã€æ‰‹åŠ¨è§¦å‘ | æ•°æ®åº“è¿ç§»å’Œå®Œæ•´éƒ¨ç½²    |
| Health Check    | æ¯å°æ—¶ã€æ‰‹åŠ¨è§¦å‘         | ç³»ç»Ÿå¥åº·ç›‘æ§            |

## ğŸ” å¿…éœ€çš„ GitHub Secrets

ç¡®ä¿ä»¥ä¸‹ Secrets å·²åœ¨ GitHub ä»“åº“ä¸­é…ç½®ï¼š

| Secret åç§°              | æè¿°              | è·å–æ–¹å¼                                                     |
| ------------------------ | ----------------- | ------------------------------------------------------------ |
| `SUPABASE_ACCESS_TOKEN`  | Supabase è®¿é—®ä»¤ç‰Œ | Supabase Dashboard > Settings > API > Personal access tokens |
| `SUPABASE_PROJECT_REF`   | é¡¹ç›®å¼•ç”¨ ID       | æ‚¨çš„é¡¹ç›® ID: ndmxwdejswybvbwrxsai                            |
| `VITE_SUPABASE_URL`      | é¡¹ç›® API URL      | æ‚¨çš„ URL: https://fytiwsutzgmygfxnqoft.supabase.co           |
| `VITE_SUPABASE_ANON_KEY` | é¡¹ç›®åŒ¿åå¯†é’¥      | Supabase Dashboard > Settings > API                          |

## ğŸš€ éƒ¨ç½²æµç¨‹

### æ­£å¸¸éƒ¨ç½²æµç¨‹

1. **ä»£ç æäº¤** â†’ æ¨é€åˆ° main åˆ†æ”¯
2. **CI æ£€æŸ¥** â†’ ä»£ç è´¨é‡å’Œæ„å»ºæµ‹è¯•
3. **è‡ªåŠ¨éƒ¨ç½²** â†’ Netlify è‡ªåŠ¨æ‹‰å–å¹¶éƒ¨ç½²
4. **å¥åº·æ£€æŸ¥** â†’ æ¯å°æ—¶éªŒè¯ç³»ç»ŸçŠ¶æ€

### Supabase éƒ¨ç½²æµç¨‹

1. **æ•°æ®åº“å˜æ›´** â†’ ä¿®æ”¹ supabase/ ç›®å½•
2. **å·¥ä½œæµè§¦å‘** â†’ è‡ªåŠ¨æˆ–æ‰‹åŠ¨è§¦å‘ Supabase éƒ¨ç½²
3. **æ•°æ®åº“è¿ç§»** â†’ è¿è¡Œ supabase db push
4. **å‰ç«¯æ„å»º** â†’ æ„å»ºå¹¶å‡†å¤‡éƒ¨ç½²
5. **éªŒè¯éƒ¨ç½²** â†’ æ£€æŸ¥éƒ¨ç½²çŠ¶æ€

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

1. **æ„å»ºå¤±è´¥**
   - è¿è¡Œ `npm run deps:clean` æ¸…ç†ä¾èµ–
   - æ£€æŸ¥ Node.js ç‰ˆæœ¬ (éœ€è¦ >= 18)
   - æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯

2. **Supabase è¿æ¥å¤±è´¥**
   - è¿è¡Œ `npm run secrets:check` éªŒè¯é…ç½®
   - æ£€æŸ¥ Supabase é¡¹ç›®çŠ¶æ€
   - ç¡®è®¤ API å¯†é’¥æƒé™

3. **éƒ¨ç½²å·¥ä½œæµå¤±è´¥**
   - æ£€æŸ¥ GitHub Secrets é…ç½®
   - æŸ¥çœ‹å·¥ä½œæµè¿è¡Œæ—¥å¿—
   - è¿è¡Œ `npm run test:deployment` æœ¬åœ°æµ‹è¯•

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### è‡ªåŠ¨ç›‘æ§

- **å¥åº·æ£€æŸ¥**: æ¯å°æ—¶è‡ªåŠ¨è¿è¡Œ
- **å¤±è´¥å‘Šè­¦**: è‡ªåŠ¨åˆ›å»º GitHub Issue
- **çŠ¶æ€æŠ¥å‘Š**: è¯¦ç»†çš„å¥åº·çŠ¶æ€æŠ¥å‘Š

### æ‰‹åŠ¨æ£€æŸ¥

```bash
# æ£€æŸ¥ GitHub Secrets é…ç½®
npm run secrets:check

# æµ‹è¯•å®Œæ•´éƒ¨ç½²æµç¨‹
npm run test:deployment

# è¿è¡Œå¥åº·æ£€æŸ¥
npm run monitor:health

# å¯åŠ¨æŒç»­ç›‘æ§
npm run monitor:watch
```

## ğŸ”— æœ‰ç”¨çš„é“¾æ¥

- ğŸŒ [ç”Ÿäº§ç½‘ç«™](https://ramusi.cn)
- ğŸ“Š [GitHub Actions](https://github.com/jiayuwee/advanced-tools-navigation/actions)
- ğŸ“¦ [Netlify æ§åˆ¶å°](https://app.netlify.com/sites/spiffy-torrone-5454e1/deploys)
- ğŸ—„ï¸ [Supabase æ§åˆ¶å°](https://supabase.com/dashboard/project/ndmxwdejswybvbwrxsai)

## âœ… ä¼˜åŒ–æˆæœ

é€šè¿‡æœ¬æ¬¡ä¼˜åŒ–ï¼Œé¡¹ç›®çš„å·¥ä½œæµç°åœ¨å…·å¤‡äº†ï¼š

1. **æ›´æ¸…æ™°çš„å·¥ä½œæµç»“æ„** - æ¶ˆé™¤äº†é‡å¤å’Œå†²çª
2. **å®Œå–„çš„é…ç½®éªŒè¯** - ç¡®ä¿éƒ¨ç½²ç¯å¢ƒæ­£ç¡®
3. **è·¨å¹³å°å…¼å®¹æ€§** - è§£å†³äº†ä¾èµ–ç®¡ç†é—®é¢˜
4. **å…¨é¢çš„æµ‹è¯•è¦†ç›–** - éªŒè¯æ•´ä¸ªéƒ¨ç½²æµç¨‹
5. **ä¸»åŠ¨ç›‘æ§ç³»ç»Ÿ** - åŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜

è¿™äº›æ”¹è¿›å¤§å¤§æé«˜äº†éƒ¨ç½²çš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
